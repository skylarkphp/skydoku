/**
 * skylark-widgets-gradienter - The skylark gradient picker widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-gradienter/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-eventer","skylark-domx-finder","skylark-domx-query","skylark-data-color/colors","skylark-data-color/Color","skylark-widgets-swt/swt","skylark-widgets-swt/Widget","skylark-widgets-colorpicker/ColorPicker","./Drag"],function(e,t,i,r,s,a,d,n,o,l,_,g,c){"use strict";void 0===d.fn.draggable&&(d.fn.draggable=function(){var e=document.getElementById(this.attr("id"));return e.style.top="121px",c.init(e,null,26,426,86,86),this});return e.attach("widgets.Gradienter",function(e,i){var r={targets:[],sliders:[],direction:"left",type:"linear",code_shown:!1,change:function(e,t){}},s=c.gradx={rand_RGB:[],rand_pos:[],id:null,slider_ids:[],slider_index:0,sliders:[],direction:"left",type:"linear",shape:"cover",slider_hovered:[],jQ_present:!0,code_shown:!1,load_jQ:function(){this.gx=d},add_event:function(e,t,i){var r,s,a;s=t,a=i,(r=e).attachEvent?r.attachEvent("on"+s,function(){a.call(r)}):r.addEventListener&&r.addEventListener(s,a,!1)},get_random_position:function(){var e;do{e=parseInt(100*Math.random())}while(this.rand_pos.indexOf(e)>-1);return this.rand_pos.push(e),e},get_random_rgb:function(){var e;do{e="rgb("+parseInt(255*Math.random())+", "+parseInt(255*Math.random())+", "+parseInt(255*Math.random())+")"}while(this.rand_RGB.indexOf(e)>-1);return this.rand_RGB.push(e),e},update_target:function(e){if(this.targets.length>0){var t,i,r,a=this.targets.length,d=e.length;for(t=0;t<a;t++)for(r=s.gx(this.targets[t]),i=0;i<d;i++)r.css("background-image",e[i])}},apply_style:function(e,t){var i="linear";if("linear"!=s.type&&(i="radial"),t.indexOf(this.direction)>-1)var r=["-webkit-"+i+"-gradient("+t+")","-moz-"+i+"-gradient("+t+")","-ms-"+i+"-gradient("+t+")","-o-"+i+"-gradient("+t+")",i+"-gradient("+t+")"];else r=[t];for(var a=r.length,d="";a>0;)a--,e.css("background",r[a]),d+="background: "+r[a]+";\n";this.change(this.sliders,r),this.update_target(r),s.gx("#gradx_code").html(d)},apply_default_styles:function(){this.update_style_array();var e=this.get_style_value();this.apply_style(this.panel,e)},update_style_array:function(){this.sliders=[];var e,t,i,r,a=s.slider_ids.length;for(e=0;e<a;e++)r="#"+s.slider_ids[e],t=parseInt(s.gx(r).css("left")),i=parseInt(t/s.container_width*100),i-=6,s.sliders.push([s.gx(r).css("background-color"),i]);this.sliders.sort(function(e,t){return e[1]>t[1]?1:-1})},get_style_value:function(){var e=s.slider_ids.length;if(1===e)t=this.sliders[0][0];else{for(var t="",i="",r=0;r<e;r++)""==this.sliders[r][1]?t+=i+this.sliders[r][0]:(this.sliders[r][1]>100&&(this.sliders[r][1]=100),t+=i+(this.sliders[r][0]+" ")+this.sliders[r][1]+"%"),i=" , ";t="linear"==this.type?this.direction+" , "+t:this.direction+" , "+this.type+" "+this.shape+" , "+t}return t},get_rgb_obj:function(e){return e=(e=(e=e.split("("))[1]).split(","),{r:parseInt(e[0]),g:parseInt(e[1]),b:parseInt(e[2])}},load_info:function(e){var t="#"+e.id;if(this.current_slider_id=t,this.slider_ids.indexOf(e.id)>-1){var i=s.gx(t).css("backgroundColor"),r=this.get_rgb_obj(i),a=s.gx(t).css("left");parseInt(a)>26&&parseInt(a)<426&&s.gx("#gradx_slider_info").css("left",a).show(),this.set_colorpicker(r),console.log(r)}},add_slider:function(e){var t,i,r,a;0===e.length&&(e=[{color:s.get_random_rgb(),position:s.get_random_position()},{color:s.get_random_rgb(),position:s.get_random_position()}]);var d=e;for(r in d){if(void 0===d[r].position)break;var n=26;a=parseInt(d[r].position*this.container_width/100)+n+"px",t="gradx_slider_"+this.slider_index,this.sliders.push([d[r].color,d[r].position]),this.slider_ids.push(t),i="<div class='gradx_slider' id='"+t+"'></div>",s.gx("#gradx_start_sliders_"+this.id).append(i),s.gx("#"+t).css("backgroundColor",d[r].color).css("left",a),this.slider_index++}for(var o=0,l=this.slider_ids.length;o<l;o++)s.gx("#"+this.slider_ids[o]).draggable({containment:"parent",axis:"x",start:function(){s.jQ_present&&(s.current_slider_id="#"+s.gx(this).attr("id"))},drag:function(){s.update_style_array(),s.apply_style(s.panel,s.get_style_value());var e=s.gx(s.current_slider_id).css("left");parseInt(e)>26&&parseInt(e)<426&&s.gx("#gradx_slider_info").css("left",e).show();var t=s.gx(s.current_slider_id).css("backgroundColor"),i=s.get_rgb_obj(t);s.cp.colorPicker("set",i)}}).click(function(){return s.load_info(this),!1})},set_colorpicker:function(e){s.cp.colorPicker({move:function(e){if(0!=s.current_slider_id){var t=e.toRgbString();s.gx(s.current_slider_id).css("background-color",t),s.update_style_array(),s.apply_style(s.panel,s.get_style_value())}},change:function(){s.gx("#gradx_slider_info").hide()},flat:!0,showAlpha:!0,color:e,clickoutFiresChange:!0,showInput:!0,showButtons:!1})},generate_options:function(e){for(var t,i,r=e.length,s="",a=0;a<r;a++)t=(t=e[a].split(" "))[0],i=a<2?t[1]:"",t=t.replace("-"," "),s+="<option value="+e[a]+" "+i+">"+t+"</option>";return s},generate_radial_options:function(){var e;e=["horizontal-center disabled","center selected","left","right"],s.gx("#gradx_gradient_subtype").html(s.generate_options(e)),e=["vertical-center disabled","center selected","top","bottom"],s.gx("#gradx_gradient_subtype2").html(s.generate_options(e)).show()},generate_linear_options:function(){var e;e=["horizontal-center disabled","left selected","right","top","bottom"],s.gx("#gradx_gradient_subtype").html(s.generate_options(e)),s.gx("#gradx_gradient_subtype2").hide()},destroy:function(){var e={targets:[],sliders:[],direction:"left",type:"linear",code_shown:!1,change:function(e,t){}};for(var t in e)s[t]=e[t]},load_gradx:function(e,t){this.me=s.gx(e),this.id=e.replace("#",""),e=this.id,this.current_slider_id=!1;var i,r="<div class='gradx'>\n                            <div id='gradx_add_slider' class='gradx_add_slider gradx_btn'><i class='icon icon-add'></i>add</div>\n                            <div class='gradx_slectboxes'>\n                            <select id='gradx_gradient_type' class='gradx_gradient_type'>\n                                <option value='linear'>Linear</option>\n                                <option value='circle'>Radial - Circle</option>\n                                <option value='ellipse'>Radial - Ellipse</option>\n                            </select>\n                            <select id='gradx_gradient_subtype' class='gradx_gradient_type'>\n                                <option id='gradx_gradient_subtype_desc' value='gradient-direction' disabled>gradient direction</option>\n                                <option value='left' selected>Left</option>\n                                <option value='right'>Right</option>\n                                <option value='top'>Top</option>\n                                <option value='bottom'>Bottom</option>\n                            </select>\n                            <select id='gradx_gradient_subtype2' class='gradx_gradient_type gradx_hide'>\n                            </select>\n                            <select id='gradx_radial_gradient_size' class='gradx_gradient_type gradx_hide'>\n                            </select>\n                            </div>\n                            <div class='gradx_container' id='gradx_"+e+"'>\n                                <div id='gradx_stop_sliders_"+e+"'></div>\n                                <div class='gradx_panel' id='gradx_panel_"+e+"'></div>\n                                <div class='gradx_start_sliders' id='gradx_start_sliders_"+e+"'>\n                                    <div class='cp-default' id='gradx_slider_info'>\n                                        <div id='gradx_slider_controls'>\n                                            <div id='gradx_delete_slider' class='gradx_btn'><i class='icon icon-remove'></i>delete</div>\n                                        </div>\n                                        <div id='gradx_slider_content'></div>\n                                    </div> \n                                </div>\n                            </div>\n                            <div id='gradx_show_code' class='gradx_show_code gradx_btn'><i class='icon icon-file-css'></i><span>show the code</span></div>\n                            <div id='gradx_show_presets' style='display:none' class='gradx_show_presets gradx_btn'><i class='icon icon-preset'></i><span>show presets</span></div>\n                            <textarea class='gradx_code' id='gradx_code'></textarea>\n                        </div>";if(this.me.html(r),i=s.generate_options(["gradient-size disabled","closest-side selected","closest-corner","farthest-side","farthest-corner","contain","cover"]),s.gx("#gradx_radial_gradient_size").html(i),this.container=s.gx("#gradx_"+e),this.panel=s.gx("#gradx_panel_"+e),this.container_width=400,this.add_slider(t),s.add_event(document,"click",function(){if(!s.slider_hovered[e])return s.gx("#gradx_slider_info").hide(),!1}),s.gx("#gradx_add_slider").click(function(){s.add_slider([{color:s.get_random_rgb(),position:s.get_random_position()}]),s.update_style_array(),s.apply_style(s.panel,s.get_style_value())}),s.cp=s.gx("#gradx_slider_content"),s.set_colorpicker("blue"),s.gx("#gradx_delete_slider").click(function(){s.gx(s.current_slider_id).remove(),s.gx("#gradx_slider_info").hide();for(var e=s.current_slider_id.replace("#",""),t=0;t<s.slider_ids.length;t++)s.slider_ids[t]==e&&s.slider_ids.splice(t,1);s.update_style_array(),s.apply_style(s.panel,s.get_style_value()),s.current_slider_id=!1}),s.gx("#gradx_code").focus(function(){var e=s.gx(this);e.select(),e.mouseup(function(){return e.off("mouseup"),!1})}),s.gx("#gradx_gradient_type").change(function(){var e=s.gx(this).val();"linear"!==e?s.generate_radial_options():(s.generate_linear_options(),s.gx("#gradx_gradient_subtype").val("left")),s.type=e,s.direction=s.gx("#gradx_gradient_subtype").val(),s.apply_style(s.panel,s.get_style_value())}),"linear"!==this.type){var a;if(s.gx("#gradx_gradient_type").val(this.type),s.generate_radial_options(),"left"!==this.direction)d=(a=this.direction.indexOf(",")>-1?this.direction.split(","):this.direction.split(" "))[0],n=a[1],s.gx("#gradx_gradient_subtype").val(d),s.gx("#gradx_gradient_subtype2").val(n);else var d=s.gx("#gradx_gradient_subtype").val(),n=s.gx("#gradx_gradient_subtype2").val();s.direction=d+" "+n,s.apply_style(s.panel,s.get_style_value())}else"left"!==this.direction&&s.gx("#gradx_gradient_subtype").val(this.direction);s.gx("#gradx_gradient_subtype").change(function(){if("linear"===s.type)s.direction=s.gx(this).val();else{var e=s.gx(this).val(),t=s.gx("#gradx_gradient_subtype2").val();s.direction=e+" "+t}s.apply_style(s.panel,s.get_style_value())}),s.gx("#gradx_gradient_subtype2").change(function(){var e=s.gx("#gradx_gradient_subtype").val(),t=s.gx(this).val();s.direction=e+" "+t,s.apply_style(s.panel,s.get_style_value())}),s.gx("#gradx_radial_gradient_size").change(function(){s.shape=s.gx(this).val(),s.apply_style(s.panel,s.get_style_value())}),s.gx("#gradx_show_code").click(function(){s.code_shown?(s.code_shown=!1,s.gx("#gradx_show_code span").text("show the code"),s.gx("#gradx_code").hide()):(s.gx("#gradx_show_code span").text("hide the code"),s.gx("#gradx_code").show(),s.code_shown=!0)}),s.code_shown&&(s.gx("#gradx_show_code span").text("hide the code"),s.gx("#gradx_code").show()),s.add_event(document.getElementById("gradx_slider_info"),"mouseout",function(){s.slider_hovered[e]=!1}),s.add_event(document.getElementById("gradx_slider_info"),"mouseover",function(){s.slider_hovered[e]=!0})}};for(var a in s.load_jQ(),t.mixin(r,i),r)s[a]=r[a];s.load_gradx(e,s.sliders),s.apply_default_styles()})});
//# sourceMappingURL=sourcemaps/Gradienter.js.map
