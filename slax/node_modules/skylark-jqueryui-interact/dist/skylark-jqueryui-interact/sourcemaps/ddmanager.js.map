{"version":3,"sources":["ddmanager.js"],"names":["define","langx","ddmanager","current","droppables","default","prepareOffsets","t","event","i","j","m","options","scope","type","list","currentItem","element","find","addBack","droppablesLoop","length","disabled","accept","call","proportions","height","visible","css","_activate","offset","width","offsetWidth","offsetHeight","drop","draggable","dropped","each","slice","this","intersect","tolerance","_drop","isout","isover","_deactivate","dragStart","parentsUntil","on","refreshPositions","drag","greedyChild","parentInstance","parent","intersects","c","greedy","parents","filter","$","droppable","_out","_over","dragStop","off","isOverAxis","x","reference","size","toleranceMode","x1","positionAbs","position","absolute","left","margins","y1","top","x2","helperProportions","y2","l","r","b","pageY","pageX"],"mappings":"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","file":"../ddmanager.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\"\r\n],function(langx) {\r\n\t/*\r\n\t * This manager tracks offsets of draggables and droppables\r\n\t */\r\n\tvar ddmanager = {\r\n\t\tcurrent: null,\r\n\t\tdroppables: { \"default\": [] },\r\n\t\tprepareOffsets: function( t, event ) {\r\n\r\n\t\t\tvar i, j,\r\n\t\t\t\tm = ddmanager.droppables[ t.options.scope ] || [],\r\n\t\t\t\ttype = event ? event.type : null, // workaround for #2317\r\n\t\t\t\tlist = ( t.currentItem || t.element ).find( \":data(ui-droppable)\" ).addBack();\r\n\r\n\t\t\tdroppablesLoop: for ( i = 0; i < m.length; i++ ) {\r\n\r\n\t\t\t\t// No disabled and non-accepted\r\n\t\t\t\tif ( m[ i ].options.disabled || ( t && !m[ i ].accept.call( m[ i ].element[ 0 ],\r\n\t\t\t\t\t\t( t.currentItem || t.element ) ) ) ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Filter out elements in the current dragged item\r\n\t\t\t\tfor ( j = 0; j < list.length; j++ ) {\r\n\t\t\t\t\tif ( list[ j ] === m[ i ].element[ 0 ] ) {\r\n\t\t\t\t\t\tm[ i ].proportions().height = 0;\r\n\t\t\t\t\t\tcontinue droppablesLoop;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tm[ i ].visible = m[ i ].element.css( \"display\" ) !== \"none\";\r\n\t\t\t\tif ( !m[ i ].visible ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Activate the droppable if used directly from draggables\r\n\t\t\t\tif ( type === \"mousedown\" ) {\r\n\t\t\t\t\tm[ i ]._activate.call( m[ i ], event );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tm[ i ].offset = m[ i ].element.offset();\r\n\t\t\t\tm[ i ].proportions( {\r\n\t\t\t\t\twidth: m[ i ].element[ 0 ].offsetWidth,\r\n\t\t\t\t\theight: m[ i ].element[ 0 ].offsetHeight\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t},\r\n\t\tdrop: function( draggable, event ) {\r\n\r\n\t\t\tvar dropped = false;\r\n\r\n\t\t\t// Create a copy of the droppables in case the list changes during the drop (#9116)\r\n\t\t\tlangx.each( ( ddmanager.droppables[ draggable.options.scope ] || [] ).slice(), function() {\r\n\r\n\t\t\t\tif ( !this.options ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif ( !this.options.disabled && this.visible &&\r\n\t\t\t\t\t\tddmanager.intersect( draggable, this, this.options.tolerance, event ) ) {\r\n\t\t\t\t\tdropped = this._drop.call( this, event ) || dropped;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( !this.options.disabled && this.visible && this.accept.call( this.element[ 0 ],\r\n\t\t\t\t\t\t( draggable.currentItem || draggable.element ) ) ) {\r\n\t\t\t\t\tthis.isout = true;\r\n\t\t\t\t\tthis.isover = false;\r\n\t\t\t\t\tthis._deactivate.call( this, event );\r\n\t\t\t\t}\r\n\r\n\t\t\t} );\r\n\t\t\treturn dropped;\r\n\r\n\t\t},\r\n\t\tdragStart: function( draggable, event ) {\r\n\r\n\t\t\t// Listen for scrolling so that if the dragging causes scrolling the position of the\r\n\t\t\t// droppables can be recalculated (see #5003)\r\n\t\t\tdraggable.element.parentsUntil( \"body\" ).on( \"scroll.droppable\", function() {\r\n\t\t\t\tif ( !draggable.options.refreshPositions ) {\r\n\t\t\t\t\tddmanager.prepareOffsets( draggable, event );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t},\r\n\t\tdrag: function( draggable, event ) {\r\n\r\n\t\t\t// If you have a highly dynamic page, you might try this option. It renders positions\r\n\t\t\t// every time you move the mouse.\r\n\t\t\tif ( draggable.options.refreshPositions ) {\r\n\t\t\t\tddmanager.prepareOffsets( draggable, event );\r\n\t\t\t}\r\n\r\n\t\t\t// Run through all droppables and check their positions based on specific tolerance options\r\n\t\t\tlangx.each( ddmanager.droppables[ draggable.options.scope ] || [], function() {\r\n\r\n\t\t\t\tif ( this.options.disabled || this.greedyChild || !this.visible ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar parentInstance, scope, parent,\r\n\t\t\t\t\tintersects = ddmanager.intersect( draggable, this, this.options.tolerance, event ),\r\n\t\t\t\t\tc = !intersects && this.isover ?\r\n\t\t\t\t\t\t\"isout\" :\r\n\t\t\t\t\t\t( intersects && !this.isover ? \"isover\" : null );\r\n\t\t\t\tif ( !c ) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( this.options.greedy ) {\r\n\r\n\t\t\t\t\t// find droppable parents with same scope\r\n\t\t\t\t\tscope = this.options.scope;\r\n\t\t\t\t\tparent = this.element.parents( \":data(ui-droppable)\" ).filter( function() {\r\n\t\t\t\t\t\treturn $( this ).droppable( \"instance\" ).options.scope === scope;\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\tif ( parent.length ) {\r\n\t\t\t\t\t\tparentInstance = $( parent[ 0 ] ).droppable( \"instance\" );\r\n\t\t\t\t\t\tparentInstance.greedyChild = ( c === \"isover\" );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// We just moved into a greedy child\r\n\t\t\t\tif ( parentInstance && c === \"isover\" ) {\r\n\t\t\t\t\tparentInstance.isover = false;\r\n\t\t\t\t\tparentInstance.isout = true;\r\n\t\t\t\t\tparentInstance._out.call( parentInstance, event );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis[ c ] = true;\r\n\t\t\t\tthis[ c === \"isout\" ? \"isover\" : \"isout\" ] = false;\r\n\t\t\t\tthis[ c === \"isover\" ? \"_over\" : \"_out\" ].call( this, event );\r\n\r\n\t\t\t\t// We just moved out of a greedy child\r\n\t\t\t\tif ( parentInstance && c === \"isout\" ) {\r\n\t\t\t\t\tparentInstance.isout = false;\r\n\t\t\t\t\tparentInstance.isover = true;\r\n\t\t\t\t\tparentInstance._over.call( parentInstance, event );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\r\n\t\t},\r\n\t\tdragStop: function( draggable, event ) {\r\n\t\t\tdraggable.element.parentsUntil( \"body\" ).off( \"scroll.droppable\" );\r\n\r\n\t\t\t// Call prepareOffsets one final time since IE does not fire return scroll events when\r\n\t\t\t// overflow was caused by drag (see #5003)\r\n\t\t\tif ( !draggable.options.refreshPositions ) {\r\n\t\t\t\tddmanager.prepareOffsets( draggable, event );\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tddmanager.intersect = ( function() {\r\n\t\tfunction isOverAxis( x, reference, size ) {\r\n\t\t\treturn ( x >= reference ) && ( x < ( reference + size ) );\r\n\t\t}\r\n\r\n\t\treturn function( draggable, droppable, toleranceMode, event ) {\r\n\r\n\t\t\tif ( !droppable.offset ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tvar x1 = ( draggable.positionAbs ||\r\n\t\t\t\t\tdraggable.position.absolute ).left + draggable.margins.left,\r\n\t\t\t\ty1 = ( draggable.positionAbs ||\r\n\t\t\t\t\tdraggable.position.absolute ).top + draggable.margins.top,\r\n\t\t\t\tx2 = x1 + draggable.helperProportions.width,\r\n\t\t\t\ty2 = y1 + draggable.helperProportions.height,\r\n\t\t\t\tl = droppable.offset.left,\r\n\t\t\t\tt = droppable.offset.top,\r\n\t\t\t\tr = l + droppable.proportions().width,\r\n\t\t\t\tb = t + droppable.proportions().height;\r\n\r\n\t\t\tswitch ( toleranceMode ) {\r\n\t\t\tcase \"fit\":\r\n\t\t\t\treturn ( l <= x1 && x2 <= r && t <= y1 && y2 <= b );\r\n\t\t\tcase \"intersect\":\r\n\t\t\t\treturn ( l < x1 + ( draggable.helperProportions.width / 2 ) && // Right Half\r\n\t\t\t\t\tx2 - ( draggable.helperProportions.width / 2 ) < r && // Left Half\r\n\t\t\t\t\tt < y1 + ( draggable.helperProportions.height / 2 ) && // Bottom Half\r\n\t\t\t\t\ty2 - ( draggable.helperProportions.height / 2 ) < b ); // Top Half\r\n\t\t\tcase \"pointer\":\r\n\t\t\t\treturn isOverAxis( event.pageY, t, droppable.proportions().height ) &&\r\n\t\t\t\t\tisOverAxis( event.pageX, l, droppable.proportions().width );\r\n\t\t\tcase \"touch\":\r\n\t\t\t\treturn (\r\n\t\t\t\t\t( y1 >= t && y1 <= b ) || // Top edge touching\r\n\t\t\t\t\t( y2 >= t && y2 <= b ) || // Bottom edge touching\r\n\t\t\t\t\t( y1 < t && y2 > b ) // Surrounded vertically\r\n\t\t\t\t) && (\r\n\t\t\t\t\t( x1 >= l && x1 <= r ) || // Left edge touching\r\n\t\t\t\t\t( x2 >= l && x2 <= r ) || // Right edge touching\r\n\t\t\t\t\t( x1 < l && x2 > r ) // Surrounded horizontally\r\n\t\t\t\t);\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t} )();\r\n\r\n\r\n\treturn ddmanager;\r\n});"]}