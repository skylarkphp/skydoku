/**
 * skylark-widgets-swt - The skylark widget framework and standard widgets
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-swt/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","./swt","./Widget"],function(e,t,n,o,i,l,r,s){var a=s.inherit({klassName:"Tabular",pluginName:"lark.tabular",options:{buttonClasses:{append:null,removeLast:null,insert:null,remove:null,moveUp:null,moveDown:null,rowDrag:null},sectionClasses:{caption:null,header:null,body:null,subPanel:null,footer:null},hideButtons:{append:!1,removeLast:!1,insert:!1,remove:!1,moveUp:!1,moveDown:!1}},_showEmptyMessage:function(e,t){var n=this._tbWrap,o=l("<td></td>").text(e._i18n.rowEmpty).attr("colspan",e._finalColSpan);l("table.body tbody",n).append(l("<tr></tr>").addClass("empty").append(o))},_calculateColumnWidth:function(){var e=this._tbWrap,t=l("table.body",e),n=l("div.scroller",e),o=t.data("appendGrid"),i=l("table.head tr.columnHead",e)[0],r=l("table.body colgroup",e)[0];if(o._rowOrder.length>0){l("td",i).width("auto"),l("col",r).width("auto"),t.width("auto"),n.width("auto");var s=l("tbody tr",t)[0],a=-2;l.fn.modal&&(a=1);for(var u=Math.min(i.childNodes.length,s.childNodes.length),d=0;d<u;d++){var c=i.childNodes[d].clientWidth+1,m=s.childNodes[d].clientWidth+a;m>c?i.childNodes[d].style.width=m+"px":r.childNodes[d].style.width=c+"px"}}else l("table.body,table.foot",e).width(l("table.head").width());l("table.foot",e).width(t.width()),n.width(t.width()+n[0].offsetWidth-n[0].clientWidth+1)},_createGridButton:function(t,n){var o=null;return t&&(e.isFunction(t)?o=l(t()):t.nodeType?o=l(t).clone():(t.icon||t.label)&&(o=l("<button/>").attr({type:"button"})).plugin("lark.button",t)),o||(o=l("<button/>").attr({type:"button"})).plugin("lark.button",{icon:n,showLabel:!1}),o},_sortSequence:function(e){var t=this._elm,n=l(t).data("appendGrid");if(!n.hideRowNumColumn)for(var o=e;o<n._rowOrder.length;o++)l("#"+n.idPrefix+"_Row_"+n._rowOrder[o]+" td.first",t).text(o+1)},_emptyGrid:function(){var e=this._elm,t=l(e).data("appendGrid");l("tbody",e).empty(),t._rowOrder.length=0,t._uniqueIndex=0,this._saveSetting(t),this._showEmptyMessage(t)},_gridRowDragged:function(t,n,o){for(var i=this._elm,r=l(i).data("appendGrid"),s=-1,a=0;a<r._rowOrder.length;a++)if(r._rowOrder[a]==n){t?(s=o,r._rowOrder.splice(a,1),r._rowOrder.splice(o,0,n)):(s=a,r._rowOrder.splice(o+1,0,n),r._rowOrder.splice(a,1));break}this._sortSequence(s),this._saveSetting(r),e.isFunction(r.afterRowDragged)&&r.afterRowDragged(i,o,n)},_saveSetting:function(e){var t=this._elm;l(t).data("appendGrid",e),l("#"+e.idPrefix+"_rowOrder",t).val(e._rowOrder.join())},_checkGridAndGetSettings:function(e){var t=null,n=l(this._elm);return 1==n.length?(t=n.data("appendGrid"))||e||alert(m.notInit):e||alert(m.getValueMultiGrid),t},_insertRow:function(t,n,o){var i,r,s,a,u=this,d=this._elm,c=l(d).data("appendGrid"),m=[],p=null,h=[],f=(d.getElementsByTagName("thead")[0],d.getElementsByTagName("tbody")[0]),_=null,w=!1,g=0,C=0,x=t,y=!1;if(e.isArray(t)&&(x=t.length,y=!0),e.isNumeric(o)){for(var R=0;R<c._rowOrder.length;R++)if(c._rowOrder[R]==o){n=R,0!=R&&(p=R-1);break}}else e.isNumeric(n)?n>=c._rowOrder.length?n=null:p=n-1:0!=c._rowOrder.length&&(n=null,p=c._rowOrder.length-1);c.maintainScroll&&!e.isNumeric(n)&&(g=l(d).height(),C=l(d).scrollParent().scrollTop()),0==c._rowOrder.length&&l("tr.empty",d).remove();for(R=0;R<x;R++){if(0<c.maxRowsAllowed&&c._rowOrder.length>=c.maxRowsAllowed){w=!0;break}c._uniqueIndex++,i=c._uniqueIndex,h.length=0,e.isNumeric(n)?(c._rowOrder.splice(n,0,i),c.useSubPanel?(f.insertBefore(_=document.createElement("tr"),f.childNodes[2*n]),f.insertBefore(s=document.createElement("tr"),f.childNodes[2*n])):f.insertBefore(s=document.createElement("tr"),f.childNodes[n]),m.push(n)):(c._rowOrder.push(i),f.appendChild(s=document.createElement("tr")),c.useSubPanel&&f.appendChild(_=document.createElement("tr")),m.push(c._rowOrder.length-1)),s.id=c.idPrefix+"_Row_"+i,c._sectionClasses.body&&(s.className=c._sectionClasses.body),l(s).data("appendGrid",i),null!=_&&(_.id=c.idPrefix+"_SubRow_"+i,l(_).data("appendGrid",i),c._sectionClasses.subPanel&&(_.className=c._sectionClasses.subPanel)),c.hideRowNumColumn||(s.appendChild(a=document.createElement("td")),l(a).addClass("ui-widget-content first").text(c._rowOrder.length),c.useSubPanel&&(a.rowSpan=2));for(var G=0;G<c.columns.length;G++)if("hidden"!=c.columns[G].type){var S="ui-widget-content";c.columns[G].invisible&&(S+=" invisible"),s.appendChild(a=document.createElement("td")),a.id=c.idPrefix+"_"+c.columns[G].name+"_td_"+i,a.className=S,null!=c.columns[G].cellCss&&l(a).css(c.columns[G].cellCss);var B,P=c.idPrefix+"_"+c.columns[G].name+"_"+i;if(B=e.isFunction(c.nameFormatter)?c.nameFormatter(c.idPrefix,c.columns[G].name,i):P,r=null,"custom"==c.columns[G].type)e.isFunction(c.columns[G].customBuilder)&&(r=c.columns[G].customBuilder(a,c.idPrefix,c.columns[G].name,i));else if("select"==c.columns[G].type||"ui-selectmenu"==c.columns[G].type){if((r=document.createElement("select")).id=P,r.name=B,e.isArray(c.columns[G].ctrlOptions)){if(c.columns[G].ctrlOptions.length>0)if(e.isPlainObject(c.columns[G].ctrlOptions[0]))for(var k=null,N=null,D=0;D<c.columns[G].ctrlOptions.length;D++){b(c.columns[G].ctrlOptions[D].group)?N=null:k!=c.columns[G].ctrlOptions[D].group&&(k=c.columns[G].ctrlOptions[D].group,(N=document.createElement("optgroup")).label=k,r.appendChild(N));var E=l("<option/>").val(c.columns[G].ctrlOptions[D].value).text(c.columns[G].ctrlOptions[D].label);b(c.columns[G].ctrlOptions[D].title)||E.attr("title",c.columns[G].ctrlOptions[D].title),null==N?E.appendTo(r):E.appendTo(N)}else for(D=0;D<c.columns[G].ctrlOptions.length;D++)r.options[r.options.length]=new Option(c.columns[G].ctrlOptions[D],c.columns[G].ctrlOptions[D])}else if(e.isPlainObject(c.columns[G].ctrlOptions))for(var D in c.columns[G].ctrlOptions)r.options[r.options.length]=new Option(c.columns[G].ctrlOptions[D],D);else if("string"==typeof c.columns[G].ctrlOptions){var I=c.columns[G].ctrlOptions.split(";");for(D=0;D<I.length;D++){var A=I[D].indexOf(":");r.options[r.options.length]=-1==A?new Option(I[D],I[D]):new Option(I[D].substring(A+1,I[D].length),I[D].substring(0,A))}}else e.isFunction(c.columns[G].ctrlOptions)&&c.columns[G].ctrlOptions(r);a.appendChild(r),"ui-selectmenu"==c.columns[G].type&&l(r).selectmenu(c.columns[G].uiOption)}else if("checkbox"==c.columns[G].type)(r=document.createElement("input")).type="checkbox",r.id=P,r.name=B,r.value=1,a.appendChild(r),a.style.textAlign="center";else if("textarea"==c.columns[G].type)(r=document.createElement("textarea")).id=P,r.name=B,a.appendChild(r);else if(-1!=c.columns[G].type.search(/^(color|date|datetime|datetime\-local|email|month|number|range|search|tel|time|url|week)$/)){r=document.createElement("input");try{r.type=c.columns[G].type}catch(e){}r.id=P,r.name=B,a.appendChild(r)}else(r=document.createElement("input")).type="text",r.id=P,r.name=B,a.appendChild(r),"ui-datepicker"==c.columns[G].type?l(r).datepicker(c.columns[G].uiOption):"ui-spinner"==c.columns[G].type?l(r).spinner(c.columns[G].uiOption):"ui-autocomplete"==c.columns[G].type&&l(r).autocomplete(c.columns[G].uiOption);"custom"!=c.columns[G].type&&(null!=c.columns[G].ctrlAttr&&l(r).attr(c.columns[G].ctrlAttr),null!=c.columns[G].ctrlProp&&l(r).prop(c.columns[G].ctrlProp),null!=c.columns[G].ctrlCss&&l(r).css(c.columns[G].ctrlCss),null!=c.columns[G].ctrlClass&&l(r).addClass(c.columns[G].ctrlClass),c.columns[G].uiTooltip&&l(r).tooltip(c.columns[G].uiTooltip),e.isFunction(c.columns[G].onClick)&&l(r).click({caller:d,callback:c.columns[G].onClick,uniqueIndex:i},function(e){e.data.callback(e,l(e.data.caller).appendGrid("getRowIndex",e.data.uniqueIndex))}),e.isFunction(c.columns[G].onChange)&&l(r).change({caller:d,callback:c.columns[G].onChange,uniqueIndex:i},function(e){e.data.callback(e,l(e.data.caller).plugin("lark.tabular").getRowIndex(e.data.uniqueIndex))})),y?O(c,G,i,t[R][c.columns[G].name]):b(c.columns[G].value)||O(c,G,i,c.columns[G].value)}else h.push(G);if(!c._hideLastColumn||c.columns.length>c._visibleCount){if(c.rowButtonsInFront?c.hideRowNumColumn?s.insertBefore(a=document.createElement("td"),s.firstChild):s.insertBefore(a=document.createElement("td"),s.childNodes[1]):s.appendChild(a=document.createElement("td")),a.className="ui-widget-content last",a.id=c.idPrefix+"_last_td_"+i,c._hideLastColumn&&(a.style.display="none"),!c.hideButtons.insert){var T=this._createGridButton(c.customGridButtons.insert,"ui-icon-arrowreturnthick-1-w").attr({id:c.idPrefix+"_Insert_"+i,title:c._i18n.insert,tabindex:-1}).addClass("insert").data("appendGrid",{uniqueIndex:i}).click(function(e){var t=l(this).data("appendGrid").uniqueIndex;return l(d).plugin("lark.tabular").insertRow(1,null,t),e&&e.preventDefault&&e.preventDefault(c._buttonClasses.insert),!1}).appendTo(a);b(c._buttonClasses.insert)||T.addClass(c._buttonClasses.insert)}if(!c.hideButtons.remove){T=this._createGridButton(c.customGridButtons.remove,"ui-icon-trash").attr({id:c.idPrefix+"_Delete_"+i,title:c._i18n.remove,tabindex:-1}).addClass("remove").data("appendGrid",{uniqueIndex:i}).click(function(e){var t=l(this).data("appendGrid").uniqueIndex;return u._removeRow(null,t,!1),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(a);b(c._buttonClasses.remove)||T.addClass(c._buttonClasses.remove)}if(!c.hideButtons.moveUp){T=this._createGridButton(c.customGridButtons.moveUp,"ui-icon-arrowthick-1-n").attr({id:c.idPrefix+"_MoveUp_"+i,title:c._i18n.moveUp,tabindex:-1}).addClass("moveUp").data("appendGrid",{uniqueIndex:i}).click(function(e){var t=l(this).data("appendGrid").uniqueIndex;return l(d).plugin("lark.tabular").moveUpRow(null,t),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(a);b(c._buttonClasses.moveUp)||T.addClass(c._buttonClasses.moveUp)}if(!c.hideButtons.moveDown){T=this._createGridButton(c.customGridButtons.moveDown,"ui-icon-arrowthick-1-s").attr({id:c.idPrefix+"_MoveDown_"+i,title:c._i18n.moveDown,tabindex:-1}).addClass("moveDown").data("appendGrid",{uniqueIndex:i}).click(function(e){var t=l(this).data("appendGrid").uniqueIndex;return l(d).plugin("lark.tabular").moveDownRow(null,t),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(a);b(c._buttonClasses.moveDown)||T.addClass(c._buttonClasses.moveDown)}if(c.rowDragging){T=l("<div/>").addClass("rowDrag ui-state-default ui-corner-all").attr("title",c._i18n.rowDrag).append(l("<div/>").addClass("ui-icon ui-icon-caret-2-n-s").append(l("<span/>").addClass("ui-button-text").text("Drag"))).appendTo(a);b(c._buttonClasses.rowDrag)||T.addClass(c._buttonClasses.rowDrag)}for(G=0;G<h.length;G++)(r=document.createElement("input")).id=c.idPrefix+"_"+c.columns[h[G]].name+"_"+i,e.isFunction(c.nameFormatter)?r.name=c.nameFormatter(c.idPrefix,c.columns[G].name,i):r.name=r.id,r.type="hidden",y?r.value=t[R][c.columns[h[G]].name]:b(c.columns[h[G]].value)||(r.value=c.columns[h[G]].value),a.appendChild(r);if(c.customRowButtons&&c.customRowButtons.length){for(G=c.customRowButtons.length-1;G>=0;G--){(F=c.customRowButtons[G])&&F.uiButton&&F.click&&F.atTheFront&&l(a).prepend(v(d,F,i))}for(G=0;G<c.customRowButtons.length;G++){var F;(F=c.customRowButtons[G])&&F.uiButton&&F.click&&!F.atTheFront&&l(a).append(v(d,F,i))}}}c.useSubPanel&&(_.appendChild(a=document.createElement("td")),a.className="ui-widget-content",a.colSpan=c._visibleCount+(c._hideLastColumn?0:1),e.isFunction(c.subPanelBuilder)&&c.subPanelBuilder(a,i))}if(this._saveSetting(c),e.isNumeric(n)?e.isFunction(c.afterRowInserted)&&c.afterRowInserted(d,p,m):e.isFunction(c.afterRowAppended)&&c.afterRowAppended(d,p,m),w&&e.isFunction(c.maxNumRowsReached)&&c.maxNumRowsReached(),c.maintainScroll&&!e.isNumeric(n)){var L=l(d).height();l(d).scrollParent().scrollTop(C+L-g)}return{addedRows:m,parentIndex:p,rowIndex:n}},_removeRow:function(t,n,o){var i=this._elm,r=l(i).data("appendGrid"),s=i.getElementsByTagName("tbody")[0];if(e.isNumeric(n))for(var a=0;a<r._rowOrder.length;a++)if(r._rowOrder[a]==n){t=a;break}if(e.isNumeric(t))(o||"function"!=typeof r.beforeRowRemove||r.beforeRowRemove(i,t))&&(r._rowOrder.splice(t,1),r.useSubPanel?(s.removeChild(s.childNodes[2*t]),s.removeChild(s.childNodes[2*t])):s.removeChild(s.childNodes[t]),this._saveSetting(r),this._sortSequence(t),e.isFunction(r.afterRowRemoved)&&r.afterRowRemoved(i,t));else{var u=0,d=0;if(r.maintainScroll&&(u=l(i).height(),d=l(i).scrollParent().scrollTop()),(o||!e.isFunction(r.beforeRowRemove)||r.beforeRowRemove(i,r._rowOrder.length-1))&&(n=r._rowOrder.pop(),s.removeChild(s.lastChild),r.useSubPanel&&s.removeChild(s.lastChild),this._saveSetting(r),e.isFunction(r.afterRowRemoved)&&r.afterRowRemoved(i,null)),r.maintainScroll){var c=l(i).height();l(i).scrollParent().scrollTop(d+c-u)}}0==r._rowOrder.length&&this._showEmptyMessage(r)},_loadData:function(t,n){var o,i,r=this._elm,s=l(r).data("appendGrid");if(s){if(o=r.getElementsByTagName("tbody")[0],l(o).empty(),s._rowOrder.length=0,s._uniqueIndex=0,null!=t&&t.length){i=this._insertRow(t.length,null,null);for(var a=0;a<i.addedRows.length;a++){for(var u=0;u<s.columns.length;u++)O(s,u,s._rowOrder[a],t[a][s.columns[u].name]);e.isFunction(s.rowDataLoaded)&&s.rowDataLoaded(r,t[a],a,s._rowOrder[a])}}s._isDataLoaded=!0,n&&(s.initData=null),l(r).data("appendGrid",s),e.isFunction(s.dataLoaded)&&s.dataLoaded(r,t)}},_init:function(){var t=this.options,n=this;e.isArray(t.columns)&&0!=t.columns.length||alert(m.noColumnInfo);var o,i,r,s,a,v,g,C=this._elm;(b(C.tagName)||"TABLE"!=C.tagName)&&alert(m.elemNotTable);var x,y,O=e.extend({},u,d,t);e.extend(O,{_uniqueIndex:0,_rowOrder:[],_isDataLoaded:!1,_visibleCount:0,_finalColSpan:0,_hideLastColumn:!1,_wrapperId:null,_calculateWidth:!0}),e.isPlainObject(t.i18n)?O._i18n=e.extend({},p,t.i18n):O._i18n=e.extend({},p),e.isPlainObject(t.buttonClasses)?O._buttonClasses=e.extend({},h,t.buttonClasses):O._buttonClasses=e.extend({},h),e.isPlainObject(t.sectionClasses)?O._sectionClasses=e.extend({},f,t.sectionClasses):O._sectionClasses=e.extend({},f),e.isPlainObject(t.hideButtons)?O.hideButtons=e.extend({},_,t.hideButtons):O.hideButtons=e.extend({},_),b(O.idPrefix)&&(b(C.id)||""==C.id?O.idPrefix="ag"+(new Date).getTime():O.idPrefix=C.id),e.isPlainObject(O.customGridButtons)||(O.customGridButtons={}),O.useSubPanel&&O.rowDragging&&(O.rowDragging=!1),(i=document.createElement("thead")).className="ui-widget-header",(r=document.createElement("tbody")).className="ui-widget-content",(s=document.createElement("tfoot")).className="ui-widget-header",a=document.createElement("colgroup"),O._wrapperId=O.idPrefix+"-wrapper",o=this._tbWrap=document.createElement("div"),l(o).attr("id",O._wrapperId).addClass("appendGrid").insertAfter(C),l(C).empty().addClass("ui-widget").appendTo(o),l(C).addClass("head body foot").append(a,i,r,s),i.appendChild(v=document.createElement("tr")),O._sectionClasses.header?v.className="columnHead "+O._sectionClasses.header:v.className="columnHead",O.hideRowNumColumn||(v.appendChild(x=document.createElement("td")),x.className="ui-widget-header first",a.appendChild(document.createElement("col")));for(var R=0,G=0;G<O.columns.length;G++){var S=e.extend({},c,O.columns[G]);if(O.columns[G]=S,"hidden"!=O.columns[G].type)if(O.columns[G].invisible||O._visibleCount++,0==R){var B="ui-widget-header";O.columns[G].invisible&&(B+=" invisible"),O.columns[G].resizable&&(B+=" resizable"),v.appendChild(g=document.createElement("td")),g.id=O.idPrefix+"_"+O.columns[G].name+"_td_head",g.className=B,O.columns[G].displayCss&&l(g).css(O.columns[G].displayCss),O.columns[G].headerSpan>1&&(l(g).attr("colSpan",O.columns[G].headerSpan),R=O.columns[G].headerSpan-1),e.isPlainObject(O.columns[G].displayTooltip)?l(g).tooltip(O.columns[G].displayTooltip):b(O.columns[G].displayTooltip)||l(g).attr("title",O.columns[G].displayTooltip).tooltip(),e.isFunction(O.columns[G].display)?O.columns[G].display(g):b(O.columns[G].display)||l(g).text(O.columns[G].display),a.appendChild(document.createElement("col"))}else R--}if(l.fn.resizable&&l("td.resizable",i).resizable({handles:"e"}),O.hideButtons.insert&&O.hideButtons.remove&&O.hideButtons.moveUp&&O.hideButtons.moveDown&&(!e.isArray(O.customRowButtons)||0==O.customRowButtons.length)&&(O._hideLastColumn=!0),O._finalColSpan=O._visibleCount,O.hideRowNumColumn||O._finalColSpan++,O._hideLastColumn||O._finalColSpan++,O._hideLastColumn||(O.rowButtonsInFront?O.hideRowNumColumn?v.insertBefore(y=document.createElement("td"),v.firstChild):v.insertBefore(y=document.createElement("td"),v.childnodes[1]):v.appendChild(y=document.createElement("td")),y.className="ui-widget-header last",y.id=O.idPrefix+"_last_td_head",a.appendChild(document.createElement("col"))),O.caption&&(i.insertBefore(v=document.createElement("tr"),i.firstChild),O._sectionClasses.caption&&(v.className=O._sectionClasses.caption),v.appendChild(g=document.createElement("td")),g.id=O.idPrefix+"_caption_td",g.className="ui-state-active caption",g.colSpan=O._finalColSpan,e.isPlainObject(O.captionTooltip)?l(g).tooltip(O.captionTooltip):b(O.captionTooltip)||l(g).attr("title",O.captionTooltip).tooltip(),e.isFunction(O.caption)?O.caption(g):l(g).text(O.caption)),s.appendChild(v=document.createElement("tr")),O._sectionClasses.footer&&(v.className=O._sectionClasses.footer),v.appendChild(g=document.createElement("td")),g.id=O.idPrefix+"_footer_td",g.colSpan=O._finalColSpan,l("<input/>").attr({type:"hidden",id:O.idPrefix+"_rowOrder",name:O.idPrefix+"_rowOrder"}).appendTo(g),!O.hideButtons.append||!O.hideButtons.removeLast||e.isArray(O.customFooterButtons)&&0!=O.customFooterButtons.length){if(!O.hideButtons.append){var P=this._createGridButton(O.customGridButtons.append,"ui-icon-plusthick").attr({title:O._i18n.append}).addClass("append").click(function(e){return n._insertRow(1,null,null),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(g);b(O._buttonClasses.append)||P.addClass(O._buttonClasses.append)}if(!O.hideButtons.removeLast){P=this._createGridButton(O.customGridButtons.removeLast,"ui-icon-closethick").attr({title:O._i18n.removeLast}).addClass("removeLast").click(function(e){return n._removeRow(null,this.value,!1),e&&e.preventDefault&&e.preventDefault(),!1}).appendTo(g);b(O._buttonClasses.removeLast)||P.addClass(O._buttonClasses.removeLast)}if(O.customFooterButtons&&O.customFooterButtons.length){for(var k=O.customFooterButtons.length-1;k>=0;k--){(N=O.customFooterButtons[k])&&N.uiButton&&N.click&&N.atTheFront&&l(g).prepend(w(C,N))}for(k=0;k<O.customFooterButtons.length;k++){var N;(N=O.customFooterButtons[k])&&N.uiButton&&N.click&&!N.atTheFront&&l(g).append(w(C,N))}}}else v.style.display="none";O.rowDragging&&l(r).sortable({axis:"y",containment:C,handle:".rowDrag",helper:function(e,t){var n=t.children(),o=t.clone();return o.children().each(function(e){l(this).width(n.eq(e).width());var t=l("select",this);if(t.length>0)for(var o=0;o<t.length;o++){var i=n.eq(e).find("select");i.length>o&&(t[o].value=i[o].value)}}),o},update:function(e,t){var o=t.item[0].id.substring(t.item[0].id.lastIndexOf("_")+1),r=t.item[0].rowIndex-l("tr",i).length;n._gridRowDragged(t.originalPosition.top>t.position.top,o,r)}}),l(C).data("appendGrid",O),e.isArray(t.initData)?this._loadData(t.initData,!0):this.appendRow(O.initRows),0==O._rowOrder.length&&this._showEmptyMessage(O,!0)},isReady:function(){return!!this._checkGridAndGetSettings(!0)},isDataLoaded:function(){var e=this._checkGridAndGetSettings();return!!e&&e._isDataLoaded},load:function(e){return this._checkGridAndGetSettings()&&(null!=e&&e.length>0?this._loadData(e,!1):this._emptyGrid()),this},appendRow:function(e){return this.insertRow(e)},insertRow:function(t,n,o){var i=this._checkGridAndGetSettings();if(i&&(e.isArray(t)&&t.length>0||e.isNumeric(t)&&t>0)){var r=this[0];if(insertResult=this._insertRow(t,n,o),e.isNumeric(n)||e.isNumeric(o)){this._sortSequence(insertResult.rowIndex);var s=i._rowOrder[insertResult.addedRows[0]];l("#"+i.idPrefix+"_Insert_"+s,r).focus()}}return this},removeRow:function(e,t){var n=this._checkGridAndGetSettings();return n&&n._rowOrder.length>0&&this._removeRow(e,t,!0),this},emptyGrid:function(){return this._checkGridAndGetSettings()&&this._emptyGrid(),target},moveUpRow:function(t,n){var o=this._checkGridAndGetSettings();if(o){var i,r,s,a,u=this[0],d=null,c=u.getElementsByTagName("tbody")[0];e.isNumeric(t)&&t>0&&t<o._rowOrder.length?(d=t,n=o._rowOrder[t]):e.isNumeric(n)&&(d=g(n,o)),null!=d&&d>0&&(i=document.getElementById(o.idPrefix+"_Row_"+n,u),r=document.getElementById(o.idPrefix+"_Row_"+o._rowOrder[d-1],u),o.useSubPanel&&(s=document.getElementById(o.idPrefix+"_SubRow_"+n,u)),c.removeChild(i),o.useSubPanel&&c.removeChild(s),c.insertBefore(i,r),o.useSubPanel&&c.insertBefore(s,r),o._rowOrder[d]=o._rowOrder[d-1],o._rowOrder[d-1]=n,a=l("td.first",r).html(),l("td.first",r).html(l("td.first",i).html()),l("td.first",i).html(a),this._saveSetting(o),l("td.last button.moveUp",i).removeClass("ui-state-hover").blur(),l("td.last button.moveUp",r).focus(),o.afterRowSwapped&&o.afterRowSwapped(u,d,d-1))}return this},moveDownRow:function(t,n){var o=this._checkGridAndGetSettings();if(o){var i,r,s,a,u=this[0],d=null,c=u.getElementsByTagName("tbody")[0];e.isNumeric(t)&&t>=0&&t<o._rowOrder.length-1?(d=t,n=o._rowOrder[t]):e.isNumeric(n)&&(d=g(n,o)),null!=d&&d!=o._rowOrder.length-1&&(i=document.getElementById(o.idPrefix+"_Row_"+n,u),r=document.getElementById(o.idPrefix+"_Row_"+o._rowOrder[d+1],u),o.useSubPanel&&(s=document.getElementById(o.idPrefix+"_SubRow_"+o._rowOrder[d+1],u)),c.removeChild(r),c.insertBefore(r,i),o.useSubPanel&&c.insertBefore(s,i),o._rowOrder[d]=o._rowOrder[d+1],o._rowOrder[d+1]=n,a=l("td.first",r).html(),l("td.first",r).html(l("td.first",i).html()),l("td.first",i).html(a),this._saveSetting(o),l("td.last button.moveDown",i).removeClass("ui-state-hover").blur(),l("td.last button.moveDown",r).focus(),o.afterRowSwapped&&o.afterRowSwapped(u,d,d+1))}return this},showColumn:function(e){var t=this._checkGridAndGetSettings();if(t&&e){for(var n=-1,o=(this[0],0);o<t.columns.length;o++)if(t.columns[o].name==e){n=o;break}if(-1!=n&&t.columns[n].invisible){t._visibleCount++,t._finalColSpan++,l("#"+t.idPrefix+"_caption_td").attr("colSpan",t._finalColSpan),l("#"+t.idPrefix+"_footer_td").attr("colSpan",t._finalColSpan),l("#"+t.idPrefix+"_"+e+"_td_head").removeClass("invisible");for(o=0;o<t._rowOrder.length;o++){var i=t._rowOrder[o];l("#"+t.idPrefix+"_"+e+"_td_"+i).removeClass("invisible"),t.useSubPanel&&l("#"+t.idPrefix+"_SubRow_"+i).attr("colSpan",t._visibleCount+(t._hideLastColumn?0:1))}t.columns[n].invisible=!1,this._saveSetting(t)}}return this},hideColumn:function(e){var t=this._checkGridAndGetSettings();if(t&&e){for(var n=-1,o=(this[0],0);o<t.columns.length;o++)if(t.columns[o].name==e){n=o;break}if(-1!=n&&!t.columns[n].invisible){t._visibleCount--,t._finalColSpan--,l("#"+t.idPrefix+"_caption_td").attr("colSpan",t._finalColSpan),l("#"+t.idPrefix+"_footer_td").attr("colSpan",t._finalColSpan),l("#"+t.idPrefix+"_"+e+"_td_head").addClass("invisible");for(o=0;o<t._rowOrder.length;o++){var i=t._rowOrder[o];l("#"+t.idPrefix+"_"+e+"_td_"+i).addClass("invisible"),t.useSubPanel&&l("#"+t.idPrefix+"_SubRow_"+i).attr("colSpan",t._visibleCount+(t._hideLastColumn?0:1))}t.columns[n].invisible=!0,this._saveSetting(t)}}return this},isColumnInvisible:function(e){var t=this._checkGridAndGetSettings();if(t&&e)for(var n=0;n<t.columns.length;n++)if(t.columns[n].name==e)return t.columns[n].invisible;return null},getRowCount:function(){var e=this._checkGridAndGetSettings();return e?e._rowOrder.length:null},getUniqueIndex:function(t){var n=this._checkGridAndGetSettings();return n&&e.isNumeric(t)&&t<n._rowOrder.length?n._rowOrder[t]:null},getRowIndex:function(t){var n=this._checkGridAndGetSettings();if(n&&e.isNumeric(t))for(var o=0;o<n._rowOrder.length;o++)if(n._rowOrder[o]==t)return o;return null},getRowValue:function(t,n,o){var i=this._checkGridAndGetSettings(),l=null;return i&&(e.isNumeric(t)&&t>=0&&t<i._rowOrder.length&&(n=i._rowOrder[t]),b(n)||(l=C(i,n,o))),l},getAllValue:function(t){var n=this._checkGridAndGetSettings(),o=null;if(n){o=t?{}:[];for(var i=0;i<n._rowOrder.length;i++)t?(rowValue=C(n,n._rowOrder[i],i),e.extend(o,rowValue)):(rowValue=C(n,n._rowOrder[i]),o.push(rowValue));t&&(o[n.rowCountName]=n._rowOrder.length)}return o},getCtrlValue:function(e,t){var n=this._checkGridAndGetSettings();if(n&&t>=0&&t<n._rowOrder.length)for(var o=0;o<n.columns.length;o++)if(n.columns[o].name===e)return x(n,o,n._rowOrder[t]);return null},setCtrlValue:function(e,t,n){var o=this._checkGridAndGetSettings();if(o&&t>=0&&t<o._rowOrder.length)for(var i=0;i<o.columns.length;i++)if(o.columns[i].name==e){O(o,i,o._rowOrder[t],n);break}return this},getCellCtrl:function(e,t){var n=this._checkGridAndGetSettings();if(n&&t>=0&&t<n._rowOrder.length)for(var o=n._rowOrder[t],i=0;i<n.columns.length;i++)if(n.columns[i].name===e)return y(n.columns[i].type,n.idPrefix,e,o);return null},getCellCtrlByUniqueIndex:function(e,t){var n=this._checkGridAndGetSettings();if(n)for(var o=0;o<n.columns.length;o++)if(n.columns[o].name===e)return y(n.columns[o].type,n.idPrefix,e,t);return null},getRowOrder:function(){var e=this._checkGridAndGetSettings();return e?e._rowOrder.slice():null},getColumns:function(){var e=this._checkGridAndGetSettings();return e?e.columns.slice():null},isRowEmpty:function(e){var t=this._checkGridAndGetSettings();return t?R(t,e):null},removeEmptyRows:function(){var e=this._checkGridAndGetSettings();if(e){this[0];for(var t=e._rowOrder.length;t>=0;t--)R(e,t)&&this._removeRow(null,e._rowOrder[t],!0);return this}return null}}),u={caption:null,captionTooltip:null,initRows:3,maxRowsAllowed:0,initData:null,columns:null,i18n:null,idPrefix:null,rowDragging:!1,hideButtons:null,hideRowNumColumn:!1,rowButtonsInFront:!1,rowCountName:"_RowCount",buttonClasses:null,sectionClasses:null,customGridButtons:null,customRowButtons:null,customFooterButtons:null,useSubPanel:!1,maintainScroll:!1,maxBodyHeight:0,autoColumnWidth:!0},d={nameFormatter:null,dataLoaded:null,rowDataLoaded:null,afterRowAppended:null,afterRowInserted:null,afterRowSwapped:null,beforeRowRemove:null,afterRowRemoved:null,afterRowDragged:null,subPanelBuilder:null,subPanelGetter:null,maxNumRowsReached:null},c={type:"text",name:null,value:null,display:null,displayCss:null,displayTooltip:null,headerSpan:1,cellCss:null,ctrlAttr:null,ctrlProp:null,ctrlCss:null,ctrlClass:null,ctrlOptions:null,uiOption:null,uiTooltip:null,resizable:!1,invisible:!1,emptyCriteria:null,customBuilder:null,customGetter:null,customSetter:null,onClick:null,onChange:null},m={noColumnInfo:"Cannot initial grid without column information!",elemNotTable:"Cannot initial grid on element other than TABLE!",notInit:"`appendGrid` does not initialized",getValueMultiGrid:"Cannot get values on multiple grid",notSupportMethod:"Method is not supported by `appendGrid`: "},p={append:"Append Row",removeLast:"Remove Last Row",insert:"Insert Row Above",remove:"Remove Current Row",moveUp:"Move Up",moveDown:"Move Down",rowDrag:"Sort Row",rowEmpty:"This Grid Is Empty"},h={append:null,removeLast:null,insert:null,remove:null,moveUp:null,moveDown:null,rowDrag:null},f={caption:null,header:null,body:null,subPanel:null,footer:null},_={append:!1,removeLast:!1,insert:!1,remove:!1,moveUp:!1,moveDown:!1};function w(e,t){var n=l("<button/>").attr({type:"button",tabindex:-1}).button(t.uiButton).click({tbWhole:e},t.click);return t.btnClass&&n.addClass(t.btnClass),t.btnCss&&n.css(t.btnCss),t.btnAttr&&n.attr(t.btnAttr),n}function v(e,t,n){var o=l("<button/>").val(n).attr({type:"button",tabindex:-1}).button(t.uiButton).click({tbWhole:e,uniqueIndex:n},function(e){var n=l(e.data.tbWhole).plugin("lark.tabular").getRowValue(null,e.data.uniqueIndex);t.click(e,e.data.uniqueIndex,n)});return t.btnClass&&o.addClass(t.btnClass),t.btnCss&&o.css(t.btnCss),t.btnAttr&&o.attr(t.btnAttr),o}function g(e,t){for(var n=0;n<t._rowOrder.length;n++)if(t._rowOrder[n]==e)return n;return null}function b(e){return void 0===e||null==e}function C(t,n,o){for(var i={},l=b(o)?"":"_"+o,r=0;r<t.columns.length;r++)i[t.columns[r].name+l]=x(t,r,n);if(t.useSubPanel&&e.isFunction(t.subPanelGetter)){var s=t.subPanelGetter(n);if(e.isPlainObject(s))if(""==l)e.extend(i,s);else{var a={};for(var u in s)a[u+l]=s[u];e.extend(i,a)}}return i}function x(t,n,o){var i=t.columns[n].type,r=t.columns[n].name;if("custom"==i)return e.isFunction(t.columns[n].customGetter)?t.columns[n].customGetter(t.idPrefix,r,o):null;var s=y(i,t.idPrefix,r,o);return null==s?null:"checkbox"==i?s.checked?1:0:l(s).val()}function y(e,t,n,o){return document.getElementById(t+"_"+n+"_"+o)}function O(t,n,o,i){var r=t.columns[n].type,s=t.columns[n].name;if("custom"==r)e.isFunction(t.columns[n].customSetter)&&t.columns[n].customSetter(t.idPrefix,s,o,i);else{var a=y(0,t.idPrefix,s,o);"checkbox"==r?a.checked=null!=i&&0!=i:"ui-selectmenu"==r?(a.value=null==i?"":i,l(a).selectmenu("refresh")):l(a).val(null==i?"":i)}}function R(t,n){for(var o=0;o<t.columns.length;o++){var i=t._rowOrder[n],l=x(t,o,i);if(e.isFunction(t.columns[o].emptyCriteria)){if(!t.columns[o].emptyCriteria(l))return!1}else{var r=null;if(b(t.columns[o].emptyCriteria))if("checkbox"==t.columns[o].type)r=0;else if("select"==t.columns[o].type||"ui-selectmenu"==t.columns[o].type){var s=y(t.columns[o].type,t.idPrefix,t.columns[o].name,i).options;r=s.length>0?s[0].value:""}else r="";else r=t.columns[o].emptyCriteria;if(l!=r)return!1}}return!0}return a});
//# sourceMappingURL=sourcemaps/Tabular.js.map
