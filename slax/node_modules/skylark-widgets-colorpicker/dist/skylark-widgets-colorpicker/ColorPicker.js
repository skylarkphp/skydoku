/**
 * skylark-widgets-colorpicker - The skylark color picker widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-widgets-colorpicker/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-eventer","skylark-domx-finder","skylark-domx-query","skylark-data-color/colors","skylark-data-color/Color","skylark-widgets-swt/swt","skylark-widgets-swt/Widget"],function(t,e,o,a,s,i,l,r,n,c,d){"use strict";var p=e.noop,h={beforeShow:p,move:p,change:p,show:p,hide:p,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},f=[],u=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),g=function(){var t="";if(o.isIE)for(var e=1;e<=6;e++)t+="<div class='sp-"+e+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",t,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function v(t,e,o,a){for(var s=[],i=0;i<t.length;i++){var c=t[i];if(c){var d=r.Color(c),p=d.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";p+=n.equals(e,c)?" sp-thumb-active":"";var h=d.toString(a.preferredFormat||"rgb"),f="background-color:"+d.toRgbString();s.push('<span title="'+h+'" data-color="'+d.toRgbString()+'" class="'+p+'"><span class="sp-thumb-inner" style="'+f+';" /></span>')}else{s.push(l("<div />").append(l('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",a.noColorSelectedText)).html())}}return"<div class='sp-cf "+o+"'>"+s.join("")+"</div>"}var m=e.Evented.inherit({klassName:"ColorPicker",init:function(t,a){var i=function(t,o){var a=e.mixin({},h,t);return a.callbacks={move:k(a.move,o),change:k(a.change,o),show:k(a.show,o),hide:k(a.hide,o),beforeShow:k(a.beforeShow,o)},a}(a,t),c=i.flat,d=i.showSelectionPalette,p=i.localStorageKey,m=i.theme,y=i.callbacks,C=e.debounce(Kt,10),P=!1,x=!1,S=0,T=0,M=0,E=0,F=0,I=0,A=0,D=0,O=0,R=0,N=1,z=[],H=[],j={},q=i.selectionPalette.slice(0),K=i.maxSelectionSize,L="sp-dragging",W=null,B=t.ownerDocument,V=(B.body,l(t)),X=!1,Y=l(g,B).addClass(m),G=Y.find(".sp-picker-container"),J=Y.find(".sp-color"),Q=Y.find(".sp-dragger"),U=Y.find(".sp-hue"),Z=Y.find(".sp-slider"),$=Y.find(".sp-alpha-inner"),_=Y.find(".sp-alpha"),tt=Y.find(".sp-alpha-handle"),et=Y.find(".sp-input"),ot=Y.find(".sp-palette"),at=Y.find(".sp-initial"),st=Y.find(".sp-cancel"),it=Y.find(".sp-clear"),lt=Y.find(".sp-choose"),rt=Y.find(".sp-palette-toggle"),nt=V.is("input"),ct=nt&&"color"===V.attr("type")&&inputTypeColorSupport(),dt=nt&&!c,pt=dt?l(u).addClass(m).addClass(i.className).addClass(i.replacerClassName):l([]),ht=dt?pt:V,ft=pt.find(".sp-preview-inner"),ut=i.color||nt&&V.val(),gt=!1,vt=i.preferredFormat,mt=!i.showButtons||i.clickoutFiresChange,wt=!ut,kt=i.allowEmpty&&!ct;function bt(){if(i.showPaletteOnly&&(i.showPalette=!0),rt.text(i.showPaletteOnly?i.togglePaletteMoreText:i.togglePaletteLessText),i.palette){z=i.palette.slice(0),H=e.isArray(z[0])?z:[z],j={};for(var t=0;t<H.length;t++)for(var o=0;o<H[t].length;o++){var a=n(H[t][o]).toRgbString();j[a]=!0}}Y.toggleClass("sp-flat",c),Y.toggleClass("sp-input-disabled",!i.showInput),Y.toggleClass("sp-alpha-enabled",i.showAlpha),Y.toggleClass("sp-clear-enabled",kt),Y.toggleClass("sp-buttons-disabled",!i.showButtons),Y.toggleClass("sp-palette-buttons-disabled",!i.togglePaletteOnly),Y.toggleClass("sp-palette-disabled",!i.showPalette),Y.toggleClass("sp-palette-only",i.showPaletteOnly),Y.toggleClass("sp-initial-disabled",!i.showInitial),Y.addClass(i.className).addClass(i.containerClassName),Kt()}function yt(){if(p&&window.localStorage){try{var t=window.localStorage[p].split(",#");t.length>1&&(delete window.localStorage[p],e.each(t,function(t,e){Ct(e)}))}catch(t){}try{q=window.localStorage[p].split(";")}catch(t){}}}function Ct(t){if(d){var o=n(t).toRgbString();if(!j[o]&&-1===e.inArray(o,q))for(q.push(o);q.length>K;)q.shift();if(p&&window.localStorage)try{window.localStorage[p]=q.join(";")}catch(t){}}}function Pt(){var t=Nt(),o=e.map(H,function(e,o){return v(e,t,"sp-palette-row sp-palette-row-"+o,i)});yt(),q&&o.push(v(function(){var t=[];if(i.showPalette)for(var e=0;e<q.length;e++){var o=n(q[e]).toRgbString();j[o]||t.push(q[e])}return t.reverse().slice(0,i.maxSelectionSize)}(),t,"sp-palette-row sp-palette-row-selection",i)),ot.html(o.join(""))}function xt(){if(i.showInitial){var t=gt,e=Nt();at.html(v([t,e],e,"sp-palette-row-initial",i))}}function St(){(T<=0||S<=0||E<=0)&&Kt(),x=!0,Y.addClass(L),W=null,V.trigger("dragstart.ColorPicker",[Nt()])}function Tt(){x=!1,Y.removeClass(L),V.trigger("dragstop.ColorPicker",[Nt()])}function Mt(){var t=et.val();if(null!==t&&""!==t||!kt){var e=n(t);e.isValid()?(Rt(e),zt(),qt()):et.addClass("sp-validation-error")}else Rt(null),zt(),qt()}function Et(){P?Dt():Ft()}function Ft(){var t=s.create("beforeShow.ColorPicker");P?Kt():(V.trigger(t,[Nt()]),!1===y.beforeShow(Nt())||t.isDefaultPrevented()||(function(){for(var t=0;t<f.length;t++)f[t]&&f[t].hide()}(),P=!0,l(B).on("keydown.ColorPicker",It),l(B).on("click.ColorPicker",At),l(window).on("resize.ColorPicker",C),pt.addClass("sp-active"),Y.removeClass("sp-hidden"),Kt(),Ht(),gt=Nt(),xt(),y.show(gt),V.trigger("show.ColorPicker",[gt])))}function It(t){27===t.keyCode&&Dt()}function At(t){2!=t.button&&(x||(mt?qt(!0):Ot(),Dt()))}function Dt(){P&&!c&&(P=!1,l(B).off("keydown.ColorPicker",It),l(B).off("click.ColorPicker",At),l(window).off("resize.ColorPicker",C),pt.removeClass("sp-active"),Y.addClass("sp-hidden"),y.hide(Nt()),V.trigger("hide.ColorPicker",[Nt()]))}function Ot(){Rt(gt,!0),qt(!0)}function Rt(t,e){var o,a;n.equals(t,Nt())?Ht():(!t&&kt?wt=!0:(wt=!1,a=(o=r.Color(t)).toHsv(),D=a.h%360/360,O=a.s,R=a.v,N=a.a),Ht(),o&&o.isValid()&&!e&&(vt=i.preferredFormat||o.getFormat()))}function Nt(t){return t=t||{},kt&&wt?null:n.fromRatio({h:D,s:O,v:R,a:Math.round(1e3*N)/1e3},{format:t.format||vt})}function zt(){Ht(),y.move(Nt()),V.trigger("move.ColorPicker",[Nt()])}function Ht(){et.removeClass("sp-validation-error"),jt();var t=n.fromRatio({h:D,s:1,v:1});J.css("background-color",t.toHexString());var e=vt;N<1&&(0!==N||"name"!==e)&&("hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb"));var a=Nt({format:e}),s="";if(ft.removeClass("sp-clear-display"),ft.css("background-color","transparent"),!a&&kt)ft.addClass("sp-clear-display");else{var l=a.toHexString(),r=a.toRgbString();if(ft.css("background-color",r),i.showAlpha){var c=a.toRgb();c.a=0;var d=n(c).toRgbString(),p="linear-gradient(left, "+d+", "+l+")";o.isIE?$.css("filter",n(d).toFilter({gradientType:1},l)):($.css("background","-webkit-"+p),$.css("background","-moz-"+p),$.css("background","-ms-"+p),$.css("background","linear-gradient(to right, "+d+", "+l+")"))}s=a.toString(e)}i.showInput&&et.val(s),i.showPalette&&Pt(),xt()}function jt(){var t=O,e=R;if(kt&&wt)tt.hide(),Z.hide(),Q.hide();else{tt.show(),Z.show(),Q.show();var o=t*S,a=T-e*T;o=Math.max(-M,Math.min(S-M,o-M)),a=Math.max(-M,Math.min(T-M,a-M)),Q.css({top:a+"px",left:o+"px"});var s=N*F;tt.css({left:s-I/2+"px"});var i=D*E;Z.css({top:i-A+"px"})}}function qt(t){var e=Nt(),o="",a=!n.equals(e,gt);e&&(o=e.toString(vt),Ct(e)),nt&&V.val(o),t&&a&&(y.change(e),V.trigger("change",[e]))}function Kt(){var t,e,o,a,s,r,n,d,p,h,f,u;P&&(S=J.width(),T=J.height(),M=Q.height(),U.width(),E=U.height(),A=Z.height(),F=_.width(),I=tt.width(),c||(Y.css("position","absolute"),i.offset?Y.offset(i.offset):Y.offset((e=ht,o=(t=Y).outerWidth(),a=t.outerHeight(),s=e.outerHeight(),r=t[0].ownerDocument,n=r.documentElement,d=n.clientWidth+l(r).scrollLeft(),p=n.clientHeight+l(r).scrollTop(),h=e.offset(),f=h.left,u=h.top,u+=s,f-=Math.min(f,f+o>d&&d>o?Math.abs(f+o-d):0),{top:u-=Math.min(u,u+a>p&&p>a?Math.abs(a+s-0):0),bottom:h.bottom,left:f,right:h.right,width:h.width,height:h.height}))),jt(),i.showPalette&&Pt(),V.trigger("reflow.ColorPicker"))}function Lt(){Dt(),X=!0,V.attr("disabled",!0),ht.addClass("sp-disabled")}!function(){if(o.isIE&&Y.find("*:not(input)").attr("unselectable","on"),bt(),dt&&V.after(pt).hide(),kt||it.hide(),c)V.after(Y).hide();else{var t="parent"===i.appendTo?V.parent():l(i.appendTo);1!==t.length&&(t=l("body")),t.append(Y)}function e(t){return t.data&&t.data.ignore?(Rt(l(t.target).closest(".sp-thumb-el").data("color")),zt()):(Rt(l(t.target).closest(".sp-thumb-el").data("color")),zt(),i.hideAfterPaletteSelect?(qt(!0),Dt()):qt()),!1}yt(),ht.on("click.ColorPicker touchstart.ColorPicker",function(t){X||Et(),t.stopPropagation(),l(t.target).is("input")||t.preventDefault()}),(V.is(":disabled")||!0===i.disabled)&&Lt(),Y.click(w),et.change(Mt),et.on("paste",function(){setTimeout(Mt,1)}),et.keydown(function(t){13==t.keyCode&&Mt()}),st.text(i.cancelText),st.on("click.ColorPicker",function(t){t.stopPropagation(),t.preventDefault(),Ot(),Dt()}),it.attr("title",i.clearText),it.on("click.ColorPicker",function(t){t.stopPropagation(),t.preventDefault(),wt=!0,zt(),c&&qt(!0)}),lt.text(i.chooseText),lt.on("click.ColorPicker",function(t){t.stopPropagation(),t.preventDefault(),o.isIE&&et.is(":focus")&&et.trigger("change"),et.hasClass("sp-validation-error")||(qt(!0),Dt())}),rt.text(i.showPaletteOnly?i.togglePaletteMoreText:i.togglePaletteLessText),rt.on("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),i.showPaletteOnly=!i.showPaletteOnly,i.showPaletteOnly||c||Y.css("left","-="+(G.outerWidth(!0)+5)),bt()}),b(_,function(t,e,o){N=t/F,wt=!1,o.shiftKey&&(N=Math.round(10*N)/10),zt()},St,Tt),b(U,function(t,e){D=parseFloat(e/E),wt=!1,i.showAlpha||(N=1),zt()},St,Tt),b(J,function(t,e,o){if(o.shiftKey){if(!W){var a=O*S,s=T-R*T,l=Math.abs(t-a)>Math.abs(e-s);W=l?"x":"y"}}else W=null;var r=!W||"y"===W;(!W||"x"===W)&&(O=parseFloat(t/S)),r&&(R=parseFloat((T-e)/T)),wt=!1,i.showAlpha||(N=1),zt()},St,Tt),ut?(Rt(ut),Ht(),vt=i.preferredFormat||n(ut).format,Ct(ut)):Ht(),c&&Ft();var a=o.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";ot.on(a,".sp-thumb-el",e),at.on(a,".sp-thumb-el:nth-child(1)",{ignore:!0},e)}();var Wt={show:Ft,hide:Dt,toggle:Et,reflow:Kt,option:function(t,o){return void 0===t?e.mixin({},i):void 0===o?i[t]:(i[t]=o,"preferredFormat"===t&&(vt=i.preferredFormat),void bt())},enable:function(){X=!1,V.attr("disabled",!1),ht.removeClass("sp-disabled")},disable:Lt,offset:function(t){i.offset=t,Kt()},set:function(t){Rt(t),qt()},get:Nt,destroy:function(){V.show(),ht.off("click.ColorPicker touchstart.ColorPicker"),Y.remove(),pt.remove(),f[Wt.id]=null},container:Y};return Wt.id=f.push(Wt)-1,Wt}});function w(t){t.stopPropagation()}function k(t,e){var o=Array.prototype.slice,a=o.call(arguments,2);return function(){return t.apply(e,a.concat(o.call(arguments)))}}function b(t,e,a,s){e=e||function(){},a=a||function(){},s=s||function(){};var i=document,r=!1,n={},c=0,d=0,p="ontouchstart"in window,h={};function f(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.returnValue=!1}function u(a){if(r){if(o.isIE&&i.documentMode<9&&!a.button)return g();var s=a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches[0],l=s&&s.pageX||a.pageX,h=s&&s.pageY||a.pageY,u=Math.max(0,Math.min(l-n.left,d)),v=Math.max(0,Math.min(h-n.top,c));p&&f(a),e.apply(t,[u,v,a])}}function g(){r&&(l(i).off(h),l(i.body).removeClass("sp-dragging"),setTimeout(function(){s.apply(t,arguments)},0)),r=!1}h.selectstart=f,h.dragstart=f,h["touchmove mousemove"]=u,h["touchend mouseup"]=g,l(t).on("touchstart mousedown",function(e){(e.which?3==e.which:2==e.button)||r||!1!==a.apply(t,arguments)&&(r=!0,c=l(t).height(),d=l(t).width(),n=l(t).offset(),l(i).on(h),l(i.body).addClass("sp-dragging"),u(e),f(e))})}var y="ColorPicker.id";return m.load=!0,m.loadOpts={},m.draggable=b,m.defaults=h,m.localization={},m.palettes={},l.fn.colorPicker=function(t,o){if("string"==typeof t){var a=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=f[l(this).data(y)];if(e){var o=e[t];if(!o)throw new Error("skylark-ui-colorpicker: no such method: '"+t+"'");"get"==t?a=e.get():"container"==t?a=e.container:"option"==t?a=e.option.apply(e,s):"destroy"==t?(e.destroy(),l(this).removeData(y)):o.apply(e,s)}}),a}return this.colorPicker("destroy").each(function(){var o=e.mixin({},l(this).data(),t),a=m(this,o);l(this).data(y,a.id)})},t.attach("ui.ColorPicker",m)});
//# sourceMappingURL=sourcemaps/ColorPicker.js.map
