/**
 * skylark-data-entities - The skylark entityframework library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/langx","../entities"],function(t,e){function r(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var i=t.klass({_construct:function(t){this.name=t;var e=this.localStorage().getItem(this.name);this.records=e&&e.split(",")||[]},save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(t){return t.id||(t.id=r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r(),t.set(t.idAttribute,t.id)),this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),this.records.push(t.id.toString()),this.save(),this.find(t)},update:function(t){return this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),_.include(this.records,t.id.toString())||this.records.push(t.id.toString()),this.save(),this.find(t)},find:function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t.id))},findAll:function(){return _(this.records).chain().map(function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t))},this).compact().value()},destroy:function(t){return!t.isNew()&&(this.localStorage().removeItem(this.name+"-"+t.id),this.records=_.reject(this.records,function(e){return e===t.id.toString()}),this.save(),t)},localStorage:function(){return localStorage},jsonData:function(t){return t&&JSON.parse(t)}});function s(e,r,i){var s,n,o=r.localStorage||r.collection.localStorage,a=t.Deferred();try{switch(e){case"read":s=void 0!=r.id?o.find(r):o.findAll();break;case"create":s=o.create(r);break;case"update":s=o.update(r);break;case"delete":s=o.destroy(r)}}catch(t){n=t.code===DOMException.QUOTA_EXCEEDED_ERR&&0===window.localStorage.length?"Private browsing is unsupported":t.message}return s?(r.trigger("sync",r,s,i),i&&i.success&&i.success(s),a&&a.resolve(s)):(n=n||"Record Not Found",i&&i.error&&i.error(n),a&&a.reject(n)),i&&i.complete&&i.complete(s),a&&a.promise()}return e.backends.LocalStorage=s.LocalStorage=i,e.backends.localSync=s});
//# sourceMappingURL=../sourcemaps/backends/localSync.js.map
