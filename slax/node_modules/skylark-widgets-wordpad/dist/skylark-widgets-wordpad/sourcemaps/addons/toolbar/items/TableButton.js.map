{"version":3,"sources":["addons/toolbar/items/TableButton.js"],"names":["define","langx","$","ToolButton","i18n","addons","TableButton","inherit","_doActive","active","prototype","call","this","createMenu","hide","editMenu","show","renderMenu","$table","_this","translate","appendTo","menuWrapper","find","action","createTable","on","e","$td","$tr","$trs","num","removeClass","currentTarget","parent","index","prevAll","addBack","is","add","addClass","$closestBlock","colNum","rowNum","wrapper","editor","editable","inputManager","focused","length","selection","blockNodes","last","util","isEmptyNode","replaceWith","after","decorate","setRangeAtStartOf","trigger","toolbar","items","table"],"mappings":";;;;;;;AAAAA,QACE,sBACA,qBACA,sBACA,gBACA,mBACA,SAASC,EAAOC,EAAEC,EAAWC,EAAKC,GAElC,IAAIC,EAAcH,EAAWI,SAC3BC,UAAY,SAASC,GAInB,OAFAN,EAAWO,UAAUF,UAAUG,KAAKC,KAAMH,GAEtCA,GACFG,KAAKC,WAAWC,OACTF,KAAKG,SAASC,SAErBJ,KAAKC,WAAWG,OACTJ,KAAKG,SAASD,WA8D3B,OAvDAR,EAAYI,UAAUO,WAAa,WACjC,IAAIC,EAKiDC,EAiBrD,OArBAjB,EAAE,4NAA6OE,EAAKgB,UAAU,aAAgB,iLAA8LhB,EAAKgB,UAAU,kBAAqB,oMAAiNhB,EAAKgB,UAAU,kBAAqB,6OAA4PhB,EAAKgB,UAAU,gBAAmB,gLAA6LhB,EAAKgB,UAAU,oBAAuB,oMAAiNhB,EAAKgB,UAAU,qBAAwB,+OAA8PhB,EAAKgB,UAAU,eAAkB,mDAAmDC,SAAST,KAAKU,aAC9zDV,KAAKC,WAAaD,KAAKU,YAAYC,KAAK,sBACxCX,KAAKG,SAAWH,KAAKU,YAAYC,KAAK,oBACtCL,EAASN,KAAKY,OAAOC,YAAY,EAAG,GAAGJ,SAAST,KAAKC,YACrDD,KAAKC,WAAWa,GAAG,aAAc,UAAoBP,EAalDP,KAZM,SAASe,GACd,IAAIC,EAAKC,EAAKC,EAAMC,EASpB,OARAZ,EAAMN,WAAWU,KAAK,UAAUS,YAAY,YAG5CD,GADAF,GADAD,EAAM1B,EAAEyB,EAAEM,gBACAC,UACAX,KAAK,UAAUY,MAAMP,GAAO,EACtCE,EAAOD,EAAIO,QAAQ,MAAMC,UACrBR,EAAIK,SAASI,GAAG,WAClBR,EAAOA,EAAKS,IAAIrB,EAAOK,KAAK,cAEvBO,EAAKP,KAAK,SAAWQ,EAAM,YAAcA,EAAM,KAAKS,SAAS,eAGxE5B,KAAKC,WAAWa,GAAG,aAAc,SAASC,GACxC,OAAOzB,EAAEyB,EAAEM,eAAeV,KAAK,UAAUS,YAAY,cAEhDpB,KAAKC,WAAWa,GAAG,YAAa,SAAU,SAAUP,GACzD,OAAO,SAASQ,GACd,IAAIc,EAAeb,EAAKC,EAAKa,EAAQC,EAErC,GADAxB,EAAMyB,QAAQZ,YAAY,WACrBb,EAAM0B,OAAOC,SAASC,aAAaC,QAoBxC,OAfAN,GADAb,GADAD,EAAM1B,EAAEyB,EAAEM,gBACAC,UACGX,KAAK,MAAMY,MAAMP,GAAO,EACrCe,EAASd,EAAIO,QAAQ,MAAMa,OAAS,EAChCpB,EAAIK,SAASI,GAAG,WAClBK,GAAU,GAEZzB,EAASC,EAAMK,OAAOC,YAAYkB,EAAQD,GAAQ,GAClDD,EAAgBtB,EAAM0B,OAAOC,SAASI,UAAUC,aAAaC,OACzDjC,EAAM0B,OAAOC,SAASO,KAAKC,YAAYb,GACzCA,EAAcc,YAAYrC,GAE1BuB,EAAce,MAAMtC,GAEtBC,EAAMK,OAAOiC,SAASvC,GACtBC,EAAM0B,OAAOC,SAASI,UAAUQ,kBAAkBxC,EAAOK,KAAK,aAC9DJ,EAAM0B,OAAOc,QAAQ,iBACd,GAxBsC,CA0B9C/C,QAILP,EAAOuD,QAAQC,MAAMC,MAAQxD,EAEtBA","file":"../../../../addons/toolbar/items/TableButton.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-query\",\r\n  \"../../../ToolButton\",\r\n  \"../../../i18n\",\r\n  \"../../../addons\"\r\n],function(langx, $,ToolButton,i18n,addons){ \r\n\r\n  var TableButton = ToolButton.inherit({\r\n    _doActive : function(active) {\r\n\r\n      ToolButton.prototype._doActive.call(this, active);\r\n\r\n      if (active) {\r\n        this.createMenu.hide();\r\n        return this.editMenu.show();\r\n      } else {\r\n        this.createMenu.show();\r\n        return this.editMenu.hide();\r\n      }\r\n\r\n    }\r\n   });\r\n\r\n\r\n  TableButton.prototype.renderMenu = function() {\r\n    var $table;\r\n    $(\"<div class=\\\"menu-create-table\\\">\\n</div>\\n<div class=\\\"menu-edit-table\\\">\\n  <ul>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteRow\\\">\\n        <span>\" + (i18n.translate('deleteRow')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowAbove\\\">\\n        <span>\" + (i18n.translate('insertRowAbove')) + \" ( Ctrl + Alt + ↑ )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowBelow\\\">\\n        <span>\" + (i18n.translate('insertRowBelow')) + \" ( Ctrl + Alt + ↓ )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteCol\\\">\\n        <span>\" + (i18n.translate('deleteColumn')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColLeft\\\">\\n        <span>\" + (i18n.translate('insertColumnLeft')) + \" ( Ctrl + Alt + ← )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColRight\\\">\\n        <span>\" + (i18n.translate('insertColumnRight')) + \" ( Ctrl + Alt + → )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteTable\\\">\\n        <span>\" + (i18n.translate('deleteTable')) + \"</span>\\n      </a>\\n    </li>\\n  </ul>\\n</div>\").appendTo(this.menuWrapper);\r\n    this.createMenu = this.menuWrapper.find('.menu-create-table');\r\n    this.editMenu = this.menuWrapper.find('.menu-edit-table');\r\n    $table = this.action.createTable(6, 6).appendTo(this.createMenu);\r\n    this.createMenu.on('mouseenter', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $td, $tr, $trs, num;\r\n        _this.createMenu.find('td, th').removeClass('selected');\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        num = $tr.find('td, th').index($td) + 1;\r\n        $trs = $tr.prevAll('tr').addBack();\r\n        if ($tr.parent().is('tbody')) {\r\n          $trs = $trs.add($table.find('thead tr'));\r\n        }\r\n        return $trs.find(\"td:lt(\" + num + \"), th:lt(\" + num + \")\").addClass('selected');\r\n      };\r\n    })(this));\r\n    this.createMenu.on('mouseleave', function(e) {\r\n      return $(e.currentTarget).find('td, th').removeClass('selected');\r\n    });\r\n    return this.createMenu.on('mousedown', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $closestBlock, $td, $tr, colNum, rowNum;\r\n        _this.wrapper.removeClass('menu-on');\r\n        if (!_this.editor.editable.inputManager.focused) {\r\n          return;\r\n        }\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        colNum = $tr.find('td').index($td) + 1;\r\n        rowNum = $tr.prevAll('tr').length + 1;\r\n        if ($tr.parent().is('tbody')) {\r\n          rowNum += 1;\r\n        }\r\n        $table = _this.action.createTable(rowNum, colNum, true);\r\n        $closestBlock = _this.editor.editable.selection.blockNodes().last();\r\n        if (_this.editor.editable.util.isEmptyNode($closestBlock)) {\r\n          $closestBlock.replaceWith($table);\r\n        } else {\r\n          $closestBlock.after($table);\r\n        }\r\n        _this.action.decorate($table);\r\n        _this.editor.editable.selection.setRangeAtStartOf($table.find('th:first'));\r\n        _this.editor.trigger('valuechanged');\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n\r\n  addons.toolbar.items.table = TableButton;\r\n\r\n  return TableButton;\r\n\r\n\r\n});"]}