{"version":3,"sources":["Wordpad.js"],"names":["define","skylark","langx","$","Editable","Widget","Toolbar","uploader","i18n","addons","Wordpad","inherit","klassName","pluginName","options","classes","icons","html","header","bold","italic","underline","strikethrough","fontScale","fontColor","mark","blockquote","listul","listol","code","table","fullscreen","emoji","link","image","video","hr","indent","outdent","alignLeft","alignCenter","alignRight","alignJustify","srcNodeRef","placeholder","actions","placeholderImage","placeholderPoster","toolbar","items","params","upload","template","_init","editor","uploadOpts","this","_actions","opts","textarea","attr","length","Error","data","destroy","id","count","_render","self","editable","_elm","classPrefix","body","on","e","trigger","type","toolbarFloat","toolbarHidden","toolbarFloatOffset","_placeholder","setValue","val","trim","focus","prototype","triggerHandler","args","concat","Evented","apply","key","ref","results","el","insertBefore","wrapper","find","placeholderEl","append","blur","push","name","value","insertAfter","children","util","isEmptyNode","parseInt","css","indentWidth","show","hide","hidePopover","getValue","sync","findAction","action","constructor","each","i","popover","active","closest","off","selection","clear","inputManager","focused","removeData","remove","document","window","attach"],"mappings":"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","file":"../Wordpad.js","sourcesContent":["define([\n  \"skylark-langx/skylark\",\n  \"skylark-langx/langx\",\n  \"skylark-domx-query\",\n  \"skylark-domx-contents/Editable\",\n  \"skylark-widgets-base/Widget\",\n  \"./Toolbar\",\n  \"./uploader\",\n  \"./i18n\",\n  \"./addons\"\n\n],function(skylark,langx, $, Editable,Widget,Toolbar,uploader,i18n,addons){ \n\n  var Wordpad = Widget.inherit({\n      klassName : \"Wordpad\",\n      pluginName : \"lark.wordpad\",\n\n      options : {\n        classes : {\n          icons : {\n            html : \"fa fa-html5\",\n            \n            header: \"fa fa-header\",\n\n            bold : \"fa fa-bold\",\n            italic : \"fa fa-italic\",\n            underline: \"fa fa-underline\",\n            strikethrough : \"fa fa-strikethrough\",\n            fontScale: \"fa fa-text-height\",\n            fontColor: \"fa fa-font\",\n            mark : \"fa fa-pencil\",\n\n            blockquote: \"fa fa-quote-right\",\n            listul : \"fa fa-list-ul\",\n            listol : \"fa fa-list-ol\",\n            code: \"fa fa-code\",\n            table : \"fa fa-table\",\n\n            fullscreen : \"fa fa-expand\",\n\n            emoji: \"fa fa-smile-o\",\n            link : \"fa fa-link\",\n            image: \"fa fa-picture-o\",\n            video: \"fa fa-video-camera\",\n            hr: \"fa fa-minus\",\n\n            indent: \"fa fa-indent\",\n            outdent: \"fa fa-dedent\",\n            alignLeft: \"fa fa-align-left\",\n            alignCenter: \"fa fa-align-center\",\n            alignRight: \"fa fa-align-right\",\n            alignJustify: \"fa fa-align-justify\",\n\n          }\n        },\n        srcNodeRef: null,\n        placeholder: '',\n        addons : {\n          actions : {\n            image : {\n               placeholderImage: 'images/image.png',\n            },\n            video : {\n              placeholderPoster: \"images/poster.jpg\"\n            }\n          },\n          toolbar : {\n            items : {\n              emoji : {\n\n              }\n            }\n          }\n        },\n       \n        params: {},\n        upload: false,\n        template : \"<div class=\\\"lark-wordpad\\\">\\n  <div class=\\\"wordpad-wrapper\\\">\\n    <div class=\\\"wordpad-placeholder\\\"></div>\\n    <div class=\\\"wordpad-body\\\" contenteditable=\\\"true\\\">\\n    </div>\\n  </div>\\n</div>\"\n      },\n\n\n    _init : function() {\n      this._actions = [];\n\n      //this.opts = langx.extend({}, this.opts, opts);\n      this.opts = this.options;\n\n      var e, editor, uploadOpts;\n      this.textarea = $(this.options.srcNodeRef);\n\n      this.options.placeholder = this.options.placeholder || this.textarea.attr('placeholder');\n\n      if (!this.textarea.length) {\n        throw new Error('Wordpad: param textarea is required.');\n        return;\n      }\n\n      editor = this.textarea.data('wordpad');\n      if (editor != null) {\n        editor.destroy();\n      }\n      this.id = ++Wordpad.count;\n      this._render();\n\n\n      var self = this;\n      this.editable = new Editable(this._elm,{\n        classPrefix : \"lark-wordpad-\",\n        textarea : this.textarea,\n        body : this.body\n      });\n\n      // TODO\n      this.editable.on(\"all\",function(e,data){\n        return self.trigger(e.type,data);\n      });\n\n      if (this.options.upload && uploader) {\n        uploadOpts = typeof this.options.upload === 'object' ? this.options.upload : {};\n        this.uploader = uploader(uploadOpts);\n      }\n\n      this.toolbar = new Toolbar(this,{\n        toolbar: this.options.toolbar,\n        toolbarFloat:  this.options.toolbarFloat,\n        toolbarHidden:  this.options.toolbarHidden,\n        toolbarFloatOffset:  this.options.toolbarFloatOffset\n\n      });\n\n      if (this.options.placeholder) {\n        this.on('valuechanged', function() {\n          return self._placeholder();\n        });\n      }\n      this.setValue(this.textarea.val().trim() || '');\n      if (this.textarea.attr('autofocus')) {\n        return self.focus();\n      }\n\n\n    }\n  });\n\n \n  Wordpad.prototype.triggerHandler =  Wordpad.prototype.trigger = function(type,data) {\n    var args, ref;\n    args = [type];\n    if (data) {\n      args = args.concat(data);\n    }\n    langx.Evented.prototype.trigger.apply(this, args);\n    return this;\n  };\n\n\n  //Wordpad.connect(Util);\n\n  //Wordpad.connect(InputManager);\n\n  //Wordpad.connect(Selection);\n\n  //Wordpad.connect(UndoManager);\n\n  //Wordpad.connect(Keystroke);\n\n  //Wordpad.connect(Formatter);\n\n  //Wordpad.connect(Toolbar);\n\n  //Wordpad.connect(Indentation);\n\n  //Wordpad.connect(Clipboard);\n\n  Wordpad.count = 0;\n\n\n  Wordpad.prototype._render = function() {\n    var key, ref, results, val;\n\n    //this.el = $(this._tpl).insertBefore(this.textarea);\n    this.el = $(this._elm).insertBefore (this.textarea);\n\n    this.wrapper = this.el.find('.wordpad-wrapper');\n    this.body = this.wrapper.find('.wordpad-body');\n    this.placeholderEl = this.wrapper.find('.wordpad-placeholder').append(this.options.placeholder);\n    this.el.data('wordpad', this);\n    this.wrapper.append(this.textarea);\n    this.textarea.data('wordpad', this).blur();\n    this.body.attr('tabindex', this.textarea.attr('tabindex'));\n\n    if (this.options.params) {\n      ref = this.options.params;\n      results = [];\n      for (key in ref) {\n        val = ref[key];\n        results.push($('<input/>', {\n          type: 'hidden',\n          name: key,\n          value: val\n        }).insertAfter(this.textarea));\n      }\n      return results;\n    }\n  };\n\n  Wordpad.prototype._placeholder = function() {\n    var children;\n    children = this.body.children();\n    if (children.length === 0 || (children.length === 1 && this.editable.util.isEmptyNode(children) && parseInt(children.css('margin-left') || 0) < this.options.indentWidth)) {\n      return this.placeholderEl.show();\n    } else {\n      return this.placeholderEl.hide();\n    }\n  };\n\n  Wordpad.prototype.setValue = function(val) {\n    this.hidePopover();\n\n    this.editable.setValue(val);\n\n    return this.trigger('valuechanged');\n  };\n\n  Wordpad.prototype.getValue = function() {\n    return this.editable.getValue();\n  };\n\n  Wordpad.prototype.sync = function() {\n    this.editable.sync();\n    return this;\n  };\n\n  Wordpad.prototype.focus = function() {\n    this.editable.focus();\n    return this;\n  };\n\n  Wordpad.prototype.blur = function() {\n    this.editable.blur();\n    return this;\n  };\n\n  Wordpad.prototype.findAction = function(name) {\n    var action = this._actions[name];\n    if (!action) {\n      if (!this.constructor.addons.actions[name]) {\n        throw new Error(\"Wordpad: invalid action \" + name);\n      }\n\n      action = this._actions[name] = new this.constructor.addons.actions[name]({\n        editor: this\n      });\n\n      this._actions.push(action);\n    }\n\n    return action;\n  };\n\n  Wordpad.prototype.hidePopover = function() {\n    return this.el.find('.wordpad-popover').each(function(i, popover) {\n      popover = $(popover).data('popover');\n      if (popover.active) {\n        return popover.hide();\n      }\n    });\n  };\n\n  Wordpad.prototype.destroy = function() {\n    this.trigger('destroy');\n    this.textarea.closest('form').off('.Wordpad .wordpad-' + this.id);\n    this.selection.clear();\n    this.inputManager.focused = false;\n    this.textarea.insertBefore(this.el).hide().val('').removeData('wordpad');\n    this.el.remove();\n    $(document).off('.wordpad-' + this.id);\n    $(window).off('.wordpad-' + this.id);\n    return this.off();\n  };\n\n\n  Wordpad.Toolbar = Toolbar;\n\n  Wordpad.i18n = i18n;\n\n  Wordpad.addons = addons;\n\n\n  return skylark.attach(\"widgets.Wordpad\",Wordpad);\n\n});\n"]}