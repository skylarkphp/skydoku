{"version":3,"sources":["removing/buttons/MarkButton.js"],"names":["define","$","Toolbar","Wordpad","Button","i18n","MarkButton","inherit","name","prototype","icon","htmlTag","disableTag","command","$end","$start","range","this","editor","editable","selection","active","save","unmark","restore","trigger","collapsed","startContainer","endContainer","closest","length","setStartBefore","setEndAfter","mark","util","support","onselectionchange","$contents","$mark","extractContents","find","each","index","ele","replaceWith","html","append","insertNode","commonAncestorContainer","is","parent","addButton"],"mappings":";;;;;;;AAAAA,QACE,qBACA,aACA,aACA,YACA,WACA,SAASC,EAAEC,EAAQC,EAAQC,EAAOC,GAGlC,IAAIC,EAAaF,EAAOG,SACtBC,KAAO,SA2ET,OAtEAF,EAAWG,UAAUC,KAAO,OAE5BJ,EAAWG,UAAUE,QAAU,OAE/BL,EAAWG,UAAUG,WAAa,aAElCN,EAAWG,UAAUI,QAAU,WAC7B,IAAIC,EAAMC,EAAQC,EAElB,OADAA,EAAQC,KAAKC,OAAOC,SAASC,UAAUJ,QACnCC,KAAKI,QACPJ,KAAKC,OAAOC,SAASC,UAAUE,OAC/BL,KAAKM,OAAOP,GACZC,KAAKC,OAAOC,SAASC,UAAUI,eAC/BP,KAAKC,OAAOO,QAAQ,iBAGlBT,EAAMU,eAAV,GAGAT,KAAKC,OAAOC,SAASC,UAAUE,OAC/BP,EAASd,EAAEe,EAAMW,gBACjBb,EAAOb,EAAEe,EAAMY,cACXb,EAAOc,QAAQ,QAAQC,QACzBd,EAAMe,eAAehB,EAAOc,QAAQ,QAAQ,IAE1Cf,EAAKe,QAAQ,QAAQC,QACvBd,EAAMgB,YAAYlB,EAAKe,QAAQ,QAAQ,IAEzCZ,KAAKgB,KAAKjB,GACVC,KAAKC,OAAOC,SAASC,UAAUI,UAC/BP,KAAKC,OAAOO,QAAQ,gBAChBR,KAAKC,OAAOC,SAASe,KAAKC,QAAQC,kBAC7BnB,KAAKC,OAAOO,QAAQ,yBAD7B,IAKFnB,EAAWG,UAAUwB,KAAO,SAASjB,GACnC,IAAIqB,EAAWC,EASf,OARa,MAATtB,IACFA,EAAQC,KAAKC,OAAOC,SAASC,UAAUJ,UAEzCqB,EAAYpC,EAAEe,EAAMuB,oBACVC,KAAK,QAAQC,KAAK,SAASC,EAAOC,GAC1C,OAAO1C,EAAE0C,GAAKC,YAAY3C,EAAE0C,GAAKE,UAEnCP,EAAQrC,EAAE,UAAU6C,OAAOT,GACpBrB,EAAM+B,WAAWT,EAAM,KAGhChC,EAAWG,UAAUc,OAAS,SAASP,GACrC,IAAIsB,EAcJ,OAba,MAATtB,IACFA,EAAQC,KAAKC,OAAOC,SAASC,UAAUJ,SAErCA,EAAMU,WACRY,EAAQrC,EAAEe,EAAMgC,0BACLC,GAAG,UACZX,EAAQA,EAAMY,UAEPjD,EAAEe,EAAMW,gBAAgBE,QAAQ,QAAQC,OACjDQ,EAAQrC,EAAEe,EAAMW,gBAAgBE,QAAQ,QAC/B5B,EAAEe,EAAMY,cAAcC,QAAQ,QAAQC,SAC/CQ,EAAQrC,EAAEe,EAAMY,cAAcC,QAAQ,SAEjCS,EAAMM,YAAYN,EAAMO,SAIjC1C,EAAQD,QAAQiD,UAAU7C,GAEnBA","file":"../../../removing/buttons/MarkButton.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"../Toolbar\",\r\n  \"../Wordpad\",\r\n  \"../Button\",\r\n  \"../i18n\"\r\n],function($,Toolbar,Wordpad,Button,i18n){ \r\n\r\n\r\n  var MarkButton = Button.inherit({\r\n    name : 'mark'\r\n\r\n  });\r\n\r\n\r\n  MarkButton.prototype.icon = 'mark';\r\n\r\n  MarkButton.prototype.htmlTag = 'mark';\r\n\r\n  MarkButton.prototype.disableTag = 'pre, table';\r\n\r\n  MarkButton.prototype.command = function() {\r\n    var $end, $start, range;\r\n    range = this.editor.editable.selection.range();\r\n    if (this.active) {\r\n      this.editor.editable.selection.save();\r\n      this.unmark(range);\r\n      this.editor.editable.selection.restore();\r\n      this.editor.trigger('valuechanged');\r\n      return;\r\n    }\r\n    if (range.collapsed) {\r\n      return;\r\n    }\r\n    this.editor.editable.selection.save();\r\n    $start = $(range.startContainer);\r\n    $end = $(range.endContainer);\r\n    if ($start.closest('mark').length) {\r\n      range.setStartBefore($start.closest('mark')[0]);\r\n    }\r\n    if ($end.closest('mark').length) {\r\n      range.setEndAfter($end.closest('mark')[0]);\r\n    }\r\n    this.mark(range);\r\n    this.editor.editable.selection.restore();\r\n    this.editor.trigger('valuechanged');\r\n    if (this.editor.editable.util.support.onselectionchange) {\r\n      return this.editor.trigger('selectionchanged');\r\n    }\r\n  };\r\n\r\n  MarkButton.prototype.mark = function(range) {\r\n    var $contents, $mark;\r\n    if (range == null) {\r\n      range = this.editor.editable.selection.range();\r\n    }\r\n    $contents = $(range.extractContents());\r\n    $contents.find('mark').each(function(index, ele) {\r\n      return $(ele).replaceWith($(ele).html());\r\n    });\r\n    $mark = $('<mark>').append($contents);\r\n    return range.insertNode($mark[0]);\r\n  };\r\n\r\n  MarkButton.prototype.unmark = function(range) {\r\n    var $mark;\r\n    if (range == null) {\r\n      range = this.editor.editable.selection.range();\r\n    }\r\n    if (range.collapsed) {\r\n      $mark = $(range.commonAncestorContainer);\r\n      if (!$mark.is('mark')) {\r\n        $mark = $mark.parent();\r\n      }\r\n    } else if ($(range.startContainer).closest('mark').length) {\r\n      $mark = $(range.startContainer).closest('mark');\r\n    } else if ($(range.endContainer).closest('mark').length) {\r\n      $mark = $(range.endContainer).closest('mark');\r\n    }\r\n    return $mark.replaceWith($mark.html());\r\n  };  \r\n\r\n  \r\n  Wordpad.Toolbar.addButton(MarkButton);\r\n\r\n  return MarkButton;\r\n\r\n }); "]}