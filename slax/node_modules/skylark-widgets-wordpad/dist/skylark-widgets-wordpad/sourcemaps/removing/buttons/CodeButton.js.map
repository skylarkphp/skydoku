{"version":3,"sources":["removing/buttons/CodeButton.js"],"names":["define","$","Toolbar","Wordpad","Button","CodePopover","CodeButton","inherit","prototype","name","icon","htmlTag","disableTag","_init","_this","call","this","editor","on","e","$el","find","each","i","pre","decorate","undecorate","render","args","arguments","length","Array","slice","apply","popover","button","_checkMode","range","editable","selection","cloneContents","util","blockNodes","join","collapsed","startNodes","filter","inlineMode","_status","active","show","node","hide","$pre","$code","lang","ref","ref1","attr","match","contents","unwrap","addClass","wrapInner","removeAttr","command","_inlineCommand","_blockCommand","blockCode","inlineCode","addButton"],"mappings":";;;;;;;AAAAA,QACE,qBACA,aACA,aACA,YACA,iBACA,SAASC,EAAEC,EAAQC,EAAQC,EAAOC,GAGjC,IAAIC,EAAaF,EAAOG,YA0GzB,OApGAD,EAAWE,UAAUC,KAAO,OAE5BH,EAAWE,UAAUE,KAAO,OAE5BJ,EAAWE,UAAUG,QAAU,MAE/BL,EAAWE,UAAUI,WAAa,gBAElCN,EAAWE,UAAUK,MAAQ,WAEA,IAAUC,EAOrC,OARAV,EAAOI,UAAUK,MAAME,KAAKC,MAC5BA,KAAKC,OAAOC,GAAG,YAAsBJ,EAMlCE,KALM,SAASG,EAAGC,GACjB,OAAOA,EAAIC,KAAK,OAAOC,KAAK,SAASC,EAAGC,GACtC,OAAOV,EAAMW,SAASxB,EAAEuB,SAIvBR,KAAKC,OAAOC,GAAG,aAAc,SAAUJ,GAC5C,OAAO,SAASK,EAAGC,GACjB,OAAOA,EAAIC,KAAK,OAAOC,KAAK,SAASC,EAAGC,GACtC,OAAOV,EAAMY,WAAWzB,EAAEuB,OAHI,CAMjCR,QAGLV,EAAWE,UAAUmB,OAAS,WAC5B,IAAIC,EAGJ,OAFAA,EAAO,GAAKC,UAAUC,OAASC,MAAMvB,UAAUwB,MAAMjB,KAAKc,UAAW,MACrEzB,EAAOI,UAAUmB,OAAOM,MAAMjB,KAAMY,GAC7BZ,KAAKkB,QAAU,IAAI7B,GACxB8B,OAAQnB,QAIZV,EAAWE,UAAU4B,WAAa,WAChC,IAAiBC,EAEjB,OADAA,EAAQrB,KAAKC,OAAOqB,SAASC,UAAUF,QACpBpC,EAAEoC,EAAMG,iBAAiBnB,KAAKL,KAAKC,OAAOqB,SAASG,KAAKC,WAAWC,KAAK,MAAS,GAAMN,EAAMO,WAAmF,IAAtE5B,KAAKC,OAAOqB,SAASC,UAAUM,aAAaC,OAAO,QAAQhB,QACtLd,KAAK+B,YAAa,EACX/B,KAAKL,QAAU,QAEtBK,KAAK+B,YAAa,EACX/B,KAAKL,QAAU,SAI1BL,EAAWE,UAAUwC,QAAU,WAG7B,GAFAhC,KAAKoB,aACLhC,EAAOI,UAAUwC,QAAQjC,KAAKC,OAC1BA,KAAK+B,WAGT,OAAI/B,KAAKiC,OACAjC,KAAKkB,QAAQgB,KAAKlC,KAAKmC,MAEvBnC,KAAKkB,QAAQkB,QAIxB9C,EAAWE,UAAUiB,SAAW,SAAS4B,GACvC,IAAIC,EAAOC,EAAMC,EAAKC,EAEtB,IADAH,EAAQD,EAAKhC,KAAK,WACRS,OAAS,IACjByB,EAAsC,OAA9BC,EAAMF,EAAMI,KAAK,WAAwD,OAAnCD,EAAOD,EAAIG,MAAM,eAAyBF,EAAK,QAAc,EAC3GH,EAAMM,WAAWC,SACbN,GACF,OAAOF,EAAKK,KAAK,YAAaH,IAKpCjD,EAAWE,UAAUkB,WAAa,SAAS2B,GACzC,IAAIC,EAAOC,EAMX,OALAA,EAAOF,EAAKK,KAAK,aACjBJ,EAAQrD,EAAE,WACNsD,IAAkB,IAAVA,GACVD,EAAMQ,SAAS,QAAUP,GAEpBF,EAAKU,UAAUT,GAAOU,WAAW,cAG1C1D,EAAWE,UAAUyD,QAAU,WAC7B,OAAIjD,KAAK+B,WACA/B,KAAKkD,iBAELlD,KAAKmD,iBAIhB7D,EAAWE,UAAU2D,cAAgB,WACnC,OAAOnD,KAAKC,OAAOqB,SAAS8B,UAAUpD,KAAKL,QAAQK,KAAKJ,aAG1DN,EAAWE,UAAU0D,eAAiB,WACpC,OAAOlD,KAAKC,OAAOqB,SAAS+B,WAAWrD,KAAKiC,SAG9C9C,EAAQD,QAAQoE,UAAUhE,GAEnBA","file":"../../../removing/buttons/CodeButton.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"../Toolbar\",\r\n  \"../Wordpad\",\r\n  \"../Button\",\r\n  \"./CodePopover\"\r\n],function($,Toolbar,Wordpad,Button,CodePopover){ \r\n  \r\n\r\n   var CodeButton = Button.inherit({\r\n\r\n   });\r\n\r\n\r\n\r\n  CodeButton.prototype.name = 'code';\r\n\r\n  CodeButton.prototype.icon = 'code';\r\n\r\n  CodeButton.prototype.htmlTag = 'pre';\r\n\r\n  CodeButton.prototype.disableTag = 'ul, ol, table';\r\n\r\n  CodeButton.prototype._init = function() {\r\n    Button.prototype._init.call(this);\r\n    this.editor.on('decorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('pre').each(function(i, pre) {\r\n          return _this.decorate($(pre));\r\n        });\r\n      };\r\n    })(this));\r\n    return this.editor.on('undecorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('pre').each(function(i, pre) {\r\n          return _this.undecorate($(pre));\r\n        });\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  CodeButton.prototype.render = function() {\r\n    var args;\r\n    args = 1 <= arguments.length ? Array.prototype.slice.call(arguments, 0) : [];\r\n    Button.prototype.render.apply(this, args);\r\n    return this.popover = new CodePopover({\r\n      button: this\r\n    });\r\n  };\r\n\r\n  CodeButton.prototype._checkMode = function() {\r\n    var $blockNodes, range;\r\n    range = this.editor.editable.selection.range();\r\n    if (($blockNodes = $(range.cloneContents()).find(this.editor.editable.util.blockNodes.join(','))) > 0 || (range.collapsed && this.editor.editable.selection.startNodes().filter('code').length === 0)) {\r\n      this.inlineMode = false;\r\n      return this.htmlTag = 'pre';\r\n    } else {\r\n      this.inlineMode = true;\r\n      return this.htmlTag = 'code';\r\n    }\r\n  };\r\n\r\n  CodeButton.prototype._status = function() {\r\n    this._checkMode();\r\n    Button.prototype._status.call(this);\r\n    if (this.inlineMode) {\r\n      return;\r\n    }\r\n    if (this.active) {\r\n      return this.popover.show(this.node);\r\n    } else {\r\n      return this.popover.hide();\r\n    }\r\n  };\r\n\r\n  CodeButton.prototype.decorate = function($pre) {\r\n    var $code, lang, ref, ref1;\r\n    $code = $pre.find('> code');\r\n    if ($code.length > 0) {\r\n      lang = (ref = $code.attr('class')) != null ? (ref1 = ref.match(/lang-(\\S+)/)) != null ? ref1[1] : void 0 : void 0;\r\n      $code.contents().unwrap();\r\n      if (lang) {\r\n        return $pre.attr('data-lang', lang);\r\n      }\r\n    }\r\n  };\r\n\r\n  CodeButton.prototype.undecorate = function($pre) {\r\n    var $code, lang;\r\n    lang = $pre.attr('data-lang');\r\n    $code = $('<code/>');\r\n    if (lang && lang !== -1) {\r\n      $code.addClass('lang-' + lang);\r\n    }\r\n    return $pre.wrapInner($code).removeAttr('data-lang');\r\n  };\r\n\r\n  CodeButton.prototype.command = function() {\r\n    if (this.inlineMode) {\r\n      return this._inlineCommand();\r\n    } else {\r\n      return this._blockCommand();\r\n    }\r\n  };\r\n\r\n  CodeButton.prototype._blockCommand = function() {\r\n    return this.editor.editable.blockCode(this.htmlTag,this.disableTag);\r\n  };\r\n\r\n  CodeButton.prototype._inlineCommand = function() {\r\n    return this.editor.editable.inlineCode(this.active);\r\n  };\r\n\r\n  Wordpad.Toolbar.addButton(CodeButton);    \r\n\r\n  return CodeButton;\r\n\r\n});"]}