{"version":3,"sources":["removing/buttons/TableButton.js"],"names":["define","langx","tables","$","Toolbar","Wordpad","Button","TableButton","inherit","prototype","name","icon","htmlTag","disableTag","menu","_init","_this","call","this","merge","editor","editable","formatter","_allowedTags","extend","_allowedAttributes","td","col","_allowedStyles","th","_initShortcuts","_initResize","on","e","$el","find","each","i","table","decorate","undecorate","$container","range","body","removeClass","selection","containerNode","collapsed","is","setRangeAtEndOf","closest","addClass","keystroke","add","$node","_tdNav","$td","direction","$anotherTr","$tr","action","index","ref","parent","length","eq","resizable","document","cssClasses","resizeHandle","wrapper","hotkeys","editMenu","click","renderMenu","$table","_t","appendTo","menuWrapper","createMenu","createTable","$trs","num","currentTarget","prevAll","addBack","$closestBlock","colNum","rowNum","inputManager","focused","blockNodes","last","util","isEmptyNode","replaceWith","after","setRangeAtStartOf","trigger","tableDecorate","row","phBr","refreshTableWidth","setActive","active","hide","show","deleteRow","ret","self","newTr","insertRow","deleteCol","newTd","insertCol","deleteTable","$block","command","param","addButton"],"mappings":"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","file":"../../../removing/buttons/TableButton.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-tables\",\r\n  \"skylark-domx-query\",\r\n  \"../Toolbar\",\r\n  \"../Wordpad\",\r\n  \"../Button\"\r\n],function(langx,tables,$,Toolbar,Wordpad,Button){ \r\n  var TableButton = Button.inherit({\r\n\r\n   });\r\n\r\n\r\n  TableButton.prototype.name = 'table';\r\n\r\n  TableButton.prototype.icon = 'table';\r\n\r\n  TableButton.prototype.htmlTag = 'table';\r\n\r\n  TableButton.prototype.disableTag = 'pre, li, blockquote';\r\n\r\n  TableButton.prototype.menu = true;\r\n\r\n  TableButton.prototype._init = function() {\r\n    Button.prototype._init.call(this);\r\n    langx.merge(this.editor.editable.formatter._allowedTags, ['thead', 'th', 'tbody', 'tr', 'td', 'colgroup', 'col']);\r\n    langx.extend(this.editor.editable.formatter._allowedAttributes, {\r\n      td: ['rowspan', 'colspan'],\r\n      col: ['width']\r\n    });\r\n    langx.extend(this.editor.editable.formatter._allowedStyles, {\r\n      td: ['text-align'],\r\n      th: ['text-align']\r\n    });\r\n    this._initShortcuts();\r\n    this._initResize();\r\n    this.editor.on('decorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('table').each(function(i, table) {\r\n          return _this.decorate($(table));\r\n        });\r\n      };\r\n    })(this));\r\n    this.editor.on('undecorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('table').each(function(i, table) {\r\n          return _this.undecorate($(table));\r\n        });\r\n      };\r\n    })(this));\r\n    this.editor.on('selectionchanged.table', (function(_this) {\r\n      return function(e) {\r\n        var $container, range;\r\n        _this.editor.body.find('.wordpad-table td, .wordpad-table th').removeClass('active');\r\n        range = _this.editor.editable.selection.range();\r\n        if (!range) {\r\n          return;\r\n        }\r\n        $container = _this.editor.editable.selection.containerNode();\r\n        if (range.collapsed && $container.is('.wordpad-table')) {\r\n          _this.editor.editable.selection.setRangeAtEndOf($container);\r\n        }\r\n        return $container.closest('td, th', _this.editor.body).addClass('active');\r\n      };\r\n    })(this));\r\n    this.editor.on('blur.table', (function(_this) {\r\n      return function(e) {\r\n        return _this.editor.body.find('.wordpad-table td, .wordpad-table th').removeClass('active');\r\n      };\r\n    })(this));\r\n    this.editor.editable.keystroke.add('up', 'td', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'up');\r\n        return true;\r\n      };\r\n    })(this));\r\n    this.editor.editable.keystroke.add('up', 'th', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'up');\r\n        return true;\r\n      };\r\n    })(this));\r\n    this.editor.editable.keystroke.add('down', 'td', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'down');\r\n        return true;\r\n      };\r\n    })(this));\r\n    return this.editor.editable.keystroke.add('down', 'th', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'down');\r\n        return true;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype._tdNav = function($td, direction) {\r\n    var $anotherTr, $tr, action, anotherTag, index, parentTag, ref;\r\n    if (direction == null) {\r\n      direction = 'up';\r\n    }\r\n    action = direction === 'up' ? 'prev' : 'next';\r\n    ref = direction === 'up' ? ['tbody', 'thead'] : ['thead', 'tbody'], parentTag = ref[0], anotherTag = ref[1];\r\n    $tr = $td.parent('tr');\r\n    $anotherTr = this[\"_\" + action + \"Row\"]($tr);\r\n    if (!($anotherTr.length > 0)) {\r\n      return true;\r\n    }\r\n    index = $tr.find('td, th').index($td);\r\n    return this.editor.editable.selection.setRangeAtEndOf($anotherTr.find('td, th').eq(index));\r\n  };\r\n\r\n  TableButton.prototype._initResize = function() {\r\n\r\n    tables.resizable(document,{\r\n      cssClasses : {\r\n        resizeHandle : \"wordpad-resize-handle\",\r\n        wrapper : \"wordpad-table\"\r\n      }\r\n    });\r\n\r\n  };\r\n\r\n  TableButton.prototype._initShortcuts = function() {\r\n    this.editor.editable.hotkeys.add('ctrl+alt+up', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertRowAbove]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    this.editor.editable.hotkeys.add('ctrl+alt+down', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertRowBelow]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    this.editor.editable.hotkeys.add('ctrl+alt+left', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertColLeft]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    return this.editor.editable.hotkeys.add('ctrl+alt+right', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertColRight]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype.renderMenu = function() {\r\n    var $table;\r\n    $(\"<div class=\\\"menu-create-table\\\">\\n</div>\\n<div class=\\\"menu-edit-table\\\">\\n  <ul>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteRow\\\">\\n        <span>\" + (this._t('deleteRow')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowAbove\\\">\\n        <span>\" + (this._t('insertRowAbove')) + \" ( Ctrl + Alt + ↑ )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowBelow\\\">\\n        <span>\" + (this._t('insertRowBelow')) + \" ( Ctrl + Alt + ↓ )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteCol\\\">\\n        <span>\" + (this._t('deleteColumn')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColLeft\\\">\\n        <span>\" + (this._t('insertColumnLeft')) + \" ( Ctrl + Alt + ← )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColRight\\\">\\n        <span>\" + (this._t('insertColumnRight')) + \" ( Ctrl + Alt + → )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteTable\\\">\\n        <span>\" + (this._t('deleteTable')) + \"</span>\\n      </a>\\n    </li>\\n  </ul>\\n</div>\").appendTo(this.menuWrapper);\r\n    this.createMenu = this.menuWrapper.find('.menu-create-table');\r\n    this.editMenu = this.menuWrapper.find('.menu-edit-table');\r\n    $table = this.createTable(6, 6).appendTo(this.createMenu);\r\n    this.createMenu.on('mouseenter', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $td, $tr, $trs, num;\r\n        _this.createMenu.find('td, th').removeClass('selected');\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        num = $tr.find('td, th').index($td) + 1;\r\n        $trs = $tr.prevAll('tr').addBack();\r\n        if ($tr.parent().is('tbody')) {\r\n          $trs = $trs.add($table.find('thead tr'));\r\n        }\r\n        return $trs.find(\"td:lt(\" + num + \"), th:lt(\" + num + \")\").addClass('selected');\r\n      };\r\n    })(this));\r\n    this.createMenu.on('mouseleave', function(e) {\r\n      return $(e.currentTarget).find('td, th').removeClass('selected');\r\n    });\r\n    return this.createMenu.on('mousedown', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $closestBlock, $td, $tr, colNum, rowNum;\r\n        _this.wrapper.removeClass('menu-on');\r\n        if (!_this.editor.editable.inputManager.focused) {\r\n          return;\r\n        }\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        colNum = $tr.find('td').index($td) + 1;\r\n        rowNum = $tr.prevAll('tr').length + 1;\r\n        if ($tr.parent().is('tbody')) {\r\n          rowNum += 1;\r\n        }\r\n        $table = _this.createTable(rowNum, colNum, true);\r\n        $closestBlock = _this.editor.editable.selection.blockNodes().last();\r\n        if (_this.editor.editable.util.isEmptyNode($closestBlock)) {\r\n          $closestBlock.replaceWith($table);\r\n        } else {\r\n          $closestBlock.after($table);\r\n        }\r\n        _this.decorate($table);\r\n        _this.editor.editable.selection.setRangeAtStartOf($table.find('th:first'));\r\n        _this.editor.trigger('valuechanged');\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype.decorate = function($table) {\r\n    return $(tables.decorate($table[0],{\r\n      tableDecorate : 'wordpad-table',\r\n      resizeHandle : 'wordpad-resize-handle'\r\n    }));\r\n\r\n  };\r\n\r\n  TableButton.prototype.undecorate = function($table) {\r\n    return $(tables.undecorate($table[0],{\r\n      tableDecorate : 'wordpad-table',\r\n      resizeHandle : 'wordpad-resize-handle'\r\n    }));\r\n\r\n  };\r\n\r\n\r\n  TableButton.prototype.createTable = function(row, col, phBr) {\r\n    return $(tables.createTable(row,col,phBr ? this.editor.editable.util.phBr : null));\r\n  };\r\n\r\n  TableButton.prototype.refreshTableWidth = function($table) {\r\n    return table.refreshTableWidth($table[0]);\r\n  };\r\n\r\n  TableButton.prototype.setActive = function(active) {\r\n    Button.prototype.setActive.call(this, active);\r\n    if (active) {\r\n      this.createMenu.hide();\r\n      return this.editMenu.show();\r\n    } else {\r\n      this.createMenu.show();\r\n      return this.editMenu.hide();\r\n    }\r\n  };\r\n\r\n  TableButton.prototype.deleteRow = function($td) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.deleteRow($td[0],function(newTr,index){\r\n      if (newTr) {\r\n        ret = self.editor.editable.selection.setRangeAtEndOf($(newTr).find('td, th').eq(index));\r\n      }\r\n    })\r\n\r\n    return ret;\r\n  };\r\n\r\n  TableButton.prototype.insertRow = function($td, direction) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.insertRow($td[0],direction,self.editor.editable.util.phBr,function(newTr,index){\r\n      ret =  self.editor.editable.selection.setRangeAtStartOf($(newTr).find('td, th').eq(index));\r\n    })\r\n\r\n    return ret;\r\n\r\n  };\r\n\r\n  TableButton.prototype.deleteCol = function($td) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.deleteCol($td[0],function(newTd){\r\n      if (newTd) {\r\n        ret = self.editor.editable.selection.setRangeAtEndOf($(newTd));\r\n      }\r\n    })\r\n\r\n    return ret;\r\n  };\r\n\r\n  TableButton.prototype.insertCol = function($td, direction) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.insertCol($td[0],direction,self.editor.editable.util.phBr,function(newTd){\r\n      ret = self.editor.editable.selection.setRangeAtStartOf($(newTd));\r\n    })\r\n\r\n    return ret;\r\n  };\r\n\r\n  TableButton.prototype.deleteTable = function($td) {\r\n    var self = this;\r\n    tables.deleteTable($td[0],function($block){\r\n      if ($block.length > 0) {\r\n        return self.editor.editable.selection.setRangeAtStartOf($block);\r\n      }\r\n    });\r\n  };\r\n\r\n  TableButton.prototype.command = function(param) {\r\n    var $td;\r\n    $td = this.editor.editable.selection.containerNode().closest('td, th');\r\n    if (!($td.length > 0)) {\r\n      return;\r\n    }\r\n    if (param === 'deleteRow') {\r\n      this.deleteRow($td);\r\n    } else if (param === 'insertRowAbove') {\r\n      this.insertRow($td, 'before');\r\n    } else if (param === 'insertRowBelow') {\r\n      this.insertRow($td);\r\n    } else if (param === 'deleteCol') {\r\n      this.deleteCol($td);\r\n    } else if (param === 'insertColLeft') {\r\n      this.insertCol($td, 'before');\r\n    } else if (param === 'insertColRight') {\r\n      this.insertCol($td);\r\n    } else if (param === 'deleteTable') {\r\n      this.deleteTable($td);\r\n    } else {\r\n      return;\r\n    }\r\n    return this.editor.trigger('valuechanged');\r\n  };\r\n\r\n  Wordpad.Toolbar.addButton(TableButton);\r\n\r\n  return TableButton;\r\n\r\n\r\n});"]}