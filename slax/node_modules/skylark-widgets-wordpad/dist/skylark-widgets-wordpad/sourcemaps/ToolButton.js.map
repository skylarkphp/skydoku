{"version":3,"sources":["ToolButton.js"],"names":["define","langx","$","Widget","i18n","inherit","options","template","menu","menuWrapper","menuItem","separator","_construct","opts","this","action","toolbar","editor","prototype","call","_init","render","_this","el","on","e","noFocus","param","preventDefault","needFocus","editable","inputManager","focused","hasClass","focus","wrapper","toggleClass","siblings","removeClass","is","offset","left","outerWidth","css","right","trigger","data","command","btn","currentTarget","state","args","updates","undefined","_doActive","value","_doDisabled","active","disabled","iconClassOf","icon","setIcon","find","addClass","text","addToolItem","_elm","attr","title","name","appendTo","renderMenu","$menuBtnEl","k","len","ref","ref1","results","isArray","menuEl","length","data-param","push","params","execute","get","tooltip","htmlTag","disableTag","_options","shortcut"],"mappings":"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","file":"../ToolButton.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-widgets-base/Widget\",\r\n  \"./i18n\"\r\n],function(langx, $, Widget, i18n){ \r\n  var slice = [].slice;\r\n\r\n  var ToolButton = Widget.inherit( {\r\n\r\n    options : {\r\n      template: '<li><a tabindex=\"-1\" unselectable=\"on\" class=\"toolbar-item\" href=\"javascript:;\"><span></span></a></li>',\r\n\r\n      menu : {\r\n        menuWrapper: '<div class=\"toolbar-menu\"></div>',\r\n        menuItem: '<li><a tabindex=\"-1\" unselectable=\"on\" class=\"menu-item\" href=\"javascript:;\"><span></span></a></li>',\r\n        separator: '<li><span class=\"separator\"></span></li>'      \r\n      }\r\n\r\n    },\r\n\r\n    _construct : function(opts) {\r\n      this.action = opts.action;\r\n      this.toolbar = opts.toolbar;\r\n      this.editor = opts.toolbar.editor;\r\n      Widget.prototype._construct.call(this,opts);\r\n    },\r\n\r\n    _init : function() {\r\n      var k, len, ref, tag;\r\n      this.render();\r\n      var _this = this;\r\n      this.el.on('mousedown', function(e) {\r\n          var exceed, noFocus, param;\r\n          e.preventDefault();\r\n          noFocus = _this.needFocus && !_this.editor.editable.inputManager.focused;\r\n          if (_this.el.hasClass('disabled')) {\r\n            return false;\r\n          }\r\n          if (noFocus) {\r\n            _this.editor.focus();\r\n          }\r\n          if (_this.menu) {\r\n            _this.wrapper.toggleClass('menu-on').siblings('li').removeClass('menu-on');\r\n            if (_this.wrapper.is('.menu-on')) {\r\n              exceed = _this.menuWrapper.offset().left + _this.menuWrapper.outerWidth() + 5 - _this.editor.wrapper.offset().left - _this.editor.wrapper.outerWidth();\r\n              if (exceed > 0) {\r\n                _this.menuWrapper.css({\r\n                  'left': 'auto',\r\n                  'right': 0\r\n                });\r\n              }\r\n              _this.trigger('menuexpand');\r\n            }\r\n            return false;\r\n          }\r\n          param = _this.el.data('param');\r\n          _this.command(param);\r\n          return false;\r\n      });\r\n      this.wrapper.on('click', 'a.menu-item', function(e) {\r\n          var btn, noFocus, param;\r\n          e.preventDefault();\r\n          btn = $(e.currentTarget);\r\n          _this.wrapper.removeClass('menu-on');\r\n          noFocus = _this.needFocus && !_this.editor.editable.inputManager.focused;\r\n          if (btn.hasClass('disabled') || noFocus) {\r\n            return false;\r\n          }\r\n          _this.toolbar.wrapper.removeClass('menu-on');\r\n          param = btn.data('param');\r\n          _this.command(param);\r\n          return false;\r\n      });\r\n      this.wrapper.on('mousedown', 'a.menu-item', function(e) {\r\n        return false;\r\n      });\r\n\r\n      this.action.state.on(\"changed\", function(e,args) {\r\n        var updates = args.data;\r\n        if (updates[\"active\"] !== undefined) {\r\n          _this._doActive(updates[\"active\"].value);\r\n        }\r\n\r\n        if (updates[\"disabled\"] !== undefined) {\r\n          _this._doDisabled(updates[\"disabled\"].value);\r\n        }\r\n\r\n      });\r\n    },\r\n\r\n    _doActive : function(value) {\r\n      return this.el.toggleClass('active', this.active);\r\n    },\r\n\r\n    _doDisabled : function(value) {\r\n      return this.el.toggleClass('disabled', this.disabled);\r\n    },\r\n\r\n    iconClassOf : function(icon) {\r\n      if (icon) {\r\n        return \"wordpad-icon wordpad-icon-\" + icon;\r\n      } else {\r\n        return '';\r\n      }\r\n    },\r\n\r\n    setIcon : function(icon) {\r\n      return this.el.find('span').removeClass().addClass(this.iconClassOf(icon)).text(this.text);\r\n    },\r\n\r\n    render : function() {\r\n\r\n      //this.wrapper = $(this._tpl.item).appendTo(this.toolbar.list);\r\n      this.toolbar.addToolItem(this);\r\n      this.wrapper = $(this._elm);\r\n\r\n      this.el = this.wrapper.find('a.toolbar-item');\r\n      this.el.attr('title', this.title).addClass(\"toolbar-item-\" + this.name).data('button', this);\r\n      this.setIcon(this.icon);\r\n      if (!this.menu) {\r\n        return;\r\n      }\r\n      this.menuWrapper = $(this.options.menu.menuWrapper).appendTo(this.wrapper);\r\n      this.menuWrapper.addClass(\"toolbar-menu-\" + this.name);\r\n      return this.renderMenu();\r\n    },\r\n\r\n    renderMenu : function() {\r\n      var $menuBtnEl, $menuItemEl, k, len, menuItem, ref, ref1, results;\r\n      if (!langx.isArray(this.menu)) {\r\n        return;\r\n      }\r\n      this.menuEl = $('<ul/>').appendTo(this.menuWrapper);\r\n      ref = this.menu;\r\n      results = [];\r\n      for (k = 0, len = ref.length; k < len; k++) {\r\n        menuItem = ref[k];\r\n        if (menuItem === '|') {\r\n          $(this.options.menu.separator).appendTo(this.menuEl);\r\n          continue;\r\n        }\r\n        $menuItemEl = $(this.options.menu.menuItem).appendTo(this.menuEl);\r\n        $menuBtnEl = $menuItemEl.find('a.menu-item').attr({\r\n          'title': (ref1 = menuItem.title) != null ? ref1 : menuItem.text,\r\n          'data-param': menuItem.param\r\n        }).addClass('menu-item-' + menuItem.name);\r\n        if (menuItem.icon) {\r\n          results.push($menuBtnEl.find('span').addClass(this.iconClassOf(menuItem.icon)));\r\n        } else {\r\n          results.push($menuBtnEl.find('span').text(menuItem.text));\r\n        }\r\n      }\r\n      return results;\r\n    },\r\n\r\n    command : function(params) {\r\n      this.action.execute(params);\r\n    },\r\n\r\n    \"name\" : {\r\n      get : function() {\r\n        return this.action.name;\r\n      }\r\n    },\r\n\r\n    \"icon\" : {\r\n      get : function() {\r\n        return this.action.icon;\r\n      }\r\n    },\r\n\r\n    \"title\" : {\r\n      get : function() {\r\n        return this.action.tooltip;\r\n      }\r\n    },\r\n\r\n    \"text\" : {\r\n      get : function() {\r\n        return this.action.text;\r\n      }\r\n    },\r\n\r\n    \"htmlTag\" : {\r\n      get : function() {\r\n        return this.action.htmlTag;\r\n      }\r\n    },\r\n\r\n    \"disableTag\" : {\r\n      get : function() {\r\n        return this.action.disableTag;\r\n      }\r\n    },\r\n\r\n    \"menu\" : {\r\n      get : function() {\r\n        return this.action.menu;\r\n      }\r\n    },\r\n\r\n    \"editable\" : {\r\n      get : function() {\r\n        return this._options.editable;\r\n      }\r\n    },\r\n\r\n    \"active\" : {\r\n      get : function() {\r\n        return this.action.active;\r\n      }\r\n    },\r\n\r\n    \"disabled\" : {\r\n      get : function() {\r\n        return this.action.disabled;\r\n      }\r\n    },\r\n\r\n    \"needFocus\" : {\r\n      get : function() {\r\n        return this.action.needFocus;\r\n      }\r\n    },\r\n\r\n\r\n    \"shortcut\" : {\r\n      get : function() {\r\n        return this.action.shortcut;\r\n      }\r\n    }\r\n\r\n\r\n  }); \r\n\r\n\r\n  return ToolButton;\r\n});\r\n"]}