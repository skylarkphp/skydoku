/**
 * skylark-widgets-wordpad - The skylark richeditor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-wordpad/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-tables","skylark-domx-query","../Toolbar","../Wordpad","../Button"],function(e,t,n,i,r,a){var o=a.inherit({});return o.prototype.name="table",o.prototype.icon="table",o.prototype.htmlTag="table",o.prototype.disableTag="pre, li, blockquote",o.prototype.menu=!0,o.prototype._init=function(){var t;return a.prototype._init.call(this),e.merge(this.editor.editable.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),e.extend(this.editor.editable.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),e.extend(this.editor.editable.formatter._allowedStyles,{td:["text-align"],th:["text-align"]}),this._initShortcuts(),this._initResize(),this.editor.on("decorate",(t=this,function(e,i){return i.find("table").each(function(e,i){return t.decorate(n(i))})})),this.editor.on("undecorate",function(e){return function(t,i){return i.find("table").each(function(t,i){return e.undecorate(n(i))})}}(this)),this.editor.on("selectionchanged.table",function(e){return function(t){var n,i;if(e.editor.body.find(".wordpad-table td, .wordpad-table th").removeClass("active"),i=e.editor.editable.selection.range())return n=e.editor.editable.selection.containerNode(),i.collapsed&&n.is(".wordpad-table")&&e.editor.editable.selection.setRangeAtEndOf(n),n.closest("td, th",e.editor.body).addClass("active")}}(this)),this.editor.on("blur.table",function(e){return function(t){return e.editor.body.find(".wordpad-table td, .wordpad-table th").removeClass("active")}}(this)),this.editor.editable.keystroke.add("up","td",function(e){return function(t,n){return e._tdNav(n,"up"),!0}}(this)),this.editor.editable.keystroke.add("up","th",function(e){return function(t,n){return e._tdNav(n,"up"),!0}}(this)),this.editor.editable.keystroke.add("down","td",function(e){return function(t,n){return e._tdNav(n,"down"),!0}}(this)),this.editor.editable.keystroke.add("down","th",function(e){return function(t,n){return e._tdNav(n,"down"),!0}}(this))},o.prototype._tdNav=function(e,t){var n,i,r,a,o;return null==t&&(t="up"),r="up"===t?"prev":"next",(o="up"===t?["tbody","thead"]:["thead","tbody"])[0],o[1],i=e.parent("tr"),!((n=this["_"+r+"Row"](i)).length>0)||(a=i.find("td, th").index(e),this.editor.editable.selection.setRangeAtEndOf(n.find("td, th").eq(a)))},o.prototype._initResize=function(){t.resizable(document,{cssClasses:{resizeHandle:"wordpad-resize-handle",wrapper:"wordpad-table"}})},o.prototype._initShortcuts=function(){var e;return this.editor.editable.hotkeys.add("ctrl+alt+up",(e=this,function(t){return e.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1})),this.editor.editable.hotkeys.add("ctrl+alt+down",function(e){return function(t){return e.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.editable.hotkeys.add("ctrl+alt+left",function(e){return function(t){return e.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.editable.hotkeys.add("ctrl+alt+right",function(e){return function(t){return e.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},o.prototype.renderMenu=function(){var e,t;return n('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),e=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",(t=this,function(i){var r,a,o,d;return t.createMenu.find("td, th").removeClass("selected"),d=(a=(r=n(i.currentTarget)).parent()).find("td, th").index(r)+1,o=a.prevAll("tr").addBack(),a.parent().is("tbody")&&(o=o.add(e.find("thead tr"))),o.find("td:lt("+d+"), th:lt("+d+")").addClass("selected")})),this.createMenu.on("mouseleave",function(e){return n(e.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(t){return function(i){var r,a,o,d,l;if(t.wrapper.removeClass("menu-on"),t.editor.editable.inputManager.focused)return d=(o=(a=n(i.currentTarget)).parent()).find("td").index(a)+1,l=o.prevAll("tr").length+1,o.parent().is("tbody")&&(l+=1),e=t.createTable(l,d,!0),r=t.editor.editable.selection.blockNodes().last(),t.editor.editable.util.isEmptyNode(r)?r.replaceWith(e):r.after(e),t.decorate(e),t.editor.editable.selection.setRangeAtStartOf(e.find("th:first")),t.editor.trigger("valuechanged"),!1}}(this))},o.prototype.decorate=function(e){return n(t.decorate(e[0],{tableDecorate:"wordpad-table",resizeHandle:"wordpad-resize-handle"}))},o.prototype.undecorate=function(e){return n(t.undecorate(e[0],{tableDecorate:"wordpad-table",resizeHandle:"wordpad-resize-handle"}))},o.prototype.createTable=function(e,i,r){return n(t.createTable(e,i,r?this.editor.editable.util.phBr:null))},o.prototype.refreshTableWidth=function(e){return table.refreshTableWidth(e[0])},o.prototype.setActive=function(e){return a.prototype.setActive.call(this,e),e?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},o.prototype.deleteRow=function(e){var i,r=this;return t.deleteRow(e[0],function(e,t){e&&(i=r.editor.editable.selection.setRangeAtEndOf(n(e).find("td, th").eq(t)))}),i},o.prototype.insertRow=function(e,i){var r,a=this;return t.insertRow(e[0],i,a.editor.editable.util.phBr,function(e,t){r=a.editor.editable.selection.setRangeAtStartOf(n(e).find("td, th").eq(t))}),r},o.prototype.deleteCol=function(e){var i,r=this;return t.deleteCol(e[0],function(e){e&&(i=r.editor.editable.selection.setRangeAtEndOf(n(e)))}),i},o.prototype.insertCol=function(e,i){var r,a=this;return t.insertCol(e[0],i,a.editor.editable.util.phBr,function(e){r=a.editor.editable.selection.setRangeAtStartOf(n(e))}),r},o.prototype.deleteTable=function(e){var n=this;t.deleteTable(e[0],function(e){if(e.length>0)return n.editor.editable.selection.setRangeAtStartOf(e)})},o.prototype.command=function(e){var t;if((t=this.editor.editable.selection.containerNode().closest("td, th")).length>0){if("deleteRow"===e)this.deleteRow(t);else if("insertRowAbove"===e)this.insertRow(t,"before");else if("insertRowBelow"===e)this.insertRow(t);else if("deleteCol"===e)this.deleteCol(t);else if("insertColLeft"===e)this.insertCol(t,"before");else if("insertColRight"===e)this.insertCol(t);else{if("deleteTable"!==e)return;this.deleteTable(t)}return this.editor.trigger("valuechanged")}},r.Toolbar.addButton(o),o});
//# sourceMappingURL=../../sourcemaps/removing/buttons/TableButton.js.map
