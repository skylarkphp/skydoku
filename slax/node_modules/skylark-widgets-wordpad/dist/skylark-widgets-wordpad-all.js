/**
 * skylark-widgets-wordpad - The skylark richeditor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-wordpad/
 * @license MIT
 */
!function(factory,globals){var define=globals.define,require=globals.require,isAmd="function"==typeof define&&define.amd,isCmd=!isAmd&&"undefined"!=typeof exports;if(!isAmd&&!define){var map={};define=globals.define=function(t,e,n){"function"==typeof n?(map[t]={factory:n,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var n=e.split("/"),i=t.split("/");n.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?n.pop():n.push(i[r]));return n.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):map[t]={factory:null,resolved:!0,exports:n}},require=globals.require=function(t){if(!map.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var e=map[t];if(!e.resolved){var n=[];e.deps.forEach(function(t){n.push(require(t))}),e.exports=e.factory.apply(globals,n)||null,e.resolved=!0}return e.exports}}if(!define)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(define,require){define("skylark-langx-ns/_attach",[],function(){return function(t,e,n){"string"==typeof e&&(e=e.split("."));for(var i=e.length,r=t,o=0,a=e[o++];o<i;)r=r[a]=r[a]||{},a=e[o++];return r[a]=n}}),define("skylark-langx-ns/ns",["./_attach"],function(t){var e={attach:function(n,i){return t(e,n,i)}};return e}),define("skylark-langx-ns/main",["./ns"],function(t){return t}),define("skylark-langx-ns",["skylark-langx-ns/main"],function(t){return t}),define("skylark-langx/skylark",["skylark-langx-ns"],function(t){return t}),define("skylark-langx-types/types",["skylark-langx-ns"],function(t){var e,n={}.toString,i=(e={},"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(t){e["[object "+t+"]"]=t.toLowerCase()}),function(t){return null==t?String(t):e[n.call(t)]||"object"});function r(t){var e;for(e in t)if(null!==t[e])return!1;return!0}function o(t){return"function"==i(t)}function a(t){return t&&t.nodeType}function s(t){return"number"==typeof t}function l(t){return"object"==i(t)}function u(t){return"string"==typeof t}function d(t){return t&&t==t.window}return t.attach("langx.types",{isArray:function(t){return t&&t.constructor===Array},isArrayLike:function(t){return!u(t)&&!a(t)&&"number"==typeof t.length&&!o(t)},isBoolean:function(t){return"boolean"==typeof t},isDefined:function(t){return void 0!==t},isDocument:function(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE},isEmpty:r,isEmptyObject:r,isFunction:o,isHtmlNode:a,isNull:function(t){return"null"===i(t)},isNumber:s,isNumeric:s,isObject:l,isPlainObject:function(t){return l(t)&&!d(t)&&Object.getPrototypeOf(t)==Object.prototype},isString:u,isSameOrigin:function(t){if(t){var e=location.protocol+"//"+location.hostname;return location.port&&(e+=":"+location.port),t.startsWith(e)}},isSymbol:function(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag},isUndefined:function(t){return void 0===t},isWindow:d,type:i})}),define("skylark-langx-types/main",["./types"],function(t){return t}),define("skylark-langx-types",["skylark-langx-types/main"],function(t){return t}),define("skylark-langx-numbers/numbers",["skylark-langx-ns","skylark-langx-types"],function(t,e){var n=e.isObject,i=e.isSymbol,r=1/0,o=1.7976931348623157e308,a=NaN,s=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,d=/^0o[0-7]+$/i,c=parseInt;function h(t){if(!t)return 0===t?t:0;if((t=f(t))===r||t===-r){var e=t<0?-1:1;return e*o}return t==t?t:0}function f(t){if("number"==typeof t)return t;if(i(t))return a;if(n(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(s,"");var r=u.test(t);return r||d.test(t)?c(t.slice(2),r?2:8):l.test(t)?a:+t}return t.attach("langx.numbers",{toFinite:h,toNumber:f,toInteger:function(t){var e=h(t),n=e%1;return e==e?n?e-n:e:0}})}),define("skylark-langx-numbers/main",["./numbers"],function(t){return t}),define("skylark-langx-numbers",["skylark-langx-numbers/main"],function(t){return t}),define("skylark-langx-objects/objects",["skylark-langx-ns/ns","skylark-langx-ns/_attach","skylark-langx-types","skylark-langx-numbers"],function(t,e,n,i){var r,o,a=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l=n.isBoolean,u=n.isFunction,d=n.isObject,c=n.isPlainObject,h=n.isArray,f=n.isArrayLike,p=n.isString,g=i.toInteger;var m,v,y="undefined"!=typeof Symbol?Symbol.prototype:null;function b(t){if(!d(t))return[];var e=[];for(var n in t)e.push(n);return e}function k(t,e){if(!h(e))return null!=t&&a.call(t,e);for(var n=e.length,i=0;i<n;i++){var r=e[i];if(null==t||!a.call(t,r))return!1;t=t[r]}return!!n}function x(t,e,n,i){for(var r in e)i&&void 0!==t[r]||(n&&(c(e[r])||h(e[r]))?(c(e[r])&&!c(t[r])&&(t[r]={}),h(e[r])&&!h(t[r])&&(t[r]=[]),x(t[r],e[r],n,i)):void 0!==e[r]&&(t[r]=e[r]));return t}function w(t){var e=s.call(arguments,0),n=e.shift(),i=!1;return l(e[e.length-1])&&(i=e.pop()),{target:n,sources:e,deep:i}}function _(){var t=w.apply(this,arguments);return t.sources.forEach(function(e){x(t.target,e,t.deep,!1)}),t.target}function A(t){for(var e=b(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i}return r=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var r=typeof t;return("function"===r||"object"===r||"object"==typeof e)&&o(t,e,n,i)},o=function(t,e,n,i){var o=toString.call(t);if(o!==toString.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return y.valueOf.call(t)===y.valueOf.call(e)}var a="[object Array]"===o;if(!a){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,l=e.constructor;if(s!==l&&!(u(s)&&s instanceof s&&u(l)&&l instanceof l)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],i=i||[];for(var d=n.length;d--;)if(n[d]===t)return i[d]===e;if(n.push(t),i.push(e),a){if((d=t.length)!==e.length)return!1;for(;d--;)if(!r(t[d],e[d],n,i))return!1}else{var c,h=Object.keys(t);if(d=h.length,Object.keys(e).length!==d)return!1;for(;d--;)if(c=h[d],void 0===e[c]||!r(t[c],e[c],n,i))return!1}return n.pop(),i.pop(),!0},t.attach("langx.objects",{allKeys:b,attach:e,clone:function t(e,n){var i;if(void 0===e||null===e)i=e;else if(n&&e.clone)i=e.clone();else if(h(e)){i=[];for(var r=0;r<e.length;r++)i.push(t(e[r]))}else if(c(e))for(var o in i={},e)i[o]=t(e[o]);else i=e;return i},defaults:(m=b,v=!0,function(t){var e=arguments.length;if(v&&(t=Object(t)),e<2||null==t)return t;for(var n=1;n<e;n++)for(var i=arguments[n],r=m(i),o=r.length,a=0;a<o;a++){var s=r[a];v&&void 0!==t[s]||(t[s]=i[s])}return t}),each:function(t,e){var n,i,r,o;if(t)if(void 0===(n=t.length)){for(i in t)if(t.hasOwnProperty(i)&&(o=t[i],!1===e.call(o,i,o)))break}else for(r=0;r<n&&(o=t[r],!1!==e.call(o,r,o));r++);return this},extend:function(t){var e,n=s.call(arguments,1);"boolean"==typeof t&&(e=t,t=n.shift());0==n.length&&(n=[t],t=this);return n.forEach(function(n){_(t,n,e)}),t},has:k,isEqual:function(t,e){return r(t,e)},includes:function(t,e,n,i){t=f(t)?t:A(t),n=n&&!i?g(n):0;var r=t.length;n<0&&(n=nativeMax(r+n,0));return p(t)?n<=r&&t.indexOf(e,n)>-1:!!r&&baseIndexOf(t,e,n)>-1},isMatch:function(t,e){var n=n(e),i=n.length;if(null==t)return!i;for(var r=Object(t),o=0;o<i;o++){var a=n[o];if(e[a]!==r[a]||!(a in r))return!1}return!0},keys:function(t){if(d(t))return[];var e=[];for(var n in t)k(t,n)&&e.push(n);return e},mixin:_,omit:function(t,e,n){if(!t)return null;for(var i=_({},t),r=1;r<arguments.length;r++){var o=arguments[r];o in t&&delete i[o]}return i},pick:function(t,e,n){if(!t)return null;for(var i={},r=1;r<arguments.length;r++){var o=arguments[r];o in t&&(i[o]=t[o])}return i},removeItem:function(t,e){if(h(t)){var n=t.indexOf(e);-1!=n&&t.splice(n,1)}else if(c(t))for(var i in t)if(t[i]==e){delete t[i];break}return this},result:function(t,e,n){h(e)||(e=e.split("."));var i=e.length;if(!i)return u(n)?n.call(t):n;for(var r=0;r<i;r++){var o=null==t?void 0:t[e[r]];void 0===o&&(o=n,r=i),t=u(o)?o.call(t):o}return t},safeMixin:function(){var t=w.apply(this,arguments);return t.sources.forEach(function(e){x(t.target,e,t.deep,!0)}),t.target},values:A})}),define("skylark-langx-objects/main",["./objects"],function(t){return t}),define("skylark-langx-objects",["skylark-langx-objects/main"],function(t){return t}),define("skylark-langx-arrays/arrays",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects"],function(t,e,n){var i=Array.prototype.filter,r=e.isArrayLike;function o(t,e,n,i){for(var r=t.length,o=n+(i?1:-1);i?o--:++o<r;)if(e(t[o],o,t))return o;return-1}function a(t){return t!=t}function s(t){if(r(t)){for(var e=[],n=0;n<t.length;n++){var i=t[n];if(r(i))for(var o=0;o<i.length;o++)e.push(i[o]);else e.push(i)}return e}return t}return t.attach("langx.arrays",{baseFindIndex:o,baseIndexOf:function(t,e,n){if(e!=e)return o(t,a,n);var i=n-1,r=t.length;for(;++i<r;)if(t[i]===e)return i;return-1},compact:function(t){return i.call(t,function(t){return null!=t})},first:function(t,e){return e?t.slice(0,e):t[0]},filter:function(t,e){return i.call(t,e)},flatten:s,grep:function(t,e){var i=[];return n.each(t,function(t,n){e(n,t)&&i.push(n)}),i},inArray:function(t,e){if(!e)return-1;var n;if(e.indexOf)return e.indexOf(t);n=e.length;for(;n--;)if(e[n]===t)return n;return-1},makeArray:function(t,e,n){if(r(t))return(n||[]).concat(Array.prototype.slice.call(t,e||0));return[t]},merge:function(t,e){var n=e.length,i=t.length,r=0;if("number"==typeof n)for(;r<n;r++)t[i++]=e[r];else for(;void 0!==e[r];)t[i++]=e[r++];return t.length=i,t},forEach:function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n)},map:function(t,e){var n,i,o,a=[];if(r(t))for(i=0;i<t.length;i++)null!=(n=e.call(t[i],t[i],i))&&a.push(n);else for(o in t)null!=(n=e.call(t[o],t[o],o))&&a.push(n);return s(a)},reduce:function(t,e,n){return Array.prototype.reduce.call(t,e,n)},uniq:function(t){return i.call(t,function(e,n){return t.indexOf(e)==n})}})}),define("skylark-langx-arrays/main",["./arrays"],function(t){return t}),define("skylark-langx-arrays",["skylark-langx-arrays/main"],function(t){return t}),define("skylark-langx/arrays",["skylark-langx-arrays"],function(t){return t}),define("skylark-langx-klass/klass",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects","skylark-langx-arrays"],function(t,e,n,i){var r=i.uniq,o=n.has,a=n.mixin,s=e.isArray,l=e.isDefined;var u=function(){function t(){return this._construct?this._construct.apply(this,arguments):this.init?this.init.apply(this,arguments):void 0}return function n(i,u,d,c){s(u)&&(c=d,d=u,u=null),u=u||Object,l(d)&&!s(d)&&(c=d,d=!1);var h=u;d&&(d=function(t,e){var n=[];return e.forEach(function(t){if(o(t,"__mixins__"))throw new Error("nested mixins");for(var e=[];t;)e.unshift(t),t=t.superclass;n=n.concat(e)}),(n=(n=r(n)).filter(function(e){for(var n=t;n;){if(e===n)return!1;if(o(n,"__mixins__"))for(var i=n.__mixins__,r=0;r<i.length;r++)if(i[r]===e)return!1;n=n.superclass}return!0})).length>0&&n}(h,d)),d&&(h=function(t,e){for(var n=t,i=0;i<e.length;i++){var r=new Function;r.prototype=Object.create(n.prototype),r.__proto__=n,r.superclass=null,a(r.prototype,e[i].prototype),r.prototype.__mixin__=e[i],n=r}return n}(h,d));var f=i.klassName||"",p=new Function("return function "+f+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return p.prototype=Object.create(h.prototype),p.prototype.constructor=p,p.superclass=u,p.__proto__=h,p._constructor||(p._constructor=t),d&&(p.__mixins__=d),p.partial||(p.partial=function(t,n){return function(t,n,i){var r=t.prototype,o=t.superclass.prototype,a=i&&i.noOverrided;i&&i.overrides;for(var s in n)if("constructor"!==s){var l=n[s];"function"==typeof n[s]?r[s]=l._constructor||a||"function"!=typeof o[s]?l:function(t,e,n){return function(){var t=this.overrided;this.overrided=n;var i=e.apply(this,arguments);return this.overrided=t,i}}(0,l,o[s]):e.isPlainObject(l)&&null!==l&&l.get?Object.defineProperty(r,s,l):r[s]=l}return t}(this,t,n)}),p.inherit||(p.inherit=function(t,e,i){return n(t,this,e,i)}),p.partial(i,c),p}}();return t.attach("langx.klass",u)}),define("skylark-langx-klass/main",["./klass"],function(t){return t}),define("skylark-langx-klass",["skylark-langx-klass/main"],function(t){return t}),define("skylark-langx/klass",["skylark-langx-klass"],function(t){return t}),define("skylark-langx/ArrayStore",["./klass"],function(t){var e=function(t){if(!t)return t;var n=!!t.then;function i(i){t[i]=function(){var r=arguments,o=Deferred.when(t,function(t){return e(Array.prototype[i].apply(t,r))});if("forEach"!==i||n)return o}}return n&&(t=Object.delegate(t)),i("forEach"),i("filter"),i("map"),null==t.total&&(t.total=Deferred.when(t,function(t){return t.length})),t},n=t({klassName:"ArrayStore",queryEngine:function(t,e){switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var n=t;t=function(t){for(var e in n){var i=n[e];if(i&&i.test){if(!i.test(t[e],t))return!1}else if(i!=t[e])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}function i(n){var i=function(t,e,n){var i,r=0,o=t&&t.length||0,a=[];o&&"string"==typeof t&&(t=t.split(""));"string"==typeof e&&(e=cache[e]||buildFn(e));if(n)for(;r<o;++r)i=t[r],e.call(n,i,r,t)&&a.push(i);else for(;r<o;++r)i=t[r],e(i,r,t)&&a.push(i);return a}(n,t),r=e&&e.sort;if(r&&i.sort("function"==typeof r?r:function(t,e){for(var n,i=0;n=r[i];i++){var o=t[n.attribute],a=e[n.attribute];if(o=null!=o?o.valueOf():o,a=null!=a?a.valueOf():a,o!=a)return!!n.descending==(null==o||o>a)?-1:1}return 0}),e&&(e.start||e.count)){var o=i.length;(i=i.slice(e.start||0,(e.start||0)+(e.count||1/0))).total=o}return i}return i.matches=t,i},idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,e){var n=this.data,i=this.index,r=this.idProperty,o=t[r]=e&&"id"in e?e.id:r in t?t[r]:Math.random();if(o in i){if(e&&!1===e.overwrite)throw new Error("Object already exists");n[i[o]]=t}else i[o]=n.push(t)-1;return o},add:function(t,e){return(e=e||{}).overwrite=!1,this.put(t,e)},remove:function(t){var e=this.index,n=this.data;if(t in e)return n.splice(e[t],1),this.setData(n),!0},query:function(t,n){return e(this.queryEngine(t,n)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var e=0,n=t.length;e<n;e++)this.index[t[e][this.idProperty]]=e},init:function(t){for(var e in t)this[e]=t[e];this.setData(this.data||[])}});return n}),define("skylark-langx-aspect/aspect",["skylark-langx-ns"],function(t){var e,n=0;function i(t){return function(i,r,o,a){var s,l=i[r];l&&l.target==i||(i[r]=s=function(){for(var t=n,i=arguments,r=s.before;r;)i=r.advice.apply(this,i)||i,r=r.next;if(s.around)var o=s.around.advice(this,i);for(var a=s.after;a&&a.id<t;){if(a.receiveArguments){var l=a.advice.apply(this,i);o=l===e?o:l}else o=a.advice.call(this,o,i);a=a.next}return o},l&&(s.around={advice:function(t,e){return l.apply(t,e)}}),s.target=i);var u=function(t,e,i,r){var o,a=t[e],s="around"==e;if(s){var l=i(function(){return a.advice(this,arguments)});o={remove:function(){l&&(l=t=i=null)},advice:function(t,e){return l?l.apply(t,e):a.advice(t,e)}}}else o={remove:function(){if(o.advice){var n=o.previous,r=o.next;r||n?(n?n.next=r:t[e]=r,r&&(r.previous=n)):delete t[e],t=i=o.advice=null}},id:n++,advice:i,receiveArguments:r};if(a&&!s)if("after"==e){for(;a.next&&(a=a.next););a.next=o,o.previous=a}else"before"==e&&(t[e]=o,o.next=a,a.previous=o);else t[e]=o;return o}(s||l,t,o,a);return o=null,u}}return t.attach("langx.aspect",{after:i("after"),around:i("around"),before:i("before")})}),define("skylark-langx-aspect/main",["./aspect"],function(t){return t}),define("skylark-langx-aspect",["skylark-langx-aspect/main"],function(t){return t}),define("skylark-langx/aspect",["skylark-langx-aspect"],function(t){return t}),define("skylark-langx-funcs/funcs",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects"],function(t,e,n){var i=n.mixin,r=Array.prototype.slice,o=e.isFunction,a=e.isString;var s=function(){function t(){}return function(e,n){t.prototype=e;var r=new t;return t.prototype=null,n&&i(r,n),r}}(),l={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};return t.attach("langx.funcs",{debounce:function(t,e){var n;return function(){var i=this,r=arguments;n&&clearTimeout(n),n=setTimeout(function(){n=null,t.apply(i,r)},e)}},delegate:s,defer:function(t){requestAnimationFrame?requestAnimationFrame(t):setTimeoutout(t);return this},noop:function(){},proxy:function t(e,n){var i=2 in arguments&&r.call(arguments,2);if(o(e)){return function(){return e.apply(n,i?i.concat(r.call(arguments)):arguments)}}if(a(n))return i?(i.unshift(e[n],e),t.apply(null,i)):t(e[n],e);throw new TypeError("expected function")},returnTrue:function(){return!0},returnFalse:function(){return!1},templateSettings:l,template:function(t,e,i){!e&&i&&(e=i);e=n.defaults({},e,l);var r,o=RegExp([(e.escape||noMatch).source,(e.interpolate||noMatch).source,(e.evaluate||noMatch).source].join("|")+"|$","g"),a=0,s="__p+='";t.replace(o,function(e,n,i,r,o){return s+=t.slice(a,o).replace(escapeRegExp,escapeChar),a=o+e.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":r&&(s+="';\n"+r+"\n__p+='"),e}),s+="';\n",e.variable||(s="with(obj||{}){\n"+s+"}\n");s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(e.variable||"obj","_",s)}catch(t){throw t.source=s,t}var u=function(t){return r.call(this,t,_)},d=e.variable||"obj";return u.source="function("+d+"){\n"+s+"}",u}})}),define("skylark-langx-funcs/main",["./funcs"],function(t){return t}),define("skylark-langx-funcs",["skylark-langx-funcs/main"],function(t){return t}),define("skylark-langx-async/Deferred",["skylark-langx-arrays","skylark-langx-funcs","skylark-langx-objects"],function(t,e,n){"use strict";var i=Symbol?Symbol():"__pglisteners",r=Symbol?Symbol():"__pgnotifies",o=Array.prototype.slice,a=e.proxy,s=t.makeArray,l=n.result,u=n.mixin;u(Promise.prototype,{always:function(t){return this.then(t,t),this},done:function(){for(var t=0;t<arguments.length;t++)this.then(arguments[t]);return this},fail:function(t){return this.catch(t),this}});var d=function(){var t=this,e=this.promise=new Promise(function(e,n){t._resolve=e,t._reject=n});c(e,t),this[i]=[],this[r]=[]};function c(t,e){var n={state:function(){return e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},then:function(t,e,n){return n&&this.progress(n),c(Promise.prototype.then.call(this,t&&function(e){return e&&void 0!==e.__ctx__?t.apply(e.__ctx__,e):t(e)},e&&function(t){return t&&void 0!==t.__ctx__?e.apply(t.__ctx__,t):e(t)}))},progress:function(t){return e[r].forEach(function(e){t(e)}),e[i].push(t),this}};return n.pipe=n.then,u(t,n)}return d.prototype.resolve=function(t){var e=o.call(arguments);return this.resolveWith(null,e)},d.prototype.resolveWith=function(t,e){return(e=e?s(e):[]).__ctx__=t,this._resolve(e),this._resolved=!0,this},d.prototype.notify=function(t){try{return this[r].push(t),this[i].forEach(function(e){return e(t)})}catch(t){this.reject(t)}return this},d.prototype.reject=function(t){var e=o.call(arguments);return this.rejectWith(null,e)},d.prototype.rejectWith=function(t,e){return(e=e?s(e):[]).__ctx__=t,this._reject(e),this._rejected=!0,this},d.prototype.isResolved=function(){return!!this._resolved},d.prototype.isRejected=function(){return!!this._rejected},d.prototype.then=function(t,e,n){var i=l(this,"promise");return i.then(t,e,n)},d.prototype.progress=function(t){var e=l(this,"promise");return e.progress(t)},d.prototype.catch=function(t){var e=l(this,"promise");return e.catch(t)},d.prototype.done=function(){var t=l(this,"promise");return t.done.apply(t,arguments)},d.prototype.fail=function(t){var e=l(this,"promise");return e.fail(t)},d.all=function(t){var e=new d;return Promise.all(t).then(e.resolve.bind(e),e.reject.bind(e)),l(e,"promise")},d.first=function(t){return c(Promise.race(t))},d.when=function(t,e,n,i){var r=t&&"function"==typeof t.then,o=r&&t instanceof Promise;if(!r)return arguments.length>1?e?e(t):t:(new d).resolve(t);if(!o){var s=new d(t.cancel);t.then(a(s.resolve,s),a(s.reject,s),s.notify),t=s.promise}return e||n||i?t.then(e,n,i):t},d.reject=function(t){var e=new d;return e.reject(t),e.promise},d.immediate=d.resolve=function(t){var e=new d;return e.resolve.apply(e,arguments),e.promise},d}),define("skylark-langx-async/async",["skylark-langx-ns","skylark-langx-objects","./Deferred"],function(t,e,n){var i=e.each,r={Deferred:n,parallel:function(t,e,r){var o=[];return r=r||null,e=e||[],i(t,function(t,n){o.push(n.apply(r,e))}),n.all(o)},series:function(t,e,r){var o=[],a=new n,s=a.promise;return r=r||null,e=e||[],a.resolve(),i(t,function(t,n){s=s.then(function(){return n.apply(r,e)}),o.push(s)}),n.all(o)},waterful:function(t,e,r){var o=new n,a=o.promise;return r=r||null,e=e||[],o.resolveWith(r,e),i(t,function(t,e){a=a.then(e)}),a}};return t.attach("langx.async",r)}),define("skylark-langx-async/main",["./async"],function(t){return t}),define("skylark-langx-async",["skylark-langx-async/main"],function(t){return t}),define("skylark-langx/async",["skylark-langx-async"],function(t){return t}),define("skylark-langx-datetimes/datetimes",["skylark-langx-ns"],function(t){return t.attach("langx.datetimes",{parseMilliSeconds:function(t){var e=t.split(" "),n=parseInt(e[0]);if(isNaN(n))return 0;switch(e[1].trim().replace(/\./g,"")){case"minutes":case"minute":case"min":case"mm":case"m":return 6e4*n;case"hours":case"hour":case"HH":case"hh":case"h":case"H":return 36e5*n;case"seconds":case"second":case"sec":case"ss":case"s":return 1e3*n;case"days":case"day":case"DD":case"dd":case"d":return 864e5*n;case"months":case"month":case"MM":case"M":return 24192e5*n;case"weeks":case"week":case"W":case"w":return 6048e5*n;case"years":case"year":case"yyyy":case"yy":case"y":return 31536e6*n;default:return 0}}})}),define("skylark-langx-datetimes/main",["./datetimes"],function(t){return t}),define("skylark-langx-datetimes",["skylark-langx-datetimes/main"],function(t){return t}),define("skylark-langx/datetimes",["skylark-langx-datetimes"],function(t){return t}),define("skylark-langx/Deferred",["skylark-langx-async/Deferred"],function(t){return t}),define("skylark-langx-emitter/Emitter",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-klass"],function(t,e,n,i,r){var o=Array.prototype.slice,a=i.compact,s=e.isDefined,l=e.isPlainObject,u=e.isFunction,d=e.isString,c=e.isEmptyObject,h=n.mixin,f=n.safeMixin;function p(t){var e=(""+t).split(".");return{name:e[0],ns:e.slice(1).join(" ")}}var g=r({on:function(t,e,n,i,r,o){var a=this,s=this._hub||(this._hub={});return l(t)?(r=i,each(t,function(t,i){a.on(t,e,n,i,r,o)}),this):(d(e)||u(i)||(r=i,i=n,n=e,e=void 0),u(n)&&(r=i,i=n,n=null),d(t)&&(t=t.split(/\s/)),t.forEach(function(t){var a=p(t),l=a.name,u=a.ns;(s[l]||(s[l]=[])).push({fn:i,selector:e,data:n,ctx:r,ns:u,one:o})}),this)},one:function(t,e,n,i,r){return this.on(t,e,n,i,r,1)},emit:function(t){if(!this._hub)return this;var e=this;d(t)&&(t=new CustomEvent(t)),Object.defineProperty(t,"target",{value:this});var n=o.call(arguments,1);return n=s(n)?[t].concat(n):[t],[t.type||t.name,"all"].forEach(function(i){var r=p(i),o=r.name,s=r.ns,l=e._hub[o];if(l){for(var u=l.length,d=!1,c=0;c<u;c++){var f=l[c];(!s||f.ns&&f.ns.startsWith(s))&&(t.data?f.data&&(t.data=h({},f.data,t.data)):t.data=f.data||null,f.fn.apply(f.ctx,n),f.one&&(l[c]=null,d=!0))}d&&(e._hub[i]=a(l))}}),this},listened:function(t){var e=(this._hub||(this._events={}))[t]||[];return e.length>0},listenTo:function(t,e,n,i){if(!t)return this;d(n)&&(n=this[n]),i?t.one(e,n,this):t.on(e,n,this);for(var r,o=this._listeningTo||(this._listeningTo=[]),a=0;a<o.length;a++)if(o[a].obj==t){r=o[a];break}r||o.push(r={obj:t,events:{}});var s=r.events,l=s[e]=s[e]||[];return-1==l.indexOf(n)&&l.push(n),this},listenToOnce:function(t,e,n){return this.listenTo(t,e,n,1)},off:function(t,e){var n=this._hub||(this._hub={});return d(t)&&(t=t.split(/\s/)),t.forEach(function(t){var i=p(t),r=i.name,o=i.ns,a=n[r];if(a){var s=[];if(e||o)for(var l=0,u=a.length;l<u;l++)e&&a[l].fn!==e&&a[l].fn._!==e?s.push(a[l]):!o||a[l].ns&&0==a[l].ns.indexOf(o)||s.push(a[l]);s.length?n[r]=s:delete n[r]}}),this},unlistenTo:function(t,e,n){var i=this._listeningTo;if(!i)return this;for(var r=0;r<i.length;r++){var o=i[r];if(!t||t==o.obj){var s=o.events;for(var l in s)if(!e||e==l){for(var u=s[l],d=0;d<u.length;d++)n&&n!=u[r]||(o.obj.off(l,u[r],this),u[r]=null);u=s[l]=a(u),c(u)&&(s[l]=null)}c(s)&&(i[r]=null)}}return i=this._listeningTo=a(i),c(i)&&(this._listeningTo=null),this},trigger:function(){return this.emit.apply(this,arguments)}});return g.createEvent=function(t,e){var n=new CustomEvent(t,e);return f(n,e)},t.attach("langx.Emitter",g)}),define("skylark-langx-emitter/Evented",["skylark-langx-ns/ns","./Emitter"],function(t,e){return t.attach("langx.Evented",e)}),define("skylark-langx-emitter/main",["./Emitter","./Evented"],function(t){return t}),define("skylark-langx-emitter",["skylark-langx-emitter/main"],function(t){return t}),define("skylark-langx/Emitter",["skylark-langx-emitter"],function(t){return t}),define("skylark-langx/Evented",["skylark-langx-emitter"],function(t){return t}),define("skylark-langx/funcs",["skylark-langx-funcs"],function(t){return t}),define("skylark-langx-hoster/hoster",["skylark-langx-ns"],function(t){var e={isBrowser:!0,isNode:null,global:this,browser:null,node:null};"object"==typeof process&&process.versions&&process.versions.node&&process.versions.v8&&(e.isNode=!0,e.isBrowser=!1),e.global=function(){return"undefined"!=typeof global&&"function"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this}();var n=null;if(Object.defineProperty(e,"document",function(){if(!n){var t="undefined"==typeof window?require("html-element"):window;n=t.document}return n}),e.isBrowser){var i=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(navigator.userAgent),r=e.browser={};i.browser&&(r[i.browser]=!0,r.version=i.version),r.chrome?r.webkit=!0:r.webkit&&(r.safari=!0)}return t.attach("langx.hoster",e)}),define("skylark-langx-hoster/main",["./hoster"],function(t){return t}),define("skylark-langx-hoster",["skylark-langx-hoster/main"],function(t){return t}),define("skylark-langx/hoster",["skylark-langx-hoster"],function(t){return t}),define("skylark-langx/numbers",["skylark-langx-numbers"],function(t){return t}),define("skylark-langx/objects",["skylark-langx-objects"],function(t){return t}),define("skylark-langx-strings/strings",["skylark-langx-ns"],function(t){var e=Object.freeze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"});function n(t){return e[t]}var i=/[&<>"'`=]/g;var r=0;function o(t,e){var n,i,r,o,a,s,l,u=arguments.callee;return u.cache[t]||(u.cache[t]=(n=t,i=/^[\w\-]+$/.test(t)?u.get(t):(n="template(string)",t),r=1,o=("try { "+(u.variable?"var "+u.variable+" = this.stash;":"with (this.stash) { ")+"this.ret += '"+i.replace(/<%/g,"").replace(/%>/g,"").replace(/'(?![^\x11\x13]+?\x13)/g,"\\x27").replace(/^\s*|\s*$/g,"").replace(/\n|\r\n/g,function(){return"';\nthis.line = "+ ++r+"; this.ret += '\\n"}).replace(/\x11=raw(.+?)\x13/g,"' + ($1) + '").replace(/\x11=(.+?)\x13/g,"' + this.escapeHTML($1) + '").replace(/\x11(.+?)\x13/g,"'; $1; this.ret += '")+"'; "+(u.variable?"":"}")+"return this.ret;} catch (e) { throw 'TemplateError: ' + e + ' (on "+n+"' + ' line ' + this.line + ')'; } //@ sourceURL="+n+"\n").replace(/this\.ret \+= '';/g,""),a=new Function(o),s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#x22;","'":"&#x27;"},l=function(t){return(""+t).replace(/[&<>\'\"]/g,function(t){return s[t]})},function(t){return a.call(u.context={escapeHTML:l,line:1,ret:"",stash:t})})),e?u.cache[t](e):u.cache[t]}return o.cache={},o.get=function(t){return document.getElementById(t).innerHTML},t.attach("langx.strings",{camelCase:function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})},dasherize:function(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()},deserializeValue:function(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(e){return t}},escapeHTML:function(t){if(null==t)return"";if(!t)return String(t);return t.toString().replace(i,n)},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)})},lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},rtrim:function(t){return t.replace(/\s+$/g,"")},serializeValue:function(t){return JSON.stringify(t)},substitute:function(t,e,n,i){function r(t,e){if(t.match(/\./)){var n,i=function(t,e){var r=t.pop();return r?e[r]?i(t,n=e[r]):null:n};return i(t.split(".").reverse(),e)}return e[t]}return i=i||window,n=n?proxy(i,n):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,o,a){var s=r(o,e);return a&&(s=r(a,i).call(i,s,o)),n(s,o).toString()})},slugify:function(t){t=(t=t.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var e="ÁÄÂÀÃÅČÇĆĎÉĚËÈÊẼĔȆÍÌÎÏŇÑÓÖÒÔÕØŘŔŠŤÚŮÜÙÛÝŸŽáäâàãåčçćďéěëèêẽĕȇíìîïňñóöòôõøðřŕšťúůüùûýÿžþÞĐđßÆa·/_,:;",n=0,i=e.length;n<i;n++)t=t.replace(new RegExp(e.charAt(n),"g"),"AAAAAACCCDEEEEEEEEIIIINNOOOOOORRSTUUUUUYYZaaaaaacccdeeeeeeeeiiiinnooooooorrstuuuuuyyzbBDdBAa------".charAt(n));return t=t.replace(/\s+/g,"-").replace(/-+/g,"-")},template:o,trim:function(t){return null==t?"":String.prototype.trim.call(t)},uniqueId:function(t){var e=++r+"";return t?t+e:e},upperFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}})}),define("skylark-langx-strings/main",["./strings"],function(t){return t}),define("skylark-langx-strings",["skylark-langx-strings/main"],function(t){return t}),define("skylark-langx/strings",["skylark-langx-strings"],function(t){return t}),define("skylark-langx/Stateful",["./Evented","./strings","./objects"],function(t,e,n){var i=n.isEqual,r=n.mixin,o=n.result,a=n.isEmptyObject,s=n.clone,l=e.uniqueId,u=t.inherit({_construct:function(t,e){var n=t||{};e||(e={}),this.cid=l(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var i=o(this,"defaults");n=r({},i,n),this.set(n,e),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(t){return s(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return null!=this.get(t)},set:function(t,e,n){if(null==t)return this;var r;if("object"==typeof t?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;var o=n.unset,a=n.silent,l=[],u=this._changing;this._changing=!0,u||(this._previousAttributes=s(this.attributes),this.changed={});var d=this.attributes,c=this.changed,h=this._previousAttributes;for(var f in r)e=r[f],i(d[f],e)||l.push(f),i(h[f],e)?delete c[f]:c[f]=e,o?delete d[f]:d[f]=e;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!a){l.length&&(this._pending=n);for(var p=0;p<l.length;p++)this.trigger("change:"+l[p],this,d[l[p]],n)}if(u)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,r({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,r({},t,{unset:!0}))},hasChanged:function(t){return null==t?!a(this.changed):void 0!==this.changed[t]},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&s(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var r in t){var o=t[r];i(e[r],o)||(n[r]=o)}return!a(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return s(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},r({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=r({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,r(e,{validationError:n})),!1)}});return u}),define("skylark-langx-topic/topic",["skylark-langx-ns","skylark-langx-emitter/Evented"],function(t,e){var n=new e;return t.attach("langx.topic",{publish:function(t,e,i){var r=[].slice.call(arguments,1);return n.trigger({type:t,data:r})},subscribe:function(t,e,i){var r=function(t){e.apply(i,t.data)};return n.on(t,r),{remove:function(){n.off(t,r)}}}})}),define("skylark-langx-topic/main",["./topic"],function(t){return t}),define("skylark-langx-topic",["skylark-langx-topic/main"],function(t){return t}),define("skylark-langx/topic",["skylark-langx-topic"],function(t){return t}),define("skylark-langx/types",["skylark-langx-types"],function(t){return t}),define("skylark-langx/langx",["./skylark","./arrays","./ArrayStore","./aspect","./async","./datetimes","./Deferred","./Emitter","./Evented","./funcs","./hoster","./klass","./numbers","./objects","./Stateful","./strings","./topic","./types"],function(t,e,n,i,r,o,a,s,l,u,d,c,h,f,p,g,m,v){"use strict";Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter;var y=f.mixin,b=(f.safeMixin,v.isFunction);var k=1;function x(){return x}return y(x,{createEvent:s.createEvent,funcArg:function(t,e,n,i){return b(e)?e.call(t,n,i):e},getQueryParams:function(t){var e=(t=t||window.location.href).split("?"),n={};e.length>1&&e[1].split("&").forEach(function(t){var e=t.split("=");n[e[0]]=e[1]});return n},toPixel:function(t){return parseFloat(t)||0},uid:function(t){return t._uid||(t._uid=k++)},URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),y(x,e,i,o,u,h,f,g,v,{ArrayStore:n,async:r,Deferred:a,Emitter:s,Evented:l,hoster:d,klass:c,Stateful:p,topic:m}),t.langx=x}),define("skylark-domx-browser/browser",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){"use strict";var n,i,r=e.hoster.browser,o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},a=null,s="",l="",u={},d={},c=/^(Webkit|webkit|O|Moz|moz|ms)(.*)$/,h=window.document,f=h.createElement("div"),p=f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.matchesSelector,g=f.requestFullscreen||f.webkitRequestFullscreen||f.mozRequestFullScreen||f.msRequestFullscreen,m=(h.exitFullscreen||h.webkitCancelFullScreen||h.mozCancelFullScreen||h.msExitFullscreen,f.style);for(var v in m){var y=v.match(i||c);if(y){i||(n=y[1],i=new RegExp("^("+n+")(.*)$"),n,s="-"+n.toLowerCase()+"-",l=n.toLowerCase()),u[e.lowerFirst(y[2])]=v;var b=e.dasherize(y[2]);d[b]=s+b,o[v]&&(a=o[v])}}return a||void 0!==m.transition&&(a=o.transition),e.mixin(r,{css3PropPrefix:s,isIE:!!/msie/i.exec(window.navigator.userAgent),normalizeStyleProperty:function(t){return u[t]||t},normalizeCssProperty:function(t){return d[t]||t},normalizeCssEvent:function(t){return l?l+t:t.toLowerCase()},matchesSelector:p,requestFullScreen:g,exitFullscreen:g,location:function(){return window.location},support:{}}),a&&(r.support.transition={end:a}),f=null,t.attach("domx.browser",r)}),define("skylark-domx-browser/main",["./browser"],function(t){return t}),define("skylark-domx-browser",["skylark-domx-browser/main"],function(t){return t}),define("skylark-domx-noder/noder",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser"],function(t,e,n){var i=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g),r=/^\s*<(\w+|!)[^>]*>/,o=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,a=document.createElement("div"),s=document.createElement("table"),l=document.createElement("tbody"),u=document.createElement("tr"),d={tr:l,tbody:s,thead:s,tfoot:s,td:u,th:u,"*":a},c=/^(?:body|html)$/i,h=Array.prototype.map,f=Array.prototype.slice;function p(t,n){return e.isArrayLike(t)||(t=[t]),n&&(t=h.call(t,function(t){return t.cloneNode(!0)})),e.flatten(t)}function g(t,e){var n=t.nodeName&&t.nodeName.toLowerCase();return void 0!==e?n===e.toLowerCase():n}function m(t,n){if(e.isFunction(t))return t.apply(n,[]);if(e.isArrayLike(t)){for(var i,r=0;r<t.length;r++)e.isFunction(t[r])&&(t[r]=t[r].apply(n,[]),e.isArrayLike(t[r])&&(i=!0));i&&(t=e.flatten(t))}return t}function v(t,e,n){e=m(e,t);for(var i=t,r=p(e,n),o=0;o<r.length;o++)i.appendChild(r[o]);return this}function y(t,e,n){var i=document.createElement(t);if(e)for(var r in e)i.setAttribute(r,e[r]);return n&&v(n,i),i}var b=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi;function k(t,e,n){if(n)return t.parentNode===e;if(document.documentElement.contains)return e.contains(t);for(;t;){if(e===t)return!0;t=t.parentNode}return!1}function x(t){return t?9==t.nodeType?t:t.ownerDocument:document}function w(){return w}return e.mixin(w,{active:function(t){var e;t=t||document;try{e=t.activeElement}catch(n){e=t.body}e||(e=t.body);e.nodeName||(e=t.body);return e},blur:function(t){t.blur()},body:function(){return document.body},clone:function(t,e){var n,r=this;if(!i||1!==t.nodeType||e)return t.cloneNode(e);if(!e)return n=document.createElement(t.nodeName),each(r.getAttribs(t),function(e){r.setAttrib(n,e.nodeName,r.getAttrib(t,e.nodeName))}),n},contents:function(t){if(g(t,"iframe"))return t.contentDocument;return t.childNodes},createElement:y,createFragment:function(t){if(t=e.trim(t),o.test(t))return[y(RegExp.$1)];var n=r.test(t)&&RegExp.$1;n in d||(n="*");var i=d[n];return i.innerHTML=""+t,dom=f.call(i.childNodes),dom.forEach(function(t){i.removeChild(t)}),dom},contains:function(t,e){return k(e,t)},createTextNode:function(t){return document.createTextNode(t)},doc:function(){return document},empty:function(t){for(;t.hasChildNodes();){var e=t.firstChild;t.removeChild(e)}return this},fullScreen:function(t){if(!1===t)n.exitFullScreen.apply(document);else{if(!t)return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n.requestFullScreen.apply(t),t}},focusable:function(t,e){var n,i,r,o,a,s=t.nodeName.toLowerCase();if("area"===s)return n=t.parentNode,i=n.name,!(!t.href||!i||"map"!==n.nodeName.toLowerCase())&&((r=$("img[usemap='#"+i+"']")).length>0&&r.is(":visible"));/^(input|select|textarea|button|object)$/.test(s)?(o=!t.disabled)&&(a=$(t).closest("fieldset")[0])&&(o=!a.disabled):o="a"===s&&t.href||e;return o&&$(t).is(":visible")&&visible($(t))},html:function(t,n){if(void 0===n)return t.innerHTML;if(this.empty(t),n=n||"",e.isString(n)&&(n=n.replace(b,"<$1></$2>")),e.isString(n)||e.isNumber(n))t.innerHTML=n;else if(e.isArrayLike(n))for(var i=0;i<n.length;i++)t.appendChild(n[i]);else t.appendChild(n);return this},isChildOf:k,isDocument:function(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE},isInDocument:function(t){return t===document.body||document.body.contains(t)},isWindow:e.isWindow,nodeName:g,offsetParent:function(t){var e=t.offsetParent||document.body;for(;e&&!c.test(e.nodeName)&&"static"==document.defaultView.getComputedStyle(e).position;)e=e.offsetParent;return e},ownerDoc:x,ownerWindow:function(t){var e=x(t);return e.defaultView||e.parentWindow},after:function(t,e,n){e=m(e,t);var i=(o=t).parentNode;if(i)for(var r=p(e,n),o=o.nextSibling,a=0;a<r.length;a++)o?i.insertBefore(r[a],o):i.appendChild(r[a]);return this},before:function(t,e,n){e=m(e,t);var i=t,r=i.parentNode;if(r)for(var o=p(e,n),a=0;a<o.length;a++)r.insertBefore(o[a],i);return this},prepend:function(t,e,n){for(var i=t,r=i.firstChild,o=p(e,n),a=0;a<o.length;a++)r?i.insertBefore(o[a],r):i.appendChild(o[a]);return this},append:v,reflow:function(t){null==el&&(t=document);return t.offsetHeight,this},remove:function(t){if(t&&t.parentNode)try{t.parentNode.removeChild(t)}catch(t){console.warn("The node is already removed",t)}return this},removeChild:function(t,n){e.isArrayLike(n)||(n=[n]);for(var i=0;i<n.length;i++)t.removeChild(n[i]);return this},replace:function(t,e){return e.parentNode.replaceChild(t,e),this},traverse:function t(e,n){n(e);for(var i=0,r=e.childNodes.length;i<r;i++)t(e.childNodes[i],n);return this},reverse:function(t){for(var e=t.firstChild,n=t.children.length-1;n>0;n--)if(n>0){var i=t.children[n];t.insertBefore(i,e)}},wrapper:function(t,n){e.isString(n)&&(n=this.createFragment(n).firstChild);t.parentNode.insertBefore(n,t),n.appendChild(t)},wrapperInner:function(t,e){var n=f.call(t.childNodes);t.appendChild(e);for(var i=0;i<n.length;i++)e.appendChild(n[i]);return this},unwrap:function(t){var e=t.parentNode;if(e){if(this.isDoc(e.parentNode))return;e.parentNode.insertBefore(t,e)}}}),t.attach("domx.noder",w)}),define("skylark-domx-noder/main",["./noder"],function(t){return t}),define("skylark-domx-noder",["skylark-domx-noder/main"],function(t){return t}),define("skylark-domx-finder/finder",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder"],function(t,e,n,r){var o={},a=Array.prototype.filter,s=Array.prototype.slice,l=n.matchesSelector;(function(){var t,e,n,i,r,o={},a={},s=/\\/g,l=function(n,r){if(null==n)return null;if(!0===n.Slick)return n;n=(""+n).replace(/^\s+|\s+$/g,"");var s=(i=!!r)?a:o;if(s[n])return s[n];for(t={Slick:!0,expressions:[],raw:n,reverse:function(){return l(this.raw,!0)}},e=-1;n!=(n=n.replace(h,f)););return t.length=t.expressions.length,s[t.raw]=i?d(t):t},u=function(t){return"!"===t?" ":" "===t?"!":/^!/.test(t)?t.replace(/^!/,""):"!"+t},d=function(t){for(var e=t.expressions,n=0;n<e.length;n++){for(var i=e[n],r={parts:[],tag:"*",combinator:u(i[0].combinator)},o=0;o<i.length;o++){var a=i[o];a.reverseCombinator||(a.reverseCombinator=" "),a.combinator=a.reverseCombinator,delete a.reverseCombinator}i.reverse().push(r)}return t},c=(r=/(?=[\-\[\]{}()*+?.\\\^$|,#\s])/g,function(t){return t.replace(r,"\\")}),h=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+c(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function f(r,o,a,l,d,h,f,p,g,m,v,y,b,k,x,w){if((o||-1===e)&&(t.expressions[++e]=[],n=-1,o))return"";if(a||l||-1===n){a=a||" ";var _=t.expressions[e];i&&_[n]&&(_[n].reverseCombinator=u(a)),_[++n]={combinator:a,tag:"*"}}var A=t.expressions[e][n];if(d)A.tag=d.replace(s,"");else if(h)A.id=h.replace(s,"");else if(f)f=f.replace(s,""),A.classList||(A.classList=[]),A.classes||(A.classes=[]),A.classList.push(f),A.classes.push({value:f,regexp:new RegExp("(^|\\s)"+c(f)+"(\\s|$)")});else if(b)w=(w=w||x)?w.replace(s,""):null,A.pseudos||(A.pseudos=[]),A.pseudos.push({key:b.replace(s,""),value:w,type:1==y.length?"class":"element"});else if(p){var C,T;switch(p=p.replace(s,""),v=(v||"").replace(s,""),g){case"^=":T=new RegExp("^"+c(v));break;case"$=":T=new RegExp(c(v)+"$");break;case"~=":T=new RegExp("(^|\\s)"+c(v)+"(\\s|$)");break;case"|=":T=new RegExp("^"+c(v)+"(-|$)");break;case"=":C=function(t){return v==t};break;case"*=":C=function(t){return t&&t.indexOf(v)>-1};break;case"!=":C=function(t){return v!=t};break;default:C=function(t){return!!t}}""==v&&/^[*$^]=$/.test(g)&&(C=function(){return!1}),C||(C=function(t){return t&&T.test(t)}),A.attributes||(A.attributes=[]),A.attributes.push({key:p,operator:g,value:v,test:C})}return""}var p=this.Slick||{};p.parse=function(t){return l(t)},p.escapeRegExp=c,this.Slick||(this.Slick=p)}).apply(o);var u=/^(?:input|select|textarea|button)$/i,d=/^h\d$/i,s=Array.prototype.slice;o.parseSelector=o.Slick.parse;var c=o.pseudos={button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},checked:function(t){return!!t.checked},contains:function(t,e,n,i){if($(this).text().indexOf(i)>-1)return this},disabled:function(t){return!!t.disabled},enabled:function(t){return!t.disabled},eq:function(t,e,n,i){return e==i},even:function(t,e,n,i){return e%2==0},focus:function(t){return document.activeElement===t&&(t.href||t.type||t.tabindex)},focusable:function(t){return r.focusable(t,null!=t.tabindex)},first:function(t,e){return 0===e},gt:function(t,e,n,i){return e>i},has:function(t,e,n,i){return y(t,i)},header:function(t){return d.test(t.nodeName)},hidden:function(t){return!o.pseudos.visible(t)},input:function(t){return u.test(t.nodeName)},last:function(t,e,n){return e===n.length-1},lt:function(t,e,n,i){return e<i},not:function(t,e,n,i){return!x(t,i)},odd:function(t,e,n,i){return e%2==1},parent:function(t){return!!t.parentNode},selected:function(t){return!!t.selected},tabbable:function(t){var e=t.tabindex,n=null!=e;return(!n||e>=0)&&r.focusable(element,n)},text:function(t){return"text"===t.type},visible:function(t){return t.offsetWidth&&t.offsetWidth}};function h(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function f(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}for(i in["first","eq","last"].forEach(function(t){c[t].isArrayFilter=!0}),c.nth=c.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})c[i]=h(i);for(i in{submit:!0,reset:!0})c[i]=f(i);function p(t,n,i){for(var r=[],a=i&&e.isString(i);(t=t.parentNode)&&9!==t.nodeType;){if(i)if(a){if(x(t,i))break}else if(e.isArrayLike(i)){if(e.inArray(t,i)>-1)break}else if(t==i)break;r.push(t)}return n&&(r=o.filter(r,n)),r}function g(t,e){for(var n=t.childNodes,i=[],r=0;r<n.length;r++){var t=n[r];1==t.nodeType&&i.push(t)}return e&&(i=o.filter(i,e)),i}function m(t,e){try{return s.call(t.querySelectorAll(e))}catch(t){}return o.query(t,e)}function v(t,e){try{return t.querySelector(e)}catch(t){}var n=o.query(t,e);return n.length>0?n[0]:null}function y(t,e){return e||(e=t,t=document.body),x(t,e)?t:v(t,e)}function b(t,e,n){for(var i=t.childNodes,r=i[0];r;){if(1==r.nodeType){if(!e||x(r,e))return r;if(n)break}r=r.nextSibling}return null}function k(t,e,n){for(var i=t.childNodes,r=i[i.length-1];r;){if(1==r.nodeType){if(!e||x(r,e))return r;if(n)break}r=r.previousSibling}return null}function x(t,n){if(!n||!t||1!==t.nodeType)return!1;if(e.isString(n)){try{return l.call(t,n.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(t){}return o.match(t,n)}return e.isArrayLike(n)?e.inArray(t,n)>-1:e.isPlainObject(n)?o.check(t,n):t===n}function w(t,e,n){for(var i=t.nextSibling;i;){if(1==i.nodeType){if(!e||x(i,e))return i;if(n)break}i=i.nextSibling}return null}function _(t,e){for(var n=t.nextSibling,i=[];n;)1==n.nodeType&&(e&&!x(n,e)||i.push(n)),n=n.nextSibling;return i}function A(t,e){var n=t.parentNode;return!n||e&&!x(n,e)?null:n}function C(t,e,n){for(var i=t.previousSibling;i;){if(1==i.nodeType){if(!e||x(i,e))return i;if(n)break}i=i.previousSibling}return null}function T(t,e){for(var n=t.previousSibling,i=[];n;)1==n.nodeType&&(e&&!x(n,e)||i.push(n)),n=n.previousSibling;return i}function E(t,e){for(var n=t.parentNode.firstChild,i=[];n;)1==n.nodeType&&n!==t&&(e&&!x(n,e)||i.push(n)),n=n.nextSibling;return i}o.divide=function(t){var e,n,i,r,o,a="",s=[];if((n=t.id)&&(a+="#"+n),i=t.classes)for(var l=i.length;l--;)a+="."+i[l].value;if(r=t.attributes)for(var l=0;l<r.length;l++)r[l].operator?a+="["+r[l].key+r[l].operator+JSON.stringify(r[l].value)+"]":a+="["+r[l].key+"]";if(o=t.pseudos)for(l=o.length;l--;)part=o[l],this.pseudos[part.key]?s.push(part):void 0!==part.value&&(a+=":"+part.key+"("+JSON.stringify(part));return(e=t.tag)&&"*"!==e&&(a=e.toUpperCase()+a),a||(a="*"),{nativeSelector:a,customPseudos:s}},o.check=function(t,e,n,i,r){var o,a,s,u,d,c,h,f,p;if(!r){if(o=e.tag){var g=t.nodeName.toUpperCase();if("*"==o){if(g<"@")return!1}else if(g!=(o||"").toUpperCase())return!1}if((a=e.id)&&t.getAttribute("id")!=a)return!1;if(s=e.classes)for(c=s.length;c--;)if(!(f=t.getAttribute("class"))||!s[c].regexp.test(f))return!1;if(u=e.attributes)for(c=u.length;c--;)if((h=u[c]).operator?!h.test(t.getAttribute(h.key)):!t.hasAttribute(h.key))return!1}if(d=e.pseudos)for(c=d.length;c--;)if(h=d[c],p=this.pseudos[h.key]){if((r&&p.isArrayFilter||!r&&!p.isArrayFilter)&&!p(t,n,i,h.value))return!1}else if(!r&&!l.call(t,h.key))return!1;return!0},o.match=function(t,n){var i;if(!(i=e.isString(n)?o.Slick.parse(n):n))return!0;var r,a,s=i.expressions,l=0;for(r=0;a=s[r];r++)if(1==a.length){var u=a[0];if(this.check(t,u))return!0;l++}if(l==i.length)return!1;var d,c=this.query(document,i);for(r=0;d=c[r++];)if(d===t)return!0;return!1},o.filterSingle=function(t,e){var n=a.call(t,function(n,i){return o.check(n,e,i,t,!1)});return n=a.call(n,function(t,i){return o.check(t,e,i,n,!0)})},o.filter=function(t,n){if(!e.isString(n))return o.filterSingle(t,n);var i,r,a=o.Slick.parse(n).expressions,s=[];for(i=0;r=a[i];i++){if(1!=r.length)throw new Error("not supported selector:"+n);var l=r[0],u=o.filterSingle(t,l);s=e.uniq(s.concat(u))}return s},o.combine=function(t,e){var n,i=e.combinator,r=e,l=[];switch(i){case">":l=g(t,r);break;case"+":(n=w(t,r,!0))&&l.push(n);break;case"^":(n=b(t,r,!0))&&l.push(n);break;case"~":l=_(t,r);break;case"++":var u=C(t,r,!0),d=w(t,r,!0);u&&l.push(u),d&&l.push(d);break;case"~~":l=E(t,r);break;case"!":l=p(t,r);break;case"!>":(n=A(t,r))&&l.push(n);break;case"!+":l=C(t,r,!0);break;case"!^":(n=k(t,r,!0))&&l.push(n);break;case"!~":l=T(t,r);break;default:var c=this.divide(e);if(l=s.call(t.querySelectorAll(c.nativeSelector)),c.customPseudos)for(var h=c.customPseudos.length-1;h>=0;h--)l=a.call(l,function(t,e){return o.check(t,{pseudos:[c.customPseudos[h]]},e,l,!1)}),l=a.call(l,function(t,e){return o.check(t,{pseudos:[c.customPseudos[h]]},e,l,!0)})}return l},o.query=function(t,n,i){for(var r,a,s=this.Slick.parse(n),l=[],u=s.expressions,d=0;r=u[d];d++){for(var c,h=[t],f=0;a=r[f];f++)(c=e.map(h,function(t,e){return o.combine(t,a)}))&&(h=c);c&&(l=l.concat(c))}return l};var N=function(){return N};return e.mixin(N,{ancestor:function(t,n,i){var r=i&&e.isString(i);for(;t=t.parentNode;){if(x(t,n))return t;if(i)if(r){if(x(t,i))break}else if(t==i)break}return null},ancestors:p,byId:function(t,e){return(e=e||r.doc()).getElementById(t)},children:g,closest:function(t,e){for(;t&&!x(t,e);)t=t.parentNode;return t},descendant:v,descendants:m,find:y,findAll:function(t,e){e||(e=t,t=document.body);return m(t,e)},firstChild:b,lastChild:k,matches:x,nextSibling:w,nextSiblings:_,parent:A,previousSibling:C,previousSiblings:T,pseudos:o.pseudos,siblings:E}),t.attach("domx.finder",N)}),define("skylark-domx-finder/main",["./finder"],function(t){return t}),define("skylark-domx-finder",["skylark-domx-finder/main"],function(t){return t}),define("skylark-domx-query/query",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-finder"],function(t,e,n,i){var r,o=Array.prototype.some,a=Array.prototype.push,s=(Array.prototype.every,Array.prototype.concat,Array.prototype.slice),l=(Array.prototype.map,Array.prototype.filter),u=Array.prototype.forEach,d=Array.prototype.indexOf,c=Array.prototype.sort,h=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,f=e.funcArg,p=e.isArrayLike,g=e.isString,m=e.uniq,v=e.isFunction,y=e.type,b=(e.isArray,e.isWindow,e.isDocument,e.isObject);e.isPlainObject,e.compact,e.flatten,e.camelCase,e.dasherize,i.children;function k(t,i,r){return function(r){var o,a=e.map(arguments,function(t){return"function"==(o=y(t))||"object"==o||"array"==o||null==t?t:n.createFragment(t)});return a.length<1?this:(this.each(function(e){t.apply(i,[this,a,e>0])}),this)}}function x(t,n){return function(){var i=s.call(arguments),r=e.map(this,function(e,r){return t.apply(n,[e].concat(i))});return N(m(r))}}function w(t,e,n){return function(i){s.call(arguments);var r=this.map(function(r,o){return t.apply(e,n?[o]:[o,i])});return n&&i?r.filter(i):r}}function _(t,e,n){return function(i,r){s.call(arguments);var o=this.map(function(o,a){return t.apply(e,n?[a,i]:[a,r,i])});return n&&r?o.filter(r):o}}function A(t,e){return function(){var n=s.call(arguments);return this.each(function(i,r){t.apply(e,[this].concat(n))}),this}}function C(t,n,i){return function(r){return e.isDefined(r)?(u.call(this,function(e,o){var a;a=i?f(e,r,o,i(e)):r,t.apply(n,[e,a])}),this):this[0]?t.apply(n,[this[0]]):void 0}}var T,E=e.klass({klassName:"SkNodeList",init:function(t,r){var o,s,l,u;if(t&&(this.context=r=r||n.doc(),g(t)?(this.selector=t,(o="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:h.exec(t))?o[1]?(s=n.createFragment(t),e.isPlainObject(r)&&(u=r)):(l=i.byId(o[2],n.ownerDoc(r)))&&(s=[l]):(e.isString(r)&&(r=i.find(r)),s=i.descendants(r,t))):s=t!==window&&p(t)?t:[t]),s&&(a.apply(this,s),u))for(var d in u)e.isFunction(this[d])?this[d](u[d]):this.attr(d,u[d]);return this}}),N=function(){r=function(t){return t instanceof E},init=function(t,e){return new E(t,e)};var t=function(e,n){if(!v(e))return r(e)?e:n&&r(n)&&g(e)?n.find(e):init(e,n);t.ready(function(){e(t)})};t.fn=E.prototype,e.mixin(t.fn,{length:0,map:function(n){return t(m(e.map(this,function(t,e){return n.call(t,e,t)})))},slice:function(){return t(s.apply(this,arguments))},forEach:function(){return u.apply(this,arguments)},get:function(t){return void 0===t?s.call(this):this[t>=0?t:t+this.length]},indexOf:function(){return d.apply(this,arguments)},sort:function(){return c.apply(this,arguments)},toArray:function(){return s.call(this)},size:function(){return this.length},remove:function(t){return t?this.find(t).remove():(this.each(function(t,e){n.remove(e)}),this)},each:function(t){return e.each(this,t),this},filter:function(e){return v(e)?this.not(this.not(e)):t(l.call(this,function(t){return i.matches(t,e)}))},add:function(e,n){return t(m(this.toArray().concat(t(e,n).toArray())))},is:function(t){if(this.length>0){if(e.isString(t))return o.call(this,function(e){return i.matches(e,t)});if(e.isArrayLike(t))return o.call(this,function(n){return e.inArray(n,t)>-1});if(e.isHtmlNode(t))return o.call(this,function(e){return e==t})}return!1},not:function(e){var n=[];if(v(e)&&void 0!==e.call)this.each(function(t,i){e.call(this,t,i)||n.push(this)});else{var i="string"==typeof e?this.filter(e):p(e)&&v(e.item)?s.call(e):t(e);this.forEach(function(t){i.indexOf(t)<0&&n.push(t)})}return t(n)},has:function(e){return this.filter(function(){return b(e)?n.contains(this,e):t(this).find(e).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:w(i.descendants,i),closest:w(i.closest,i),parents:w(i.ancestors,i),parentsUntil:_(i.ancestors,i),parent:w(i.parent,i),children:w(i.children,i),contents:x(n.contents,n),empty:A(n.empty,n),html:C(n.html,n),pluck:function(t){return e.map(this,function(e){return e[t]})},pushStack:function(e){var n=t(e);return n.prevObject=this,n},replaceWith:function(t){return this.before(t).remove()},wrap:function(e){var n=v(e);if(this[0]&&!n)var i=t(e).get(0),r=i.parentNode||this.length>1;return this.each(function(o,a){t(this).wrapAll(n?e.call(this,o,a):r?i.cloneNode(!0):i)})},wrapAll:function(e){if(this[0]){var n;for(t(this[0]).before(e=t(e));(n=e.children()).length;)e=n.first();t(e).append(this)}return this},wrapInner:function(e){var n=v(e);return this.each(function(i,r){var o=t(this),a=o.contents(),s=n?e.call(this,i,r):e;a.length?a.wrapAll(s):o.append(s)})},unwrap:function(e){return 0===this.parent().children().length?this.parent(e).not("body").each(function(){t(this).replaceWith(document.createTextNode(this.childNodes[0].textContent))}):this.parent().each(function(){t(this).replaceWith(t(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},toggle:function(e){return this.each(function(){var n=t(this);(void 0===e?"none"==n.css("display"):e)?n.show():n.hide()})},prev:function(e){return t(this.pluck("previousElementSibling")).filter(e||"*")},prevAll:w(i.previousSiblings,i),next:function(e){return t(this.pluck("nextElementSibling")).filter(e||"*")},nextAll:w(i.nextSiblings,i),siblings:w(i.siblings,i),index:function(e){return e?this.indexOf(t(e)[0]):this.parent().children().indexOf(this[0])}}),t.fn.detach=t.fn.remove,t.fn.hover=function(t,e){return this.mouseenter(t).mouseleave(e||t)};n.traverse;return t.fn.after=k(n.after,n),t.fn.prepend=k(n.prepend,n),t.fn.before=k(n.before,n),t.fn.append=k(n.append,n),e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,n){t.fn[e]=function(e){for(var i,r=[],o=t(e),s=o.length-1,l=0;l<=s;l++)i=l===s?this:this.clone(!0),t(o[l])[n](i),a.apply(r,i.get());return this.pushStack(r)}}),t}();return(T=N).fn.scrollParent=function(t){var e=this.css("position"),n="absolute"===e,i=t?/(auto|scroll|hidden)/:/(auto|scroll)/,r=this.parents().filter(function(){var t=T(this);return(!n||"static"!==t.css("position"))&&i.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==e&&r.length?r:T(this[0].ownerDocument||document)},function(t){t.fn.end=function(){return this.prevObject||t()},t.fn.andSelf=function(){return this.add(this.prevObject||t())},t.fn.addBack=function(t){return this.prevObject?t?this.add(this.prevObject.filter(t)):this.add(this.prevObject):this},"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings,prev,prevAll,next,nextAll".split(",").forEach(function(e){var n=t.fn[e];t.fn[e]=function(){var t=n.apply(this,arguments);return t.prevObject=this,t}})}(N),function(t){var o;t.fn.query=t.fn.find,t.fn.place=function(t,o){return e.isString(t)?t=i.descendant(t):r(t)&&(t=t[0]),this.each(function(e,i){switch(o){case"before":n.before(t,i);break;case"after":n.after(t,i);break;case"replace":n.replace(t,i);break;case"only":n.empty(t),n.append(t,i);break;case"first":n.prepend(t,i);break;default:n.append(t,i)}})},t.fn.addContent=function(t,n){return t.template&&(t=e.substitute(t.template,t)),this.append(t)},t.fn.disableSelection=(o="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(o+".ui-disableSelection",function(t){t.preventDefault()})}),t.fn.enableSelection=function(){return this.off(".ui-disableSelection")},t.fn.reflow=function(){return n.flow(this[0])},t.fn.isBlockNode=function(){return n.isBlockNode(this[0])}}(N),N.fn.plugin=function(t,e){var n=s.call(arguments,1),i=this,r=this;return this.each(function(){r=plugins.instantiate.apply(i,[this,t].concat(n))}),r},N.wraps={wrapper_node_operation:k,wrapper_map:x,wrapper_value:C,wrapper_selector:w,wrapper_some_chk:function(t,e){return function(){var n=s.call(arguments);return o.call(this,function(i){return t.apply(e,[i].concat(n))})}},wrapper_selector_until:_,wrapper_every_act_firstArgFunc:function(t,e,n){return function(i){var r=s.call(arguments);return u.call(this,function(o,a){f(o,i,a,n(o));t.apply(e,[o,i].concat(r.slice(1)))}),this}},wrapper_every_act:A,wrapper_name_value:function(t,n,i){return function(r,o){var a=s.call(arguments);return e.isPlainObject(r)||e.isDefined(o)?(u.call(this,function(e,s){i&&f(e,o,s,i(e,r)),t.apply(n,[e].concat(a))}),this):this[0]?t.apply(n,[this[0],r]):void 0}}},t.attach("domx.query",N)}),define("skylark-domx-query/main",["./query"],function(t){return t}),define("skylark-domx-query",["skylark-domx-query/main"],function(t){return t}),define("skylark-domx-data/data",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-finder","skylark-domx-noder"],function(t,e,n,i){var r=Array.prototype.map,o=(Array.prototype.filter,e.camelCase),a=e.deserializeValue,s=/([A-Z])/g,l={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"};var u={option:{get:function(t){var e=t.getAttribute("value");return null!=e?e:(g(t).match(/[^\x20\t\r\n\f]+/g)||[]).join(" ")}},select:{get:function(t){var e,n,r,o=t.options,a=t.selectedIndex,s="select-one"===t.type,l=s?null:[],u=s?a+1:o.length;for(r=a<0?u:s?a:0;r<u;r++)if((n=o[r]).selected&&!n.disabled&&(!n.parentNode.disabled||!i.nodeName(n.parentNode,"optgroup"))){if(e=m(n),s)return e;l.push(e)}return l},set:function(t,n){for(var i,r,o=t.options,a=e.makeArray(n),s=o.length;s--;)((r=o[s]).selected=e.inArray(u.option.get(r),a)>-1)&&(i=!0);return i||(t.selectedIndex=-1),a}}};function d(t,e,n){if(void 0!==n)return t.setAttribute(e,n),this;if("object"==typeof e){for(var i in e)d(t,i,e[i]);return this}return t.hasAttribute&&t.hasAttribute(e)?t.getAttribute(e):void 0}function c(t,n){var i=t._$_store;return!i&&n&&(i=t._$_store=function(t){var n={};return e.each(t.attributes||[],function(t,e){0==e.name.indexOf("data-")&&(n[o(e.name.replace("data-",""))]=a(e.value))}),n}(t)),i}function h(t,e,n){var i=c(t,!0);i[o(e)]=n}function f(t,e,n){if(void 0===n){if("object"==typeof e){for(var i in e)h(t,i,e[i]);return this}return function(t,e){if(void 0===e)return c(t,!0);var n=c(t);if(n){if(e in n)return n[e];var i=o(e);if(i in n)return n[i]}var r="data-"+e.replace(s,"-$1").toLowerCase();return d(t,r)}(t,e)}return h(t,e,n),this}function p(t){t._$_store&&delete t._$_store}function g(t,e){return void 0===e?t.textContent:(t.textContent=null==e?"":""+e,this)}function m(t,n){var i=u[t.type]||u[t.nodeName.toLowerCase()];if(void 0===n)return i&&"get"in i&&void 0!==(ret=i.get(t,"value"))?ret:(ret=t.value,"string"==typeof ret?ret.replace(/\r/g,""):null==ret?"":ret);null==n?n="":"number"==typeof n?n+="":e.isArray(n)&&(n=e.map(n,function(t){return null==t?"":t+""})),i&&"set"in i&&void 0!==i.set(t,n,"value")||(t.value=n)}function v(){return v}return e.each(["radio","checkbox"],function(){u[this]={set:function(t,n){if(e.isArray(n))return t.checked=e.inArray(m(t),n)>-1}}}),n.pseudos.data=function(t,e,n,i){return!!f(t,i||n[3])},e.mixin(v,{aria:function(t,e,n){return this.attr(t,"aria-"+e,n)},attr:d,cleanData:p,data:f,pluck:function(t,e){return r.call(t,function(t){return t[e]})},prop:function(t,e,n){return e=l[e]||e,void 0===n?t[e]:(t[e]=n,this)},removeAttr:function(t,e){return e.split(" ").forEach(function(e){!function(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}(t,e)}),this},removeData:function(t,n){if(n){e.isString(n)&&(n=n.split(/\s+/));var i=c(t,!0);n.forEach(function(t){delete i[t]})}else p(t);return this},removeProp:function(t,e){return e.split(" ").forEach(function(e){delete t[e]}),this},text:g,val:m,valHooks:u}),t.attach("domx.data",v)}),define("skylark-domx-velm/velm",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-finder","skylark-domx-query"],function(t,e,n,i,r){var o=Array.prototype.map,a=Array.prototype.slice,s=e.klass({klassName:"VisualElement",_construct:function(t){e.isString(t)&&(t="<"===t.charAt(0)?n.createFragment(t)[0]:document.getElementById(t)),this._elm=t}});s.prototype.$=s.prototype.query=function(t){return r(t,this._elm)},s.prototype.elm=function(){return this._elm};var l=new s(document.body),u=function(t){return t?new s(t):l};return e.mixin(u,{batch:function(t,e,n){return t.forEach(function(t){var i=t instanceof s?t:u(t);i[e].apply(i,n)}),this},root:new s(document.body),VisualElement:s,partial:function(t,e){var n={};n[t]=e,s.partial(n)},delegate:function(t,n){var i={};t.forEach(function(t){i[t]=function(t,n){return function(){var i=this._elm,r=t.apply(n,[i].concat(a.call(arguments)));if(r){if(r===n)return this;r instanceof HTMLElement?r=new s(r):e.isArrayLike(r)&&(r=o.call(r,function(t){return t instanceof HTMLElement?new s(t):t}))}return r}}(n[t],n)}),s.partial(i)}}),u.delegate(["ancestor","ancestors","children","descendant","find","findAll","firstChild","lastChild","matches","nextSibling","nextSiblings","parent","previousSibling","previousSiblings","siblings"],i),u.find=function(t){return"body"===t?this.root:this.root.descendant(t)},u.delegate(["after","append","before","clone","contains","contents","empty","html","isChildOf","isDocument","isInDocument","isWindow","ownerDoc","prepend","remove","removeChild","replace","reverse","throb","traverse","wrapper","wrapperInner","unwrap"],n),t.attach("domx.velm",u)}),define("skylark-domx-velm/main",["./velm"],function(t){return t}),define("skylark-domx-velm",["skylark-domx-velm/main"],function(t){return t}),define("skylark-domx-data/main",["./data","skylark-domx-velm","skylark-domx-query"],function(t,e,n){return e.delegate(["attr","data","prop","removeAttr","removeData","text","val"],t),n.fn.text=n.wraps.wrapper_value(t.text,t,t.text),n.fn.attr=n.wraps.wrapper_name_value(t.attr,t,t.attr),n.fn.removeAttr=n.wraps.wrapper_every_act(t.removeAttr,t),n.fn.prop=n.wraps.wrapper_name_value(t.prop,t,t.prop),n.fn.removeProp=n.wraps.wrapper_every_act(t.removeProp,t),n.fn.data=n.wraps.wrapper_name_value(t.data,t,t.data),n.fn.removeData=n.wraps.wrapper_every_act(t.removeData,t),n.fn.val=n.wraps.wrapper_value(t.val,t,t.val),t}),define("skylark-domx-data",["skylark-domx-data/main"],function(t){return t}),define("skylark-domx-contents/contents",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-data"],function(t,e,n,i){"use strict";var r=function(){return r};return t.attach("domx.contents",r)}),define("skylark-domx-contents/Hotkeys",["skylark-langx/langx","skylark-domx-query","./contents"],function(t,e,n){var i=t.Evented.inherit({});return i.count=0,i.keyNameMap={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",91:"Meta",93:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i.aliases={escape:"esc",delete:"del",return:"enter",ctrl:"control",space:"spacebar",ins:"insert",cmd:"meta",command:"meta",wins:"meta",windows:"meta"},i.normalize=function(t){var e,n,i,r,o,a;for(o=t.toLowerCase().replace(/\s+/gi,"").split("+"),e=n=0,a=o.length;n<a;e=++n)i=o[e],o[e]=this.aliases[i]||i;return r=o.pop(),o.sort().push(r),o.join("_")},i.prototype.opts={el:document},i.prototype.init=function(){var t;this.id=++this.constructor.count,this._map={},this._delegate="string"==typeof this.opts.el?document:this.opts.el,e(this._delegate).on("keydown.simple-hotkeys-"+this.id,this.opts.el,(t=this,function(e){var n;return null!=(n=t._getHander(e))?n.call(t,e):void 0}))},i.prototype._getHander=function(t){var e,n;if(e=this.constructor.keyNameMap[t.which])return n="",t.altKey&&(n+="alt_"),t.ctrlKey&&(n+="control_"),t.metaKey&&(n+="meta_"),t.shiftKey&&(n+="shift_"),n+=e.toLowerCase(),this._map[n]},i.prototype.respondTo=function(t){return"string"==typeof t?null!=this._map[this.constructor.normalize(t)]:null!=this._getHander(t)},i.prototype.add=function(t,e){return this._map[this.constructor.normalize(t)]=e,this},i.prototype.remove=function(t){return delete this._map[this.constructor.normalize(t)],this},i.prototype.destroy=function(){return e(this._delegate).off(".simple-hotkeys-"+this.id),this._map={},this},n.Hotkeys=i}),define("skylark-domx-contents/Util",["skylark-langx/langx","skylark-domx-query","./contents"],function(t,e,n){var i,r,o,a,s,l,u,d,c,h,f,p,g=t.Evented.inherit({init:function(e,n){if(this.editor=e,this.opts=t.extend({},this.opts,n),this.browser.msie&&this.browser.version<11)return this.phBr=""}});return g.pluginName="Util",g.prototype.phBr="<br/>",g.prototype.os=(i={},/Mac/.test(navigator.appVersion)?i.mac=!0:/Linux/.test(navigator.appVersion)?i.linux=!0:/Win/.test(navigator.appVersion)?i.win=!0:/X11/.test(navigator.appVersion)&&(i.unix=!0),/Mobi/.test(navigator.appVersion)&&(i.mobile=!0),i),g.prototype.browser=(p=navigator.userAgent,s=/(msie|trident)/i.test(p),r=/chrome|crios/i.test(p),f=/safari/i.test(p)&&!r,a=/firefox/i.test(p),o=/edge/i.test(p),s?{msie:!0,version:1*(null!=(l=p.match(/(msie |rv:)(\d+(\.\d+)?)/i))?l[2]:void 0)}:o?{edge:!0,webkit:!0,version:1*(null!=(u=p.match(/edge\/(\d+(\.\d+)?)/i))?u[1]:void 0)}:r?{webkit:!0,chrome:!0,version:1*(null!=(d=p.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))?d[1]:void 0)}:f?{webkit:!0,safari:!0,version:1*(null!=(c=p.match(/version\/(\d+(\.\d+)?)/i))?c[1]:void 0)}:a?{mozilla:!0,firefox:!0,version:1*(null!=(h=p.match(/firefox\/(\d+(\.\d+)?)/i))?h[1]:void 0)}:{}),g.prototype.support={onselectionchange:function(){var t;if(void 0!==(t=document.onselectionchange))try{return document.onselectionchange=0,null===document.onselectionchange}catch(t){}finally{document.onselectionchange=t}return!1}(),oninput:!/(msie|trident)/i.test(navigator.userAgent)},g.prototype.reflow=function(t){return null==t&&(t=document),e(t)[0].offsetHeight},g.prototype.metaKey=function(t){return/Mac/.test(navigator.userAgent)?t.metaKey:t.ctrlKey},g.prototype.isEmptyNode=function(t){var n;return(n=e(t)).is(":empty")||!n.text()&&!n.find(":not(br, span, div)").length},g.prototype.isDecoratedNode=function(t){return e(t).is('[class^="'+this.opts.classPrefix+'"]')},g.prototype.blockNodes=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","h5","table"],g.prototype.isBlockNode=function(t){return!(!(t=e(t)[0])||3===t.nodeType)&&new RegExp("^("+this.blockNodes.join("|")+")$").test(t.nodeName.toLowerCase())},g.prototype.getNodeLength=function(t){switch((t=e(t)[0]).nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}},g.prototype.dataURLtoBlob=function(t){var e,n,i,r,o,a,s,l,u,d,c;if(a=window.Blob&&function(){try{return Boolean(new Blob)}catch(t){return t,!1}}(),o=a&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return t,!1}}(),e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,!((a||e)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(r=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),n=new ArrayBuffer(r.length),l=new Uint8Array(n),s=u=0,c=r.length;0<=c?u<=c:u>=c;s=0<=c?++u:--u)l[s]=r.charCodeAt(s);return d=t.split(",")[0].split(":")[1].split(";")[0],a?new Blob([o?l:n],{type:d}):((i=new e).append(n),i.getBlob(d))},g.prototype.throttle=function(t,e){var n,i,r,o,a,s,l;return o=0,l=0,r=n=a=null,i=function(){return l=0,o=+new Date,a=t.apply(r,n),r=null,n=null},(s=function(){var t;return r=this,n=arguments,t=new Date-o,l||(t>=e?i():l=setTimeout(i,e-t)),a}).clear=function(){if(l)return clearTimeout(l),i()},s},g.prototype.formatHTML=function(e){var n,i,r,o,a,s,l,u;for(a=/<(\/?)(.+?)(\/?)>/g,l="",r=0,i=null,"  ",s=function(t,e){return new Array(e+1).join(t)};null!==(o=a.exec(e));)o.isBlockNode=t.inArray(o[2],this.blockNodes)>-1,o.isStartTag="/"!==o[1]&&"/"!==o[3],o.isEndTag="/"===o[1]||"/"===o[3],n=i?i.index+i[0].length:0,(u=e.substring(n,o.index)).length>0&&t.trim(u)&&(l+=u),o.isBlockNode&&o.isEndTag&&!o.isStartTag&&(r-=1),o.isBlockNode&&o.isStartTag&&(i&&i.isBlockNode&&i.isEndTag||(l+="\n"),l+=s("  ",r)),l+=o[0],o.isBlockNode&&o.isEndTag&&(l+="\n"),o.isBlockNode&&o.isStartTag&&(r+=1),i=o;return t.trim(l)},n.Util=g}),define("skylark-domx-contents/InputManager",["skylark-langx/langx","skylark-domx-query","./contents"],function(t,e,n){var i=[].indexOf,r=t.Evented.inherit({init:function(n,i){var r,o,a;this.editable=n,this.opts=t.extend({},this.opts,i),this.throttledValueChanged=this.editable.util.throttle((a=this,function(t){return setTimeout(function(){return a.editable.trigger("valuechanged",t)},10)}),300),this.throttledSelectionChanged=this.editable.util.throttle(function(t){return function(){return t.editable.trigger("selectionchanged")}}(this),50),e(document).on("selectionchange.simditor"+this.editable.id,function(t){return function(e){var n;if(t.focused&&!t.editable.clipboard.pasting)return(n=function(){return t._selectionTimer&&(clearTimeout(t._selectionTimer),t._selectionTimer=null),t.editable.selection._selection.rangeCount>0?t.throttledSelectionChanged():t._selectionTimer=setTimeout(function(){if(t._selectionTimer=null,t.focused)return n()},10)})()}}(this)),this.editable.on("valuechanged",function(t){return function(){var n;if(t.lastCaretPosition=null,n=t.editable.body.children().filter(function(e,n){return t.editable.util.isBlockNode(n)}),t.focused&&0===n.length&&(t.editable.selection.save(),t.editable.formatter.format(),t.editable.selection.restore()),t.editable.body.find("hr, pre, ."+t.opts.classPrefix+"table").each(function(n,i){var r,o;if(((r=e(i)).parent().is("blockquote")||r.parent()[0]===t.editable.body[0])&&(o=!1,0===r.next().length&&(e("<p/>").append(t.editable.util.phBr).insertAfter(r),o=!0),0===r.prev().length&&(e("<p/>").append(t.editable.util.phBr).insertBefore(r),o=!0),o))return t.throttledValueChanged()}),t.editable.body.find("pre:empty").append(t.editable.util.phBr),!t.editable.util.support.onselectionchange&&t.focused)return t.throttledSelectionChanged()}}(this)),this.editable.body.on("keydown",t.proxy(this._onKeyDown,this)).on("keypress",t.proxy(this._onKeyPress,this)).on("keyup",t.proxy(this._onKeyUp,this)).on("mouseup",t.proxy(this._onMouseUp,this)).on("focus",t.proxy(this._onFocus,this)).on("blur",t.proxy(this._onBlur,this)).on("drop",t.proxy(this._onDrop,this)).on("input",t.proxy(this._onInput,this)),this.editable.util.browser.firefox&&(this.editable.hotkeys.add("cmd+left",function(t){return function(e){return e.preventDefault(),t.editable.selection._selection.modify("move","backward","lineboundary"),!1}}(this)),this.editable.hotkeys.add("cmd+right",function(t){return function(e){return e.preventDefault(),t.editable.selection._selection.modify("move","forward","lineboundary"),!1}}(this)),r=this.editable.util.os.mac?"cmd+a":"ctrl+a",this.editable.hotkeys.add(r,function(t){return function(e){var n,i,r,o;if((n=t.editable.body.children()).length>0)return i=n.first().get(0),r=n.last().get(0),(o=document.createRange()).setStart(i,0),o.setEnd(r,t.editable.util.getNodeLength(r)),t.editable.selection.range(o),!1}}(this))),o=this.editable.util.os.mac?"cmd+enter":"ctrl+enter",this.editable.hotkeys.add(o,function(t){return function(e){return t.editable.$el.closest("form").find("button:submit").click(),!1}}(this))}});return r.pluginName="InputManager",r.prototype._modifierKeys=[16,17,18,91,93,224],r.prototype._arrowKeys=[37,38,39,40],r.prototype._onFocus=function(t){var e;if(!this.editable.clipboard.pasting)return this.editable.$el.addClass("focus").removeClass("error"),this.focused=!0,setTimeout((e=this,function(){var t,n;if((n=e.editable.selection._selection.getRangeAt(0)).startContainer===e.editable.body[0]&&(e.lastCaretPosition?e.editable.undoManager.caretPosition(e.lastCaretPosition):(t=e.editable.body.children().first(),n=document.createRange(),e.editable.selection.setRangeAtStartOf(t,n),console.log("aaaaaa"))),e.lastCaretPosition=null,e.editable.trigger("focus"),!e.editable.util.support.onselectionchange)return e.throttledSelectionChanged()}),0)},r.prototype._onBlur=function(t){var e;if(!this.editable.clipboard.pasting)return this.editable.$el.removeClass("focus"),this.editable.sync(),this.focused=!1,this.lastCaretPosition=null!=(e=this.editable.undoManager.currentState())?e.caret:void 0,this.editable.trigger("blur")},r.prototype._onMouseUp=function(t){if(!this.editable.util.support.onselectionchange)return this.throttledSelectionChanged()},r.prototype._onKeyDown=function(t){var e,n;if(!1===this.editable.trigger(t))return!1;if(!this.editable.hotkeys.respondTo(t)){if(this.editable.keystroke.respondTo(t))return this.throttledValueChanged(),!1;if(!(e=t.which,i.call(this._modifierKeys,e)>=0||(n=t.which,i.call(this._arrowKeys,n)>=0)||this.editable.util.metaKey(t)&&86===t.which))return this.editable.util.support.oninput||this.throttledValueChanged(["typing"]),null}},r.prototype._onKeyPress=function(t){if(!1===this.editable.trigger(t))return!1},r.prototype._onKeyUp=function(t){var n,r;if(!1===this.editable.trigger(t))return!1;!this.editable.util.support.onselectionchange&&(r=t.which,i.call(this._arrowKeys,r)>=0)?this.throttledValueChanged():8!==t.which&&46!==t.which||!this.editable.util.isEmptyNode(this.editable.body)||(this.editable.body.empty(),n=e("<p/>").append(this.editable.util.phBr).appendTo(this.editable.body),this.editable.selection.setRangeAtStartOf(n))},r.prototype._onDrop=function(t){return!1!==this.editable.trigger(t)&&this.throttledValueChanged()},r.prototype._onInput=function(t){return this.throttledValueChanged(["oninput"])},n.InputManager=r}),define("skylark-domx-contents/Selection",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","./contents"],function(t,e,n,i){var r=t.Evented.inherit({_range:null,_startNodes:null,_endNodes:null,_containerNode:null,_nodes:null,_blockNodes:null,_rootNodes:null,init:function(e,n){var i=this;this.editable=e,this.opts=t.extend({},this.opts,n),this._selection=document.getSelection(),this.editable.on("selectionchanged",function(t){return console.log("selectionchanged"),i.reset(),i._range=i._selection.getRangeAt(0)}),this.editable.on("blur",function(t){return i.reset()}),this.editable.on("focus",function(t){return i.reset(),i._range=i._selection.getRangeAt(0)})},reset:function(){return this._range=null,this._startNodes=null,this._endNodes=null,this._containerNode=null,this._nodes=null,this._blockNodes=null,this._rootNodes=null},clear:function(){try{this._selection.removeAllRanges(),console.log("clear")}catch(t){t}return this.reset()},range:function(e){var n;return e?(this.clear(),this._selection.addRange(e),this._range=e,n=t.hoster.browser.mozilla||t.hoster.browser.msie,!this.editable.inputManager.focused&&n&&this.editable.body.focus()):!this._range&&this.editable.inputManager.focused&&this._selection.rangeCount&&(this._range=this._selection.getRangeAt(0)),this._range},startNodes:function(){var t;return this._range&&(this._startNodes||(this._startNodes=(t=this,function(){var e;return(e=n(t._range.startContainer).parentsUntil(t.editable.body).get()).unshift(t._range.startContainer),n(e)})())),this._startNodes},endNodes:function(){var t;return this._range&&(this._endNodes||(this._endNodes=this._range.collapsed?this.startNodes():((t=n(this._range.endContainer).parentsUntil(this.editable.body).get()).unshift(this._range.endContainer),n(t)))),this._endNodes},containerNode:function(){return this._range&&(this._containerNode||(this._containerNode=n(this._range.commonAncestorContainer))),this._containerNode},nodes:function(){var e;return this._range&&(this._nodes||(this._nodes=(e=this,function(){var i;return i=[],e.startNodes().first().is(e.endNodes().first())?i=e.startNodes().get():(e.startNodes().each(function(r,o){var a,s,l,u,d,c,h;return s=n(o),e.endNodes().index(s)>-1?i.push(o):s.parent().is(e.editable.body)||(c=e.endNodes().index(s.parent()))>-1?(a=c&&c>-1?e.endNodes().eq(c-1):e.endNodes().last(),l=s.parent().contents(),h=l.index(s),u=l.index(a),t.merge(i,l.slice(h,u).get())):(l=s.parent().contents(),d=l.index(s),t.merge(i,l.slice(d).get()))}),e.endNodes().each(function(r,o){var a,s,l;return(a=n(o)).parent().is(e.editable.body)||e.startNodes().index(a.parent())>-1?(i.push(o),!1):(s=a.parent().contents(),l=s.index(a),t.merge(i,s.slice(0,l+1)))})),n(t.uniq(i))})())),this._nodes},blockNodes:function(){var t;if(this._range)return this._blockNodes||(this._blockNodes=(t=this,function(){return t.nodes().filter(function(e,n){return t.editable.util.isBlockNode(n)})})()),this._blockNodes},rootNodes:function(){var t;if(this._range)return this._rootNodes||(this._rootNodes=(t=this,function(){return t.nodes().filter(function(e,i){var r;return(r=n(i).parent()).is(t.editable.body)||r.is("blockquote")})})()),this._rootNodes},rangeAtEndOf:function(t,i){var r,o,a,s,l,u;if(null==i&&(i=this.range()),i&&i.collapsed)return t=n(t)[0],a=i.endContainer,s=this.editable.util.getNodeLength(a),o=i.endOffset===s-1,l=n(a).contents().last().is("br"),r=i.endOffset===s,!!(o&&l||r)&&(t===a||!!e.contains(t,a)&&(u=!0,n(a).parentsUntil(t).addBack().each(function(t,e){var i,r,o,a;if(a=n(e).parent().contents().filter(function(){return!(this!==e&&3===this.nodeType&&!this.nodeValue)}),i=a.last(),o=i.get(0)===e,r=i.is("br")&&i.prev().get(0)===e,!o&&!r)return u=!1,!1}),u))},rangeAtStartOf:function(t,i){var r,o;if(null==i&&(i=this.range()),i&&i.collapsed)return t=n(t)[0],o=i.startContainer,0===i.startOffset&&(t===o||!!e.contains(t,o)&&(r=!0,n(o).parentsUntil(t).addBack().each(function(t,e){if(n(e).parent().contents().filter(function(){return!(this!==e&&3===this.nodeType&&!this.nodeValue)}).first().get(0)!==e)return r=!1}),r))},insertNode:function(t,e){if(null==e&&(e=this.range()),e)return t=n(t)[0],e.insertNode(t),this.setRangeAfter(t,e)},setRangeAfter:function(t,e){if(null==e&&(e=this.range()),null!=e)return t=n(t)[0],e.setEndAfter(t),e.collapse(!1),this.range(e)},setRangeBefore:function(t,e){if(null==e&&(e=this.range()),null!=e)return t=n(t)[0],e.setEndBefore(t),e.collapse(!1),this.range(e)},setRangeAtStartOf:function(t,e){return null==e&&(e=this.range()),t=n(t).get(0),e.setEnd(t,0),e.collapse(!1),this.range(e)},setRangeAtEndOf:function(t,e){var i,r,o,a,s,l,u;if(null==e&&(e=this.range()),r=n(t),t=r[0])return r.is("pre")?(o=r.contents()).length>0?(a=o.last(),l=a.text(),s=this.editable.util.getNodeLength(a[0]),"\n"===l.charAt(l.length-1)?e.setEnd(a[0],s-1):e.setEnd(a[0],s)):e.setEnd(t,0):(u=this.editable.util.getNodeLength(t),3!==t.nodeType&&u>0&&((i=n(t).contents().last()).is("br")?u-=1:3!==i[0].nodeType&&this.editable.util.isEmptyNode(i)&&(i.append(this.editable.util.phBr),t=i[0],u=0)),e.setEnd(t,u)),e.collapse(!1),this.range(e)},deleteRangeContents:function(t){var e,n,i,r;return null==t&&(t=this.range()),r=t.cloneRange(),i=t.cloneRange(),r.collapse(!0),i.collapse(!1),n=this.rangeAtStartOf(this.editable.body,r),e=this.rangeAtEndOf(this.editable.body,i),!t.collapsed&&n&&e?(this.editable.body.empty(),t.setStart(this.editable.body[0],0),t.collapse(!0),this.range(t)):t.deleteContents(),t},breakBlockEl:function(t,e){var i;return null==e&&(e=this.range()),i=n(t),e.collapsed?(e.setStartBefore(i.get(0)),e.collapsed?i:i.before(e.extractContents())):i},save:function(t){var e,i,r;if(null==t&&(t=this.range()),!this._selectionSaved)return(i=t.cloneRange()).collapse(!1),r=n("<span/>").addClass(this.opts.classPrefix+"caret-start"),e=n("<span/>").addClass(this.opts.classPrefix+"caret-end"),i.insertNode(e[0]),t.insertNode(r[0]),this.clear(),this._selectionSaved=!0},restore:function(){var t,e,n,i,r,o,a;return!!this._selectionSaved&&(r=this.editable.body.find("."+this.opts.classPrefix+"caret-start"),t=this.editable.body.find("."+this.opts.classPrefix+"caret-end"),r.length&&t.length?(o=r.parent(),a=o.contents().index(r),e=t.parent(),n=e.contents().index(t),o[0]===e[0]&&(n-=1),(i=document.createRange()).setStart(o.get(0),a),i.setEnd(e.get(0),n),r.remove(),t.remove(),this.range(i)):(r.remove(),t.remove()),this._selectionSaved=!1,i)}});return r.pluginName="Selection",i.Selection=r}),define("skylark-domx-contents/UndoManager",["skylark-langx/langx","skylark-domx-query","./contents"],function(t,e,n){var i=t.Evented.inherit({init:function(e,n){var i,r,o;this.editable=e,this.opts=t.extend({},this.opts,n),this._stack=[],this.editable.util.os.mac?(r="cmd+z",i="shift+cmd+z"):this.editable.util.os.win?(r="ctrl+z",i="ctrl+y"):(r="ctrl+z",i="shift+ctrl+z"),this.editable.hotkeys.add(r,(o=this,function(t){return t.preventDefault(),o.undo(),!1})),this.editable.hotkeys.add(i,function(t){return function(e){return e.preventDefault(),t.redo(),!1}}(this)),this.throttledPushState=this.editable.util.throttle(function(t){return function(){return t._pushUndoState()}}(this),2e3),this.editable.on("valuechanged",function(t){return function(e,n){if("undo"!==n&&"redo"!==n)return t.throttledPushState()}}(this)),this.editable.on("selectionchanged",function(t){return function(e){return t.resetCaretPosition(),t.update()}}(this)),this.editable.on("focus",function(t){return function(e){if(0===t._stack.length)return t._pushUndoState()}}(this)),this.editable.on("blur",function(t){return function(e){return t.resetCaretPosition()}}(this))}});return i.pluginName="UndoManager",i.prototype._index=-1,i.prototype._capacity=20,i.prototype._startPosition=null,i.prototype._endPosition=null,i.prototype.resetCaretPosition=function(){return this._startPosition=null,this._endPosition=null},i.prototype.startPosition=function(){return this.editable.selection._range&&(this._startPosition||(this._startPosition=this._getPosition("start"))),this._startPosition},i.prototype.endPosition=function(){var t;return this.editable.selection._range&&(this._endPosition||(this._endPosition=(t=this,function(){return t.editable.selection.range().collapsed?t._startPosition:t._getPosition("end")})())),this._endPosition},i.prototype._pushUndoState=function(){if(!1!==this.editable.trigger("pushundostate")&&this.caretPosition().start)return this._index+=1,this._stack.length=this._index,this._stack.push({html:this.editable.body.html(),caret:this.caretPosition()}),this._stack.length>this._capacity?(this._stack.shift(),this._index-=1):void 0},i.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},i.prototype.undo=function(){var t;if(!(this._index<1||this._stack.length<2))return this.editable.hidePopover(),this._index-=1,t=this._stack[this._index],this.editable.body.get(0).innerHTML=t.html,this.caretPosition(t.caret),this.editable.body.find(".selected").removeClass("selected"),this.editable.sync(),this.editable.trigger("valuechanged",["undo"])},i.prototype.redo=function(){var t;if(!(this._index<0||this._stack.length<this._index+2))return this.editable.hidePopover(),this._index+=1,t=this._stack[this._index],this.editable.body.get(0).innerHTML=t.html,this.caretPosition(t.caret),this.editable.body.find(".selected").removeClass("selected"),this.editable.sync(),this.editable.trigger("valuechanged",["redo"])},i.prototype.update=function(){var t;if(t=this.currentState())return t.html=this.editable.body.html(),t.caret=this.caretPosition()},i.prototype._getNodeOffset=function(n,i){var r,o,a;return r=t.isNumber(i)?e(n):e(n).parent(),a=0,o=!1,r.contents().each(function(t,e){return n!==e&&(i!==t||0!==t)&&(e.nodeType===Node.TEXT_NODE?!o&&e.nodeValue.length>0&&(a+=1,o=!0):(a+=1,o=!1),i-1!==t&&null)}),a},i.prototype._getPosition=function(t){var n,i,r,o,a,s,l,u;if(null==t&&(t="start"),l=this.editable.selection.range(),o=l[t+"Offset"],n=this.editable.selection[t+"Nodes"](),(i=n.first()[0]).nodeType===Node.TEXT_NODE){for(s=i.previousSibling;s&&s.nodeType===Node.TEXT_NODE;)i=s,o+=this.editable.util.getNodeLength(s),s=s.previousSibling;(r=n.get())[0]=i,n=e(r)}else o=this._getNodeOffset(i,o);return a=[o],n.each((u=this,function(t,e){return a.unshift(u._getNodeOffset(e))})),a},i.prototype._getNodeByPosition=function(t){var n,i,r,o,a,s,l,u;for(s=this.editable.body[0],u=t.slice(0,t.length-1),r=o=0,a=u.length;o<a;r=++o){if(l=u[r],i=s.childNodes,l>i.length-1){if(r!==t.length-2||!e(s).is(":empty")){s=null;break}n=document.createTextNode(""),s.appendChild(n),i=s.childNodes}s=i[l]}return s},i.prototype.caretPosition=function(t){var e,n,i,r,o;if(t){if(!t.start)return;return r=this._getNodeByPosition(t.start),o=t.start[t.start.length-1],t.collapsed?(e=r,n=o):(e=this._getNodeByPosition(t.end),n=t.start[t.start.length-1]),r&&e?((i=document.createRange()).setStart(r,o),i.setEnd(e,n),this.editable.selection.range(i)):void("undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("simditor: invalid caret state"))}return i=this.editable.selection.range(),t=this.editable.inputManager.focused&&null!=i?{start:this.startPosition(),end:this.endPosition(),collapsed:i.collapsed}:{}},n.UndoManager=i}),define("skylark-domx-contents/Keystroke",["skylark-langx/langx","skylark-domx-query","./contents"],function(t,e,n){var i=t.Evented.inherit({init:function(e,n){this.editable=e,this.opts=t.extend({},this.opts,n),this._keystrokeHandlers={},this._initKeystrokeHandlers()}});return i.pluginName="Keystroke",i.prototype.add=function(t,e,n){return t=t.toLowerCase(),t=this.editable.hotkeys.constructor.aliases[t]||t,this._keystrokeHandlers[t]||(this._keystrokeHandlers[t]={}),this._keystrokeHandlers[t][e]=n},i.prototype.respondTo=function(t){var n,i,r,o,a;if(i=null!=(r=this.editable.hotkeys.constructor.keyNameMap[t.which])?r.toLowerCase():void 0)return!!(i in this._keystrokeHandlers&&((o="function"==typeof(n=this._keystrokeHandlers[i])["*"]?n["*"](t):void 0)||this.editable.selection.startNodes().each((a=this,function(n,r){var s,l;if(r.nodeType===Node.ELEMENT_NODE)return s=null!=(l=a._keystrokeHandlers[i])?l[r.tagName.toLowerCase()]:void 0,!0!==(o="function"==typeof s?s(t,e(r)):void 0)&&!1!==o&&void 0})),o))||void 0},i.prototype._initKeystrokeHandlers=function(){var t,n;return this.editable.util.browser.safari&&this.add("enter","*",(n=this,function(t){var i,r;if(t.shiftKey&&!(i=n.editable.selection.blockNodes().last()).is("pre"))return r=e("<br/>"),n.editable.selection.rangeAtEndOf(i)?(n.editable.selection.insertNode(r),n.editable.selection.insertNode(e("<br/>")),n.editable.selection.setRangeBefore(r)):n.editable.selection.insertNode(r),!0})),(this.editable.util.browser.webkit||this.editable.util.browser.msie)&&(t=function(t){return function(n,i){var r;if(t.editable.selection.rangeAtEndOf(i))return r=e("<p/>").append(t.editable.util.phBr).insertAfter(i),t.editable.selection.setRangeAtStartOf(r),!0}}(this),this.add("enter","h1",t),this.add("enter","h2",t),this.add("enter","h3",t),this.add("enter","h4",t),this.add("enter","h5",t),this.add("enter","h6",t)),this.add("backspace","*",function(t){return function(e){var n,i,r;return r=t.editable.selection.rootNodes().first(),(i=r.prev()).is("hr")&&t.editable.selection.rangeAtStartOf(r)?(t.editable.selection.save(),i.remove(),t.editable.selection.restore(),!0):((n=t.editable.selection.blockNodes().last()).is("."+this.opts.classPrefix+"resize-handle")&&r.is("."+this.opts.classPrefix+"table")&&(e.preventDefault(),r.remove(),t.editable.selection.setRangeAtEndOf(i)),i.is("."+this.opts.classPrefix+"table")&&!n.is("table")&&t.editable.util.isEmptyNode(n)&&(e.preventDefault(),n.remove(),t.editable.selection.setRangeAtEndOf(i)),t.editable.util.browser.webkit&&t.editable.selection.rangeAtStartOf(n)?(t.editable.selection.save(),t.editable.formatter.cleanNode(n,!0),t.editable.selection.restore(),null):void 0)}}(this)),this.add("enter","div",function(t){return function(n,i){var r;if(i.is("."+this.opts.classPrefix+"table")&&t.editable.selection.blockNodes().last().is("."+this.opts.classPrefix+"resize-handle"))return n.preventDefault(),r=e("<p/>").append(t.editable.util.phBr).insertAfter(i),t.editable.selection.setRangeAtStartOf(r)}}(this)),this.add("enter","li",function(t){return function(n,i){var r,o,a,s;if((r=i.clone()).find("ul, ol").remove(),t.editable.util.isEmptyNode(r)&&i.is(t.editable.selection.blockNodes().last())){if(o=i.parent(),i.next("li").length>0){if(!t.editable.util.isEmptyNode(i))return;o.parent("li").length>0?(a=e("<li/>").append(t.editable.util.phBr).insertAfter(o.parent("li")),s=e("<"+o[0].tagName+"/>").append(i.nextAll("li")),a.append(s)):(a=e("<p/>").append(t.editable.util.phBr).insertAfter(o),s=e("<"+o[0].tagName+"/>").append(i.nextAll("li")),a.after(s))}else o.parent("li").length>0?(a=e("<li/>").insertAfter(o.parent("li")),i.contents().length>0?a.append(i.contents()):a.append(t.editable.util.phBr)):(a=e("<p/>").append(t.editable.util.phBr).insertAfter(o),i.children("ul, ol").length>0&&a.after(i.children("ul, ol")));return i.prev("li").length?i.remove():i.prev("ul").length||i.prev("ol").length?i.remove():o.remove(),t.editable.selection.setRangeAtStartOf(a),!0}}}(this)),this.add("enter","pre",function(t){return function(n,i){var r,o,a;return n.preventDefault(),n.shiftKey?(r=e("<p/>").append(t.editable.util.phBr).insertAfter(i),t.editable.selection.setRangeAtStartOf(r),!0):(a=t.editable.selection.range(),o=null,a.deleteContents(),o=!t.editable.util.browser.msie&&t.editable.selection.rangeAtEndOf(i)?document.createTextNode("\n\n"):document.createTextNode("\n"),a.insertNode(o),a.setEnd(o,1),a.collapse(!1),t.editable.selection.range(a),!0)}}(this)),this.add("enter","blockquote",function(t){return function(e,n){var i,r;if((i=t.editable.selection.blockNodes().last()).is("p")&&!i.next().length&&t.editable.util.isEmptyNode(i))return n.after(i),r=document.createRange(),t.editable.selection.setRangeAtStartOf(i,r),!0}}(this)),this.add("backspace","li",function(t){return function(n,i){var r,o,a,s,l,u,d,c,h;return o=i.children("ul, ol"),l=i.prev("li"),o.length>0&&l.length>0&&(h="",u=null,i.contents().each(function(t,n){return(1!==n.nodeType||!/UL|OL/.test(n.nodeName))&&(1===n.nodeType&&/BR/.test(n.nodeName)?void 0:(3===n.nodeType&&n.nodeValue?h+=n.nodeValue:1===n.nodeType&&(h+=e(n).text()),u=e(n)))}),d=t.editable.util.browser.firefox&&!u.next("br").length,u&&1===h.length&&d?(r=e(t.editable.util.phBr).insertAfter(u),u.remove(),t.editable.selection.setRangeBefore(r),!0):!(h.length>0)&&(c=document.createRange(),(s=l.children("ul, ol")).length>0?(a=e("<li/>").append(t.editable.util.phBr).appendTo(s),s.append(o.children("li")),i.remove(),t.editable.selection.setRangeAtEndOf(a,c)):(t.editable.selection.setRangeAtEndOf(l,c),l.append(o),i.remove(),t.editable.selection.range(c)),!0))}}(this)),this.add("backspace","pre",function(t){return function(n,i){var r,o,a;if(t.editable.selection.rangeAtStartOf(i))return o=i.html().replace("\n","<br/>")||t.editable.util.phBr,r=e("<p/>").append(o).insertAfter(i),i.remove(),a=document.createRange(),t.editable.selection.setRangeAtStartOf(r,a),!0}}(this)),this.add("backspace","blockquote",function(t){return function(e,n){var i,r;if(t.editable.selection.rangeAtStartOf(n))return i=n.children().first().unwrap(),r=document.createRange(),t.editable.selection.setRangeAtStartOf(i,r),!0}}(this))},n.Keystroke=i}),define("skylark-domx-contents/Formatter",["skylark-langx/langx","skylark-domx-query","./contents"],function(t,e,n){var i=[].indexOf,r=t.Evented.inherit({opts:{allowedTags:[],allowedAttributes:{},allowedStyles:{}},init:function(e,n){this.editable=e,this.opts=t.extend({},this.opts,n),this._allowedTags=t.merge(["br","span","a","img","b","strong","i","strike","u","font","p","ul","ol","li","blockquote","pre","code","h1","h2","h3","h4","hr"],this.opts.allowedTags),this._allowedAttributes=t.extend({img:["src","alt","width","height","data-non-image"],a:["href","target"],font:["color"],code:["class"]},this.opts.allowedAttributes),this._allowedStyles=t.extend({span:["color","font-size"],b:["color","font-size"],i:["color","font-size"],strong:["color","font-size"],strike:["color","font-size"],u:["color","font-size"],p:["margin-left","text-align"],h1:["margin-left","text-align"],h2:["margin-left","text-align"],h3:["margin-left","text-align"],h4:["margin-left","text-align"]},this.opts.allowedStyles),this.editable.body.on("click","a",function(t){return!1})},decorate:function(t){return null==t&&(t=this.editable.body),this.editable.trigger("decorate",[t]),t},undecorate:function(t){return null==t&&(t=this.editable.body.clone()),this.editable.trigger("undecorate",[t]),t},autolink:function(t){var n,i,r,o,a,s,l,u,d,c,h,f,p;for(null==t&&(t=this.editable.body),l=[],(r=function(n){return n.contents().each(function(n,i){var o,a;if(!(o=e(i)).is("a")&&!o.closest("a, pre",t).length)return!o.is("iframe")&&o.contents().length?r(o):(a=o.text())&&/https?:\/\/|www\./gi.test(a)?l.push(o):void 0})})(t),d=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/gi,o=0,s=l.length;o<s;o++){for(i=l[o],f=i.text(),c=[],u=null,a=0;null!==(u=d.exec(f));)h=f.substring(a,u.index),c.push(document.createTextNode(h)),a=d.lastIndex,p=/^(http(s)?:\/\/|\/)/.test(u[0])?u[0]:"http://"+u[0],n=e('<a href="'+p+'" rel="nofollow"></a>').text(u[0]),c.push(n[0]);c.push(document.createTextNode(f.substring(a))),i.replaceWith(e(c))}return t},format:function(t){var n,i,r,o,a,s,l,u,d,c;if(null==t&&(t=this.editable.body),t.is(":empty"))return t.append("<p>"+this.editable.util.phBr+"</p>"),t;for(d=t.contents(),r=0,a=d.length;r<a;r++)l=d[r],this.cleanNode(l,!0);for(c=t.contents(),o=0,s=c.length;o<s;o++)u=c[o],(n=e(u)).is("br")?(void 0!==i&&null!==i&&(i=null),n.remove()):this.editable.util.isBlockNode(u)?n.is("li")?i&&i.is("ul, ol")?i.append(u):(i=e("<ul/>").insertBefore(u)).append(u):i=null:(i&&!i.is("ul, ol")||(i=e("<p/>").insertBefore(u)),i.append(u),this.editable.util.isEmptyNode(i)&&i.append(this.editable.util.phBr));return t},cleanNode:function(n,r){var o,a,s,l,u,d,c,h,f,p,g,m,v,y,b,k,x,w;if((s=e(n)).length>0){if(3!==s[0].nodeType){if(h=s.is("iframe")?null:s.contents(),f=this.editable.util.isDecoratedNode(s),s.is(this._allowedTags.join(","))||f){if(s.is("a")&&(a=s.find("img")).length>0&&(s.replaceWith(a),s=a,h=null),s.is("td")&&(o=s.find(this.editable.util.blockNodes.join(","))).length>0&&(o.each(function(t,n){return e(n).contents().unwrap()}),h=s.contents()),s.is("img")&&s.hasClass("uploading")&&s.remove(),!f){for(d=this._allowedAttributes[s[0].tagName.toLowerCase()],b=t.makeArray(s[0].attributes),p=0,m=b.length;p<m;p++)"style"!==(c=b[p]).name&&(null!=d&&(k=c.name,i.call(d,k)>=0)||s.removeAttr(c.name));this._cleanNodeStyles(s),s.is("span")&&(0===s[0].attributes.length&&s.contents().first().unwrap(),2===s[0].style.length&&"rgb(51, 51, 51)"===s[0].style.color&&"16px"===s[0].style.fontSize&&s.contents().unwrap())}}else 1!==s[0].nodeType||s.is(":empty")?(s.remove(),h=null):s.is("div, article, dl, header, footer, tr")?(s.append("<br/>"),h.first().unwrap()):s.is("table")?(l=e("<p/>"),s.find("tr").each(function(t,n){return l.append(e(n).text()+"<br/>")}),s.replaceWith(l),h=null):s.is("thead, tfoot")?(s.remove(),h=null):s.is("th")?(u=e("<td/>").append(s.contents()),s.replaceWith(u)):h.first().unwrap();if(r&&null!=h&&!s.is("pre"))for(g=0,v=h.length;g<v;g++)y=h[g],this.cleanNode(y,!0);return null}(x=s.text().replace(/(\r\n|\n|\r)/gm,""))?(w=document.createTextNode(x),s.replaceWith(w)):s.remove()}},_cleanNodeStyles:function(e){var n,r,o,a,s,l,u,d,c;if(d=e.attr("style")){if(e.removeAttr("style"),!((n=this._allowedStyles[e[0].tagName.toLowerCase()])&&n.length>0))return e;for(c={},s=d.split(";"),r=0,o=s.length;r<o;r++)u=s[r],u=t.trim(u),2===(a=u.split(":")).length&&("font-size"===a[0]&&a[1].indexOf("px")>0&&parseInt(a[1],10)<12||(l=a[0],i.call(n,l)>=0&&(c[t.trim(a[0])]=t.trim(a[1]))));return Object.keys(c).length>0&&e.css(c),e}},clearHtml:function(t,n){var i,r,o,a;return null==n&&(n=!0),i=e("<div/>").append(t),r=i.contents(),o="",r.each((a=this,function(t,i){var s,l;return 3===i.nodeType?o+=i.nodeValue:1===i.nodeType&&(s=e(i),(l=s.is("iframe")?null:s.contents())&&l.length>0&&(o+=a.clearHtml(l)),n&&t<r.length-1&&s.is("br, p, div, li,tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2,h3, h4, header"))?o+="\n":void 0})),o},beautify:function(t){var n;return n=function(t){return!!(t.is("p")&&!t.text()&&t.children(":not(br)").length<1)},t.each(function(t,i){var r;return r=e(i),(r.is(':not(img, br, col, td, hr, [class^="'+this.opts.classPrefix+'"]):empty')||n(r))&&r.remove(),r.find(':not(img, br, col, td, hr, [class^="'+this.opts.classPrefix+'"]):empty').remove()})}});return r.pluginName="Formatter",n.Formatter=r}),define("skylark-domx-contents/Indentation",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","./contents"],function(t,e,n,i){var r=t.Evented.inherit({});return r.pluginName="Indentation",r.prototype.opts={tabIndent:!0,indentWidth:40},r.prototype.init=function(e,n){var i;this.editable=e,this.opts=t.extend({},this.opts,n),this.editable.keystroke.add("tab","*",(i=this,function(t){var e;if(e=i.editable.toolbar.findButton("code"),i.opts.tabIndent||e&&e.active)return i.indent(t.shiftKey)}))},r.prototype.indent=function(t){var i,r,o,a;return this.editable.selection.startNodes(),this.editable.selection.endNodes(),i=this.editable.selection.blockNodes(),r=[],i=i.each(function(t,n){var i,o,a,s,l;for(i=!0,o=a=0,s=r.length;a<s;o=++a){if(l=r[o],e.contains(n,l)){i=!1;break}if(e.contains(l,n)){r.splice(o,1,n),i=!1;break}}if(i)return r.push(n)}),i=n(r),o=!1,i.each((a=this,function(e,n){var i;if(i=t?a.outdentBlock(n):a.indentBlock(n))return o=i})),o},r.prototype.indentBlock=function(t){var e,i,r,o,a,s,l,u,d,c;if((e=n(t)).length){if(e.is("pre")){if(!(s=this.editable.selection.containerNode()).is(e)&&!s.closest("pre").is(e))return;this.indentText(this.editable.selection.range())}else if(e.is("li")){if((a=e.prev("li")).length<1)return;this.editable.selection.save(),c=e.parent()[0].tagName,(i=a.children("ul, ol")).length>0?i.append(e):n("<"+c+"/>").append(e).appendTo(a),this.editable.selection.restore()}else if(e.is("p, h1, h2, h3, h4"))d=parseInt(e.css("margin-left"))||0,d=(Math.round(d/this.opts.indentWidth)+1)*this.opts.indentWidth,e.css("margin-left",d);else{if(!e.is("table")&&!e.is("."+this.opts.classPrefix+"table"))return!1;if(l=this.editable.selection.containerNode().closest("td, th"),(r=l.next("td, th")).length>0||(u=l.parent("tr"),(o=u.next("tr")).length<1&&u.parent().is("thead")&&(o=u.parent("thead").next("tbody").find("tr:first")),r=o.find("td:first, th:first")),!(l.length>0&&r.length>0))return;this.editable.selection.setRangeAtEndOf(r)}return!0}},r.prototype.indentText=function(t){var e,n;return e=t.toString().replace(/^(?=.+)/gm,"  "),n=document.createTextNode(e||"  "),t.deleteContents(),t.insertNode(n),e?(t.selectNode(n),this.editable.selection.range(t)):this.editable.selection.setRangeAfter(n)},r.prototype.outdentBlock=function(t){var e,i,r,o,a,s,l,u,d,c;if((e=n(t))&&e.length>0){if(e.is("pre")){if(!(o=this.editable.selection.containerNode()).is(e)&&!o.closest("pre").is(e))return;this.outdentText(c)}else if(e.is("li"))i=e.parent(),r=i.parent("li"),this.editable.selection.save(),r.length<1?((c=document.createRange()).setStartBefore(i[0]),c.setEndBefore(e[0]),i.before(c.extractContents()),n("<p/>").insertBefore(i).after(e.children("ul, ol")).append(e.contents()),e.remove()):(e.next("li").length>0&&n("<"+i[0].tagName+"/>").append(e.nextAll("li")).appendTo(e),e.insertAfter(r),i.children("li").length<1&&i.remove()),this.editable.selection.restore();else if(e.is("p, h1, h2, h3, h4"))d=parseInt(e.css("margin-left"))||0,d=Math.max(Math.round(d/this.opts.indentWidth)-1,0)*this.opts.indentWidth,e.css("margin-left",0===d?"":d);else{if(!e.is("table")&&!e.is("."+this.opts.classPrefix+"table"))return!1;if(l=this.editable.selection.containerNode().closest("td, th"),(a=l.prev("td, th")).length>0||(u=l.parent("tr"),(s=u.prev("tr")).length<1&&u.parent().is("tbody")&&(s=u.parent("tbody").prev("thead").find("tr:first")),a=s.find("td:last, th:last")),!(l.length>0&&a.length>0))return;this.editable.selection.setRangeAtEndOf(a)}return!0}},r.prototype.outdentText=function(t){},i.Indentation=r}),define("skylark-domx-contents/Clipboard",["skylark-langx/langx","skylark-domx-query","./contents"],function(t,e,n){var i=t.Evented.inherit({});return i.pluginName="Clipboard",i.prototype.opts={pasteImage:!1,cleanPaste:!1},i.prototype.init=function(e,n){var i;this.editable=e,this.opts=t.extend({},this.opts,n),this.opts.pasteImage&&"string"!=typeof this.opts.pasteImage&&(this.opts.pasteImage="inline"),this.editable.body.on("paste",(i=this,function(t){var e;if(!i.pasting&&!i._pasteBin)return!1!==i.editable.trigger(t)&&(e=i.editable.selection.deleteRangeContents(),i.editable.body.html()?e.collapsed||e.collapse(!0):(i.editable.formatter.format(),i.editable.selection.setRangeAtStartOf(i.editable.body.find("p:first"))),!i._processPasteByClipboardApi(t)&&(i.editable.inputManager.throttledValueChanged.clear(),i.editable.inputManager.throttledSelectionChanged.clear(),i.editable.undoManager.throttledPushState.clear(),i.editable.selection.reset(),i.editable.undoManager.resetCaretPosition(),i.pasting=!0,i._getPasteContent(function(t){return i._processPasteContent(t),i._pasteInBlockEl=null,i._pastePlainText=null,i.pasting=!1})))}))},i.prototype._processPasteByClipboardApi=function(t){var e,n,i,r;if(!this.editable.util.browser.edge&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items&&t.originalEvent.clipboardData.items.length>0&&(n=t.originalEvent.clipboardData.items[0],/^image\//.test(n.type))){if(null==(e=n.getAsFile())||!this.opts.pasteImage)return;if(e.name||(e.name="Clipboard Image.png"),!1===this.editable.triggerHandler("pasting",[e]))return;return(r={})[this.opts.pasteImage]=!0,null!=(i=this.editable.uploader)&&i.upload(e,r),!0}},i.prototype._getPasteContent=function(t){var n,i;return this._pasteBin=e('<div contenteditable="true" />').addClass(this.opts.classPrefix+"paste-bin").attr("tabIndex","-1").appendTo(this.editable.$el),n={html:this.editable.body.html(),caret:this.editable.undoManager.caretPosition()},this._pasteBin.focus(),setTimeout((i=this,function(){var r;return i.editable.hidePopover(),i.editable.body.get(0).innerHTML=n.html,i.editable.undoManager.caretPosition(n.caret),i.editable.body.focus(),i.editable.selection.reset(),i.editable.selection.range(),i._pasteInBlockEl=i.editable.selection.blockNodes().last(),i._pastePlainText=i.opts.cleanPaste||i._pasteInBlockEl.is("pre, table"),i._pastePlainText?r=i.editable.formatter.clearHtml(i._pasteBin.html(),!0):((r=e("<div/>").append(i._pasteBin.contents())).find("style").remove(),r.find("table colgroup").remove(),i._cleanPasteFontSize(r),i.editable.formatter.format(r),i.editable.formatter.decorate(r),i.editable.formatter.beautify(r.children()),r=r.contents()),i._pasteBin.remove(),i._pasteBin=null,t(r)}),0)},i.prototype._processPasteContent=function(t){var n,i,r,o,a,s,l,u,d,c,h,f,p,g,m,v,y,b,k,x,w,_,A,C,T,E;if(!1!==this.editable.triggerHandler("pasting",[t])&&(n=this._pasteInBlockEl,t)){if(this._pastePlainText)if(n.is("table")){for(y=t.split("\n"),c=y.pop(),u=0,h=y.length;u<h;u++)v=y[u],this.editable.selection.insertNode(document.createTextNode(v)),this.editable.selection.insertNode(e("<br/>"));this.editable.selection.insertNode(document.createTextNode(c))}else for(t=e("<div/>").text(t),_=t.contents(),d=0,f=_.length;d<f;d++)k=_[d],this.editable.selection.insertNode(e(k)[0]);else if(n.is(this.editable.body))for(b=0,p=t.length;b<p;b++)k=t[b],this.editable.selection.insertNode(k);else{if(t.length<1)return;if(1===t.length)if(t.is("p")){if(o=t.contents(),n.is("h1, h2, h3, h4, h5")&&o.length&&o.css("font-size",""),1===o.length&&o.is("img")){if(/^data:image/.test((i=o).attr("src"))){if(!this.opts.pasteImage)return;return(r=this.editable.util.dataURLtoBlob(i.attr("src"))).name="Clipboard Image.png",(T={})[this.opts.pasteImage]=!0,void(null!=(A=this.editable.uploader)&&A.upload(r,T))}if(new RegExp("^blob:"+location.origin+"/").test(i.attr("src"))){if(!this.opts.pasteImage)return;return(T={})[this.opts.pasteImage]=!0,a=this.editable.util.dataURLtoBlob,E=this.editable.uploader,(s=new Image).onload=function(){var t;(t=document.createElement("canvas")).width=s.naturalWidth,t.height=s.naturalHeight,t.getContext("2d").drawImage(s,0,0),(r=a(t.toDataURL("image/png"))).name="Clipboard Image.png",null!==E&&E.upload(r,T)},void(s.src=i.attr("src"))}if(i.is('img[src^="webkit-fake-url://"]'))return}for(x=0,g=o.length;x<g;x++)k=o[x],this.editable.selection.insertNode(k)}else if(n.is("p")&&this.editable.util.isEmptyNode(n))n.replaceWith(t),this.editable.selection.setRangeAtEndOf(t);else if(t.is("ul, ol"))if(1===t.find("li").length)for(t=e("<div/>").text(t.text()),C=t.contents(),w=0,m=C.length;w<m;w++)k=C[w],this.editable.selection.insertNode(e(k)[0]);else n.is("li")?(n.parent().after(t),this.editable.selection.setRangeAtEndOf(t)):(n.after(t),this.editable.selection.setRangeAtEndOf(t));else n.after(t),this.editable.selection.setRangeAtEndOf(t);else n.is("li")&&(n=n.parent()),this.editable.selection.rangeAtStartOf(n)?l="before":this.editable.selection.rangeAtEndOf(n)?l="after":(this.editable.selection.breakBlockEl(n),l="before"),n[l](t),this.editable.selection.setRangeAtEndOf(t.last())}return this.editable.inputManager.throttledValueChanged()}},i.prototype._cleanPasteFontSize=function(n){var i,r;if((i=e(n)).length>0)return r=["1.5em","1.25em","0.75em","0.5em"],i.find('[style*="font-size"]').map(function(n,i){var o;if(o=e(i),t.inArray(o.css("font-size"),r)<0)return o.css("font-size","")})},n.Clipboard=i}),define("skylark-domx-contents/Editable",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","./contents","./Hotkeys","./Util","./InputManager","./Selection","./UndoManager","./Keystroke","./Formatter","./Indentation","./Clipboard"],function(t,n,i,r,o,a,s,l,u,d,c,h,f){var p=t.Evented.inherit({init:function(t,n){this.$el=i(t),this.textarea=i(n.textarea),this.body=i(n.body);var r={classPrefix:n.classPrefix};if(this.util=new a(this,r),this.hotkeys=new o({el:this.body}),this.inputManager=new s(this,r),this.selection=new l(this,r),this.undoManager=new u(this,r),this.keystroke=new d(this,r),this.formatter=new c(this,r),this.indentation=new h(this,r),this.clipboard=new f(this,r),this.util.os.mac?this.$el.addClass(n.classPrefix+"mac"):this.util.os.linux&&this.$el.addClass(n.classPrefix+"linux"),this.util.os.mobile&&this.$el.addClass(n.classPrefix+"mobile"),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){e=t}}},setValue:function(t){this.textarea.val(t),this.body.get(0).innerHTML=t,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null},getValue:function(){return this.sync()},sync:function(){var e,n,i,r,o,a;for(n=this.body.clone(),this.formatter.undecorate(n),this.formatter.format(n),this.formatter.autolink(n),e=n.children(),o=e.last("p"),r=e.first("p");o.is("p")&&this.util.isEmptyNode(o);)i=o,o=o.prev("p"),i.remove();for(;r.is("p")&&this.util.isEmptyNode(r);)i=r,r=o.next("p"),i.remove();return n.find("img.uploading").remove(),a=t.trim(n.html()),this.textarea.val(a),a},focus:function(){var t,e;if(this.body.is(":visible")&&this.body.is("[contenteditable]"))return this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):((t=this.body.children().last()).is("p")||(t=i("<p/>").append(this.util.phBr).appendTo(this.body)),e=document.createRange(),this.selection.setRangeAtEndOf(t,e));this.$el.find("textarea:visible").focus()},blur:function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},isActive:function(t){return!0===document.queryCommandState(t)},status:function(t,e){if("alignment"===t){var n=this.selection.nodes().filter(e);return n.length<1?null:n.first().css("text-align")}},alignment:function(t,e){if("left"!==t&&"center"!==t&&"right"!==t)throw new Error("simditor alignment button: invalid align "+t);var n=this.selection.nodes().filter(e);return n.css({"text-align":"left"===t?"":t}),this.trigger("valuechanged"),this.inputManager.throttledSelectionChanged()},blockquote:function(t,e){var n,r,o,a;return n=(n=this.selection.rootNodes()).filter(function(t,e){return!i(e).parent().is("blockquote")}),this.selection.save(),o=[],a=this,r=function(){if(o.length>0)return i("<"+a.htmlTag+"/>").insertBefore(o[0]).append(o),o.length=0},n.each(function(n){return function(a,s){var l;if((l=i(s)).parent().is(n.body))return l.is(t)?(r(),l.children().unwrap()):l.is(e)||n.util.isDecoratedNode(l)?r():o.push(s)}}(this)),r(),this.selection.restore(),this.trigger("valuechanged")},blockCode:function(t,e){var n,r,o,a,s;return n=this.selection.rootNodes(),o=[],a=[],s=this,r=function(){var e;if(o.length>0)return e=i("<"+t+"/>").insertBefore(o[0]).text(s.formatter.clearHtml(o)),a.push(e[0]),o.length=0},n.each(function(n){return function(s,l){var u,d;return(u=i(l)).is(t)?(r(),d=i("<p/>").append(u.html().replace("\n","<br/>")).replaceAll(u),a.push(d[0])):u.is(e)||n.util.isDecoratedNode(u)||u.is("blockquote")?r():o.push(l)}}(this)),r(),this.selection.setRangeAtEndOf(i(a).last()),this.trigger("valuechanged")},fontColor:function(t,e,n){var i=this.selection.range();if(!e&&i.collapsed&&(textNode=document.createTextNode(n),i.insertNode(textNode),i.selectNodeContents(textNode)),this.selection.range(i),document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,t),document.execCommand("styleWithCSS",!1,!1),!this.util.support.oninput)return this.trigger("valuechanged")},fontScale:function(t,e){var n,r;if(e||(e={"x-large":"1.5em",large:"1.25em",small:".75em","x-small":".5em"}),!(r=this.selection.range()).collapsed)return this.selection.range(r),document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,t),document.execCommand("styleWithCSS",!1,!1),this.selection.reset(),this.selection.range(),n=this.selection.containerNode(),(n[0].nodeType===Node.TEXT_NODE?n.closest('span[style*="font-size"]'):n.find('span[style*="font-size"]')).each(function(t,n){var r,o;return r=i(n),o=n.style.fontSize,/large|x-large|small|x-small/.test(o)?r.css("fontSize",e[o]):"medium"===o?r[0].style.length>1?r.css("fontSize",""):r.replaceWith(r.contents()):void 0}),this.trigger("valuechanged")},hr:function(){var t,e,n;return n=this.selection.rootNodes().first(),n.next().length>0?this.selection.save():e=i("<p/>").append(this.util.phBr),t=i("<hr/>").insertAfter(n),e?(e.insertAfter(t),this.selection.setRangeAtStartOf(e)):this.selection.restore(),this.trigger("valuechanged")},inlineCode:function(t){var e,n,r;return r=this.selection.range(),this.active?(r.selectNodeContents(this.node[0]),this.selection.save(r),this.node.contents().unwrap(),this.selection.restore()):(n=i(r.extractContents()),e=i("<"+this.htmlTag+"/>").append(n.contents()),r.insertNode(e[0]),r.selectNodeContents(e[0]),this.selection.range(r)),this.trigger("valuechanged")},indent:function(){return this.indentation.indent()},link:function(t,e){var n,r,o,a,s,l;if(s=this.selection.range(),t){var u=this.selection.startNodes();l=document.createTextNode(u.text()),u.replaceWith(l),s.selectNode(l)}else n=i(s.extractContents()),a=this.formatter.clearHtml(n.contents(),!1),r=i("<a/>",{href:"",target:"_blank",text:a||e}),this.selection.blockNodes().length>0?s.insertNode(r[0]):(o=i("<p/>").append(r),s.insertNode(o[0])),s.selectNodeContents(r[0]);return this.selection.range(s),this.trigger("valuechanged")},list:function(t,e,r){var o,a,s,l;return a=this.selection.blockNodes(),s="ul"===t?"ol":"ul",this.selection.save(),o=null,a.each((l=this,function(e,a){var u;if(!((u=i(a)).is("blockquote, li")||u.is(r)||l.util.isDecoratedNode(u))&&n.contains(document,a))return u.is(t)?(u.children("li").each(function(t,e){return i(e).children("ul, ol").insertAfter(u),i("<p/>").append(i(e).html()||l.util.phBr).insertBefore(u)}),u.remove()):u.is(s)?i("<"+t+"/>").append(u.contents()).replaceAll(u):o&&u.prev().is(o)?(i("<li/>").append(u.html()||l.util.phBr).appendTo(o),u.remove()):((o=i("<"+t+"><li></li></"+t+">")).find("li").append(u.html()||l.util.phBr),o.replaceAll(u))})),this.selection.restore(),this.trigger("valuechanged")},outdent:function(){return this.indentation.indent(!0)},title:function(t,e){var n,r;return n=this.selection.rootNodes(),this.selection.save(),n.each((r=this,function(n,o){var a;if(!((a=i(o)).is("blockquote")||a.is(t)||a.is(e)||r.util.isDecoratedNode(a)))return i("<"+t+"/>").append(a.contents()).replaceAll(a)})),this.selection.restore(),this.trigger("valuechanged")}});return["bold","insertImage","insertorderedlist","insertunorderedlist","italic","justifyLeft","justifyCenter","justifyFull","justifyRight","strikethrough","underline","undo"].forEach(function(t){p.prototype[t]=function(){return document.execCommand(t,!1,null),this.util.support.oninput||this.trigger("valuechanged"),i(document).trigger("selectionchange")}}),r.Editable=p}),define("skylark-domx-eventer/eventer",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-finder","skylark-domx-noder","skylark-domx-data"],function(t,e,n,i,r,o){e.mixin,e.each,Array.prototype.slice;var a=e.uid,s=/^([A-Z]|returnValue$|layer[XY]$)/,l={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},u=/complete|loaded|interactive/;function d(t,n){return!n&&t.isDefaultPrevented||(n||(n=t),e.each(l,function(i,r){var o=n[i];t[i]=function(){return this[r]=e.returnTrue,o&&o.apply(n,arguments)},t[r]=e.returnFalse})),t}function c(t){var e=(""+t).split(".");return{type:e[0],ns:e.slice(1).sort().join(" ")}}var h=function(){var t=[window.CustomEvent,window.CompositionEvent,window.DragEvent,window.Event,window.FocusEvent,window.KeyboardEvent,window.MessageEvent,window.MouseEvent,window.MouseScrollEvent,window.MouseWheelEvent,window.MutationEvent,window.ProgressEvent,window.TextEvent,window.TouchEvent,window.UIEvent,window.WheelEvent,window.ClipboardEvent],n={compositionstart:1,compositionend:1,compositionupdate:1,beforecopy:16,beforecut:16,beforepaste:16,copy:16,cut:16,paste:16,drag:2,dragend:2,dragenter:2,dragexit:2,dragleave:2,dragover:2,dragstart:2,drop:2,abort:3,change:3,error:3,selectionchange:3,submit:3,reset:3,focus:4,blur:4,focusin:4,focusout:4,keydown:5,keypress:5,keyup:5,message:6,click:7,contextmenu:7,dblclick:7,mousedown:7,mouseup:7,mousemove:7,mouseover:7,mouseout:7,mouseenter:7,mouseleave:7,textInput:12,touchstart:13,touchmove:13,touchend:13,load:14,resize:14,select:14,scroll:14,unload:14,wheel:15};return function(i,r){e.isString(i)?r=r||{}:i=(r=i||{}).type||"";var o=c(i);i=o.type,r=e.mixin({bubbles:!0,cancelable:!0},r),o.ns&&(r.namespace=o.ns);var a=function(e){var i=n[e];i||(i=0);return t[i]}(i),s=new a(i,r);return e.safeMixin(s,r),d(s)}}();function f(t,n){var i,r={originalEvent:t};for(i in t)"keyIdentifier"===i||s.test(i)||void 0===t[i]||(r[i]=t[i]);return n&&e.mixin(r,n),d(r,t)}var p={},g="onfocusin"in window,m={focus:"focusin",blur:"focusout"},v={mouseenter:"mouseover",mouseleave:"mouseout"},y=function(t){return v[t]||g&&m[t]||t},b={},k=e.klass({init:function(t,e){this._target=t,this._event=e,this._bindings=[]},add:function(t,n){var o=this._bindings,a={fn:t,options:e.mixin({},n)};o.push(a);var s=this;if(!s._listener){s._listener=function(t){var n=this,o=f(t),a=t._args,l=s._bindings,u=o.namespace;a=e.isDefined(a)?[o].concat(a):[o],e.each(l,function(t,l){var d=n;if(o.isImmediatePropagationStopped&&o.isImmediatePropagationStopped())return!1;var c=l.fn,h=l.options||{},f=h.selector,p=h.one,g=h.data;if(!u||u==h.ns||-1!==h.ns.indexOf(u)){if(f){if(!(d=i.closest(o.target,f))||d===n)return;e.mixin(o,{currentTarget:d,liveFired:n})}var m=s._event;if(m in v){var y=o.relatedTarget;if(y&&(y===d||r.contains(d,y)))return}e.isDefined(g)&&(o.data=g),p&&s.remove(c,h);var b=c.apply(d,a);!1===b&&(o.preventDefault(),o.stopPropagation())}})};var l=s._event;s._target.addEventListener?s._target.addEventListener(y(l),s._listener,!1):console.warn("invalid eventer object",s._target)}},remove:function(t,n){var i,r;(n=e.mixin({},n)).ns&&(r=n.ns,i=new RegExp("(?:^| )"+r.replace(" "," .* ?")+"(?: |$)")),this._bindings=this._bindings.filter(function(e){var r=(!t||t===e.fn)&&(!i||i.test(e.options.ns))&&(!n.selector||n.selector==e.options.selector);return!r}),0==this._bindings.length&&(this._target.removeEventListener&&this._target.removeEventListener(y(this._event),this._listener,!1),this._listener=null)}}),x=e.klass({init:function(t){this._target=t,this._handler={}},register:function(t,n,i){var r=c(t),t=r.type,o=p[t],a=o&&(o.bindType||o.bindEventName),s=this._handler;void 0===s[t]&&(s[t]=new k(this._target,a||t)),s[t].add(n,e.mixin({ns:r.ns},i))},unregister:function(t,n,i){var r=this._handler,o=c(t);if(t=o.type){var a=r[t];a&&a.remove(n,e.mixin({ns:o.ns},i))}else for(t in r){var a=r[t];a.remove(n,e.mixin({ns:o.ns},i))}}}),w=function(t){var e=a(t),n=b[e];return n||(n=b[e]=new x(t)),n};function _(t,n,i,r,o,a){if(e.isPlainObject(n))return e.each(n,function(e,n){_(t,e,i,r,n,a)}),this;e.isString(i)||e.isFunction(o)||(o=r,r=i,i=void 0),e.isFunction(r)&&(o=r,r=void 0),!1===o&&(o=e.returnFalse),"string"==typeof n&&(n=n.indexOf(",")>-1?n.split(","):n.split(/\s/));var s=w(t);return n.forEach(function(t){if("ready"==t)return A(o);s.register(t,o,{data:r,selector:i,one:!!a})}),this}function A(t){return u.test(document.readyState)&&document.body?e.defer(t):document.addEventListener("DOMContentLoaded",t,!1),this}var C={backspace:8,comma:188,delete:46,down:40,end:35,enter:13,escape:27,home:36,left:37,page_down:34,page_up:33,period:190,right:39,space:32,tab:9,up:38};function T(){return T}return n.support.transition&&(p.transitionEnd={bindType:n.support.transition.end,delegateType:n.support.transition.end}),e.mixin(T,{create:h,keys:C,off:function t(n,i,r,o){if(e.isPlainObject(i))return e.each(i,function(e,i){t(n,e,r,i)}),this;e.isString(r)||e.isFunction(o)||!1===o||(o=r,r=void 0);!1===o&&(o=e.returnFalse);"string"==typeof i&&(i=i.indexOf(",")>-1?i.split(","):i.split(/\s/));var a=w(n);i&&i.forEach(function(t){a.unregister(t,o,{selector:r})});return this},on:_,one:function(t,e,n,i,r){return _(t,e,n,i,r,1),this},proxy:f,ready:A,shortcuts:function(t){var e=o.data(t,"shortcuts");if(!e){e={},o.data(t,"shortcuts",e);var n=function(t,e){var n=e.metaKey||e.ctrlKey;if(t.ctrl==n&&t.alt==e.altKey&&t.shift==e.shiftKey&&(e.keyCode==t.keyCode||e.charCode&&e.charCode==t.charCode))return e.preventDefault(),"keydown"==e.type&&t.fn(e),!0};_(t,"keyup keypress keydown",function(t){if(!/INPUT|TEXTAREA/.test(t.target.nodeName))for(var i in e)n(e[i],t)})}return{add:function(t,n){(t.indexOf(",")>-1?t.toLowerCase().split(","):t.toLowerCase().split(" ")).forEach(function(t){var i={fn:n,alt:!1,ctrl:!1,shift:!1};t.split("+").forEach(function(t){switch(t){case"alt":case"ctrl":case"shift":i[t]=!0;break;default:i.charCode=t.charCodeAt(0),i.keyCode=C[t]||t.toUpperCase().charCodeAt(0)}});var r=(i.ctrl?"ctrl":"")+","+(i.alt?"alt":"")+","+(i.shift?"shift":"")+","+i.keyCode;e[r]=i})}}},special:p,stop:function(t){window.document.all&&(t.keyCode=0);t.preventDefault&&(t.preventDefault(),t.stopPropagation());return this},trigger:function(t,e,n){var i;i=e instanceof Event?e:h(e,n);i._args=n;var r=t.dispatchEvent||t.trigger;r?r.call(t,i):console.warn("The evented parameter is not a eventable object");return this}}),t.attach("domx.eventer",T)}),define("skylark-domx-eventer/main",["skylark-langx/langx","./eventer","skylark-domx-velm","skylark-domx-query"],function(t,e,n,i){n.delegate(["off","on","one","shortcuts","trigger"],e);return["keyUp","keyDown","mouseOver","mouseOut","click","dblClick","change"].forEach(function(t){var e=t;n.VisualElement.prototype[e]=function(e){return this.on(t.toLowerCase(),e),this}}),i.fn.on=i.wraps.wrapper_every_act(e.on,e),i.fn.off=i.wraps.wrapper_every_act(e.off,e),i.fn.trigger=i.wraps.wrapper_every_act(e.trigger,e),"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error transitionEnd".split(" ").forEach(function(t){i.fn[t]=function(e,n){return 0 in arguments?this.on(t,e,n):this.trigger(t)}}),i.fn.one=function(e,n,i,r){return t.isString(n)||t.isFunction(r)||(r=i,i=n,n=null),t.isFunction(i)&&(r=i,i=null),this.on(e,n,i,r,1)},i.ready=e.ready,e}),define("skylark-domx-eventer",["skylark-domx-eventer/main"],function(t){return t}),define("skylark-domx-files/files",["skylark-langx/skylark"],function(t){var e=function(){return e};return t.attach("domx.files",e)}),define("skylark-domx-styler/styler",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){Array.prototype.every;var n=Array.prototype.forEach,i=e.camelCase,r=e.dasherize;function o(t,e){return"number"!=typeof e||a[r(t)]?e:e+"px"}var a={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},s={};function l(t){return t in s?s[t]:s[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function u(t,e){var n=t.className||"",i=n&&void 0!==n.baseVal;if(void 0===e)return i?n.baseVal:n;i?n.baseVal=e:t.className=e}var d={};function c(t){var e=t.ownerDocument.defaultView;return e&&e.opener||(e=window),e.getComputedStyle(t)}var h=function(){return h};return e.mixin(h,{autocssfix:!1,cssHooks:{},addClass:function(t,n){if(!n)return this;var i,r=u(t);i=e.isString(n)?n.split(/\s+/g):n;return i.forEach(function(t){var e=l(t);r.match(e)||(r+=(r?" ":"")+t)}),u(t,r),this},className:u,css:function(t,a,s){if(arguments.length<3){var l=c(t);if(e.isString(a))return t.style[i(a)]||l.getPropertyValue(r(a));if(e.isArrayLike(a)){var u={};return n.call(a,function(e){u[e]=t.style[i(e)]||l.getPropertyValue(r(e))}),u}}var d="";if("string"==typeof a)s||0===s?d=r(a)+":"+o(a,s):t.style.removeProperty(r(a));else for(key in a)void 0!==a[key]&&(a[key]||0===a[key]?d+=r(key)+":"+o(key,a[key])+";":t.style.removeProperty(r(key)));return t.style.cssText+=";"+d,this},disabled:function(t,e){if(arguments.length<2)return!!this.dom.disabled;return t.disabled=e,this},hasClass:function(t,e){var n=l(e);return t.className&&t.className.match(n)},hide:function(t){return h.css(t,"display","none"),this},isInvisible:function(t){return"none"==h.css(t,"display")||0==h.css(t,"opacity")},removeClass:function(t,n){if(n){var i=u(t);(e.isString(n)?n.split(/\s+/g):n).forEach(function(t){var e=l(t);i.match(e)&&(i=i.replace(e," "))}),u(t,i.trim())}else u(t,"");return this},show:function(t){h.css(t,"display",""),"none"==h.css(t,"display")&&h.css(t,"display",function(t){var e,n;d[t]||(e=document.createElement(t),document.body.appendChild(e),n=c(e).getPropertyValue("display"),e.parentNode.removeChild(e),"none"==n&&(n="block"),d[t]=n);return d[t]}(t.nodeName));return this},toggleClass:function(t,e,n){var i=this;return e.split(/\s+/g).forEach(function(e){void 0===n&&(n=!i.hasClass(t,e)),n?i.addClass(t,e):i.removeClass(t,e)}),i}}),t.attach("domx.styler",h)}),define("skylark-domx-styler/main",["./styler","skylark-domx-velm","skylark-domx-query"],function(t,e,n){e.delegate(["addClass","className","css","hasClass","hide","isInvisible","removeClass","show","toggleClass"],t);return["position","left","top","right","bottom","width","height","border","borderLeft","borderTop","borderRight","borderBottom","borderColor","display","overflow","margin","marginLeft","marginTop","marginRight","marginBottom","padding","paddingLeft","paddingTop","paddingRight","paddingBottom","color","background","backgroundColor","opacity","fontSize","fontWeight","textAlign","textDecoration","textTransform","cursor","zIndex"].forEach(function(t){var n=t;e.VisualElement.prototype[n]=function(e){return this.css(t,e),this}}),n.fn.style=n.wraps.wrapper_name_value(t.css,t),n.fn.css=n.wraps.wrapper_name_value(t.css,t),n.fn.hasClass=n.wraps.wrapper_some_chk(t.hasClass,t),n.fn.addClass=n.wraps.wrapper_every_act_firstArgFunc(t.addClass,t,t.className),n.fn.removeClass=n.wraps.wrapper_every_act_firstArgFunc(t.removeClass,t,t.className),n.fn.toggleClass=n.wraps.wrapper_every_act_firstArgFunc(t.toggleClass,t,t.className),n.fn.replaceClass=function(t,e){return this.removeClass(e),this.addClass(t),this},n.fn.replaceClass=function(t,e){return this.removeClass(e),this.addClass(t),this},t}),define("skylark-domx-styler",["skylark-domx-styler/main"],function(t){return t}),define("skylark-storages-diskfs/diskfs",["skylark-langx/skylark"],function(t){var e=function(){return e};return t.attach("storages.diskfs",e)}),define("skylark-storages-diskfs/webentry",["skylark-langx/arrays","skylark-langx/Deferred","./diskfs"],function(t,e,n){var i=Array.prototype.concat,r=function(){function n(t,n){var i=new e,o=function(t){i.reject(t)};if(n=n||"",t.isFile)t.file(function(t){t.relativePath=n,i.resolve(t)},o);else if(t.isDirectory){var a=t.createReader();a.readEntries(function(e){r(e,n+t.name+"/").then(function(t){i.resolve(t)}).catch(o)},o)}else i.resolve([]);return i.promise}function r(r,o){return e.all(t.map(r,function(t){return n(t,o)})).then(function(){return i.apply([],arguments)})}return{one:n,all:r}}();return n.webentry=r}),define("skylark-domx-files/dropzone",["skylark-langx/arrays","skylark-langx/Deferred","skylark-domx-styler","skylark-domx-eventer","./files","skylark-storages-diskfs/webentry"],function(t,e,n,i,r,o){return r.dropzone=function(e,r){var a=(r=r||{}).hoverClass||"dropzone",s=r.dropped,l=0;return i.on(e,"dragenter",function(t){t.dataTransfer&&t.dataTransfer.types.indexOf("Files")>-1&&(i.stop(t),l++,n.addClass(e,a))}),i.on(e,"dragover",function(t){t.dataTransfer&&t.dataTransfer.types.indexOf("Files")>-1&&i.stop(t)}),i.on(e,"dragleave",function(t){t.dataTransfer&&t.dataTransfer.types.indexOf("Files")>-1&&0==--l&&n.removeClass(e,a)}),i.on(e,"drop",function(r){if(r.dataTransfer&&r.dataTransfer.types.indexOf("Files")>-1&&(n.removeClass(e,a),i.stop(r),s)){var l=r.dataTransfer.items;l&&l.length&&(l[0].webkitGetAsEntry||l[0].getAsEntry)?o.all(t.map(l,function(t){return t.webkitGetAsEntry?t.webkitGetAsEntry():t.getAsEntry()})).then(s):s(r.dataTransfer.files)}}),this}}),define("skylark-domx-files/pastezone",["skylark-langx/objects","skylark-domx-eventer","./files"],function(t,e,n){return n.pastezone=function(n,i){(i=i||{}).hoverClass;var r=i.pasted;return e.on(n,"paste",function(e){var n=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,i=[];n&&n.length&&t.each(n,function(t,e){var n=e.getAsFile&&e.getAsFile();n&&i.push(n)}),r&&i.length&&r(i)}),this}}),define("skylark-storages-diskfs/select",["./diskfs"],function(t){var e,n=1/0;return t.select=function(t){var i=(t=t||{}).directory||!1,r=t.multiple||!1,o=t.picked;if(!e){var a=e=document.createElement("input");function s(t){for(var e=t.length;e--;)t[e].size>n&&t.splice(e,1);o(t)}a.type="file",a.style.position="fixed",a.style.left=0,a.style.top=0,a.style.opacity=.001,document.body.appendChild(a),a.onchange=function(t){var e=t.target.webkitEntries||t.target.entries;e&&e.length?webentry.all(e).then(function(t){s(t)}):s(Array.prototype.slice.call(t.target.files)),a.value=""}}e.multiple=r,e.webkitdirectory=i,e.click()}}),define("skylark-domx-files/picker",["skylark-langx/objects","skylark-domx-eventer","./files","skylark-storages-diskfs/select"],function(t,e,n,i){return n.picker=function(t,n){return e.on(t,"click",function(t){t.preventDefault(),i(n)}),this}}),define("skylark-domx-files/main",["./files","skylark-domx-velm","skylark-domx-query","./dropzone","./pastezone","./picker"],function(t,e,n){return e.delegate(["dropzone","pastezone","picker"],t),n.fn.pastezone=n.wraps.wrapper_every_act(t.pastezone,t),n.fn.dropzone=n.wraps.wrapper_every_act(t.dropzone,t),n.fn.picker=n.wraps.wrapper_every_act(t.picker,t),t}),define("skylark-domx-files",["skylark-domx-files/main"],function(t){return t}),define("skylark-domx-geom/geom",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-styler"],function(t,e,n,i){var r,o=/^(?:body|html)$/i,a=e.toPixel,s=n.offsetParent;function l(){if(void 0!==r)return r;var t,e,o=n.createFragment("<div style='display:block;position:absolute;width:200px;height:200px;overflow:hidden;'><div style='height:300px;width:auto;'></div></div>")[0],a=o.childNodes[0];return n.append(document.body,o),t=a.offsetWidth,i.css(o,"overflow","scroll"),e=a.offsetWidth,t===e&&(e=o[0].clientWidth),n.remove(o),r=t-e}function u(t){if(n.isWindow(t))return{left:0,top:0,right:0,bottom:0};var e=getComputedStyle(t);return{left:a(e.borderLeftWidth,t),top:a(e.borderTopWidth,t),right:a(e.borderRightWidth,t),bottom:a(e.borderBottomWidth,t)}}function d(t,e){if(void 0===e)return o.test(t.nodeName)?{top:0,left:0}:t.getBoundingClientRect();var n=s(t),i=d(n),r=p(t),a=u(n);return y(t,{top:e.top-i.top-r.top-a.top,left:e.left-i.left-r.left-a.left}),this}function c(t,e){return void 0===e?t.getBoundingClientRect():(d(t,e),w(t,e),this)}function h(t,e){if(void 0==e)return{width:t.clientWidth,height:t.clientHeight};var n="border-box"===i.css(t,"box-sizing"),r={width:e.width,height:e.height};if(n){var o=u(t);void 0!==r.width&&(r.width=r.width+o.left+o.right),void 0!==r.height&&(r.height=r.height+o.top+o.bottom)}else{var a=m(t);void 0!==r.width&&(r.width=r.width-a.left-a.right),void 0!==r.height&&(r.height=r.height-a.top-a.bottom)}return i.css(t,r),this}function f(t){var e=t.documentElement,n=t.body,i=Math.max,r=i(e.scrollWidth,n.scrollWidth),o=i(e.clientWidth,n.clientWidth),a=i(e.offsetWidth,n.offsetWidth),s=i(e.scrollHeight,n.scrollHeight),l=i(e.clientHeight,n.clientHeight),u=i(e.offsetHeight,n.offsetHeight);return{width:r<a?o:r,height:s<u?l:s}}function p(t){if(n.isWindow(t))return{left:0,top:0,right:0,bottom:0};var e=getComputedStyle(t);return{left:a(e.marginLeft),top:a(e.marginTop),right:a(e.marginRight),bottom:a(e.marginBottom)}}function g(t){var e=w(t),n=p(t);return{width:e.width+n.left+n.right,height:e.height+n.top+n.bottom}}function m(t){if(n.isWindow(t))return{left:0,top:0,right:0,bottom:0};var e=getComputedStyle(t);return{left:a(e.paddingLeft),top:a(e.paddingTop),right:a(e.paddingRight),bottom:a(e.paddingBottom)}}function v(t,e){if(void 0===e){var n=t.getBoundingClientRect();return{left:n.left+window.pageXOffset,top:n.top+window.pageYOffset}}var i=s(t),r=v(i),o=p(t),a=u(i);return y(t,{top:e.top-r.top-o.top-a.top,left:e.left-r.left-o.left-a.left}),this}function y(t,e){if(void 0==e){var n=s(t),r=d(t),o=d(n),a=(p(t),u(n));return{top:r.top-o.top-a.top,left:r.left-o.left-a.left}}var l={top:e.top,left:e.left};return"static"==i.css(t,"position")&&(l.position="relative"),i.css(t,l),this}function b(t,e){if(void 0===e){var n=s(t),i=c(t),r=d(n),o=(p(t),u(n));return{top:i.top-r.top-o.top,left:i.left-r.left-o.left,width:i.width,height:i.height}}return y(t,e),w(t,e),this}function k(t,e){9===t.nodeType&&(t=t.defaultView);var n="scrollLeft"in t;return void 0===e?n?t.scrollLeft:t.pageXOffset:(n?t.scrollLeft=e:t.scrollTo(e,t.scrollY),this)}function x(t,e){9===t.nodeType&&(t=t.defaultView);var n="scrollTop"in t;return void 0===e?n?t.scrollTop:t.pageYOffset:(n?t.scrollTop=e:t.scrollTo(t.scrollX,e),this)}function w(t,n){if(void 0==n)return e.isWindow(t)?{width:t.innerWidth,height:t.innerHeight}:e.isDocument(t)?f(document):{width:t.offsetWidth,height:t.offsetHeight};var r="border-box"===i.css(t,"box-sizing"),o={width:n.width,height:n.height};if(!r){var a=m(t),s=u(t);void 0!==o.width&&""!==o.width&&null!==o.width&&(o.width=o.width-a.left-a.right-s.left-s.right),void 0!==o.height&&""!==o.height&&null!==o.height&&(o.height=o.height-a.top-a.bottom-s.top-s.bottom)}return i.css(t,o),this}function _(){return _}return e.mixin(_,{borderExtents:u,boundingPosition:d,boundingRect:c,clientHeight:function(t,e){return void 0==e?h(t).height:h(t,{height:e})},clientSize:h,clientWidth:function(t,e){return void 0==e?h(t).width:(h(t,{width:e}),this)},contentRect:function(t){var e=h(t),n=m(t);return{left:n.left,top:n.top,width:e.width-n.left-n.right,height:e.height-n.top-n.bottom}},getDocumentSize:f,height:function(t,e){return void 0==e?w(t).height:(w(t,{height:e}),this)},marginExtents:p,marginRect:function(t){var e=b(t),n=p(t);return{left:e.left,top:e.top,width:e.width+n.left+n.right,height:e.height+n.top+n.bottom}},marginSize:g,offsetParent:s,paddingExtents:m,pagePosition:v,pageRect:function(t,e){if(void 0===e){var n=t.getBoundingClientRect();return{left:n.left+window.pageXOffset,top:n.top+window.pageYOffset,width:Math.round(n.width),height:Math.round(n.height)}}return v(t,e),w(t,e),this},relativePosition:y,relativeRect:b,scrollbarWidth:l,scrollIntoView:function(t,e){var n,i,r,o,a,s,l=t.parentNode,u=function(t,e){var n,i,r=t;n=i=0;for(;r&&r!=e&&r.nodeType;)n+=r.offsetLeft||0,i+=r.offsetTop||0,r=r.offsetParent;return{x:n,y:i}}(t,l);n=u.x,i=u.y,r=t.offsetWidth,o=t.offsetHeight,a=l.clientWidth,s=l.clientHeight,"end"==e?(n-=a-r,i-=s-o):"center"==e&&(n-=a/2-r/2,i-=s/2-o/2);return l.scrollLeft=n,l.scrollTop=i,this},scrollLeft:k,scrollTop:x,size:w,width:function(t,e){return void 0==e?w(t).width:(w(t,{width:e}),this)}}),function(){var t=Math.max,r=Math.abs,o=/left|center|right/,a=/top|center|bottom/,s=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,d=/%$/;function c(t,e,n){return[parseFloat(t[0])*(d.test(t[0])?e/100:1),parseFloat(t[1])*(d.test(t[1])?n/100:1)]}function h(t,e){return parseInt(i.css(t,e),10)||0}var f={fit:{left:function(e,n){var i,r=n.within,o=r.isWindow?r.scrollLeft:r.offset.left,a=r.width,s=e.left-n.collisionPosition.marginLeft,l=o-s,u=s+n.collisionWidth-a-o;n.collisionWidth>a?l>0&&u<=0?(i=e.left+l+n.collisionWidth-a-o,e.left+=l-i):e.left=u>0&&l<=0?o:l>u?o+a-n.collisionWidth:o:l>0?e.left+=l:u>0?e.left-=u:e.left=t(e.left-s,e.left)},top:function(e,n){var i,r=n.within,o=r.isWindow?r.scrollTop:r.offset.top,a=n.within.height,s=e.top-n.collisionPosition.marginTop,l=o-s,u=s+n.collisionHeight-a-o;n.collisionHeight>a?l>0&&u<=0?(i=e.top+l+n.collisionHeight-a-o,e.top+=l-i):e.top=u>0&&l<=0?o:l>u?o+a-n.collisionHeight:o:l>0?e.top+=l:u>0?e.top-=u:e.top=t(e.top-s,e.top)}},flip:{left:function(t,e){var n,i,o=e.within,a=o.offset.left+o.scrollLeft,s=o.width,l=o.isWindow?o.scrollLeft:o.offset.left,u=t.left-e.collisionPosition.marginLeft,d=u-l,c=u+e.collisionWidth-s-l,h="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,f="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,p=-2*e.offset[0];d<0?((n=t.left+h+f+p+e.collisionWidth-s-a)<0||n<r(d))&&(t.left+=h+f+p):c>0&&((i=t.left-e.collisionPosition.marginLeft+h+f+p-l)>0||r(i)<c)&&(t.left+=h+f+p)},top:function(t,e){var n,i,o=e.within,a=o.offset.top+o.scrollTop,s=o.height,l=o.isWindow?o.scrollTop:o.offset.top,u=t.top-e.collisionPosition.marginTop,d=u-l,c=u+e.collisionHeight-s-l,h="top"===e.my[1],f=h?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,p="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];d<0?((i=t.top+f+p+g+e.collisionHeight-s-a)<0||i<r(d))&&(t.top+=f+p+g):c>0&&((n=t.top-e.collisionPosition.marginTop+f+p+g-l)>0||r(n)<c)&&(t.top+=f+p+g)}},flipfit:{left:function(){f.flip.left.apply(this,arguments),f.fit.left.apply(this,arguments)},top:function(){f.flip.top.apply(this,arguments),f.fit.top.apply(this,arguments)}}};_.posit=function(d,p){var m,y,b,_,A,C,T=(p=e.extend({},p)).of,E=(O=p.within,R=O||window,j=n.isWindow(R),I=!!R&&9===R.nodeType,B=!j&&!I,z=g(R),{element:R,isWindow:j,isDocument:I,offset:B?v(O):{left:0,top:0},scrollLeft:k(R),scrollTop:x(R),width:z.width,height:z.height}),N=function(t){var e=t.isWindow||t.isDocument?"":i.css(t.element,"overflow-x"),n=t.isWindow||t.isDocument?"":i.css(t.element,"overflow-y"),r="scroll"===e||"auto"===e&&t.width<scrollWidth(t.element);return{width:"scroll"===n||"auto"===n&&t.height<scrollHeight(t.element)?l():0,height:r?l():0}}(E),S=(p.collision||"flip").split(" "),P={};var O,R,j,I,B,z;L=T,C=9===L.nodeType?{size:w(L),offset:{top:0,left:0}}:n.isWindow(L)?{size:w(L),offset:{top:x(L),left:k(L)}}:L.preventDefault?{size:{width:0,height:0},offset:{top:L.pageY,left:L.pageX}}:{size:w(L),offset:v(L)},T.preventDefault&&(p.at="left top");var L;y=C.size.width,b=C.size.height,_=C.offset,A=e.extend({},_),e.each(["my","at"],function(){var t,e,n=(p[this]||"").split(" ");1===n.length&&(n=o.test(n[0])?n.concat(["center"]):a.test(n[0])?["center"].concat(n):["center","center"]),n[0]=o.test(n[0])?n[0]:"center",n[1]=a.test(n[1])?n[1]:"center",t=s.exec(n[0]),e=s.exec(n[1]),P[this]=[t?t[0]:0,e?e[0]:0],p[this]=[u.exec(n[0])[0],u.exec(n[1])[0]]}),1===S.length&&(S[1]=S[0]);"right"===p.at[0]?A.left+=y:"center"===p.at[0]&&(A.left+=y/2);"bottom"===p.at[1]?A.top+=b:"center"===p.at[1]&&(A.top+=b/2);return m=c(P.at,y,b),A.left+=m[0],A.top+=m[1],function(n){var i,o,a=g(n),s=a.width,l=a.height,u=h(n,"marginLeft"),d=h(n,"marginTop"),k=s+u+h(n,"marginRight")+N.width,x=l+d+h(n,"marginBottom")+N.height,w=e.extend({},A),C=c(P.my,a.width,a.height);"right"===p.my[0]?w.left-=s:"center"===p.my[0]&&(w.left-=s/2),"bottom"===p.my[1]?w.top-=l:"center"===p.my[1]&&(w.top-=l/2),w.left+=C[0],w.top+=C[1],i={marginLeft:u,marginTop:d},e.each(["left","top"],function(t,e){f[S[t]]&&f[S[t]][e](w,{targetWidth:y,targetHeight:b,elemWidth:s,elemHeight:l,collisionPosition:i,collisionWidth:k,collisionHeight:x,offset:[m[0]+C[0],m[1]+C[1]],my:p.my,at:p.at,within:E,elem:n})}),p.using&&(o=function(e){var i=_.left-w.left,o=i+y-s,a=_.top-w.top,u=a+b-l,d={target:{element:T,left:_.left,top:_.top,width:y,height:b},element:{element:n,left:w.left,top:w.top,width:s,height:l},horizontal:o<0?"left":i>0?"right":"center",vertical:u<0?"top":a>0?"bottom":"middle"};y<s&&r(i+o)<y&&(d.horizontal="center"),b<l&&r(a+u)<b&&(d.vertical="middle"),t(r(i),r(o))>t(r(a),r(u))?d.important="horizontal":d.important="vertical",p.using.call(this,e,d)}),v(n,e.extend(w,{using:o}))}(d)}}(),t.attach("domx.geom",_)}),define("skylark-domx-geom/main",["skylark-langx/langx","./geom","skylark-domx-velm","skylark-domx-query"],function(t,e,n,i){return n.delegate(["borderExtents","boundingPosition","boundingRect","clientHeight","clientSize","clientWidth","contentRect","height","marginExtents","offsetParent","paddingExtents","pagePosition","pageRect","relativePosition","relativeRect","scrollIntoView","scrollLeft","scrollTop","size","width"],e),i.fn.offset=i.wraps.wrapper_value(e.pagePosition,e,e.pagePosition),i.fn.scrollTop=i.wraps.wrapper_value(e.scrollTop,e),i.fn.scrollLeft=i.wraps.wrapper_value(e.scrollLeft,e),i.fn.position=function(n){if(!this.length)return this;if(n)return n.of&&n.of.length&&((n=t.clone(n)).of=n.of[0]),this.each(function(){e.posit(this,n)});var i=this[0];return e.relativePosition(i)},i.fn.offsetParent=i.wraps.wrapper_map(e.offsetParent,e),i.fn.size=i.wraps.wrapper_value(e.size,e),i.fn.width=i.wraps.wrapper_value(e.width,e,e.width),i.fn.height=i.wraps.wrapper_value(e.height,e,e.height),i.fn.clientSize=i.wraps.wrapper_value(e.clientSize,e.clientSize),["width","height"].forEach(function(t){var n=t.replace(/./,function(t){return t[0].toUpperCase()});i.fn["outer"+n]=function(n,i){if(arguments.length?"boolean"!=typeof n&&(i=n,n=!1):(n=!1,i=void 0),void 0===i){var r=this[0];if(!r)return;var o=e.size(r);if(n){var a=e.marginExtents(r);o.width=o.width+a.left+a.right,o.height=o.height+a.top+a.bottom}return"width"===t?o.width:o.height}return this.each(function(r,o){var a={},s=e.marginExtents(o);"width"===t?(a.width=i,n&&(a.width=a.width-s.left-s.right)):(a.height=i,n&&(a.height=a.height-s.top-s.bottom)),e.size(o,a)})}}),i.fn.innerWidth=i.wraps.wrapper_value(e.clientWidth,e,e.clientWidth),i.fn.innerHeight=i.wraps.wrapper_value(e.clientHeight,e,e.clientHeight),e}),define("skylark-domx-geom",["skylark-domx-geom/main"],function(t){return t}),define("skylark-domx-fx/fx",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-geom","skylark-domx-styler","skylark-domx-eventer"],function(t,e,n,i,r,o,a){var s,l,u,d,c,h,f,p=n.normalizeCssEvent("AnimationEnd"),g=n.normalizeCssEvent("TransitionEnd"),m=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,v=n.css3PropPrefix+"transform",y={};function b(t,n,i,b,k,x){var _,A,C,T={},E=[],S="",P=this,O=!1,R=!1;if(e.isPlainObject(i)&&(b=i.easing,k=i.complete,x=i.delay,i=i.duration),e.isString(i)&&(i=N.speeds[i]),void 0===i&&(i=N.speeds.normal),i/=1e3,N.off&&(i=0),e.isFunction(b)?(k=b,eace="swing"):b=b||"swing",x?x/=1e3:x=0,e.isString(n))T[s]=n,T[l]=i+"s",T[u]=b,A=p;else{for(_ in n){var j=n[_];if(m.test(_))S+=_+"("+j+") ";else{if("scrollTop"===_&&(R=!0),"clip"==_&&e.isPlainObject(j)){if(T[_]="rect("+j.top+"px,"+j.right+"px,"+j.bottom+"px,"+j.left+"px)","auto"==o.css(t,"clip")){var I=r.size(t);o.css(t,"clip","rect(0px,"+I.width+"px,"+I.height+"px,0px)"),!0}}else T[_]=j;E.push(e.dasherize(_))}}A=g}return S&&(T[v]=S,E.push(v)),i>0&&e.isPlainObject(n)&&(T[d]=E.join(", "),T[c]=i+"s",T[f]=x+"s",T[h]=b),C=function(e){if(O=!0,e){if(e.target!==e.currentTarget)return;a.off(e.target,A,C)}else a.off(t,p,C);o.css(t,y),k&&k.call(this)},i>0&&(a.on(t,A,C),e.debounce(function(){O||C.call(P)},1e3*(i+x)+25)()),t.clientLeft,o.css(t,T),i<=0&&e.debounce(function(){O||C.call(P)},0)(),R&&w(t,n.scrollTop,i,k),this}function k(t,n,i){return o.show(t),n&&(!i&&e.isFunction(n)&&(i=n,n="normal"),o.css(t,"opacity",0),b(t,{opacity:1,scale:"1,1"},n,i)),this}function x(t,n,i){return n?(!i&&e.isFunction(n)&&(i=n,n="normal"),b(t,{opacity:0,scale:"0,0"},n,function(){o.hide(t),i&&i.call(t)})):o.hide(t),this}function w(t,n,i,r){var o=parseInt(t.scrollTop),a=0,s=1e3*i/5,l=parseInt(n),u=setInterval(function(){++a<=s&&(t.scrollTop=(l-o)/s*a+o),a>=s+1&&(clearInterval(u),r&&e.debounce(r,1e3)())},5)}function _(t,e,n,i,r){return b(t,{opacity:n},e,i,r),this}function A(t,e,n,i){var r=o.css(t,"opacity");return r>0?o.css(t,"opacity",0):r=1,o.show(t),_(t,e,r,n,i),this}function C(t,n,i,r){var a,s=o.css(t,"opacity"),l={};return e.isPlainObject(n)?(l.easing=n.easing,l.duration=n.duration,a=n.complete):(l.duration=n,r?(a=r,l.easing=i):a=i),l.complete=function(){o.css(t,"opacity",s),o.hide(t),a&&a.call(t)},_(t,l,0),this}function T(t,e,n){var i=o.css(t,"position");k(t),o.css(t,{position:"absolute",visibility:"hidden"});var r=o.css(t,"margin-top"),a=o.css(t,"margin-bottom"),s=o.css(t,"padding-top"),l=o.css(t,"padding-bottom"),u=o.css(t,"height");return o.css(t,{position:i,visibility:"visible",overflow:"hidden",height:0,marginTop:0,marginBottom:0,paddingTop:0,paddingBottom:0}),b(t,{height:u,marginTop:r,marginBottom:a,paddingTop:s,paddingBottom:l},{duration:e,complete:function(){n&&n.apply(t)}}),this}function E(t,e,n){if(r.height(t)>0){o.css(t,"position");var i=o.css(t,"height"),a=o.css(t,"margin-top"),s=o.css(t,"margin-bottom"),l=o.css(t,"padding-top"),u=o.css(t,"padding-bottom");o.css(t,{visibility:"visible",overflow:"hidden",height:i,marginTop:a,marginBottom:s,paddingTop:l,paddingBottom:u}),b(t,{height:0,marginTop:0,marginBottom:0,paddingTop:0,paddingBottom:0},{duration:e,queue:!1,complete:function(){x(t),o.css(t,{visibility:"visible",overflow:"hidden",height:i,marginTop:a,marginBottom:s,paddingTop:l,paddingBottom:u}),n&&n.apply(t)}})}return this}function N(){return N}return y[s=n.normalizeCssProperty("animation-name")]=y[l=n.normalizeCssProperty("animation-duration")]=y[n.normalizeCssProperty("animation-delay")]=y[u=n.normalizeCssProperty("animation-timing-function")]="",y[d=n.normalizeCssProperty("transition-property")]=y[c=n.normalizeCssProperty("transition-duration")]=y[f=n.normalizeCssProperty("transition-delay")]=y[h=n.normalizeCssProperty("transition-timing-function")]="",e.mixin(N,{off:!1,speeds:{normal:400,fast:200,slow:600},animate:b,emulateTransitionEnd:function(t,e){var i=!1;a.one(t,"transitionEnd",function(){i=!0});return setTimeout(function(){i||a.trigger(t,n.support.transition.end)},e),this},fadeIn:A,fadeOut:C,fadeTo:_,fadeToggle:function(t,e,n,i){o.isInvisible(t)?A(t,e,easing,callback):C(t,e,easing,callback);return this},hide:x,scrollToTop:w,slideDown:T,slideToggle:function(t,e,n){0==r.height(t)?T(t,e,n):E(t,e,n);return this},slideUp:E,show:k,throb:function(t,e){var n,r=(e=e||{}).text,a=(e.style,e.time),s=e.callback,l=i.createElement("div",{class:e.className||"throbber"}),u=(function(t,e){var n=i.createElement("div",e);o.css(n,{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2147483647,opacity:.7}),t.appendChild(n)}(l,{class:"overlay fade"}),i.createElement("div",{class:"throb"})),d=i.createTextNode(r||""),c=function(){n&&(clearTimeout(n),n=null),l&&(i.remove(l),l=null)};e.style&&o.css(l,e.style);u.appendChild(d),l.appendChild(u),t.appendChild(l),a&&(n=setTimeout(function(){c(),s&&s()},a));return{remove:c,update:function(t){t&&t.text&&l&&(d.nodeValue=t.text)}}},toggle:function(t,e,n){o.isInvisible(t)?k(t,e,n):x(t,e,n);return this}}),t.attach("domx.fx",N)}),define("skylark-domx-fx/main",["./fx","skylark-domx-velm","skylark-domx-query"],function(t,e,n){return e.delegate(["animate","emulateTransitionEnd","fadeIn","fadeOut","fadeTo","fadeToggle","hide","scrollToTop","slideDown","slideToggle","slideUp","show","toggle"],t),n.fn.hide=n.wraps.wrapper_every_act(t.hide,t),n.fn.animate=n.wraps.wrapper_every_act(t.animate,t),n.fn.emulateTransitionEnd=n.wraps.wrapper_every_act(t.emulateTransitionEnd,t),n.fn.show=n.wraps.wrapper_every_act(t.show,t),n.fn.hide=n.wraps.wrapper_every_act(t.hide,t),n.fn.toogle=n.wraps.wrapper_every_act(t.toogle,t),n.fn.fadeTo=n.wraps.wrapper_every_act(t.fadeTo,t),n.fn.fadeIn=n.wraps.wrapper_every_act(t.fadeIn,t),n.fn.fadeOut=n.wraps.wrapper_every_act(t.fadeOut,t),n.fn.fadeToggle=n.wraps.wrapper_every_act(t.fadeToggle,t),n.fn.slideDown=n.wraps.wrapper_every_act(t.slideDown,t),n.fn.slideToggle=n.wraps.wrapper_every_act(t.slideToggle,t),n.fn.slideUp=n.wraps.wrapper_every_act(t.slideUp,t),t}),define("skylark-domx-fx",["skylark-domx-fx/main"],function(t){return t}),define("skylark-domx-plugins/plugins",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-data","skylark-domx-eventer","skylark-domx-finder","skylark-domx-geom","skylark-domx-styler","skylark-domx-fx","skylark-domx-query","skylark-domx-velm"],function(t,e,n,i,r,o,a,s,l,u,d){"use strict";var c=Array.prototype.slice,h=(Array.prototype.concat,{}),f={};function p(t,e,n){var r=e.split(":"),o=r[1];e=r[0],o||(o=e);var a=i.data(t,o);if("instance"===n)return a;if("destroy"===n){if(!a)throw new Error("The plugin instance is not existed");a.destroy(),i.removeData(t,e),a=void 0}else if(a)n&&a.reset(n);else{if(void 0!==n&&"object"!=typeof n)throw new Error("The options must be a plain object");var s=h[e];a=new s(t,n),i.data(t,o,a)}return a}var g=e.Evented.inherit({klassName:"Plugin",_construct:function(t,e){this._elm=t,this._initOptions(e)},_initOptions:function(t){var n=this.constructor,i=n.cache=n.cache||{},r=i.defaults;if(!r){var o=[];do{if(o.unshift(n),n===g)break;n=n.superclass}while(n);r=i.defaults={};for(var a=0;a<o.length;a++)(n=o[a]).prototype.hasOwnProperty("options")&&e.mixin(r,n.prototype.options,!0),n.hasOwnProperty("options")&&e.mixin(r,n.options,!0)}return Object.defineProperty(this,"options",{value:e.mixin({},r,t,!0)}),this.options},destroy:function(){this._destroy(),i.removeData(this._elm,this.pluginName)},_destroy:e.noop,_delay:function(t,e){var n=this;return setTimeout(function(){return("string"==typeof t?n[t]:t).apply(n,arguments)},e||0)},option:function(t,n){var i,r,o,a=t;if(0===arguments.length)return e.mixin({},this.options);if("string"==typeof t)if(a={},i=t.split("."),t=i.shift(),i.length){for(r=a[t]=e.mixin({},this.options[t]),o=0;o<i.length-1;o++)r[i[o]]=r[i[o]]||{},r=r[i[o]];if(t=i.pop(),1===arguments.length)return void 0===r[t]?null:r[t];r[t]=n}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];a[t]=n}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,this},getUID:function(t){t=t||"plugin";do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t},elm:function(){return this._elm}});function m(){return m}return u.fn.plugin=function(t,e){var n=c.call(arguments,1),i=this,r=this;return this.each(function(){r=p.apply(i,[this,t].concat(n))}),r},d.partial("plugin",function(t,e){var n=c.call(arguments,1);return p.apply(this,[this.domNode,t].concat(n))}),e.mixin(m,{instantiate:p,Plugin:g,register:function(t,n,i,r){var o=t.prototype.pluginName;if(h[o]=t,n){i&&e.isFunction(i)&&(r=i,i=null),i&&(o=o+":"+i);var a=f[n]=function(t,n){return function(i,r){var o=p(i,t,"instance");if("instance"===r)return o||null;if(o){if(r){var a=c.call(arguments,1);if(n)return n.apply(o,a);if("string"==typeof r){var s=r;if(!o)throw new Error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+s+"'");if(!e.isFunction(o[s])||"_"===s.charAt(0))throw new Error("no such method '"+s+"' for "+t+" plugin instance");return o[s].apply(o,a)}}}else o=p(i,t,"object"==typeof r&&r||{})}}(o,r);u.fn[n]=function(t){var e=this;if(this.length||"instance"!==t){var n=c.call(arguments);this.each(function(){var t=c.call(n);t.unshift(this);var i=a.apply(null,t);if(void 0!==i)return e=i,!1})}else e=void 0;return e},d.partial(n,function(t){var e=a(this._elm,t);return void 0===e&&(e=this),e})}},shortcuts:f}),t.attach("domx.plugins",m)}),define("skylark-domx-plugins/main",["./plugins"],function(t){return t}),define("skylark-domx-plugins",["skylark-domx-plugins/main"],function(t){return t}),define("skylark-data-collection/collections",["skylark-langx/skylark"],function(t){return t.attach("data.collections",{})}),define("skylark-data-collection/Collection",["skylark-langx/Evented","./collections"],function(t,e){var n=e.Collection=t.inherit({klassName:"Collection",_clear:function(){throw new Error("Unimplemented API")},clear:function(){return this._clear(),this.trigger("changed:clear"),this},count:function(){for(var t=0,e=this.iterator();!e.hasNext();)t++;return t},forEach:function(t,e){for(var n=this.iterator();n.hasNext();){var i=n.next();t.call(e||i,i)}return this},iterator:function(){throw new Error("Unimplemented API")},toArray:function(){for(var t=[],e=this.iterator();!e.hasNext();)t.push(e.next());return t}});return n}),define("skylark-data-collection/Map",["./collections","./Collection"],function(t,e){var n=t.Map=e.inherit({klassName:"Map",_getInnerItems:function(){return this._items},_clear:function(){this._items=[]},_findKeyByRegExp:function(t,e){var n=this._getInnerItems();return n.filter(function(n){return!!n.match(t)&&(e&&e(n),!0)})},get:function(t,e){if("string"!=typeof t)throw"hash key is not string!";var n=this._getInnerItems();return n[t]},iterator:function(){var t=0;return{hasNext:function(){return t<this._items.length},next:function(){var e=this._items[t++];return[this._items[e],e]}}},set:function(t,e){if("string"!=typeof t)throw"hash key is not string!";var n=this._getInnerItems();-1==n.indexOf(t)&&n.push(t);var i=n[t];if(i!==e){n[t]=e;var r={};r[t]={name:t,value:e,oldValue:i},this.trigger("changed",{data:r})}return this},remove:function(t){if("string"!=typeof t)throw"hash key is not string!";var e=this._getInnerItems(),n=e.indexOf(t);n>=0&&(delete e[t],delete e[n])},findByRegExp:function(t,e){var n=[],i=this;return this._findKeyByRegExp(t,function(t){var r=i.get(t);e&&e(r),n.push(r)}),n},removeByRegExp:function(t){var e=this;this._findKeyByRegExp(t,function(t){e.remove(t)})},toPlain:function(){for(var t=this._getInnerItems(),e=0;e<t.length;e++){var n=t[e];plain[n]=t[n]}return plain},toString:function(t){var e=this._getInnerItems();return e.join(t||",")},init:function(t){var e=this._items=[];for(var n in t)e.push(n),e[n]=t[n]}});return n}),define("skylark-data-collection/HashMap",["./collections","./Map"],function(t,e){var n=t.HashMap=e.inherit({});return n}),define("skylark-widgets-base/base",["skylark-langx/skylark"],function(t){return t.attach("widgets.base",{})}),define("skylark-widgets-base/Widget",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-data","skylark-domx-eventer","skylark-domx-noder","skylark-domx-files","skylark-domx-geom","skylark-domx-velm","skylark-domx-query","skylark-domx-fx","skylark-domx-plugins","skylark-data-collection/HashMap","./base"],function(skylark,langx,browser,datax,eventer,noder,files,geom,elmx,$,fx,plugins,HashMap,base){var Widget=plugins.Plugin.inherit({klassName:"Widget",_elmx:elmx,_construct:function(t,e){langx.isHtmlNode(t)?e=this._parse(t,e):(e=t,t=null),this.overrided(t,e),t?this._velm=elmx(this._elm):(this._velm=this._create(),this._elm=this._velm.elm()),Object.defineProperty(this,"state",{value:this.options.state||new HashMap}),this._init();var n=this.options.addons;if(n){var i=this.constructor,r=i.addons;for(var o in n)for(var a=0;a<n[o].length;a++){var s=n[o][a];if(langx.isString(s)){var l=s,u=r[o][l],d=u.ctor?u.ctor:u;this.addon(d,u.options)}}}this._elm.parentElement&&this._startup()},_parse:function(elm,options){var optionsAttr=datax.data(elm,"options");if(optionsAttr){var options1=eval("({"+optionsAttr+"})");options=langx.mixin(options1,options)}return options||{}},_create:function(){var t=this.options.template;if(t)return this._elmx(t);throw new Error("The template is not existed in options!")},_init:function(){var t=this;this.widgetClass&&this._velm.addClass(this.widgetClass),this.state.on("changed",function(e,n){t._refresh(n.data)})},_startup:function(){},_refresh:function(t){},mapping:{events:{},attributs:{},properties:{},styles:{}},addon:function(t,e){var n=t.categoryName,i=t.addonName;this._addons=this.addons||{};var r=this._addons[n]=this._addons[n]||{};return r[i]=new t(this,e),this},addons:function(t,e){this._addons=this.addons||{};var n=this._addons[t]=this._addons[t]||{};if(void 0==e)return langx.clone(n||null);langx.mixin(n,e)},render:function(){return this._elm},getEnclosing:function(t){return null},getEnclosed:function(){return children=new ArrayList,children},show:function(){this._velm.show()},hide:function(){this._velm.hide()},focus:function(){try{this._velm.focus()}catch(t){}return this},blur:function(){return this._velm.blur(),this},enable:function(){return this.state.set("disabled",!1),this},disable:function(){return this.state.set("disabled",!0),this},aria:function(t,e){const n=this,i=n.getEl(n.ariaTarget);return void 0===e?n._aria[t]:(n._aria[t]=e,n.state.get("rendered")&&i.setAttribute("role"===t?t:"aria-"+t,e),n)},attr:function(t,e){var n=this._velm,i=n.attr(t,e);return i==n?this:i},css:function(t,e){var n=this._velm,i=n.css(t,e);return i==n?this:i},data:function(t,e){var n=this._velm,i=n.data(t,e);return i==n?this:i},prop:function(t,e){var n=this._velm,i=n.prop(t,e);return i==n?this:i},throb:function(t){return fx.throb(this._elm,t)},emit:function(t,e){var n=langx.Emitter.createEvent(t,{data:e});return langx.Emitter.prototype.emit.call(this,n,e)},attach:function(t,e){var n=t;e&&"child"!=e?"before"==e?noder.before(n,this._elm):"after"==e&&noder.after(n,this._elm):noder.append(n,this._elm),this._startup()},detach:function(){this._velm.remove()}});return Widget.inherit=function(t){var e=plugins.Plugin.inherit.apply(this,arguments);function n(t){e.prototype[t]=function(e){return void 0!==e?(this.state.set(t,e),this):this.state.get(t)}}if(t.state)for(var i in t.state)n(i);return t.pluginName&&plugins.register(e,t.pluginName),e},Widget.register=function(t,e){var n=t.prototype,i=e||n.pluginName;function r(e){t.prototype[e]=function(t){return void 0!==t?(this.state.set(e,t),this):this.state.get(e)}}if(n.state)for(var o in n.state)r(o);return i&&plugins.register(t,i),t},base.Widget=Widget}),define("skylark-widgets-swt/Toolbar",["skylark-langx/langx","skylark-domx-query","skylark-widgets-base/Widget"],function(t,e,n){var i=n.inherit({pluginName:"lark.toolbar",options:{toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0,template:'<div class="lark-toolbar"><ul></ul></div>',separator:{template:'<li><span class="separator"></span></li>'}},_init:function(){var t,n;this.opts=this.options,this.wrapper=e(this._elm),this.list=this.wrapper.find("ul"),this.list.on("click",function(t){return!1}),this.wrapper.on("mousedown",(n=this,function(t){return n.list.find(".menu-on").removeClass(".menu-on")})),e(document).on("mousedown.toolbar",function(t){return function(e){return t.list.find(".menu-on").removeClass("menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.css("top",this.opts.toolbarFloatOffset),t=0,function(e){return function(){return e.wrapper.css("position","static"),e.wrapper.width("auto"),e.editor.editable.util.reflow(e.wrapper),e.wrapper.width(e.wrapper.outerWidth()),e.wrapper.css("left",e.editor.editable.util.os.mobile?e.wrapper.position().left:e.wrapper.offset().left),e.wrapper.css("position",""),t=e.wrapper.outerHeight(),e.editor.placeholderEl.css("top",t),!0}}(this))},addToolItem:function(t){return e(t._elm).appendTo(this.list),this},addSeparator:function(){return e(this.options.separator.template).appendTo(this.list),this}});return i}),define("skylark-widgets-wordpad/i18n",[],function(){var t={"zh-CN":{blockquote:"引用",bold:"加粗文字",code:"插入代码",color:"文字颜色",coloredText:"彩色文字",hr:"分隔线",image:"插入图片",externalImage:"外链图片",uploadImage:"上传图片",uploadFailed:"上传失败了",uploadError:"上传出错了",imageUrl:"图片地址",imageSize:"图片尺寸",imageAlt:"图片描述",restoreImageSize:"还原图片尺寸",uploading:"正在上传",indent:"向右缩进",outdent:"向左缩进",italic:"斜体文字",link:"插入链接",linkText:"链接文字",linkUrl:"链接地址",linkTarget:"打开方式",openLinkInCurrentWindow:"在当前窗口中打开",openLinkInNewWindow:"在新窗口中打开",removeLink:"移除链接",ol:"有序列表",ul:"无序列表",strikethrough:"删除线文字",table:"表格",deleteRow:"删除行",insertRowAbove:"在上面插入行",insertRowBelow:"在下面插入行",deleteColumn:"删除列",insertColumnLeft:"在左边插入列",insertColumnRight:"在右边插入列",deleteTable:"删除表格",title:"标题",normalText:"普通文本",underline:"下划线文字",alignment:"水平对齐",alignCenter:"居中",alignLeft:"居左",alignRight:"居右",selectLanguage:"选择程序语言",fontScale:"字体大小",fontScaleXLarge:"超大字体",fontScaleLarge:"大号字体",fontScaleNormal:"正常大小",fontScaleSmall:"小号字体",fontScaleXSmall:"超小字体"},"en-US":{blockquote:"Block Quote",bold:"Bold",code:"Code",color:"Text Color",coloredText:"Colored Text",hr:"Horizontal Line",image:"Insert Image",externalImage:"External Image",uploadImage:"Upload Image",uploadFailed:"Upload failed",uploadError:"Error occurs during upload",imageUrl:"Url",imageSize:"Size",imageAlt:"Alt",restoreImageSize:"Restore Origin Size",uploading:"Uploading",indent:"Indent",outdent:"Outdent",italic:"Italic",link:"Insert Link",linkText:"Text",linkUrl:"Url",linkTarget:"Target",openLinkInCurrentWindow:"Open link in current window",openLinkInNewWindow:"Open link in new window",removeLink:"Remove Link",ol:"Ordered List",ul:"Unordered List",strikethrough:"Strikethrough",table:"Table",deleteRow:"Delete Row",insertRowAbove:"Insert Row Above",insertRowBelow:"Insert Row Below",deleteColumn:"Delete Column",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteTable:"Delete Table",title:"Title",normalText:"Text",underline:"Underline",alignment:"Alignment",alignCenter:"Align Center",alignLeft:"Align Left",alignRight:"Align Right",selectLanguage:"Select Language",fontScale:"Font Size",fontScaleXLarge:"X Large Size",fontScaleLarge:"Large Size",fontScaleNormal:"Normal Size",fontScaleSmall:"Small Size",fontScaleXSmall:"X Small Size"},translate:function(){var e,n,i,r;return n=arguments[0],e=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],r=(null!=(i=t[this.locale])?i[n]:void 0)||"",e.length>0?(r=r.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(t,n,i){return i?n+e[parseInt(i)-1]:n+e.shift()})).replace(/%%s/g,"%s"):r}};return t}),define("skylark-widgets-wordpad/ToolButton",["skylark-langx/langx","skylark-domx-query","skylark-widgets-base/Widget","./i18n"],function(t,e,n,i){var r=n.inherit({options:{template:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menu:{menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'}},_construct:function(t){this.action=t.action,this.toolbar=t.toolbar,this.editor=t.toolbar.editor,n.prototype._construct.call(this,t)},_init:function(){this.render();var t=this;this.el.on("mousedown",function(e){var n,i;return e.preventDefault(),n=t.needFocus&&!t.editor.editable.inputManager.focused,!t.el.hasClass("disabled")&&(n&&t.editor.focus(),t.menu?(t.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),t.wrapper.is(".menu-on")&&(t.menuWrapper.offset().left+t.menuWrapper.outerWidth()+5-t.editor.wrapper.offset().left-t.editor.wrapper.outerWidth()>0&&t.menuWrapper.css({left:"auto",right:0}),t.trigger("menuexpand")),!1):(i=t.el.data("param"),t.command(i),!1))}),this.wrapper.on("click","a.menu-item",function(n){var i,r,o;return n.preventDefault(),i=e(n.currentTarget),t.wrapper.removeClass("menu-on"),r=t.needFocus&&!t.editor.editable.inputManager.focused,!i.hasClass("disabled")&&!r&&(t.toolbar.wrapper.removeClass("menu-on"),o=i.data("param"),t.command(o),!1)}),this.wrapper.on("mousedown","a.menu-item",function(t){return!1}),this.action.state.on("changed",function(e,n){var i=n.data;void 0!==i.active&&t._doActive(i.active.value),void 0!==i.disabled&&t._doDisabled(i.disabled.value)})},_doActive:function(t){return this.el.toggleClass("active",this.active)},_doDisabled:function(t){return this.el.toggleClass("disabled",this.disabled)},iconClassOf:function(t){return t?"wordpad-icon wordpad-icon-"+t:""},setIcon:function(t){return this.el.find("span").removeClass().addClass(this.iconClassOf(t)).text(this.text)},render:function(){if(this.toolbar.addToolItem(this),this.wrapper=e(this._elm),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu)return this.menuWrapper=e(this.options.menu.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},renderMenu:function(){var n,i,r,o,a,s,l,u;if(t.isArray(this.menu)){for(this.menuEl=e("<ul/>").appendTo(this.menuWrapper),s=this.menu,u=[],r=0,o=s.length;r<o;r++)"|"!==(a=s[r])?(i=e(this.options.menu.menuItem).appendTo(this.menuEl),n=i.find("a.menu-item").attr({title:null!=(l=a.title)?l:a.text,"data-param":a.param}).addClass("menu-item-"+a.name),a.icon?u.push(n.find("span").addClass(this.iconClassOf(a.icon))):u.push(n.find("span").text(a.text))):e(this.options.menu.separator).appendTo(this.menuEl);return u}},command:function(t){this.action.execute(t)},name:{get:function(){return this.action.name}},icon:{get:function(){return this.action.icon}},title:{get:function(){return this.action.tooltip}},text:{get:function(){return this.action.text}},htmlTag:{get:function(){return this.action.htmlTag}},disableTag:{get:function(){return this.action.disableTag}},menu:{get:function(){return this.action.menu}},editable:{get:function(){return this._options.editable}},active:{get:function(){return this.action.active}},disabled:{get:function(){return this.action.disabled}},needFocus:{get:function(){return this.action.needFocus}},shortcut:{get:function(){return this.action.shortcut}}});return r}),define("skylark-widgets-wordpad/addons",[],function(){return{general:{},actions:{},toolbar:{items:{}}}}),define("skylark-widgets-wordpad/Toolbar",["skylark-langx/langx","skylark-domx-query","skylark-widgets-swt/Toolbar","./ToolButton","./addons"],function(t,e,n,i,r){var o=n.inherit({pluginName:"lark.Wordpad.toolbar",_construct:function(t,e){this.editor=t,n.prototype._construct.call(this,e)},_init:function(){n.prototype._init.call(this),this._render()}});return o.prototype._render=function(){var t,n,o,a;for(this.buttons=[],this.wrapper=e(this._elm).prependTo(this.editor.wrapper),a=this.opts.toolbar,t=0,n=a.length;t<n;t++)if("|"!==(o=a[t])){var s=this.editor.findAction(o),l=r.toolbar.items[o];l||(l=i),this.buttons.push(new l({action:s,toolbar:this}))}else this.addSeparator();if(this.opts.toolbarHidden)return this.wrapper.hide()},o.prototype.findButton=function(t){var e;return null!=(e=this.list.find(".toolbar-item-"+t).data("button"))?e:null},o.addButton=function(t){return this.buttons[t.prototype.name]=t},o.buttons={},o}),define("skylark-widgets-wordpad/uploader",["skylark-langx/langx","skylark-domx-query"],function(t,e){var n,i=t.Evented.inherit({init:function(){var n;return this.files=[],this.queue=[],this.id=++i.count,this.on("uploadcomplete",(n=this,function(e,i){return n.files.splice(t.inArray(i,n.files),1),n.queue.length>0&&n.files.length<n.opts.connectionCount?n.upload(n.queue.shift()):n.uploading=!1})),e(window).on("beforeunload.uploader-"+this.id,function(t){return function(e){if(t.uploading)return e.originalEvent.returnValue=t._t("leaveConfirm"),t._t("leaveConfirm")}}(this))}});return i.count=0,i.prototype.opts={url:"",params:null,fileKey:"upload_file",connectionCount:3},i.prototype.generateId=(n=0,function(){return n+=1}),i.prototype.upload=function(n,i){var r,o,a,s;if(null==i&&(i={}),null!=n){if(t.isArray(n)||n instanceof FileList)for(o=0,s=n.length;o<s;o++)r=n[o],this.upload(r,i);else e(n).is("input:file")?((a=e(n).attr("name"))&&(i.fileKey=a),this.upload(t.makeArray(e(n)[0].files),i)):n.id&&n.obj||(n=this.getFile(n));if(n&&n.obj)if(t.extend(n,i),this.files.length>=this.opts.connectionCount)this.queue.push(n);else if(!1!==this.trigger("beforeupload",[n]))return this.files.push(n),this._xhrUpload(n),this.uploading=!0}},i.prototype.getFile=function(t){var e,n,i;return t instanceof window.File||t instanceof window.Blob?(e=null!=(n=t.fileName)?n:t.name,{id:this.generateId(),url:this.opts.url,params:this.opts.params,fileKey:this.opts.fileKey,name:e,size:null!=(i=t.fileSize)?i:t.size,ext:e?e.split(".").pop().toLowerCase():"",obj:t}):null},i.prototype._xhrUpload=function(n){var i,r,o,a,s;if((i=new FormData).append(n.fileKey,n.obj),i.append("original_filename",n.name),n.params)for(r in o=n.params)a=o[r],i.append(r,a);return n.xhr=t.xhr({url:n.url,data:i,processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(n.name)},xhr:function(){var t,n;return(t=e.ajaxSettings.xhr())&&(t.upload.onprogress=(n=this,function(t){return n.progress(t)})),t},progress:(s=this,function(t){if(t.lengthComputable)return s.trigger("uploadprogress",[n,t.loaded,t.total])}),error:function(t){return function(e,i,r){return t.trigger("uploaderror",[n,e,i])}}(this),success:function(t){return function(i){return t.trigger("uploadprogress",[n,n.size,n.size]),t.trigger("uploadsuccess",[n,i]),e(document).trigger("uploadsuccess",[n,i,t])}}(this),complete:function(t){return function(e,i){return t.trigger("uploadcomplete",[n,e.responseText])}}(this)})},i.prototype.cancel=function(t){var e,n,i,r;if(!t.id)for(r=this.files,n=0,i=r.length;n<i;n++)if((e=r[n]).id===1*t){t=e;break}return this.trigger("uploadcancel",[t]),t.xhr&&t.xhr.abort(),t.xhr=null},i.prototype.readImageFile=function(e,n){var i,r;if(t.isFunction(n))return(r=new Image).onload=function(){return n(r)},r.onerror=function(){return n()},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(e.type)?((i=new FileReader).onload=function(t){return r.src=t.target.result},i.readAsDataURL(e)):n()},i.prototype.destroy=function(){var t,n,i,r;for(this.queue.length=0,r=this.files,n=0,i=r.length;n<i;n++)t=r[n],this.cancel(t);return e(window).off(".uploader-"+this.id),e(document).off(".uploader-"+this.id)},i.i18n={"zh-CN":{leaveConfirm:"正在上传文件，如果离开上传会自动取消"}},i.locale="zh-CN",function(t){return new i(t)}}),define("skylark-widgets-wordpad/Wordpad",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-query","skylark-domx-contents/Editable","skylark-widgets-base/Widget","./Toolbar","./uploader","./i18n","./addons"],function(t,e,n,i,r,o,a,s,l){var u=r.inherit({options:{srcNodeRef:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1,template:'<div class="wordpad">\n  <div class="wordpad-wrapper">\n    <div class="wordpad-placeholder"></div>\n    <div class="wordpad-body" contenteditable="true">\n    </div>\n  </div>\n</div>'},_init:function(){var t,e;if(this._actions=[],this.opts=this.options,this.textarea=n(this.opts.srcNodeRef),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("Wordpad: param textarea is required.");null!=(t=this.textarea.data("wordpad"))&&t.destroy(),this.id=++u.count,this._render();var r=this;if(this.editable=new i(this._elm,{classPrefix:"wordpad-",textarea:this.textarea,body:this.body}),this.editable.on("all",function(t,e){return r.trigger(t.type,e)}),this.opts.upload&&a&&(e="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=a(e)),this.toolbar=new o(this,{toolbar:this.opts.toolbar,toolbarFloat:this.opts.toolbarFloat,toolbarHidden:this.opts.toolbarHidden,toolbarFloatOffset:this.opts.toolbarFloatOffset}),this.opts.placeholder&&this.on("valuechanged",function(){return r._placeholder()}),this.setValue(this.textarea.val().trim()||""),this.textarea.attr("autofocus"))return r.focus()}});return u.prototype.triggerHandler=u.prototype.trigger=function(t,n){var i;return i=[t],n&&(i=i.concat(n)),e.Evented.prototype.trigger.apply(this,i),this},u.count=0,u.prototype._render=function(){var t,e,i,r;if(this.el=n(this._elm).insertBefore(this.textarea),this.wrapper=this.el.find(".wordpad-wrapper"),this.body=this.wrapper.find(".wordpad-body"),this.placeholderEl=this.wrapper.find(".wordpad-placeholder").append(this.opts.placeholder),this.el.data("wordpad",this),this.wrapper.append(this.textarea),this.textarea.data("wordpad",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.opts.params){for(t in e=this.opts.params,i=[],e)r=e[t],i.push(n("<input/>",{type:"hidden",name:t,value:r}).insertAfter(this.textarea));return i}},u.prototype._placeholder=function(){var t;return 0===(t=this.body.children()).length||1===t.length&&this.util.isEmptyNode(t)&&parseInt(t.css("margin-left")||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},u.prototype.setValue=function(t){return this.hidePopover(),this.editable.setValue(t),this.trigger("valuechanged")},u.prototype.getValue=function(){return this.editable.getValue()},u.prototype.focus=function(){return this.editable.focus()},u.prototype.blur=function(){return this.editable.blur()},u.prototype.findAction=function(t){if(!this._actions[t]){if(!this.constructor.addons.actions[t])throw new Error("Wordpad: invalid action "+t);this._actions[t]=new this.constructor.addons.actions[t]({editor:this})}return this._actions[t]},u.prototype.hidePopover=function(){return this.el.find(".wordpad-popover").each(function(t,e){if((e=n(e).data("popover")).active)return e.hide()})},u.prototype.destroy=function(){return this.trigger("destroy"),this.textarea.closest("form").off(".Wordpad .wordpad-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("wordpad"),this.el.remove(),n(document).off(".wordpad-"+this.id),n(window).off(".wordpad-"+this.id),this.off()},u.Toolbar=o,u.i18n=s,u.addons=l,t.attach("widgets.Wordpad",u)}),define("skylark-widgets-base/ActionManager",["skylark-langx/Evented","./base"],function(t,e){var n=t.inherit({klassName:"Manager",addAction:function(t,e,n,i){},executeAction:function(){},removeAction:function(t,e){}});return e.ActionManager=n}),define("skylark-widgets-base/Action",["skylark-langx/objects","skylark-langx/Evented","skylark-data-collection/HashMap","./base","./ActionManager"],function(t,e,n,i,r){var o=e.inherit({klassName:"Action",name:"",category:"",text:"",tooltip:"",icon:"",shortcut:"",state:{get:function(){return this._state||(this._state=new n({checked:!1,disabled:!1}))}},_construct:function(e){e&&t.mixin(this,e)},_init:function(){},execute:function(t){this._execute&&this._execute(t),this.trigger("executed",{params:t})}});return i.Action=o}),define("skylark-widgets-wordpad/Action",["skylark-langx/langx","skylark-widgets-base/Action","./Wordpad","./i18n"],function(t,e,n,i){var r=e.inherit({htmlTag:"",disableTag:"",menu:!1,active:{get:function(){return this.state.get("active")},set:function(t){return this.state.set("active",t)}},disabled:{get:function(){return this.state.get("disabled")},set:function(t){return this.state.set("disabled",t)}},needFocus:!0,_construct:function(n){e.prototype._construct.apply(this,arguments),this.title=i.translate(this.name);var r=this;this.editor.on("blur",function(){if(r.editor.body.is(":visible")&&r.editor.body.is("[contenteditable]")&&!r.editor.editable.clipboard.pasting)return r.setActive(!1),r.setDisabled(!1)}),null!=this.shortcut&&this.editor.editable.hotkeys.add(this.shortcut,function(t){return r.execute(),!1});var o=this.htmlTag.split(",");for(k=0,len=o.length;k<len;k++)tag=o[k],tag=t.trim(tag),tag&&t.inArray(tag,this.editor.editable.formatter._allowedTags)<0&&this.editor.editable.formatter._allowedTags.push(tag);this.editor.on("selectionchanged",function(t){if(r.editor.editable.inputManager.focused)return r._status()}),this._init()},_init:function(){},_disableStatus:function(){var t,e,n;return n=this.editor.editable.selection.startNodes(),e=this.editor.editable.selection.endNodes(),t=n.filter(this.disableTag).length>0||e.filter(this.disableTag).length>0,this.setDisabled(t),this.disabled&&this.setActive(!1),this.disabled},_activeStatus:function(){var t,e,n,i,r;return r=this.editor.editable.selection.startNodes(),n=this.editor.editable.selection.endNodes(),i=r.filter(this.htmlTag),e=n.filter(this.htmlTag),t=i.length>0&&e.length>0&&i.is(e),this.node=t?i:null,this.setActive(t),this.active},_status:function(){if(this._disableStatus(),!this.disabled)return this._activeStatus()},setActive:function(t){t!==this.active&&(this.active=t)},setDisabled:function(t){t!==this.disabled&&(this.disabled=t)}});return r.prototype._t=i.translate,r}),define("skylark-widgets-wordpad/Popover",["skylark-langx/langx","skylark-domx-query","./Wordpad","./i18n"],function(t,e,n,i){var r=t.Evented.inherit({init:function(t){this.action=t.action,this.editor=t.action.editor,this._init()}});return r.prototype.offset={top:4,left:0},r.prototype.target=null,r.prototype.active=!1,r.prototype._init=function(){var t;return this.el=e('<div class="wordpad-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",(t=this,function(e){return t.el.addClass("hover")})),this.el.on("mouseleave",function(t){return function(e){return t.el.removeClass("hover")}}(this))},r.prototype.render=function(){},r.prototype._initLabelWidth=function(){var t,n;if((t=this.el.find(".settings-field")).length>0)return this._labelWidth=0,t.each((n=this,function(t,i){var r,o;if(r=e(i),(o=r.find("label")).length>0)return n._labelWidth=Math.max(n._labelWidth,o.width())})),t.find("label").width(this._labelWidth)},r.prototype.show=function(t,n){if(null==n&&(n="bottom"),null!=t)return this.el.siblings(".wordpad-popover").each(function(t,n){if((n=e(n).data("popover")).active)return n.hide()}),this.active&&this.target&&this.target.removeClass("selected"),this.target=t.addClass("selected"),this.active?(this.refresh(n),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),this._labelWidth||this._initLabelWidth(),this.editor.editable.util.reflow(),this.refresh(n),this.trigger("popovershow"))},r.prototype.hide=function(){if(this.active)return this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")},r.prototype.refresh=function(t){var e,n,i,r,o,a;if(null==t&&(t="bottom"),this.active)return e=this.editor.el.offset(),o=this.target.offset(),r=this.target.outerHeight(),"bottom"===t?a=o.top-e.top+r:"top"===t&&(a=o.top-e.top-this.el.height()),i=this.editor.wrapper.width()-this.el.outerWidth()-10,n=Math.min(o.left-e.left,i),this.el.css({top:a+this.offset.top,left:n+this.offset.left})},r.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},r.prototype._t=function(t){var e;return e=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],i.translate.apply(i,e)},n.Popover=r,r}),define("skylark-widgets-wordpad/addons/actions/AlignmentAction",["skylark-domx-query","../../addons","../../Action","../../i18n"],function(t,e,n,i){var r=n.inherit({name:"alignment",icon:"align-left",htmlTag:"p, h1, h2, h3, h4, td, th",_init:function(){n.prototype._init.call(this),this.menu=[{name:"left",text:i.translate("alignLeft"),icon:"align-left",param:"left"},{name:"center",text:i.translate("alignCenter"),icon:"align-center",param:"center"},{name:"right",text:i.translate("alignRight"),icon:"align-right",param:"right"}]},_execute:function(t){return this.editor.editable.alignment(t,this.htmlTag)},setActive:function(t){null==t&&(t="left"),"left"!==t&&"center"!==t&&"right"!==t&&(t="left"),n.prototype.setActive.call(this,t)},_status:function(){var t=this.editor.editable.status("alignment",this.htmlTag);return t?(this.setDisabled(!1),this.setActive(t)):(this.setDisabled(!0),this.setActive("left"))}});return e.actions.alignment=r}),define("skylark-widgets-wordpad/addons/actions/BlockquoteAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"blockquote",icon:"quote-left",htmlTag:"blockquote",disableTag:"pre, table",_execute:function(){return this.editor.editable.blockquote(this.htmlTag,this.disableTag)}});return e.actions.blockquote=i,i}),define("skylark-widgets-wordpad/addons/actions/BoldAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"bold",icon:"bold",htmlTag:"b, strong",disableTag:"pre",shortcut:"cmd+b",_init:function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),n.prototype._init.call(this)},_activeStatus:function(){var t;return t=this.editor.editable.isActive("bold"),this.setActive(t),this.active},_execute:function(){return this.editor.editable.bold()}});return e.actions.bold=i,i}),define("skylark-widgets-wordpad/addons/actions/CodePopover",["skylark-domx-query","../../addons","../../Popover"],function(t,e,n){var i=n.inherit({render:function(){var e,n,i,r,o;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t("selectLanguage")+"</option>\n    </select>\n  </div>\n</div>",this.langs=this.editor.opts.codeLanguages||[{name:"Bash",value:"bash"},{name:"C++",value:"c++"},{name:"C#",value:"cs"},{name:"CSS",value:"css"},{name:"Erlang",value:"erlang"},{name:"Less",value:"less"},{name:"Sass",value:"sass"},{name:"Diff",value:"diff"},{name:"CoffeeScript",value:"coffeescript"},{name:"HTML,XML",value:"html"},{name:"JSON",value:"json"},{name:"Java",value:"java"},{name:"JavaScript",value:"js"},{name:"Markdown",value:"markdown"},{name:"Objective C",value:"oc"},{name:"PHP",value:"php"},{name:"Perl",value:"parl"},{name:"Python",value:"python"},{name:"Ruby",value:"ruby"},{name:"SQL",value:"sql"}],this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),r=this.langs,e=0,i=r.length;e<i;e++)n=r[e],t("<option/>",{text:n.name,value:n.value}).appendTo(this.selectEl);return this.selectEl.on("change",(o=this,function(t){var e;return o.lang=o.selectEl.val(),e=o.target.hasClass("selected"),o.target.removeClass().removeAttr("data-lang"),-1!==o.lang&&o.target.attr("data-lang",o.lang),e&&o.target.addClass("selected"),o.editor.trigger("valuechanged")})),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this))},show:function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.show.apply(this,t),this.lang=this.target.attr("data-lang"),null!=this.lang?this.selectEl.val(this.lang):this.selectEl.val(-1)}});return i}),define("skylark-widgets-wordpad/addons/actions/CodeAction",["skylark-domx-query","../../addons","../../Action","./CodePopover"],function(t,e,n,i){var r=n.inherit({name:"code",icon:"code",htmlTag:"pre",disableTag:"ul, ol, table",_init:function(){var e;return n.prototype._init.call(this),this.editor.on("decorate",(e=this,function(n,i){return i.find("pre").each(function(n,i){return e.decorate(t(i))})})),this.editor.on("undecorate",function(e){return function(n,i){return i.find("pre").each(function(n,i){return e.undecorate(t(i))})}}(this))},_checkMode:function(){var e;return e=this.editor.editable.selection.range(),t(e.cloneContents()).find(this.editor.editable.util.blockNodes.join(","))>0||e.collapsed&&0===this.editor.editable.selection.startNodes().filter("code").length?(this.inlineMode=!1,this.htmlTag="pre"):(this.inlineMode=!0,this.htmlTag="code")},_status:function(){if(this._checkMode(),n.prototype._status.call(this),!this.inlineMode)return this.active?(this.popover||(this.popover=new i({action:this})),this.popover.show(this.node)):this.popover?this.popover.hide():void 0},decorate:function(t){var e,n,i,r;if((e=t.find("> code")).length>0&&(n=null!=(i=e.attr("class"))&&null!=(r=i.match(/lang-(\S+)/))?r[1]:void 0,e.contents().unwrap(),n))return t.attr("data-lang",n)},undecorate:function(e){var n,i;return i=e.attr("data-lang"),n=t("<code/>"),i&&-1!==i&&n.addClass("lang-"+i),e.wrapInner(n).removeAttr("data-lang")},_execute:function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},_blockCommand:function(){return this.editor.editable.blockCode(this.htmlTag,this.disableTag)},_inlineCommand:function(){return this.editor.editable.inlineCode(this.active)}});return e.actions.code=r,r}),define("skylark-widgets-wordpad/addons/actions/ColorAction",["skylark-domx-query","../../addons","../../Action","../../i18n"],function(t,e,n,i){var r=n.inherit({name:"color",icon:"tint",disableTag:"pre",menu:!0});return e.actions.color=r,r}),define("skylark-widgets-wordpad/addons/actions/EmojiAction",["skylark-langx/langx","skylark-domx-query","../../addons","../../Action"],function(t,e,n,i){var r=i.inherit({name:"emoji",icon:"smile-o",menu:!0,_init:function(){i.prototype._init.apply(this),t.merge(this.editor.editable.formatter._allowedAttributes.img,["data-emoji","alt"])}});return n.actions.emoji=r,r}),define("skylark-widgets-wordpad/addons/actions/FontScaleAction",["skylark-domx-query","../../addons","../../Action","../../i18n"],function(t,e,n,i){var r=n.inherit({name:"fontScale",icon:"font",htmlTag:"span",disableTag:"pre, h1, h2, h3, h4, h5",_init:function(){return this.menu=[{name:"150%",text:i.translate("fontScaleXLarge"),param:"5"},{name:"125%",text:i.translate("fontScaleLarge"),param:"4"},{name:"100%",text:i.translate("fontScaleNormal"),param:"3"},{name:"75%",text:i.translate("fontScaleSmall"),param:"2"},{name:"50%",text:i.translate("fontScaleXSmall"),param:"1"}],n.prototype._init.call(this)},_activeStatus:function(){var t,e,n,i,r;return this.editor.editable.selection.range(),r=this.editor.editable.selection.startNodes(),n=this.editor.editable.selection.endNodes(),i=r.filter('span[style*="font-size"]'),e=n.filter('span[style*="font-size"]'),t=r.length>0&&n.length>0&&i.is(e),this.setActive(t),this.active},_execute:function(t){return this.editor.editable.fontScale(t)}});return e.actions.fontScale=r,r}),define("skylark-widgets-wordpad/addons/actions/FullScreenAction",["skylark-domx-query","../../addons","../../Action","../../i18n"],function(t,e,n,i){var r=n.inherit({name:"fullscreen",needFocus:!1,_init:function(){n.prototype._init.call(this),this.window=t(window),this.body=t("body"),this.editable=this.editor.body},iconClassOf:function(){return"icon-fullscreen"},status:function(){return this.setActive(this.body.hasClass(this.constructor.cls))},_execute:function(){var t,e,n;return this.body.toggleClass(this.constructor.cls),(e=this.body.hasClass(this.constructor.cls))?(t=this.editable.outerHeight()-this.editable.height(),this.window.on("resize.wordpad-fullscreen-"+this.editor.id,(n=this,function(){return n._resize({height:n.window.height()-n.editor.toolbar.outerHeight()-t})})).resize()):(this.window.off("resize.wordpad-fullscreen-"+this.editor.id).resize(),this._resize({height:"auto"})),this.setActive(e)},_resize:function(t){return this.editable.height(t.height)}});return r.cls="wordpad-fullscreen",r.i18n={"zh-CN":{fullscreen:"全屏"}},e.actions.fullscreen=r,r}),define("skylark-widgets-wordpad/addons/actions/HrAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"hr",icon:"minus",htmlTag:"hr",_status:function(){},_execute:function(){return this.editor.editable.hr()}});return e.actions.hr=i,i}),define("skylark-widgets-wordpad/addons/actions/HtmlAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"html",icon:"html5",needFocus:!1,_init:function(){var t;return n.prototype._init.call(this),this.editor.textarea.on("focus",(t=this,function(e){return t.editor.el.addClass("focus").removeClass("error")})),this.editor.textarea.on("blur",function(t){return function(e){return t.editor.el.removeClass("focus"),t.editor.setValue(t.editor.textarea.val())}}(this)),this.editor.textarea.on("input",function(t){return function(e){return t._resizeTextarea()}}(this))},status:function(){},_execute:function(){var t,e,n,i;for(this.editor.blur(),this.editor.el.toggleClass("wordpad-html"),this.editor.htmlMode=this.editor.el.hasClass("wordpad-html"),this.editor.htmlMode?(this.editor.hidePopover(),this.editor.textarea.val(this.beautifyHTML(this.editor.textarea.val())),this._resizeTextarea()):this.editor.setValue(this.editor.textarea.val()),i=this.editor._actions,e=0,n=i.length;e<n;e++)"html"===(t=i[e]).name?t.setActive(this.editor.htmlMode):t.setDisabled(this.editor.htmlMode);return null},beautifyHTML:function(){return arguments[0]},_resizeTextarea:function(){return this._textareaPadding||(this._textareaPadding=this.editor.textarea.innerHeight()-this.editor.textarea.height()),this.editor.textarea.height(this.editor.textarea[0].scrollHeight-this._textareaPadding)}});return e.actions.html=i,i}),define("skylark-widgets-wordpad/addons/actions/ImagePopover",["skylark-langx/langx","skylark-domx-query","../../addons","../../Popover"],function(t,e,n,i){var r=i.inherit({});return r.prototype.offset={top:6,left:-4},r.prototype.render=function(){var t,n;return t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;"\n      title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="wordpad-icon wordpad-icon-upload"></span>\n    </a>\n  </div>\n  <div class=\'settings-field\'>\n    <label>'+this._t("imageAlt")+'</label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;"\n      title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="wordpad-icon wordpad-icon-undo"></span>\n    </a>\n  </div>\n</div>',this.el.addClass("image-popover").append(t),this.srcEl=this.el.find(".image-src"),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.altEl=this.el.find("#image-alt"),this.srcEl.on("keydown",(n=this,function(t){var e;if(13===t.which&&!n.target.hasClass("uploading"))return t.preventDefault(),e=document.createRange(),n.Action.editor.editable.selection.setRangeAfter(n.target,e),n.hide()})),this.srcEl.on("blur",function(t){return function(e){return t._loadImage(t.srcEl.val())}}(this)),this.el.find(".image-size").on("blur",function(t){return function(n){return t._resizeImg(e(n.currentTarget)),t.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(t){return function(n){var i;if(i=e(n.currentTarget),13!==n.which&&27!==n.which&&9!==n.which)return t._resizeImg(i,!0)}}(this)),this.el.find(".image-size").on("keydown",function(t){return function(n){var i,r,o;return r=e(n.currentTarget),13===n.which||27===n.which?(n.preventDefault(),13===n.which?t._resizeImg(r):t._restoreImg(),i=t.target,t.hide(),o=document.createRange(),t.Action.editor.editable.selection.setRangeAfter(i,o)):9===n.which?t.el.data("popover").refresh():void 0}}(this)),this.altEl.on("keydown",function(t){return function(e){var n;if(13===e.which)return e.preventDefault(),n=document.createRange(),t.Action.editor.editable.selection.setRangeAfter(t.target,n),t.hide()}}(this)),this.altEl.on("keyup",function(t){return function(e){if(13!==e.which&&27!==e.which&&9!==e.which)return t.alt=t.altEl.val(),t.target.attr("alt",t.alt)}}(this)),this.el.find(".btn-restore").on("click",function(t){return function(e){return t._restoreImg(),t.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this)),this._initUploader()},r.prototype._initUploader=function(){var t,n,i;if(t=this.el.find(".btn-upload"),null!=this.editor.uploader)return i=this,(n=function(){return i.input&&i.input.remove(),i.input=e("<input/>",{type:"file",title:i._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(t)})(),this.el.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),this.el.on("change","input[type=file]",function(t){return function(e){return t.editor.uploader.upload(t.input,{inline:!0,img:t.target}),n()}}(this));t.remove()},r.prototype._resizeImg=function(e,n){var i,r,o;if(null==n&&(n=!1),r=1*e.val(),this.target&&(t.isNumber(r)||r<0))return e.is(this.widthEl)?(o=r,i=this.height*r/this.width,this.heightEl.val(i)):(i=r,o=this.width*r/this.height,this.widthEl.val(o)),n?void 0:(this.target.attr({width:o,height:i}),this.editor.trigger("valuechanged"))},r.prototype._restoreImg=function(){var t,e;return e=(null!=(t=this.target.data("image-size"))?t.split(","):void 0)||[this.width,this.height],this.target.attr({width:1*e[0],height:1*e[1]}),this.widthEl.val(e[0]),this.heightEl.val(e[1]),this.editor.trigger("valuechanged")},r.prototype._loadImage=function(t,e){var n;if(!/^data:image/.test(t)||this.editor.uploader){if(this.target.attr("src")!==t)return this.Action.loadImage(this.target,t,(n=this,function(i){var r;if(i)return n.active&&(n.width=i.width,n.height=i.height,n.widthEl.val(n.width),n.heightEl.val(n.height)),/^data:image/.test(t)?((r=n.editor.editable.util.dataURLtoBlob(t)).name="Base64 Image.png",n.editor.uploader.upload(r,{inline:!0,img:n.target})):n.editor.trigger("valuechanged"),e?e(i):void 0}))}else e&&e(!1)},r.prototype.show=function(){var t,e;return e=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],i.prototype.show.apply(this,e),t=this.target,this.width=t.width(),this.height=t.height(),this.alt=t.attr("alt"),t.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val(t.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},r}),define("skylark-widgets-wordpad/addons/actions/ImageAction",["skylark-langx/langx","skylark-domx-query","../../addons","../../Action","./ImagePopover","../../i18n"],function(t,e,n,i,r,o){var a=i.inherit({name:"image",icon:"picture-o",htmlTag:"img",disableTag:"pre, table",defaultImage:"",needFocus:!1,_init:function(){var t,n,a,s,l;if(this.editor.opts.imageAction)if(Array.isArray(this.editor.opts.imageAction))for(this.menu=[],s=this.editor.opts.imageAction,n=0,a=s.length;n<a;n++)t=s[n],this.menu.push({name:t+"-image",text:this._t(t+"Image")});else this.menu=!1;else null!=this.editor.uploader?this.menu=[{name:"upload-image",text:o.translate("uploadImage")},{name:"external-image",text:o.translate("externalImage")}]:this.menu=!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",(l=this,function(t){var n,i;return n=e(t.currentTarget),(i=document.createRange()).selectNode(n[0]),l.editor.editable.selection.range(i),l.editor.editable.util.support.onselectionchange||l.editor.trigger("selectionchanged"),!1})),this.editor.body.on("mouseup","img:not([data-non-image])",function(t){return!1}),this.editor.on("selectionchanged.image",function(t){return function(){var n,i,o;if(null!=(o=t.editor.editable.selection.range()))return 1===(n=e(o.cloneContents()).contents()).length&&n.is("img:not([data-non-image])")?(i=e(o.startContainer).contents().eq(o.startOffset),t.popover||(t.popover=new r({action:t})),t.popover.show(i)):t.popover?t.popover.hide():void 0}}(this)),this.editor.on("valuechanged.image",function(t){return function(){var n;if((n=t.editor.wrapper.find(".wordpad-image-loading")).length>0)return n.each(function(n,i){var r,o,a;if(o=e(i),!((r=o.data("img"))&&r.parent().length>0)&&(o.remove(),r&&(a=r.data("file"))&&(t.editor.uploader.cancel(a),t.editor.body.find("img.uploading").length<1)))return t.editor.uploader.trigger("uploadready",[a])})}}(this)),i.prototype._init.call(this)},render:function(){var t;if(t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],i.prototype.render.apply(this,t),this.popover=new r({Action:this}),"upload"===this.editor.opts.imageAction)return this._initUploader(this.el)},renderMenu:function(){return i.prototype.renderMenu.call(this),this._initUploader()},_initUploader:function(n){var i,r,o,a;if(null==n&&(n=this.menuEl.find(".menu-item-upload-image")),null!=this.editor.uploader)return i=null,a=this,(r=function(){return i&&i.remove(),i=e("<input/>",{type:"file",title:a._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(n)})(),n.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),n.on("change","input[type=file]",function(t){return function(e){return t.editor.editable.inputManager.focused?(t.editor.uploader.upload(i,{inline:!0}),r()):(t.editor.one("focus",function(e){return t.editor.uploader.upload(i,{inline:!0}),r()}),t.editor.focus()),t.wrapper.removeClass("menu-on")}}(this)),this.editor.uploader.on("beforeupload",function(t){return function(n,i){var r;if(i.inline)return i.img?r=e(i.img):(r=t.createImage(i.name),i.img=r),r.addClass("uploading"),r.data("file",i),t.editor.uploader.readImageFile(i.obj,function(e){var n;if(r.hasClass("uploading"))return n=e?e.src:t.defaultImage,t.loadImage(r,n,function(){if(t.popover.active)return t.popover.refresh(),t.popover.srcEl.val(t._t("uploading")).prop("disabled",!0)})})}}(this)),o=t.proxy(this.editor.editable.util.throttle(function(t,e,n,i){var r,o,a;if(e.inline&&(o=e.img.data("mask"))){if((r=o.data("img")).hasClass("uploading")&&r.parent().length>0)return(a=(100*(a=n/i)).toFixed(0))>99&&(a=99),o.find(".progress").height(100-a+"%");o.remove()}},500),this),this.editor.uploader.on("uploadprogress",o),this.editor.uploader.on("uploadsuccess",function(t){return function(e,n,i){var r,o,a;if(n.inline&&(r=n.img).hasClass("uploading")&&r.parent().length>0){if("object"!=typeof i)try{i=JSON.parse(i)}catch(t){t,i={success:!1}}return!1===i.success?(a=i.msg||t._t("uploadFailed"),alert(a),o=t.defaultImage):o=i.file_path,t.loadImage(r,o,function(){var e;if(r.removeData("file"),r.removeClass("uploading").removeClass("loading"),(e=r.data("mask"))&&e.remove(),r.removeData("mask"),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1)return t.editor.uploader.trigger("uploadready",[n,i])}),t.popover.active?(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(i.file_path)):void 0}}}(this)),this.editor.uploader.on("uploaderror",function(t){return function(e,n,i){var r,o;if(n.inline&&"abort"!==i.statusText){if(i.responseText)try{o=JSON.parse(i.responseText),o.msg}catch(e){e,t._t("uploadError")}if((r=n.img).hasClass("uploading")&&r.parent().length>0)return t.loadImage(r,t.defaultImage,function(){var t;return r.removeData("file"),r.removeClass("uploading").removeClass("loading"),(t=r.data("mask"))&&t.remove(),r.removeData("mask")}),t.popover.active&&(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(t.defaultImage)),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[n,o]):void 0}}}(this));this.el.find(".btn-upload").remove()},_status:function(){return this._disableStatus()},loadImage:function(n,i,r){var o,a,s,l;return l=this,s=function(){var t,e;return t=n.offset(),e=l.editor.wrapper.offset(),o.css({top:t.top-e.top,left:t.left-e.left,width:n.width(),height:n.height()}).show()},n.addClass("loading"),(o=n.data("mask"))||(o=e('<div class="wordpad-image-loading">\n  <div class="progress"></div>\n</div>').hide().appendTo(this.editor.wrapper),s(),n.data("mask",o),o.data("img",n)),(a=new Image).onload=function(e){return function(){var l,u;if(n.hasClass("loading")||n.hasClass("uploading"))return u=a.width,l=a.height,n.attr({src:i,width:u,height:l,"data-image-size":u+","+l}).removeClass("loading"),n.hasClass("uploading")?(e.editor.editable.util.reflow(e.editor.body),s()):(o.remove(),n.removeData("mask")),t.isFunction(r)?r(a):void 0}}(this),a.onerror=function(){return t.isFunction(r)&&r(!1),o.remove(),n.removeData("mask").removeClass("loading")},a.src=i},createImage:function(t){var n,i;return null==t&&(t="Image"),this.editor.editable.inputManager.focused||this.editor.focus(),(i=this.editor.editable.selection.range()).deleteContents(),this.editor.editable.selection.range(i),n=e("<img/>").attr("alt",t),i.insertNode(n[0]),this.editor.editable.selection.setRangeAfter(n,i),this.editor.trigger("valuechanged"),n},_execute:function(t){var e,n;return e=this.createImage(),this.loadImage(e,t||this.defaultImage,(n=this,function(){return n.editor.trigger("valuechanged"),n.editor.editable.util.reflow(e),e.click(),n.popover.one("popovershow",function(){return n.popover.srcEl.focus(),n.popover.srcEl[0].select()})}))}});return n.actions.image=a,a}),define("skylark-widgets-wordpad/addons/actions/IndentAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"indent",icon:"indent",_init:function(){var t;return t=!1===this.editor.opts.tabIndent?"":" (Tab)",this.title=this._t(this.name)+t,n.prototype._init.call(this)},_execute:function(){return this.editor.editable.indent()}});return e.actions.indent=i,i}),define("skylark-widgets-wordpad/addons/actions/ItalicAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"italic",icon:"italic",htmlTag:"i",disableTag:"pre",shortcut:"cmd+i",_init:function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),n.prototype._init.call(this)},_activeStatus:function(){var t;return t=this.editor.editable.isActive("italic"),this.setActive(t),this.active},_execute:function(){return this.editor.editable.italic()}});return e.actions.italic=i,i}),define("skylark-widgets-wordpad/addons/actions/LinkPopover",["skylark-domx-query","../../addons","../../Popover"],function(t,e,n){var i=n.inherit({render:function(){var e,n;return e='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("linkText")+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'"\n      tabindex="-1">\n      <span class="wordpad-icon wordpad-icon-unlink"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkTarget")+'</label>\n    <select class="link-target">\n      <option value="_blank">'+this._t("openLinkInNewWindow")+' (_blank)</option>\n      <option value="_self">'+this._t("openLinkInCurrentWindow")+" (_self)</option>\n    </select>\n  </div>\n</div>",this.el.addClass("link-popover").append(e),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.selectTarget=this.el.find(".link-target"),this.textEl.on("keyup",(n=this,function(t){if(13!==t.which)return n.target.text(n.textEl.val()),n.editor.editable.inputManager.throttledValueChanged()})),this.urlEl.on("keyup",function(t){return function(e){var n;if(13!==e.which)return n=t.urlEl.val(),!/^(http|https|ftp|ftps|file)?:\/\/|^(mailto|tel)?:|^\//gi.test(n)&&n&&(n="http://"+n),t.target.attr("href",n),t.editor.editable.inputManager.throttledValueChanged()}}(this)),t([this.urlEl[0],this.textEl[0]]).on("keydown",function(e){return function(n){var i;if(13===n.which||27===n.which||!n.shiftKey&&9===n.which&&t(n.target).hasClass("link-url"))return n.preventDefault(),i=document.createRange(),e.editor.editable.selection.setRangeAfter(e.target,i),e.hide(),e.editor.editable.inputManager.throttledValueChanged()}}(this)),this.unlinkEl.on("click",function(t){return function(e){var n,i;return i=document.createTextNode(t.target.text()),t.target.replaceWith(i),t.hide(),n=document.createRange(),t.editor.editable.selection.setRangeAfter(i,n),t.editor.editable.inputManager.throttledValueChanged()}}(this)),this.selectTarget.on("change",function(t){return function(e){return t.target.attr("target",t.selectTarget.val()),t.editor.editable.inputManager.throttledValueChanged()}}(this))},show:function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.show.apply(this,t),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))}});return i}),define("skylark-widgets-wordpad/addons/actions/LinkAction",["skylark-domx-query","../../addons","../../Action","../../i18n","./LinkPopover"],function(t,e,n,i,r){var o=n.inherit({name:"link",icon:"link",htmlTag:"a",disableTag:"pre",_status:function(){return n.prototype._status.call(this),this.active&&!this.editor.editable.selection.rangeAtEndOf(this.node)?(this.popover||(this.popover=new r({action:this})),this.popover.show(this.node)):this.popover?this.popover.hide():void 0},_execute:function(){var t;return this.active&&this.popover.one("popovershow",(t=this,function(){return linkText?(t.popover.urlEl.focus(),t.popover.urlEl[0].select()):(t.popover.textEl.focus(),t.popover.textEl[0].select())})),this.editor.editable.link(this.active,i.translate("linkText"))}});return e.actions.link=o,o}),define("skylark-widgets-wordpad/addons/actions/ListAction",["skylark-domx-noder","skylark-domx-query","../../addons","../../Action"],function(t,e,n,i){var r=i.inherit({type:"",disableTag:"pre, table",_execute:function(t){return this.editor.editable.list(this.type,t,this.disableTag)}});return r}),define("skylark-widgets-wordpad/addons/actions/MarkAction",["skylark-domx-query","../../addons","../../Action","../../i18n"],function(t,e,n,i){var r=n.inherit({name:"mark",icon:"mark",htmlTag:"mark",disableTag:"pre, table",_execute:function(){var e,n,i;return i=this.editor.editable.selection.range(),this.active?(this.editor.editable.selection.save(),this.unmark(i),this.editor.editable.selection.restore(),void this.editor.trigger("valuechanged")):i.collapsed?void 0:(this.editor.editable.selection.save(),n=t(i.startContainer),e=t(i.endContainer),n.closest("mark").length&&i.setStartBefore(n.closest("mark")[0]),e.closest("mark").length&&i.setEndAfter(e.closest("mark")[0]),this.mark(i),this.editor.editable.selection.restore(),this.editor.trigger("valuechanged"),this.editor.editable.util.support.onselectionchange?this.editor.trigger("selectionchanged"):void 0)},mark:function(e){var n,i;return null==e&&(e=this.editor.editable.selection.range()),(n=t(e.extractContents())).find("mark").each(function(e,n){return t(n).replaceWith(t(n).html())}),i=t("<mark>").append(n),e.insertNode(i[0])},unmark:function(e){var n;return null==e&&(e=this.editor.editable.selection.range()),e.collapsed?(n=t(e.commonAncestorContainer)).is("mark")||(n=n.parent()):t(e.startContainer).closest("mark").length?n=t(e.startContainer).closest("mark"):t(e.endContainer).closest("mark").length&&(n=t(e.endContainer).closest("mark")),n.replaceWith(n.html())}});return e.actions.mark=r,r}),define("skylark-widgets-wordpad/addons/actions/OrderListAction",["skylark-domx-query","../../addons","./ListAction"],function(t,e,n){var i=n.inherit({type:"ol",name:"ol",icon:"list-ol",htmlTag:"ol",shortcut:"cmd+/",_init:function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),n.prototype._init.call(this)}});return e.actions.ol=i}),define("skylark-widgets-wordpad/addons/actions/OutdentAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"outdent",icon:"outdent",_init:function(){var t;return t=!1===this.editor.opts.tabIndent?"":" (Shift + Tab)",this.title=this._t(this.name)+t,n.prototype._init.call(this)},_status:function(){},_execute:function(){return this.editor.editable.outdent()}});return e.actions.outdent=i,i}),define("skylark-widgets-wordpad/addons/actions/StrikethroughAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"strikethrough",icon:"strikethrough",htmlTag:"strike",disableTag:"pre",_activeStatus:function(){var t;return t=this.editor.editable.isActive("strikethrough"),this.setActive(t),this.active},_execute:function(){return this.editor.editable.strikethrough()}});return e.actions.strikethrough=i}),define("skylark-domx-tables/tables",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-query","skylark-domx-styler","skylark-domx-eventer","skylark-domx-fx","skylark-domx-data","skylark-domx-finder","skylark-domx-geom"],function(t,e,n){function i(){return i}function r(t,e){return t.find("td, th").each(function(t,i){var r;return(r=n(i)).replaceWith("<"+e+">"+r.html()+"</"+e+">")})}function o(t,e){var i,r,o=n(t);r=o.closest(".simditor-table"),i=r.next("p"),r.remove(),e&&e(i)}function a(t){return setTimeout(function(){var e,i;return i=t.width(),e=t.find("col"),t.find("thead tr th").each(function(t,r){return e.eq(t).attr("width",n(r).outerWidth()/i*100+"%")})},0)}function s(t){var e=n(t);if(e.parent(".simditor-table").length>0)return e.parent().replaceWith(e)[0]}return e.mixin(i,{createTable:function(t,e,i){var r,o,a,s,l,u,d,c,h,f;for(r=n("<table/>"),s=n("<thead/>").appendTo(r),o=n("<tbody/>").appendTo(r),c=u=0,h=t;0<=h?u<h:u>h;c=0<=h?++u:--u)for((l=n("<tr/>")).appendTo(0===c?s:o),d=0,f=e;0<=f?d<f:d>f;0<=f?++d:--d)a=n(0===c?"<th/>":"<td/>").appendTo(l),i&&a.append(i);return r[0]},decorate:function(t,e){var i,o,l,u,d,c=n(t);c.parent("."+e.tableDecorate).length>0&&s(t);c.wrap('<div class="'+e.tableDecorate+'"></div>'),d=c.parent("."+e.tableDecorate),i=c.find("colgroup"),c.find("thead").length<1&&(u=n("<thead />"),o=c.find("tr").first(),u.append(o),r(o,"th"),(l=c.find("tbody")).length>0?l.before(u):c.prepend(u));i.length<1&&(i=n("<colgroup/>").prependTo(c),c.find("thead tr th").each(function(t,e){return n("<col/>").appendTo(i)}),a(c));return n("<div />",{class:e.resizeHandle,contenteditable:"false"}).appendTo(d),c.parent()},deleteCol:function(t,e){var i,r,s,l,u,d,c=n(t);if(s=c.parent("tr"),d=s.closest("table").find("tr").length<2,u=c.siblings("td, th").length<1,d&&u)return o(t);l=s.find("td, th").index(c),(i=c.next("td, th")).length>0||(i=s.prev("td, th")),(r=s.closest("table")).find("col").eq(l).remove(),r.find("tr").each(function(t,e){return n(e).find("td, th").eq(l).remove()}),a(r),e&&e(i[0])},deleteRow:function(t,e){var i,a,s,l=n(t);if((a=l.parent("tr")).closest("table").find("tr").length<1)return o(t);(i=function(t){var e;(e=t.next("tr")).length<1&&t.parent("thead").length>0&&(e=t.parent("thead").next("tbody").find("tr:first"));return e}(a)).length>0||(i=function(t){var e;(e=t.prev("tr")).length<1&&t.parent("tbody").length>0&&(e=t.parent("tbody").prev("thead").find("tr"));return e}(a)),s=a.find("td, th").index(l),a.parent().is("thead")&&(i.appendTo(a.parent()),r(i,"th")),a.remove(),e&&e(i[0],s)},deleteTable:o,insertCol:function(t,e,i,r){var o,s,l,u,d,c,h,f,p=n(t);null==e&&(e="after");d=p.parent("tr"),c=d.find("td, th").index(p),u=p.closest("table"),o=u.find("col").eq(c),u.find("tr").each(function(t,r){var o,a;return a=n(r).parent().is("thead")?"th":"td",o=n("<"+a+"/>").append(i),n(r).find("td, th").eq(c)[e](o)}),s=n("<col/>"),o[e](s),h=u.width(),f=Math.max(parseFloat(o.attr("width"))/2,50/h*100),o.attr("width",f+"%"),s.attr("width",f+"%"),a(u),l="after"===e?p.next("td, th"):p.prev("td, th"),r&&r(l[0])},insertRow:function(t,e,i,o){var a,s,l,u,d,c,h,f,p=n(t);null==e&&(e="after");l=p.parent("tr"),s=l.closest("table"),d=0,s.find("tr").each(function(t,e){return d=Math.max(d,n(e).find("td").length)}),c=l.find("td, th").index(p),a=n("<tr/>"),u="td","after"===e&&l.parent().is("thead")?l.parent().next("tbody").prepend(a):"before"===e&&l.parent().is("thead")?(l.before(a),l.parent().next("tbody").prepend(l),r(l,"td"),u="th"):l[e](a);for(h=1,f=d;1<=f?h<=f:h>=f;1<=f?++h:--h)n("<"+u+"/>").append(i).appendTo(a);o&&o(a[0],c)},refreshTableWidth:a,resizable:function(t,e){var i=e.cssClasses,r=i.resizeHandle,o="."+i.wrapper,a="."+r;return n(t).on("mousemove.table",o+" td, "+o+" th",function(t){var e,i,r,s,l,u,d,c;if(r=(l=n(this).parents(o)).find(a),i=l.find("colgroup"),!l.hasClass("resizing"))if(s=n(t.currentTarget),t.pageX-n(t.currentTarget).offset().left<5&&s.prev().length>0&&(s=s.prev()),s.next("td, th").length<1)r.hide();else if(null!=(d=r.data("td"))&&d.is(s))r.show();else{if(u=s.parent().find("td, th").index(s),e=i.find("col").eq(u),null==(c=r.data("col"))||!c.is(e))return r.css("left",s.position().left+s.outerWidth()-5).data("td",s).data("col",e).show();r.show()}}),n(t).on("mouseleave"+o,o,function(t){return n(this).find(a).hide()}),n(t).on("mousedown"+a,a,function(e){var i,r,a,s,l,u,d,c,h,f,p;return u=n(this).parent(o),a=(i=n(e.currentTarget)).data("td"),r=i.data("col"),l=a.next("td, th"),s=r.next("col"),f=e.pageX,c=1*a.outerWidth(),h=1*l.outerWidth(),d=parseFloat(i.css("left")),p=a.closest(o).width(),n(t).on("mousemove.resize-table",function(t){var e,n,o;return e=t.pageX-f,o=h-e,(n=c+e)<50?(n=50,o=h-(e=50-c)):o<50&&(o=50,n=c+(e=h-50)),r.attr("width",n/p*100+"%"),s.attr("width",o/p*100+"%"),i.css("left",d+e)}),n(t).one("mouseup.resize-table",function(e){return n(t).off(".resize-table"),u.removeClass("resizing")}),u.addClass("resizing"),!1})},undecorate:s}),t.attach("domx.tables",i)}),define("skylark-domx-tables/main",["./tables"],function(t){return t}),define("skylark-domx-tables",["skylark-domx-tables/main"],function(t){return t}),define("skylark-widgets-wordpad/addons/actions/TableAction",["skylark-langx/langx","skylark-domx-tables","skylark-domx-query","../../addons","../../Action"],function(t,e,n,i,r){var o=r.inherit({name:"table",icon:"table",htmlTag:"table",disableTag:"pre, li, blockquote",menu:!0,_init:function(){var e;return r.prototype._init.call(this),t.merge(this.editor.editable.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),t.extend(this.editor.editable.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),t.extend(this.editor.editable.formatter._allowedStyles,{td:["text-align"],th:["text-align"]}),this._initShortcuts(),this._initResize(),this.editor.on("decorate",(e=this,function(t,i){return i.find("table").each(function(t,i){return e.decorate(n(i))})})),this.editor.on("undecorate",function(t){return function(e,i){return i.find("table").each(function(e,i){return t.undecorate(n(i))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(e){var n,i;if(t.editor.body.find(".wordpad-table td, .wordpad-table th").removeClass("active"),i=t.editor.editable.selection.range())return n=t.editor.editable.selection.containerNode(),i.collapsed&&n.is(".wordpad-table")&&t.editor.editable.selection.setRangeAtEndOf(n),n.closest("td, th",t.editor.body).addClass("active")}}(this)),this.editor.on("blur.table",function(t){return function(e){return t.editor.body.find(".wordpad-table td, .wordpad-table th").removeClass("active")}}(this)),this.editor.editable.keystroke.add("up","td",function(t){return function(e,n){return t._tdNav(n,"up"),!0}}(this)),this.editor.editable.keystroke.add("up","th",function(t){return function(e,n){return t._tdNav(n,"up"),!0}}(this)),this.editor.editable.keystroke.add("down","td",function(t){return function(e,n){return t._tdNav(n,"down"),!0}}(this)),this.editor.editable.keystroke.add("down","th",function(t){return function(e,n){return t._tdNav(n,"down"),!0}}(this))},_tdNav:function(t,e){var n,i,r,o,a;return null==e&&(e="up"),r="up"===e?"prev":"next",(a="up"===e?["tbody","thead"]:["thead","tbody"])[0],a[1],i=t.parent("tr"),!((n=this["_"+r+"Row"](i)).length>0)||(o=i.find("td, th").index(t),this.editor.editable.selection.setRangeAtEndOf(n.find("td, th").eq(o)))},_initResize:function(){e.resizable(document,{cssClasses:{resizeHandle:"wordpad-resize-handle",wrapper:"wordpad-table"}})},_initShortcuts:function(){var t;return this.editor.editable.hotkeys.add("ctrl+alt+up",(t=this,function(e){return t.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1})),this.editor.editable.hotkeys.add("ctrl+alt+down",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.editable.hotkeys.add("ctrl+alt+left",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.editable.hotkeys.add("ctrl+alt+right",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},renderMenu:function(){var t,e;return n('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),t=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",(e=this,function(i){var r,o,a,s;return e.createMenu.find("td, th").removeClass("selected"),r=n(i.currentTarget),o=r.parent(),s=o.find("td, th").index(r)+1,a=o.prevAll("tr").addBack(),o.parent().is("tbody")&&(a=a.add(t.find("thead tr"))),a.find("td:lt("+s+"), th:lt("+s+")").addClass("selected")})),this.createMenu.on("mouseleave",function(t){return n(t.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(e){return function(i){var r,o,a,s,l;if(e.wrapper.removeClass("menu-on"),e.editor.editable.inputManager.focused)return o=n(i.currentTarget),a=o.parent(),s=a.find("td").index(o)+1,l=a.prevAll("tr").length+1,a.parent().is("tbody")&&(l+=1),t=e.createTable(l,s,!0),r=e.editor.editable.selection.blockNodes().last(),e.editor.editable.util.isEmptyNode(r)?r.replaceWith(t):r.after(t),e.decorate(t),e.editor.editable.selection.setRangeAtStartOf(t.find("th:first")),e.editor.trigger("valuechanged"),!1}}(this))},decorate:function(t){return n(e.decorate(t[0],{tableDecorate:"wordpad-table",resizeHandle:"wordpad-resize-handle"}))},undecorate:function(t){return n(e.undecorate(t[0],{tableDecorate:"wordpad-table",resizeHandle:"wordpad-resize-handle"}))},createTable:function(t,i,r){return n(e.createTable(t,i,r?this.editor.editable.util.phBr:null))},refreshTableWidth:function(t){return table.refreshTableWidth(t[0])},deleteRow:function(t){var i,r=this;return e.deleteRow(t[0],function(t,e){t&&(i=r.editor.editable.selection.setRangeAtEndOf(n(t).find("td, th").eq(e)))}),i},insertRow:function(t,i){var r,o=this;return e.insertRow(t[0],i,o.editor.editable.util.phBr,function(t,e){r=o.editor.editable.selection.setRangeAtStartOf(n(t).find("td, th").eq(e))}),r},deleteCol:function(t){var i,r=this;return e.deleteCol(t[0],function(t){t&&(i=r.editor.editable.selection.setRangeAtEndOf(n(t)))}),i},insertCol:function(t,i){var r,o=this;return e.insertCol(t[0],i,o.editor.editable.util.phBr,function(t){r=o.editor.editable.selection.setRangeAtStartOf(n(t))}),r},deleteTable:function(t){var n=this;e.deleteTable(t[0],function(t){if(t.length>0)return n.editor.editable.selection.setRangeAtStartOf(t)})},_execute:function(t){var e;if((e=this.editor.editable.selection.containerNode().closest("td, th")).length>0){if("deleteRow"===t)this.deleteRow(e);else if("insertRowAbove"===t)this.insertRow(e,"before");else if("insertRowBelow"===t)this.insertRow(e);else if("deleteCol"===t)this.deleteCol(e);else if("insertColLeft"===t)this.insertCol(e,"before");else if("insertColRight"===t)this.insertCol(e);else{if("deleteTable"!==t)return;this.deleteTable(e)}return this.editor.trigger("valuechanged")}}});return i.actions.table=o,o}),define("skylark-widgets-wordpad/addons/actions/TitleAction",["skylark-domx-query","../../addons","../../Action","../../i18n"],function(t,e,n,i){var r=n.inherit({name:"title",htmlTag:"h1, h2, h3, h4, h5",disableTag:"pre, table",_init:function(){return this.menu=[{name:"normal",text:i.translate("normalText"),param:"p"},"|",{name:"h1",text:i.translate("title")+" 1",param:"h1"},{name:"h2",text:i.translate("title")+" 2",param:"h2"},{name:"h3",text:i.translate("title")+" 3",param:"h3"},{name:"h4",text:i.translate("title")+" 4",param:"h4"},{name:"h5",text:i.translate("title")+" 5",param:"h5"}],n.prototype._init.call(this)},setActive:function(t,e){t&&(t=this.node[0].tagName.toLowerCase()),n.prototype.setActive.call(this,t)},_execute:function(t){return this.editor.editable.title(t,this.disableTag)}});return e.actions.title=r,r}),define("skylark-widgets-wordpad/addons/actions/UnderlineAction",["skylark-domx-query","../../addons","../../Action"],function(t,e,n){var i=n.inherit({name:"underline",icon:"underline",htmlTag:"u",disableTag:"pre",shortcut:"cmd+u",render:function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),n.prototype.render.call(this)},_activeStatus:function(){var t;return t=this.editor.editable.isActive("underline"),this.setActive(t),this.active},_execute:function(){return this.editor.editable.underline()}});return e.actions.underline=i,i}),define("skylark-widgets-wordpad/addons/actions/UnorderListAction",["skylark-domx-query","../../addons","./ListAction"],function(t,e,n){var i=n.inherit({type:"ul",name:"ul",icon:"list-ul",htmlTag:"ul",shortcut:"cmd+.",_init:function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),n.prototype._init.call(this)}});return e.actions.ul=i,i}),define("skylark-widgets-wordpad/addons/toolbar/items/AlignmentButton",["skylark-domx-query","../../../ToolButton","../../../i18n","../../../addons"],function(t,e,n,i){var r=e.inherit({_doActive:function(t){return e.prototype._doActive.call(this,!!t),this.el.removeClass("align-left align-center align-right"),t&&this.el.addClass("align-"+t),this.setIcon("align-"+t),this.menuEl.find(".menu-item").show().end().find(".menu-item-"+t).hide()}});return i.toolbar.items.alignment=r,r}),define("skylark-widgets-wordpad/addons/toolbar/items/ColorButton",["skylark-domx-query","../../../ToolButton","../../../i18n","../../../addons"],function(t,e,n,i){var r=e.inherit({render:function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],e.prototype.render.apply(this,t)},renderMenu:function(){return t('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default"></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(t){return!1}),this.menuWrapper.on("click",".font-color",(e=this,function(i){var r,o,a,s;if(e.wrapper.removeClass("menu-on"),(r=t(i.currentTarget)).hasClass("font-color-default")){if(!((o=e.editor.body.find("p, li")).length>0))return;s=window.getComputedStyle(o[0],null).getPropertyValue("color"),a=e._convertRgbToHex(s)}else s=window.getComputedStyle(r[0],null).getPropertyValue("background-color"),a=e._convertRgbToHex(s);if(a)return e.editor.editable.fontColor(a,r.hasClass("font-color-default"),n.translate("coloredText"))}));var e},_convertRgbToHex:function(t){var e;return(e=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g.exec(t))?function(t,e,n){var i;return"#"+(i=function(t){var e;return 1===(e=t.toString(16)).length?"0"+e:e})(t)+i(e)+i(n)}(1*e[1],1*e[2],1*e[3]):""}});return i.toolbar.items.color=r,r}),define("skylark-widgets-wordpad/addons/toolbar/items/EmojiButton",["skylark-langx/langx","skylark-domx-query","../../../ToolButton","../../../i18n","../../../addons"],function(t,e,n,i,r){var o=n.inherit({renderMenu:function(){var n,i,r,a,s,l,u,d,c,h,f;for(u='<ul class="emoji-list">\n</ul>',s=t.extend({imagePath:"images/emoji/",images:o.images},this.editor.opts.emoji||{}),r="",i=s.imagePath.replace(/\/$/,"")+"/",h=s.images,d=0,c=h.length;d<c;d++)a=h[d],l=""+i+a,a=a.split(".")[0],r+="<li data-name='"+a+"'><img src='"+l+"' width='20' height='20' alt='"+a+"' /></li>";return(n=e(u)).html(r).appendTo(this.menuWrapper),n.on("mousedown","li",(f=this,function(t){var n;if(f.wrapper.removeClass("menu-on"),f.editor.editable.inputManager.focused)return n=e(t.currentTarget).find("img").clone().attr({"data-emoji":!0,"data-non-image":!0}),f.editor.editable.selection.insertNode(n),f.editor.trigger("valuechanged"),f.editor.trigger("selectionchanged"),!1}))}});return o.i18n={"zh-CN":{emoji:"表情"},"en-US":{emoji:"emoji"}},o.images=["smile.png","smiley.png","laughing.png","blush.png","heart_eyes.png","smirk.png","flushed.png","grin.png","wink.png","kissing_closed_eyes.png","stuck_out_tongue_winking_eye.png","stuck_out_tongue.png","sleeping.png","worried.png","expressionless.png","sweat_smile.png","cold_sweat.png","joy.png","sob.png","angry.png","mask.png","scream.png","sunglasses.png","heart.png","broken_heart.png","star.png","anger.png","exclamation.png","question.png","zzz.png","thumbsup.png","thumbsdown.png","ok_hand.png","punch.png","v.png","clap.png","muscle.png","pray.png","skull.png","trollface.png"],r.toolbar.items.emoji=o,o}),define("skylark-widgets-wordpad/addons/toolbar/items/TableButton",["skylark-langx/langx","skylark-domx-query","../../../ToolButton","../../../i18n","../../../addons"],function(t,e,n,i,r){var o=n.inherit({_doActive:function(t){return n.prototype._doActive.call(this,t),t?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())}});return o.prototype.renderMenu=function(){var t,n;return e('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+i.translate("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+i.translate("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+i.translate("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+i.translate("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+i.translate("insertColumnLeft")+' ( Ctrl + Alt + ← )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+i.translate("insertColumnRight")+' ( Ctrl + Alt + → )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+i.translate("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),t=this.action.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",(n=this,function(i){var r,o,a,s;return n.createMenu.find("td, th").removeClass("selected"),r=e(i.currentTarget),o=r.parent(),s=o.find("td, th").index(r)+1,a=o.prevAll("tr").addBack(),o.parent().is("tbody")&&(a=a.add(t.find("thead tr"))),a.find("td:lt("+s+"), th:lt("+s+")").addClass("selected")})),this.createMenu.on("mouseleave",function(t){return e(t.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(n){return function(i){var r,o,a,s,l;if(n.wrapper.removeClass("menu-on"),n.editor.editable.inputManager.focused)return o=e(i.currentTarget),a=o.parent(),s=a.find("td").index(o)+1,l=a.prevAll("tr").length+1,a.parent().is("tbody")&&(l+=1),t=n.action.createTable(l,s,!0),r=n.editor.editable.selection.blockNodes().last(),n.editor.editable.util.isEmptyNode(r)?r.replaceWith(t):r.after(t),n.action.decorate(t),n.editor.editable.selection.setRangeAtStartOf(t.find("th:first")),n.editor.trigger("valuechanged"),!1}}(this))},r.toolbar.items.table=o,o}),define("skylark-widgets-wordpad/addons/toolbar/items/TitleButton",["skylark-domx-query","../../../ToolButton","../../../addons"],function(t,e,n){var i=e.inherit({_doActive:function(t){var n=!!t,i=t;if(e.prototype._doActive.call(this,n),n&&(i||(i=this.node[0].tagName.toLowerCase())),this.el.removeClass("active-p active-h1 active-h2 active-h3 active-h4 active-h5"),n)return this.el.addClass("active active-"+i)}});return n.toolbar.items.title=i,i}),define("skylark-widgets-base/Addon",["skylark-langx/langx","skylark-langx/Evented","./base"],function(t,e,n){var i=e.inherit({_construct:function(e,n){this._widget=e,Object.defineProperty(this,"options",{value:t.mixin({},this.options,n,!0)}),this._init&&this._init()}});return i.register=function(t){var e=this.categoryName,n=this.addonName;e&&n&&(t.addons=t.addons||{},t.addons[e]=t.addons[e]||{},t.addons[e][n]=this)},n.Addon=i}),define("skylark-widgets-wordpad/addons/AutoSave",["skylark-domx-query","skylark-widgets-base/Addon","../Toolbar","../Wordpad","../i18n"],function(t,e,n,i,r){var o=e.inherit({needFocus:!1,_init:function(){var e,n,i,r,o;if((this.editor=this._module,this.opts.autosave)&&(this.name="string"==typeof this.opts.autosave?this.opts.autosave:"simditor",this.opts.autosavePath?this.path=this.opts.autosavePath:(n=t("<a/>",{href:location.href}),i=this.editor.textarea.data("autosave")||this.name,this.path="/"+n[0].pathname.replace(/\/$/g,"").replace(/^\//g,"")+"/autosave/"+i+"/"),this.path&&(this.editor.on("valuechanged",(o=this,function(){return o.storage.set(o.path,o.editor.getValue())})),this.editor.el.closest("form").on("ajax:success.simditor-"+this.editor.id,function(t){return function(e){return t.storage.remove(t.path)}}(this)),(r=this.storage.get(this.path))&&(e=this.editor.textarea.val(),r!==e))))return this.editor.textarea.is("[data-autosave-confirm]")?confirm(this.editor.textarea.data("autosave-confirm")||"Are you sure to restore unsaved changes?")?this.editor.setValue(r):this.storage.remove(this.path):this.editor.setValue(r)}});return o.categoryName="general",o.addonName="autosave",o.prototype.opts={autosave:!0,autosavePath:null},o.prototype.storage={supported:function(){try{return localStorage.setItem("_storageSupported","yes"),localStorage.removeItem("_storageSupported"),!0}catch(t){return t,!1}},set:function(t,e,n){if(null==n&&(n=!1),this.supported())return(n?sessionStorage:localStorage).setItem(t,e)},get:function(t,e){if(null==e&&(e=!1),this.supported())return(e?sessionStorage:localStorage)[t]},remove:function(t,e){if(null==e&&(e=!1),this.supported())return(e?sessionStorage:localStorage).removeItem(t)}},i.addons.general.autoSave=o}),define("skylark-widgets-wordpad/addons/Dropzone",["skylark-domx-query","skylark-widgets-base/Addon","../Toolbar","../Wordpad","../i18n"],function(t,e,n,i,r){var o=e.inherit({});return o.categoryName="genernal",o.addonName="dropzone",o.prototype._entered=0,o.prototype._init=function(){var e;if(this.editor=this._widget,null!=this.editor.uploader)return t(document.body).on("dragover",function(t){return t.originalEvent.dataTransfer.dropEffect="none",t.preventDefault()}),t(document.body).on("drop",function(t){return t.preventDefault()}),this.imageBtn=this.editor.toolbar.findButton("image"),this.editor.body.on("dragover",function(t){return t.originalEvent.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()}).on("dragenter",(e=this,function(t){return 1===(e._entered+=1)&&e.show(),t.preventDefault(),t.stopPropagation()})).on("dragleave",function(t){return function(e){return(t._entered-=1)<=0&&t.hide(),e.preventDefault(),e.stopPropagation()}}(this)).on("drop",function(t){return function(e){var n,i,r,o,a,s,l;for(i=[],l=e.originalEvent.dataTransfer.files,r=0,a=l.length;r<a;r++){if(n=l[r],!t.validFile(n))return alert("「"+n.name+"]」文件不是图片。"),t.hide(),!1;i.push(n)}for(o=0,s=i.length;o<s;o++)n=i[o],t.editor.uploader.upload(n,{inline:!0});return t.hide(),e.stopPropagation(),e.preventDefault()}}(this))},o.prototype.show=function(){return this.imageBtn.setActive(!0)},o.prototype.hide=function(){return this.imageBtn.setActive(!1),this._entered=0},o.prototype.validFile=function(t){return t.type.indexOf("image/")>-1},i.addons.general.dropzone=o}),define("skylark-widgets-wordpad/main",["./Wordpad","./Action","./Popover","./Toolbar","./ToolButton","./addons/actions/AlignmentAction","./addons/actions/BlockquoteAction","./addons/actions/BoldAction","./addons/actions/CodeAction","./addons/actions/CodePopover","./addons/actions/ColorAction","./addons/actions/EmojiAction","./addons/actions/FontScaleAction","./addons/actions/FullScreenAction","./addons/actions/HrAction","./addons/actions/HtmlAction","./addons/actions/ImageAction","./addons/actions/ImagePopover","./addons/actions/IndentAction","./addons/actions/ItalicAction","./addons/actions/LinkAction","./addons/actions/LinkPopover","./addons/actions/ListAction","./addons/actions/MarkAction","./addons/actions/OrderListAction","./addons/actions/OutdentAction","./addons/actions/StrikethroughAction","./addons/actions/TableAction","./addons/actions/TitleAction","./addons/actions/UnderlineAction","./addons/actions/UnorderListAction","./addons/toolbar/items/AlignmentButton","./addons/toolbar/items/ColorButton","./addons/toolbar/items/EmojiButton","./addons/toolbar/items/TableButton","./addons/toolbar/items/TitleButton","./addons/AutoSave","./addons/Dropzone"],function(t){return t}),define("skylark-widgets-wordpad",["skylark-widgets-wordpad/main"],function(t){return t})}(define,require),!isAmd){var skylarkjs=require("skylark-langx/skylark");isCmd?module.exports=skylarkjs:globals.skylarkjs=skylarkjs}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-widgets-wordpad-all.js.map
