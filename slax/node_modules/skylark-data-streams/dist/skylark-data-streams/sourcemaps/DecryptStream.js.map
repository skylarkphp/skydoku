{"version":3,"sources":["DecryptStream.js"],"names":["define","skylark","langx","streams","DecodeStream","DecryptStream","inherit","klassName","init","str","decrypt","this","dict","prototype","call","readBlock","chunk","getBytes","length","i","bufferLength","n","buffer","ensureBuffer","eof"],"mappings":";;;;;;;AACAA,QACI,wBACA,sBACA,YACA,kBACD,SAASC,EAASC,EAAOC,EAASC,GAEjC,IAEIC,EAAgBD,EAAaE,SAC7BC,UAAY,gBAEZC,KAAO,SAASC,EAAKC,GACjBC,KAAKF,IAAMA,EACXE,KAAKC,KAAOH,EAAIG,KAChBD,KAAKD,QAAUA,EACfN,EAAaS,UAAUL,KAAKM,KAAKH,OAGrCI,UAAY,WACR,IAAIC,EAAQL,KAAKF,IAAIQ,SAbb,KAcR,GAAKD,GAAyB,GAAhBA,EAAME,OAApB,CAKAF,GAAQN,EADMC,KAAKD,SACHM,GAEhB,IACIG,EADAC,EAAeT,KAAKS,aACjBC,EAAIL,EAAME,OACbI,EAASX,KAAKY,aAAaH,EAAeC,GAC9C,IAAKF,EAAI,EAAGA,EAAIE,EAAGF,IACfG,EAAOF,KAAkBJ,EAAMG,GACnCR,KAAKS,aAAeA,OAXhBT,KAAKa,KAAM,KAevB,OAAOrB,EAAQE,cAAgBA","file":"../DecryptStream.js","sourcesContent":["\r\ndefine([\r\n    \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"./streams\",\r\n    \"./DecodeStream\"\r\n], function(skylark, langx, streams, DecodeStream) {\r\n\r\n    var chunkSize = 512;\r\n\r\n    var DecryptStream = DecodeStream.inherit({\r\n        klassName : \"DecryptStream\",\r\n\r\n        init : function(str, decrypt) {\r\n            this.str = str;\r\n            this.dict = str.dict;\r\n            this.decrypt = decrypt;\r\n            DecodeStream.prototype.init.call(this);          \r\n        },\r\n\r\n        readBlock : function() {\r\n            var chunk = this.str.getBytes(chunkSize);\r\n            if (!chunk || chunk.length == 0) {\r\n                this.eof = true;\r\n                return;\r\n            }\r\n            var decrypt = this.decrypt;\r\n            chunk = decrypt(chunk);\r\n\r\n            var bufferLength = this.bufferLength;\r\n            var i, n = chunk.length;\r\n            var buffer = this.ensureBuffer(bufferLength + n);\r\n            for (i = 0; i < n; i++)\r\n                buffer[bufferLength++] = chunk[i];\r\n            this.bufferLength = bufferLength;\r\n        }\r\n    });\r\n\r\n    return streams.DecryptStream = DecryptStream;\r\n});\r\n"]}