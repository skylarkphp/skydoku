/**
 * skylark-widgets-coder - The skylark code editor widget for showcasing html/css/js.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-coder/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-widgets-base/Widget","skylark-domx-styler","skylark-domx-data","./util","./template","./addons"],function(t,e,s,a,r,i,n,l){"use strict";class o extends s{get klassName(){return"Coder"}get pluginName(){return"lark.coder"}get options(){return{files:[],showBlank:!1,runScripts:!0,pane:"result",debounce:250,addons:{general:["render"]}}}_init(t,s){var a=this.options;!1===a.runScripts&&a.addons.gerneral.push("scriptless"),super._init();var r={};this._get=function(t){return r[t]},this._set=function(t,e){return r[t]=e,r[t]},this._set("cachedContent",{html:null,css:null,js:null});this.$container=this._elm;var i=this._set("paneActive",a.pane);this._velm.html(n.container()).addClass(n.containerClass()).addClass(n.paneActiveClass(i)).on("keyup",e.debounce(this.change.bind(this),a.debounce)).on("change",e.debounce(this.change.bind(this),a.debounce)).on("click",this.pane.bind(this)),this._set("$status",{});for(let t of["html","css","js"])this.markup(t)}_startup(){var t=this.options;this.paneActive=this._get("paneActive");for(let t of["html","css","js"])this.load(t);if(t.showBlank)for(let t of["html","css","js"])this._velm.addClass(n.hasFileClass(t))}findFile(t){var e=this.options;for(let s in e.files){let a=e.files[s];if(a.type===t)return a}return{}}markup(t){var e=this._elm,s=e.querySelector(`.coder-pane-${t}`),r=this.findFile(t),i=document.createElement("div");i.innerHTML=n.editorContent(t,r.url),i.className=n.editorClass(t),s.appendChild(i),this._get("$status")[t]=s.querySelector(".coder-status"),void 0===r.url&&void 0===r.content||a.addClass(e,n.hasFileClass(t))}load(t){var e=this.findFile(t),s=this._elm.querySelector(`.coder-pane-${t} textarea`);void 0!==e.content?this.setValue(s,e.content):void 0!==e.url?(this.status("loading",[n.statusLoading(e.url)],{type:t,file:e}),i.fetch(e.url,(e,a)=>{e?this.status("error",[n.statusFetchError(e)],{type:t}):(this.clearStatus("loading",{type:t}),this.setValue(s,a))})):this.setValue(s,"")}setValue(t,e){t.value=e,this.change({target:t})}change(t){var e=r.data(t.target,"coder-type");if(e){var s=this._get("cachedContent");s[e]!==t.target.value&&(s[e]=t.target.value,this.emit("change",{type:e,file:r.data(t.target,"coder-file"),content:s[e]}))}}errors(t,e){this.status("error",t,e)}pane(t){if(r.data(t.target,"coder-type")){var e=this._elm,s=this._get("paneActive");a.removeClass(e,n.paneActiveClass(s)),s=this._set("paneActive",r.data(t.target,"coder-type")),a.addClass(e,n.paneActiveClass(s)),t.preventDefault()}}status(t="error",e=[],s={}){if(!e.length)return this.clearStatus(t,s);var r=this._get("$status");a.addClass(r[s.type],n.statusClass(t)),a.addClass(this._elm,n.statusActiveClass(s.type));var i="";e.forEach(function(t){i+=n.statusMessage(t)}),r[s.type].innerHTML=i}clearStatus(t,e){var s=this._get("$status");a.removeClass(s[e.type],n.statusClass(t)),a.removeClass(this._elm,n.statusActiveClass(e.type)),s[e.type].innerHTML=""}}return o.addons=l,t.attach("widgets.Coder",o)});
//# sourceMappingURL=sourcemaps/Coder.js.map
