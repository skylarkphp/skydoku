/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","../Hierarchy"],function(e,i,t,r,s,n,a){"use strict";if(!n.jstree.plugins.unique)return n.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(e,i){return e+" ("+i+")"}},n.jstree.plugins.unique=function(e,i){this.check=function(e,t,r,s,a){if(!1===i.check.call(this,e,t,r,s,a))return!1;if(t=t&&t.id?t:this.get_node(t),!(r=r&&r.id?r:this.get_node(r))||!r.children)return!0;var o,d,u,c="rename_node"===e?s:t.text,l=[],h=this.settings.unique.case_sensitive,g=this.settings.unique.trim_whitespace,F=this._model.data;for(o=0,d=r.children.length;o<d;o++)u=F[r.children[o]].text,h||(u=u.toLowerCase()),g&&(u=u.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),l.push(u);switch(h||(c=c.toLowerCase()),g&&(c=c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),e){case"delete_node":return!0;case"rename_node":return u=t.text||"",h||(u=u.toLowerCase()),g&&(u=u.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),(o=-1===n.inArray(c,l)||t.text&&u===c)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id)&&t.id,par:!(!r||!r.id)&&r.id})}),o;case"create_node":return(o=-1===n.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id)&&t.id,par:!(!r||!r.id)&&r.id})}),o;case"copy_node":return(o=-1===n.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id)&&t.id,par:!(!r||!r.id)&&r.id})}),o;case"move_node":return(o=t.parent===r.id&&(!a||!a.is_multi)||-1===n.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:s,obj:!(!t||!t.id)&&t.id,par:!(!r||!r.id)&&r.id})}),o}return!0},this.create_node=function(e,t,r,s,a){if(!t||void 0===t.text){if(null===e&&(e=n.jstree.root),!(e=this.get_node(e)))return i.create_node.call(this,e,t,r,s,a);if(!(r=void 0===r?"last":r).toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(e))return i.create_node.call(this,e,t,r,s,a);t||(t={});var o,d,u,c,l,h,g=this._model.data,F=this.settings.unique.case_sensitive,_=this.settings.unique.trim_whitespace,x=this.settings.unique.duplicate;for(d=o=this.get_string("New node"),u=[],c=0,l=e.children.length;c<l;c++)h=g[e.children[c]].text,F||(h=h.toLowerCase()),_&&(h=h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),u.push(h);for(c=1,h=d,F||(h=h.toLowerCase()),_&&(h=h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==n.inArray(h,u);)h=d=x.call(this,o,++c).toString(),F||(h=h.toLowerCase()),_&&(h=h.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));t.text=d}return i.create_node.call(this,e,t,r,s,a)}},n});
//# sourceMappingURL=../sourcemaps/addons/unique.js.map
