/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","../Hierarchy"],function(e,i,t,r,s,n,a){"use strict";if(!n.jstree.plugins.unique)return n.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(e,i){return e+" ("+i+")"}},n.jstree.plugins.unique=function(i,t){this.check=function(i,r,s,n,a){if(!1===t.check.call(this,i,r,s,n,a))return!1;if(r=r&&r.id?r:this.get_node(r),!(s=s&&s.id?s:this.get_node(s))||!s.children)return!0;var o,d,u,c="rename_node"===i?n:r.text,l=[],h=this.settings.unique.case_sensitive,g=this.settings.unique.trim_whitespace,F=this._model.data;for(o=0,d=s.children.length;o<d;o++)u=F[s.children[o]].text,h||(u=u.toLowerCase()),g&&(u=u.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),l.push(u);switch(h||(c=c.toLowerCase()),g&&(c=c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),i){case"delete_node":return!0;case"rename_node":return u=r.text||"",h||(u=u.toLowerCase()),g&&(u=u.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),(o=-1===e.inArray(c,l)||r.text&&u===c)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+i,data:JSON.stringify({chk:i,pos:n,obj:!(!r||!r.id)&&r.id,par:!(!s||!s.id)&&s.id})}),o;case"create_node":return(o=-1===e.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+i,data:JSON.stringify({chk:i,pos:n,obj:!(!r||!r.id)&&r.id,par:!(!s||!s.id)&&s.id})}),o;case"copy_node":return(o=-1===e.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+i,data:JSON.stringify({chk:i,pos:n,obj:!(!r||!r.id)&&r.id,par:!(!s||!s.id)&&s.id})}),o;case"move_node":return(o=r.parent===s.id&&(!a||!a.is_multi)||-1===e.inArray(c,l))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+i,data:JSON.stringify({chk:i,pos:n,obj:!(!r||!r.id)&&r.id,par:!(!s||!s.id)&&s.id})}),o}return!0},this.create_node=function(i,r,s,a,o){if(!r||void 0===r.text){if(null===i&&(i=n.jstree.root),!(i=this.get_node(i)))return t.create_node.call(this,i,r,s,a,o);if(!(s=void 0===s?"last":s).toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return t.create_node.call(this,i,r,s,a,o);r||(r={});var d,u,c,l,h,g,F=this._model.data,_=this.settings.unique.case_sensitive,x=this.settings.unique.trim_whitespace,p=this.settings.unique.duplicate;for(u=d=this.get_string("New node"),c=[],l=0,h=i.children.length;l<h;l++)g=F[i.children[l]].text,_||(g=g.toLowerCase()),x&&(g=g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),c.push(g);for(l=1,g=u,_||(g=g.toLowerCase()),x&&(g=g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==e.inArray(g,c);)g=u=p.call(this,d,++l).toString(),_||(g=g.toLowerCase()),x&&(g=g.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));r.text=u}return t.create_node.call(this,i,r,s,a,o)}},n});
//# sourceMappingURL=../sourcemaps/addons/unique.js.map
