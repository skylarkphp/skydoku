/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","../Hierarchy"],function(t,e,s,r,a,n,i){"use strict";if(!n.jstree.plugins.state){var o=!1;return n.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},n.jstree.plugins.state=function(t,e){this.bind=function(){e.bind.call(this);var t=n.proxy(function(){this.element.on(this.settings.state.events,n.proxy(function(){o&&clearTimeout(o),o=setTimeout(n.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",n.proxy(function(e,s){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t=this.get_state();this.settings.state.preserve_loaded||delete t.core.loaded;var e={state:t,ttl:this.settings.state.ttl,sec:+new Date};n.vakata.storage.set(this.settings.state.key,JSON.stringify(e))},this.restore_state=function(){var t=n.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(t){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&n.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.settings.state.preserve_loaded||delete t.core.loaded,this.element.one("set_state.jstree",function(e,s){s.instance.trigger("restore_state",{state:n.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return n.vakata.storage.del(this.settings.state.key)}},function(t,e){t.vakata.storage={set:function(t,e){return window.localStorage.setItem(t,e)},get:function(t){return window.localStorage.getItem(t)},del:function(t){return window.localStorage.removeItem(t)}}}(n),n}});
//# sourceMappingURL=../sourcemaps/addons/state.js.map
