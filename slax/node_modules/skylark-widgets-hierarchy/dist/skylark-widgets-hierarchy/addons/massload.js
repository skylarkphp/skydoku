/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","../Hierarchy"],function(t,a,s,e,i,n,l){"use strict";if(!n.jstree.plugins.massload)return n.jstree.defaults.massload=null,n.jstree.plugins.massload=function(t,a){this.init=function(t,s){this._data.massload={},a.init.call(this,t,s)},this._load_nodes=function(t,s,e,i){var l,o,r,d=this.settings.massload,h=(JSON.stringify(t),[]),u=this._model.data;if(!e){for(l=0,o=t.length;l<o;l++)u[t[l]]&&(u[t[l]].state.loaded||u[t[l]].state.failed)&&!i||(h.push(t[l]),(r=this.get_node(t[l],!0))&&r.length&&r.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},h.length){if(n.isFunction(d))return d.call(this,h,n.proxy(function(n){var l,o;if(n)for(l in n)n.hasOwnProperty(l)&&(this._data.massload[l]=n[l]);for(l=0,o=t.length;l<o;l++)(r=this.get_node(t[l],!0))&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);a._load_nodes.call(this,t,s,e,i)},this));if("object"==typeof d&&d&&d.url)return d=n.extend(!0,{},d),n.isFunction(d.url)&&(d.url=d.url.call(this,h)),n.isFunction(d.data)&&(d.data=d.data.call(this,h)),n.ajax(d).done(n.proxy(function(n,l,o){var d,h;if(n)for(d in n)n.hasOwnProperty(d)&&(this._data.massload[d]=n[d]);for(d=0,h=t.length;d<h;d++)(r=this.get_node(t[d],!0))&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);a._load_nodes.call(this,t,s,e,i)},this)).fail(n.proxy(function(n){a._load_nodes.call(this,t,s,e,i)},this))}}return a._load_nodes.call(this,t,s,e,i)},this._load_node=function(t,s){var e,i=this._data.massload[t.id],l=null;return i?(l=this["string"==typeof i?"_append_html_data":"_append_json_data"](t,"string"==typeof i?n(n.parseHTML(i)).filter(function(){return 3!==this.nodeType}):i,function(t){s.call(this,t)}),(e=this.get_node(t.id,!0))&&e.length&&e.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],l):a._load_node.call(this,t,s)}},n});
//# sourceMappingURL=../sourcemaps/addons/massload.js.map
