/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","../Hierarchy"],function(t,a,s,e,i,n,l){"use strict";if(!n.jstree.plugins.massload)return n.jstree.defaults.massload=null,n.jstree.plugins.massload=function(a,s){this.init=function(t,a){this._data.massload={},s.init.call(this,t,a)},this._load_nodes=function(a,e,i,n){var l,o,r,d=this.settings.massload,h=(JSON.stringify(a),[]),u=this._model.data;if(!i){for(l=0,o=a.length;l<o;l++)u[a[l]]&&(u[a[l]].state.loaded||u[a[l]].state.failed)&&!n||(h.push(a[l]),(r=this.get_node(a[l],!0))&&r.length&&r.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},h.length){if(t.isFunction(d))return d.call(this,h,t.proxy(function(t){var l,o;if(t)for(l in t)t.hasOwnProperty(l)&&(this._data.massload[l]=t[l]);for(l=0,o=a.length;l<o;l++)(r=this.get_node(a[l],!0))&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);s._load_nodes.call(this,a,e,i,n)},this));if("object"==typeof d&&d&&d.url)return d=t.extend(!0,{},d),t.isFunction(d.url)&&(d.url=d.url.call(this,h)),t.isFunction(d.data)&&(d.data=d.data.call(this,h)),ajax(d).done(t.proxy(function(t,l,o){var d,h;if(t)for(d in t)t.hasOwnProperty(d)&&(this._data.massload[d]=t[d]);for(d=0,h=a.length;d<h;d++)(r=this.get_node(a[d],!0))&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);s._load_nodes.call(this,a,e,i,n)},this)).fail(t.proxy(function(t){s._load_nodes.call(this,a,e,i,n)},this))}}return s._load_nodes.call(this,a,e,i,n)},this._load_node=function(a,e){var i,l=this._data.massload[a.id],o=null;return l?(o=this["string"==typeof l?"_append_html_data":"_append_json_data"](a,"string"==typeof l?n(t.parseHTML(l)).filter(function(){return 3!==this.nodeType}):l,function(t){e.call(this,t)}),(i=this.get_node(a.id,!0))&&i.length&&i.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[a.id],o):s._load_node.call(this,a,e)}},n});
//# sourceMappingURL=../sourcemaps/addons/massload.js.map
