/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","./menu","../Hierarchy"],function(e,t,n,r,o,a,s,i){"use strict";if(!a.jstree.plugins.contextmenu)return a.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(e,t){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{},"last",function(e){try{t.edit(e)}catch(n){setTimeout(function(){t.edit(e)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.edit(n)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.delete_node(t.get_selected()):t.delete_node(n)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.cut(t.get_top_selected()):t.cut(n)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.copy(t.get_top_selected()):t.copy(n)}},paste:{separator_before:!1,icon:!1,_disabled:function(e){return!a.jstree.reference(e.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.paste(n)}}}}}}},a.jstree.plugins.contextmenu=function(e,t){this.bind=function(){t.bind.call(this);var e,n,r=0,o=null;this.element.on("init.jstree loading.jstree ready.jstree",a.proxy(function(){this.get_container_ul().addClass("jstree-contextmenu")},this)).on("contextmenu.jstree",".jstree-anchor",a.proxy(function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),r=e.ctrlKey?+new Date:0,(t||o)&&(r=+new Date+1e4),o&&clearTimeout(o),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))},this)).on("click.jstree",".jstree-anchor",a.proxy(function(e){this._data.contextmenu.visible&&(!r||+new Date-r>250)&&s.hide(),r=0},this)).on("touchstart.jstree",".jstree-anchor",function(t){t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(e=t.originalEvent.changedTouches[0].clientX,n=t.originalEvent.changedTouches[0].clientY,o=setTimeout(function(){a(t.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(t){o&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(Math.abs(e-t.originalEvent.changedTouches[0].clientX)>10||Math.abs(n-t.originalEvent.changedTouches[0].clientY)>10)&&(clearTimeout(o),s.hide())}).on("touchend.vakata.jstree",function(e){o&&clearTimeout(o)}),a(document).on("context_hide.sbswt.popup",a.proxy(function(e,t){this._data.contextmenu.visible=!1,a(t.reference).removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&s.hide(),t.teardown.call(this)},this.show_contextmenu=function(e,t,n,r){if(!(e=this.get_node(e))||e.id===a.jstree.root)return!1;var o=this.settings.contextmenu,s=this.get_node(e,!0).children(".jstree-anchor"),i=!1,c=!1;(o.show_at_node||void 0===t||void 0===n)&&(i=s.offset(),t=i.left,n=i.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(e)&&this.activate_node(e,r),c=o.items,a.isFunction(c)&&(c=c.call(this,e,a.proxy(function(r){this._show_contextmenu(e,t,n,r)},this))),a.isPlainObject(c)&&this._show_contextmenu(e,t,n,c)},this._show_contextmenu=function(e,t,n,r){var o=this.get_node(e,!0).children(".jstree-anchor");a(document).one("context_show.sbswt.popup",a.proxy(function(e,t){var n="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";a(t.element).addClass(n),o.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,s.popup(o,{x:t,y:n},r),this.trigger("show_contextmenu",{node:e,x:t,y:n})}},a});
//# sourceMappingURL=../sourcemaps/addons/contextmenu.js.map
