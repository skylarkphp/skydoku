/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","./menu","../Hierarchy"],function(e,t,n,r,o,a,s,i){"use strict";if(!a.jstree.plugins.contextmenu)return a.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(e,t){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{},"last",function(e){try{t.edit(e)}catch(n){setTimeout(function(){t.edit(e)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.edit(n)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.delete_node(t.get_selected()):t.delete_node(n)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.cut(t.get_top_selected()):t.cut(n)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.copy(t.get_top_selected()):t.copy(n)}},paste:{separator_before:!1,icon:!1,_disabled:function(e){return!a.jstree.reference(e.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var t=a.jstree.reference(e.reference),n=t.get_node(e.reference);t.paste(n)}}}}}}},a.jstree.plugins.contextmenu=function(t,n){this.bind=function(){n.bind.call(this);var t,r,o=0,i=null;this.element.on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-contextmenu")},this)).on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),o=e.ctrlKey?+new Date:0,(t||i)&&(o=+new Date+1e4),i&&clearTimeout(i),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))},this)).on("click.jstree",".jstree-anchor",e.proxy(function(e){this._data.contextmenu.visible&&(!o||+new Date-o>250)&&s.hide(),o=0},this)).on("touchstart.jstree",".jstree-anchor",function(e){e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(t=e.originalEvent.changedTouches[0].clientX,r=e.originalEvent.changedTouches[0].clientY,i=setTimeout(function(){a(e.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){i&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.originalEvent.changedTouches[0].clientX)>10||Math.abs(r-e.originalEvent.changedTouches[0].clientY)>10)&&(clearTimeout(i),s.hide())}).on("touchend.vakata.jstree",function(e){i&&clearTimeout(i)}),a(document).on("context_hide.sbswt.popup",e.proxy(function(e,t){this._data.contextmenu.visible=!1,a(t.reference).removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&s.hide(),n.teardown.call(this)},this.show_contextmenu=function(t,n,r,o){if(!(t=this.get_node(t))||t.id===a.jstree.root)return!1;var s=this.settings.contextmenu,i=this.get_node(t,!0).children(".jstree-anchor"),c=!1,u=!1;(s.show_at_node||void 0===n||void 0===r)&&(c=i.offset(),n=c.left,r=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(t)&&this.activate_node(t,o),u=s.items,e.isFunction(u)&&(u=u.call(this,t,e.proxy(function(e){this._show_contextmenu(t,n,r,e)},this))),e.isPlainObject(u)&&this._show_contextmenu(t,n,r,u)},this._show_contextmenu=function(t,n,r,o){var i=this.get_node(t,!0).children(".jstree-anchor");a(document).one("context_show.sbswt.popup",e.proxy(function(e,t){var n="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";a(t.element).addClass(n),i.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,s.popup(i,{x:n,y:r},o),this.trigger("show_contextmenu",{node:t,x:n,y:r})}},a});
//# sourceMappingURL=../sourcemaps/addons/contextmenu.js.map
