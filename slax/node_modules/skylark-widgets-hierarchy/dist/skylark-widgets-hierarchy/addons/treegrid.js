/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","./menu","../Hierarchy"],function(e,t,i,r,s,n,d,a){var o=/^\s*$/g,l=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,h=!1,c=function(e,t){return"jstree_"+e+"_grid_"+function(e){return(e||"").replace(l,"\\$&")}(t)+"_col"},g=function(t){return e.makeArray(t.map(function(){return this.id}))},u=function(e,t,i,r){if(void 0==r&&(r=n()),null===t||void 0===t||0===t.length)return r;var s,d=n(),a=[].concat(i);return"string"==typeof t?(s=c(e,t),d=a.map(function(e){return"#"+s+e}).join(", ")):(d=[],t.forEach(function(t,i){var r=c(e,t);d=d.concat(a.map(function(e){return"#"+r+e}))}),d=d.join(", ")),1==a.length?r.find(d):n(d)},p=!1,f=null,m=0,v=0,_=/<\/?[^>]+>/gi,j=function(t,i,r,s,n){var d,a;if(s.data=e.extend(!0,{},i.data),i&&i.children_d&&n)for(d=0,a=i.children_d.length;d<a;d++)j(t,t.get_node(i.children_d[d]),r,r.get_node(s.children_d[d]),n)},w=function(e,t){var i=e.get_node(t),r=i.children;return!r||r.length<=0||!i.state.opened?t:w(e,r[r.length-1])},x=function(e,t){return void 0!==e&&null!==e?"function"==typeof e?e(t):null!==t.data&&void 0!==t.data&&void 0!==t.data[e]?t.data[e]:"":""};return n.jstree.defaults.grid={width:"auto"},n.jstree.plugins.grid=function(t,r){function s(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}this._initialize=function(){if(!this._initialized){var t=this.settings.grid||{},i=this.element,r=this._gridSettings={columns:t.columns||[],treeClass:"jstree-grid-col-0",context:t.contextmenu||!1,columnWidth:t.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:t.resizable,draggable:t.draggable,stateful:t.stateful,indent:0,sortOrder:"text",sortAsc:!0,caseInsensitive:t.caseInsensitive,fixedHeader:!1!==t.fixedHeader,width:t.width,height:t.height,gridcontextmenu:t.gridcontextmenu,treecol:0,gridcols:[]},s=r.columns,d=0,a=!1;!0===r.gridcontextmenu?r.gridcontextmenu=function(e,t,i,r,s,n,d){return{edit:{label:"Edit",action:function(t){var r=n.get_node(i);e._edit(r,s,d)}}}}:!1===r.gridcontextmenu&&(r.gridcontextmenu=!1);for(var o=0,l=t.columns.length;o<l;o++)t.columns[o].tree?(d=o,r.treecol=d):r.gridcols.push(o);if(this.uniq=Math.ceil(1e3*Math.random()),this.rootid=i.attr("id"),/msie/.test(navigator.userAgent.toLowerCase()))parseFloat(navigator.appVersion.split("MSIE")[1])<8&&(r.defaultConf.display="inline",r.defaultConf.zoom="1");h||(h=!0,n('<style type="text/css">'+[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px; cursor: default;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD; z-index: 1;}",".jstree-grid-hidden {display: none;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {table-layout: fixed; width: 100%; overflow: auto; position: relative;}",".jstree-grid-midwrapper {display: table-row;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-ellipsis {text-overflow: ellipsis;}",".jstree-grid-col-0 {width: 100%;}"].join("\n")+"</style>").appendTo("head")),this.gridWrapper=n("<div></div>").addClass("jstree-grid-wrapper").insertAfter(i),this.midWrapper=n("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),t.width&&this.gridWrapper.width(t.width),t.height&&this.gridWrapper.height(t.height);for(o=0,l=s.length;o<l;o++)n("<div></div>").addClass("jstree-default jstree-grid-column jstree-grid-column-"+o+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+d+")").append(i),i.addClass("jstree-grid-cell"),r.fixedHeader&&this.gridWrapper.scroll(function(){n(this).find(".jstree-grid-header").css("top",n(this).scrollTop())});var c,g,u=e.proxy(this.settings.sort,this);if(this.settings.sort=function(e,t){var i,s=this.colrefs;if("text"===r.sortOrder){var n=this.get_text(e).toLowerCase().localeCompare(this.get_text(t).toLowerCase());i=r.caseInsensitive?1===n:1===u(e,t)}else{var d=this.get_node(e),a=this.get_node(t),o=s[r.sortOrder].value,l="function"==typeof o?o(d):d.data[o],h="function"==typeof o?o(a):a.data[o];void 0!==h&&(i=r.caseInsensitive?l.toLowerCase()>h.toLowerCase():l>h)}return r.sortAsc||(i=!i),i?1:-1},r.draggable)if(n.ui&&n.ui.sortable)n(this.midWrapper).sortable({axis:"x",handle:".jstree-grid-header",cancel:".jstree-grid-separator",start:function(e,t){c=t.item.index()},stop:function(e,t){g=t.item.index(),r.columns.splice(g,0,r.columns.splice(c,1)[0])}});else console.warn("[jstree-grid] draggable option requires jQuery UI");this.searchColumn=function(e){var t={};if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&i%1==0&&i<s.length&&i>=0&&(t[i]=e[i]);a=t,0!==Object.keys(t).length?this.search("someValue"):this.search(""),a=!1};for(o=0,l=s.length;o<l;o++){var p=s[o];"function"!=typeof p.search_callback&&(p.search_callback=function(e,t,i,r){return new n.vakata.search(e,!0,{caseSensitive:f.case_sensitive,fuzzy:f.fuzzy}).search(t).isMatch})}var f=this.settings.search,m=f.search_callback;m||(m=function(e,t){var i,r=new n.vakata.search(e,!0,{caseSensitive:f.case_sensitive,fuzzy:f.fuzzy}),a=r.search(t.text).isMatch;if(!a)for(var o=0,l=s.length;o<l&&!(d!==o&&(i=s[o],a=r.search(x(i.value,t)).isMatch));o++);return a}),f.search_callback=function(e,t){var r=!1;if(a){for(var n in a)if(a.hasOwnProperty(n)){var o=a[n];if(""==o)continue;var l=s[n];if(!(r=d==n?l.search_callback(o,t.text,t,l):l.search_callback(o,x(l.value,t),t,l)))break}i.trigger("columnSearch_grid.jstree")}else r=m(e,t),i.trigger("omniSearch_grid.jstree");return r},this._initialized=!0}},this.init=function(e,t){r.init.call(this,e,t),this._initialize()},this.bind=function(){r.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0),r=s();this._detachColumns(r),this._prepare_grid(i),this._reattachColumns(r)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){this.gridWrapper;var i=[t.node.id];t.node&&t.node.children_d&&(i=i.concat(t.node.children_d)),u(this.uniq,i,this._gridSettings.gridcols).remove()}},this)).on("show_node.jstree",e.proxy(function(e,t){this._hideOrShowTree(t.node,!1)},this)).on("hide_node.jstree",e.proxy(function(e,t){this._hideOrShowTree(t.node,!0)},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(e,t){var i,r=this.element.find("[class~='jstree-anchor']:first").outerHeight(),s=this.element.attr("class")||"";n('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px; height: "+r+"px;}</style>").appendTo("head"),i=s.split(/\s+/).map(function(e){return e.match(/^jstree(-|$)/)?"":e}),this.gridWrapper.addClass(i.join(" "))},this)).on("move_node.jstree",e.proxy(function(t,i){i.new_instance.element.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&u(this.uniq,this._hover_node,this._gridSettings.gridcols).removeClass("jstree-hovered"),this._hover_node=r,u(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,u(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;u(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;u(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r=t.node||[];u(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i,r,d=this.gridWrapper,a=this,o=(new Date).getTime(),l=g(t.nodes.filter(".jstree-node"));if(this.holdingCells={},t.nodes.length){var h=s(),c=d.find("div.jstree-grid-cell-regular");this._detachColumns(h),this._data.search.som&&(this._data.search.smc&&(i=t.nodes.add(t.nodes.find(".jstree-node"))),i=(i||t.nodes).add(t.nodes.parentsUntil(".jstree")),c.hide(),i.filter(".jstree-node").each(function(e,t){var i=t.id;if(i){a._prepare_grid(t);e=0;for(var r=a._gridSettings.gridcols.length;e<r;e++)e!==a._gridSettings.treecol&&u(a.uniq,i,a._gridSettings.gridcols[e],n(a._domManipulation.columns[e])).show()}}));for(var p=0,f=this._gridSettings.gridcols.length;p<f;p++)p!==this._gridSettings.treecol&&u(a.uniq,l,this._gridSettings.gridcols[p],n(this._domManipulation.columns[p])).addClass("jstree-search");this._reattachColumns(h),r=(new Date).getTime(),this.element.trigger("search-complete.jstree-grid",[{time:r-o}])}return!0},this)).on("clear_search.jstree",e.proxy(function(e,t){var i=this.gridWrapper,r=g(t.nodes.filter(".jstree-node"));return i.find("div.jstree-grid-cell").show(),u(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-search"),!0},this)).on("copy_node.jstree",function(e,t){var i=t.new_instance,r=t.old_instance,s=i.get_node(t.node,!0);return j(r,t.original,i,t.node,!0),i._detachColumns(s.id),i._prepare_grid(s),i._reattachColumns(s.id),!0}).on("show_ellipsis.jstree",e.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).addClass("jstree-grid-ellipsis"),!0},this)).on("hide_ellipsis.jstree",e.proxy(function(e,t){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).removeClass("jstree-grid-ellipsis"),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-hover")},this)),this._gridSettings.stateful&&this.element.on("resize_column.jstree-grid",e.proxy(function(e,t,i){localStorage["jstree-root-"+this.rootid+"-column-"+t]=i},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),r.teardown.call(this)},this._clean_grid=function(e,t){var i=this.gridWrapper;e?u(this.uniq,t,this._gridSettings.gridcols).remove():i.find("div.jstree-grid-cell-regular").remove()},this._prepare_headers=function(){var e,t,i,r,s,d,a,o,l=this,h=this._gridSettings,c=h.columns||[],g=h.columnWidth,u=h.resizable||!1,_=h.isThemeroller,j=_?"themeroller":"regular",w=!1,x=this.gridparent,C=this.rootid,y=h.defaultConf;this.parent=x,this.colrefs={};for(var b=0,S=c.length;b<S;b++){i=c[b].headerClass||"",r=c[b].columnClass||"",s=c[b].header||"";do{o=String(Math.floor(1e4*Math.random()))}while(void 0!==this.colrefs[o]);d=c[b].value?o:"text",this.colrefs[d]=c[b],s&&(w=!0),t=h.stateful&&localStorage["jstree-root-"+C+"-column-"+b]?localStorage["jstree-root-"+C+"-column-"+b]:c[b].width||g;var k=c[b].minWidth||t,W=c[b].maxWidth||t;"auto"!==t&&"string"!=typeof t&&(t-=_?7:10),e=this.midWrapper.children("div.jstree-grid-column-"+b),(a=n("<div></div>").css(y).addClass("jstree-grid-div-"+this.uniq+"-"+b+" "+(_?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+j+" "+i+" "+r).html(s)).addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+j),!0===this.settings.core.themes.ellipsis&&a.addClass("jstree-grid-ellipsis"),a.prependTo(e),a.attr("data-jstreegrid-column",d),a.outerWidth(),n("<div class='jstree-grid-separator jstree-grid-separator-"+j+(_?" ui-widget-header":"")+(u?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(a),e.width(t),e.css("min-width",k),e.css("max-width",W)}a.addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+j),void 0===c[c.length-1].width&&(t,e.css({width:"auto"}),a.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),w?h.header=void 0:n("div.jstree-grid-header").hide(),!this.bound&&u&&(this.bound=!0,n(document).mouseup(function(){var e,t,i,r;p&&(r=f.prevAll(".jstree-grid-column").length,i=f.closest(".jstree-grid-wrapper").find(".jstree"),(e=n.jstree.reference(i)).settings.grid.columns,f.parent().children("div.jstree-grid-column"),(isNaN(r)||r<0)&&(e._gridSettings.treeWidthDiff=i.find("ins:eq(0)").width()+i.find("[class~='jstree-anchor']:eq(0)").width()-e._gridSettings.columns[0].width),t=e._gridSettings.columns[r].width=parseFloat(f.css("width")),p=!1,f=null,i.trigger("resize_column.jstree-grid",[r,t]))}).mousemove(function(e){if(p){var t,i,r,s=(v=e.pageX)-m;0!==s&&(t=f.width(),(i=parseFloat(f.css("width")))||(i=f.innerWidth()),r=i+(s=s<0?Math.max(s,-t):s),(s>0||t>0)&&r>10&&(f.width(r+"px"),f.css("min-width",r+"px"),f.css("max-width",r+"px"),m=v))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(e){return p=!0,m=e.pageX,f=n(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(e){var t,i,r=n(this).closest("div.jstree-grid-column"),s=parseFloat(r.css("width")),d=0,a=r.prevAll(".jstree-grid-column").length,o=r.width();r.find(".jstree-grid-cell").each(function(){var e,t=n(this);t.css("position","absolute"),t.css("width","auto"),e=t.outerWidth(),t.css("position","relative"),e>d&&(d=e)}),i=s+(t=(t=d-s)<0?Math.max(t,-o):t)+"px",r.width(i),r.css("min-width",i),r.css("max-width",i),n(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[a,i])}).on("click",".jstree-grid-separator",function(e){e.stopPropagation()})),this.gridWrapper.on("click",".jstree-grid-header-cell",function(e){if(l.sort){var t,i=n(this).attr("data-jstreegrid-column");h.sortOrder===i&&!0===h.sortAsc?(h.sortAsc=!1,t="&darr;"):(h.sortOrder=i,h.sortAsc=!0,t="&uarr;"),n(this.closest(".jstree-grid-wrapper")).find(".jstree-grid-sort-icon").remove(),n("<span></span>").addClass("jstree-grid-sort-icon").appendTo(n(this)).html(t);var r=l.get_node("#");l.sort(r,!0),l.redraw_node(r,!0)}})},this._domManipulation=null,this._detachColumns=function(e){if(null==this._domManipulation){var t=this._gridSettings.columns||[],i=(this._gridSettings.treecol,this.midWrapper);this._domManipulation={id:e,columns:{}};for(var r=0,s=t.length;r<s;r++)this._domManipulation.columns[r]=i.children(".jstree-grid-column-"+r)[0],this._domManipulation.columns[r].parentNode.removeChild(this._domManipulation.columns[r])}return this._domManipulation},this._reattachColumns=function(e){if(null==this._domManipulation)return!1;if(this._domManipulation.id===e){for(var t=this._gridSettings.columns||[],i=(this._gridSettings.treecol,this.midWrapper),r=0,s=t.length;r<s;r++)i[0].appendChild(this._domManipulation.columns[r]);this._domManipulation=null}return!0},this.open_node=function(t,i,n){var d=e.isArray(t),a=null;if(d||"#"!==(a=this.get_node(t)).id){var o=d?s():a.id;this._detachColumns(o);var l=r.open_node.call(this,t,i,n);return this._reattachColumns(o),l}},this.redraw_node=function(t,i,n,d){var a=e.isArray(t)?s():this.get_node(t).id;return this._detachColumns(a),(t=r.redraw_node.call(this,t,i,n,d))&&this._prepare_grid(t),this._reattachColumns(a),t},this.refresh=function(){return this._clean_grid(),r.refresh.apply(this,arguments)},this.set_id=function(e,t){var i,s=this.uniq;e&&(i=e.id);var d=r.set_id.apply(this,arguments);if(d&&void 0!==i){this.gridWrapper;var a=[i];e&&e.children_d&&(a=a.concat(e.children_d)),u(s,a,this._gridSettings.gridcols).attr("data-jstreegrid",e.id).removeClass(c(s,i)).addClass(c(s,e.id)).each(function(t,i){n(i).attr("id",c(s,e.id)+(t+1))})}return d},this._hideOrShowTree=function(e,t){this._detachColumns(e.id),this._hideOrShowNode(e,t,this._gridSettings.columns||[],this._gridSettings.treecol),this._reattachColumns(e.id)},this._hideOrShowNode=function(e,t,i,r){for(var s=0,d=i.length;s<d;s++)if(s!==r){var a=u(this.uniq,e.id,s,n(this._domManipulation.columns[s]));t?a.addClass("jstree-grid-hidden"):a.removeClass("jstree-grid-hidden")}if(e.state.opened&&e.children)for(s=0,d=e.children.length;s<d;s++)this._hideOrShowNode(this.get_node(e.children[s]),t,i,r)},this._hide_grid=function(e){if(!e)return!0;this._detachColumns(e.id);for(var t=e.children?e.children:[],i=this._gridSettings.columns||[],r=this._gridSettings.treecol,s=0,d=t.length;s<d;s++){for(var a=this.get_node(t[s]),o=0,l=i.length;o<l;o++)o!==r&&u(this.uniq,a.id,o,n(this._domManipulation.columns[o])).remove();a.state.opened&&this._hide_grid(a)}this._reattachColumns(e.id)},this.holdingCells={},this.getHoldingCells=function(e,t,i){if(e.state.hidden||!e.state.opened)return n();var r,s,d=n(),a=e.children||[],o=this.uniq;for(s=0;s<a.length;s++)i[r=c(o,a[s])+t]&&(d=d.add(i[r]).add(this.getHoldingCells(this.get_node(a[s]),t,i)));return d},this._edit=function(t,i,r){if(!t)return!1;if(t.data||(t.data={}),!r)return!1;"div"===(r=n(r)).prop("tagName").toLowerCase()&&(r=r.children("span:first"));var d=this._data.core.rtl,a=this.element.width(),o=t.data[i.value],l=n("<div />",{css:{position:"absolute",top:"-200px",left:d?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=n("<input />",{value:o,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=h.val();if(""===e||e===o)e=o;else{t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:o});var n=s();this._detachColumns(n),this._prepare_grid(this.get_node(t,!0)),this._reattachColumns(n)}h.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=o),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(l.text("pW"+this.value).width(),a))},keypress:function(e){if(13===e.which)return!1}}),c={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(h),h.css(c).width(Math.min(l.text("pW"+h[0].value).width(),a))[0].select()},this.grid_hide_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).hide()},this.grid_show_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).show()},this._prepare_grid=function(t){var r,s,a,l,h,g,p,f,m,v,j,C,y,b,S,k,W,M,z,q,A,T,O,P,N,L,D,H=this._gridSettings,I=H.treeClass,V=this,F=H.columns||[],B=H.isThemeroller,E=this.uniq,U=H.treecol,$=this.element,X=this.rootid,Q=B?"themeroller":"regular",Y=this.get_node(t),G=H.columnWidth,J=H.defaultConf,K=function(e,t,r,s,d){return function(d){var a=i.create("select_cell.jstree-grid");e.trigger(a,[{value:r,column:s.header,node:t,grid:n(this),sourceName:s.value}]),a.isDefaultPrevented()||t.children(".jstree-anchor").trigger("click.jstree",d)}},R=function(e,t,i,r,s){return function(n){H.gridcontextmenu&&(n.preventDefault(),d.popup(this,{x:n.pageX,y:n.pageY},H.gridcontextmenu(V,e,t,i,r,s,n.target)))}},Z=function(e,t){return function(){t.hover_node(e)}},ee=function(e,t){return function(){t.dehover_node(e)}},te=this.midWrapper,ie=Y.id,re=this.get_node(Y.parent).children,se=e.inArray(ie,re),ne=this.holdingCells,de=!1;if(L=(p=(r=n(t)).children("[class~='jstree-anchor']")).hasClass("jstree-search"),D=p.hasClass("jstree-clicked"),1===p.length){!Y.state.opened,b=c(E,ie),S="#"===Y.parent?null:Y.parent,p.addClass(I),function(e,t,i){var r,s=e.hasClass("jstree-anchor")?e:e.children("[class~='jstree-anchor']"),n=i.settings.grid.columns[0];r="",n.title&&("_DATA_"===n.title?r=i.get_text(t):t.attr(n.title)&&(r=t.attr(n.title))),(r=r.replace(_,""))&&s.attr("title",r)}(p,r,V),f=p,M=se<=0?Y.parent:w(this,re[se-1]),q=se>=re.length-1?"NULL":re[se+1],T=Y.children&&Y.children.length>0?Y.children[0]:"NULL";this.settings.grid;for(var ae=0,oe=F.length;ae<oe;ae++)if(U!==ae){if(O=F[ae],N=null==this._domManipulation?te.children("div:eq("+ae+")"):n(this._domManipulation.columns[ae]),l=O.cellClass||"",h=O.wideCellClass||"",g=O.columnClass||"",N.addClass(g),a=x(O.value,Y),"function"==typeof O.format&&(a=O.format(a)),O.images?(s=O.images[a]||O.images.default)&&(P="*"===s[0]?'<span class="'+s.substr(1)+'"></span>':'<img src="'+s+'">'):P=a,(void 0===P||null===P||o.test(P))&&(P="&nbsp;"),(m=O.valueClass&&null!==Y.data&&void 0!==Y.data&&Y.data[O.valueClass]||"")&&O.valueClassPrefix&&""!==O.valueClassPrefix&&(m=O.valueClassPrefix+m),(v=O.wideValueClass&&null!==Y.data&&void 0!==Y.data&&Y.data[O.wideValueClass]||"")&&O.wideValueClassPrefix&&""!==O.wideValueClassPrefix&&(v=O.wideValueClassPrefix+v),y=(y=O.title&&null!==Y.data&&void 0!==Y.data&&Y.data[O.title]||"").replace(_,""),C=7,"auto"!==(O.width||G)&&C,(!(f=u(E,ie,ae,N))||f.length<1)&&(f=n("<div></div>"),n("<span></span>").appendTo(f),f.attr("id",b+ae),f.addClass(b),f.attr("data-jstreegrid",ie),L?f.addClass("jstree-search"):f.removeClass("jstree-search"),D?f.addClass("jstree-clicked"):f.removeClass("jstree-clicked"),!0===this.settings.core.themes.ellipsis&&ae!==U&&f.addClass("jstree-grid-ellipsis")),Y.state.hidden?f.addClass("jstree-grid-hidden"):f.removeClass("jstree-grid-hidden"),W=u(E,M,ae,N),z=u(E,q,ae,N),A=u(E,T,ae,N),k=u(E,S,ae,N),S?(k&&k.length>0?(W&&W.length>0?f.insertAfter(W):A&&A.length>0?f.insertBefore(A):z&&z.length>0?f.insertBefore(z):f.insertAfter(k),de=!0):de=!1,ne[b+ae]=f):(W&&W.length>0?f.insertAfter(W):A&&A.length>0?f.insertBefore(A):z&&z.length>0?f.insertBefore(z):f.appendTo(N),de=!0),de){var le=this.getHoldingCells(Y,ae,ne);f.after(le)}(j=f.children("span")).addClass(l+" "+m).html(P),(f=f.css(J).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+X+" jstree-grid-cell-"+Q+" "+h+" "+v+(B?" ui-state-default":"")).addClass("jstree-grid-col-"+ae).addClass("jstree-animated")).click(K($,r,a,O)),f.on("contextmenu",R($,r,a,O,this)),f.hover(Z(r,this),ee(r,this)),y&&j.attr("title",y),$.trigger("render_cell.jstree-grid",[{value:a,column:O.header,node:r,sourceName:O.value}])}f.addClass("jstree-grid-cell-last"+(B?" ui-state-default":"")),void 0===F[F.length-1].width&&f.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}},n});
//# sourceMappingURL=../sourcemaps/addons/treegrid.js.map
