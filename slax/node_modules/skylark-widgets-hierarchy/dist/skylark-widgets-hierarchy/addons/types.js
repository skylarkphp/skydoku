/**
 * skylark-widgets-hierarchy - The skylark hierarchy widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-hierarchy/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-eventer","skylark-domx-noder","skylark-domx-geom","skylark-domx-query","../Hierarchy"],function(t,e,i,r,a,s,d){"use strict";if(!s.jstree.plugins.types)return s.jstree.defaults.types={default:{}},s.jstree.defaults.types[s.jstree.root]={},s.jstree.plugins.types=function(e,i){this.init=function(t,e){var r,a;if(e&&e.types&&e.types.default)for(r in e.types)if("default"!==r&&r!==s.jstree.root&&e.types.hasOwnProperty(r))for(a in e.types.default)e.types.default.hasOwnProperty(a)&&void 0===e.types[r][a]&&(e.types[r][a]=e.types.default[a]);i.init.call(this,t,e),this._model.data[s.jstree.root].type=s.jstree.root},this.refresh=function(t,e){i.refresh.call(this,t,e),this._model.data[s.jstree.root].type=s.jstree.root},this.bind=function(){this.element.on("model.jstree",t.proxy(function(t,e){var i,r,a,d=this._model.data,l=e.nodes,n=this.settings.types,o="default";for(i=0,r=l.length;i<r;i++){if(o="default",d[l[i]].original&&d[l[i]].original.type&&n[d[l[i]].original.type]&&(o=d[l[i]].original.type),d[l[i]].data&&d[l[i]].data.jstree&&d[l[i]].data.jstree.type&&n[d[l[i]].data.jstree.type]&&(o=d[l[i]].data.jstree.type),d[l[i]].type=o,!0===d[l[i]].icon&&void 0!==n[o].icon&&(d[l[i]].icon=n[o].icon),void 0!==n[o].li_attr&&"object"==typeof n[o].li_attr)for(a in n[o].li_attr)if(n[o].li_attr.hasOwnProperty(a)){if("id"===a)continue;void 0===d[l[i]].li_attr[a]?d[l[i]].li_attr[a]=n[o].li_attr[a]:"class"===a&&(d[l[i]].li_attr.class=n[o].li_attr.class+" "+d[l[i]].li_attr.class)}if(void 0!==n[o].a_attr&&"object"==typeof n[o].a_attr)for(a in n[o].a_attr)if(n[o].a_attr.hasOwnProperty(a)){if("id"===a)continue;void 0===d[l[i]].a_attr[a]?d[l[i]].a_attr[a]=n[o].a_attr[a]:"href"===a&&"#"===d[l[i]].a_attr[a]?d[l[i]].a_attr.href=n[o].a_attr.href:"class"===a&&(d[l[i]].a_attr.class=n[o].a_attr.class+" "+d[l[i]].a_attr.class)}}d[s.jstree.root].type=s.jstree.root},this)),i.bind.call(this)},this.get_json=function(e,r,a){var s,d,l=this._model.data,n=r?t.extend(!0,{},r,{no_id:!1}):{},o=i.get_json.call(this,e,n,a);if(!1===o)return!1;if(t.isArray(o))for(s=0,d=o.length;s<d;s++)o[s].type=o[s].id&&l[o[s].id]&&l[o[s].id].type?l[o[s].id].type:"default",r&&r.no_id&&(delete o[s].id,o[s].li_attr&&o[s].li_attr.id&&delete o[s].li_attr.id,o[s].a_attr&&o[s].a_attr.id&&delete o[s].a_attr.id);else o.type=o.id&&l[o.id]&&l[o.id].type?l[o.id].type:"default",r&&r.no_id&&(o=this._delete_ids(o));return o},this._delete_ids=function(e){if(t.isArray(e)){for(var i=0,r=e.length;i<r;i++)e[i]=this._delete_ids(e[i]);return e}return delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id,e.children&&t.isArray(e.children)&&(e.children=this._delete_ids(e.children)),e},this.check=function(e,r,a,d,l){if(!1===i.check.call(this,e,r,a,d,l))return!1;r=r&&r.id?r:this.get_node(r),a=a&&a.id?a:this.get_node(a);var n,o,_,c,h=r&&r.id?l&&l.origin?l.origin:s.jstree.reference(r.id):null;switch(h=h&&h._model&&h._model.data?h._model.data:null,e){case"create_node":case"move_node":case"copy_node":if("move_node"!==e||-1===t.inArray(r.id,a.children)){if(void 0!==(n=this.get_rules(a)).max_children&&-1!==n.max_children&&n.max_children===a.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+e,data:JSON.stringify({chk:e,pos:d,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(void 0!==n.valid_children&&-1!==n.valid_children&&-1===t.inArray(r.type||"default",n.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+e,data:JSON.stringify({chk:e,pos:d,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(h&&r.children_d&&r.parents){for(o=0,_=0,c=r.children_d.length;_<c;_++)o=Math.max(o,h[r.children_d[_]].parents.length);o=o-r.parents.length+1}(o<=0||void 0===o)&&(o=1);do{if(void 0!==n.max_depth&&-1!==n.max_depth&&n.max_depth<o)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+e,data:JSON.stringify({chk:e,pos:d,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;a=this.get_node(a.parent),n=this.get_rules(a),o++}while(a)}}return!0},this.get_rules=function(t){if(!(t=this.get_node(t)))return!1;var e=this.get_type(t,!0);return void 0===e.max_depth&&(e.max_depth=-1),void 0===e.max_children&&(e.max_children=-1),void 0===e.valid_children&&(e.valid_children=-1),e},this.get_type=function(e,i){return!!(e=this.get_node(e))&&(i?t.extend({type:e.type},this.settings.types[e.type]):e.type)},this.set_type=function(e,i){var r,a,s,d,l,n,o,_,c=this._model.data;if(t.isArray(e)){for(a=0,s=(e=e.slice()).length;a<s;a++)this.set_type(e[a],i);return!0}if(r=this.settings.types,e=this.get_node(e),!r[i]||!e)return!1;if((o=this.get_node(e,!0))&&o.length&&(_=o.children(".jstree-anchor")),d=e.type,l=this.get_icon(e),e.type=i,(!0===l||!r[d]||void 0!==r[d].icon&&l===r[d].icon)&&this.set_icon(e,void 0===r[i].icon||r[i].icon),r[d]&&void 0!==r[d].li_attr&&"object"==typeof r[d].li_attr)for(n in r[d].li_attr)if(r[d].li_attr.hasOwnProperty(n)){if("id"===n)continue;"class"===n?(c[e.id].li_attr.class=(c[e.id].li_attr.class||"").replace(r[d].li_attr[n],""),o&&o.removeClass(r[d].li_attr[n])):c[e.id].li_attr[n]===r[d].li_attr[n]&&(c[e.id].li_attr[n]=null,o&&o.removeAttr(n))}if(r[d]&&void 0!==r[d].a_attr&&"object"==typeof r[d].a_attr)for(n in r[d].a_attr)if(r[d].a_attr.hasOwnProperty(n)){if("id"===n)continue;"class"===n?(c[e.id].a_attr.class=(c[e.id].a_attr.class||"").replace(r[d].a_attr[n],""),_&&_.removeClass(r[d].a_attr[n])):c[e.id].a_attr[n]===r[d].a_attr[n]&&("href"===n?(c[e.id].a_attr[n]="#",_&&_.attr("href","#")):(delete c[e.id].a_attr[n],_&&_.removeAttr(n)))}if(void 0!==r[i].li_attr&&"object"==typeof r[i].li_attr)for(n in r[i].li_attr)if(r[i].li_attr.hasOwnProperty(n)){if("id"===n)continue;void 0===c[e.id].li_attr[n]?(c[e.id].li_attr[n]=r[i].li_attr[n],o&&("class"===n?o.addClass(r[i].li_attr[n]):o.attr(n,r[i].li_attr[n]))):"class"===n&&(c[e.id].li_attr.class=r[i].li_attr[n]+" "+c[e.id].li_attr.class,o&&o.addClass(r[i].li_attr[n]))}if(void 0!==r[i].a_attr&&"object"==typeof r[i].a_attr)for(n in r[i].a_attr)if(r[i].a_attr.hasOwnProperty(n)){if("id"===n)continue;void 0===c[e.id].a_attr[n]?(c[e.id].a_attr[n]=r[i].a_attr[n],_&&("class"===n?_.addClass(r[i].a_attr[n]):_.attr(n,r[i].a_attr[n]))):"href"===n&&"#"===c[e.id].a_attr[n]?(c[e.id].a_attr.href=r[i].a_attr.href,_&&_.attr("href",r[i].a_attr.href)):"class"===n&&(c[e.id].a_attr.class=r[i].a_attr.class+" "+c[e.id].a_attr.class,_&&_.addClass(r[i].a_attr[n]))}return!0}},s});
//# sourceMappingURL=../sourcemaps/addons/types.js.map
