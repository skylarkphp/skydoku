{"version":3,"sources":["addons/dnd.js"],"names":["define","langx","browser","eventer","noder","geom","$","jstree","drg","elm","plugins","dnd","defaults","copy","open_timeout","is_draggable","check_while_dragging","always_copy","inside_pos","drag_selection","touch","large_drop_target","large_drag_target","use_html5","options","parent","this","init","el","call","settings","document","createElement","bind","element","on","proxy","e","target","closest","currentTarget","type","children","hasClass","obj","get_node","mlt","is_selected","get_top_selected","length","txt","get_string","get_text","core","force_text","vakata","html","escape","id","root","which","isFunction","origin","nodes","trigger","start","get_theme","get_theme_variant","themes","responsive","_trigger","helper","data","preventDefault","redraw_node","deep","callback","force_render","apply","arguments","setAttribute","i","j","tmp","childNodes","className","indexOf","lastmv","laster","lastev","opento","marker","hide","appendTo","body","isDifferentNode","event","clearTimeout","l","t","h","p","o","ok","t1","t2","op","ps","pr","ip","tm","is_copy","pn","ins","reference","ref","off","rel","_data","attr","metaKey","ctrlKey","find","first","get_container_ul","is","offset","undefined","pageY","originalEvent","top","outerHeight","each","v","left","get_parent","index","Math","min","inArray","check","pos","is_multi","is_foreign","last_error","x","z","setTimeout","open_node","removeClass","addClass","par","is_loaded","css","show","dataTransfer","dropEffect","detach","error","_get","_clean","div","str","text","strip","empty","append","parseHTML","vakata_dnd","is_down","is_drag","helper_w","init_x","init_y","scroll_l","scroll_t","scroll_e","scroll_i","is_touch","scroll_speed","scroll_proximity","helper_left","helper_top","threshold","threshold_touch","event_name","remove","clearInterval","drag","stop","_scroll","init_only","setInterval","scrollTop","scrollLeft","changedTouches","pageX","elementFromPoint","window","pageXOffset","pageYOffset","unselectable","onselectstart","style","touchAction","msTouchAction","MozUserSelect","ignore","display","margin","padding","position","lineHeight","zIndex","abs","outerWidth","one","d","w","dh","wh","dw","ww","dt","dl","ht","hl","parentsUntil","addBack","get","reverse","filter","test","scrollHeight","offsetHeight","scrollWidth","offsetWidth","height","width","parseInt","to","click"],"mappings":"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","file":"../../addons/dnd.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-query\",\r\n  \"../Hierarchy\"\r\n],function(langx,browser,eventer,noder,geom,$,jstree){\r\n\r\n\t\"use strict\";\r\n\r\n\tif($.jstree.plugins.dnd) { return; }\r\n\r\n\t/**\r\n\t * stores all defaults for the drag'n'drop plugin\r\n\t * @name $.jstree.defaults.dnd\r\n\t * @plugin dnd\r\n\t */\r\n\t$.jstree.defaults.dnd = {\r\n\t\t/**\r\n\t\t * a boolean indicating if a copy should be possible while dragging (by pressint the meta key or Ctrl). Defaults to `true`.\r\n\t\t * @name $.jstree.defaults.dnd.copy\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tcopy : true,\r\n\t\t/**\r\n\t\t * a number indicating how long a node should remain hovered while dragging to be opened. Defaults to `500`.\r\n\t\t * @name $.jstree.defaults.dnd.open_timeout\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\topen_timeout : 500,\r\n\t\t/**\r\n\t\t * a function invoked each time a node is about to be dragged, invoked in the tree's scope and receives the nodes about to be dragged as an argument (array) and the event that started the drag - return `false` to prevent dragging\r\n\t\t * @name $.jstree.defaults.dnd.is_draggable\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tis_draggable : true,\r\n\t\t/**\r\n\t\t * a boolean indicating if checks should constantly be made while the user is dragging the node (as opposed to checking only on drop), default is `true`\r\n\t\t * @name $.jstree.defaults.dnd.check_while_dragging\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tcheck_while_dragging : true,\r\n\t\t/**\r\n\t\t * a boolean indicating if nodes from this tree should only be copied with dnd (as opposed to moved), default is `false`\r\n\t\t * @name $.jstree.defaults.dnd.always_copy\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\talways_copy : false,\r\n\t\t/**\r\n\t\t * when dropping a node \"inside\", this setting indicates the position the node should go to - it can be an integer or a string: \"first\" (same as 0) or \"last\", default is `0`\r\n\t\t * @name $.jstree.defaults.dnd.inside_pos\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tinside_pos : 0,\r\n\t\t/**\r\n\t\t * when starting the drag on a node that is selected this setting controls if all selected nodes are dragged or only the single node, default is `true`, which means all selected nodes are dragged when the drag is started on a selected node\r\n\t\t * @name $.jstree.defaults.dnd.drag_selection\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tdrag_selection : true,\r\n\t\t/**\r\n\t\t * controls whether dnd works on touch devices. If left as boolean true dnd will work the same as in desktop browsers, which in some cases may impair scrolling. If set to boolean false dnd will not work on touch devices. There is a special third option - string \"selected\" which means only selected nodes can be dragged on touch devices.\r\n\t\t * @name $.jstree.defaults.dnd.touch\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\ttouch : true,\r\n\t\t/**\r\n\t\t * controls whether items can be dropped anywhere on the node, not just on the anchor, by default only the node anchor is a valid drop target. Works best with the wholerow plugin. If enabled on mobile depending on the interface it might be hard for the user to cancel the drop, since the whole tree container will be a valid drop target.\r\n\t\t * @name $.jstree.defaults.dnd.large_drop_target\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tlarge_drop_target : false,\r\n\t\t/**\r\n\t\t * controls whether a drag can be initiated from any part of the node and not just the text/icon part, works best with the wholerow plugin. Keep in mind it can cause problems with tree scrolling on mobile depending on the interface - in that case set the touch option to \"selected\".\r\n\t\t * @name $.jstree.defaults.dnd.large_drag_target\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tlarge_drag_target : false,\r\n\t\t/**\r\n\t\t * controls whether use HTML5 dnd api instead of classical. That will allow better integration of dnd events with other HTML5 controls.\r\n\t\t * @reference http://caniuse.com/#feat=dragndrop\r\n\t\t * @name $.jstree.defaults.dnd.use_html5\r\n\t\t * @plugin dnd\r\n\t\t */\r\n\t\tuse_html5: false\r\n\t};\r\n\tvar drg, elm;\r\n\t// TODO: now check works by checking for each node individually, how about max_children, unique, etc?\r\n\t$.jstree.plugins.dnd = function (options, parent) {\r\n\t\tthis.init = function (el, options) {\r\n\t\t\tparent.init.call(this, el, options);\r\n\t\t\tthis.settings.dnd.use_html5 = this.settings.dnd.use_html5 && ('draggable' in document.createElement('span'));\r\n\t\t};\r\n\t\tthis.bind = function () {\r\n\t\t\tparent.bind.call(this);\r\n\r\n\t\t\tthis.element\r\n\t\t\t\t.on(this.settings.dnd.use_html5 ? 'dragstart.jstree' : 'mousedown.jstree touchstart.jstree', this.settings.dnd.large_drag_target ? '.jstree-node' : '.jstree-anchor', $.proxy(function (e) {\r\n\t\t\t\t\t\tif(this.settings.dnd.large_drag_target && $(e.target).closest('.jstree-node')[0] !== e.currentTarget) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(e.type === \"touchstart\" && (!this.settings.dnd.touch || (this.settings.dnd.touch === 'selected' && !$(e.currentTarget).closest('.jstree-node').children('.jstree-anchor').hasClass('jstree-clicked')))) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar obj = this.get_node(e.target),\r\n\t\t\t\t\t\t\tmlt = this.is_selected(obj) && this.settings.dnd.drag_selection ? this.get_top_selected().length : 1,\r\n\t\t\t\t\t\t\ttxt = (mlt > 1 ? mlt + ' ' + this.get_string('nodes') : this.get_text(e.currentTarget));\r\n\t\t\t\t\t\tif(this.settings.core.force_text) {\r\n\t\t\t\t\t\t\ttxt = $.vakata.html.escape(txt);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(obj && obj.id && obj.id !== $.jstree.root && (e.which === 1 || e.type === \"touchstart\" || e.type === \"dragstart\") &&\r\n\t\t\t\t\t\t\t(this.settings.dnd.is_draggable === true || ($.isFunction(this.settings.dnd.is_draggable) && this.settings.dnd.is_draggable.call(this, (mlt > 1 ? this.get_top_selected(true) : [obj]), e)))\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tdrg = { 'jstree' : true, 'origin' : this, 'obj' : this.get_node(obj,true), 'nodes' : mlt > 1 ? this.get_top_selected() : [obj.id] };\r\n\t\t\t\t\t\t\telm = e.currentTarget;\r\n\t\t\t\t\t\t\tif (this.settings.dnd.use_html5) {\r\n\t\t\t\t\t\t\t\t$.vakata.dnd._trigger('start', e, { 'helper': $(), 'element': elm, 'data': drg });\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.element.trigger('mousedown.jstree');\r\n\t\t\t\t\t\t\t\treturn $.vakata.dnd.start(e, drg, '<div id=\"jstree-dnd\" class=\"jstree-' + this.get_theme() + ' jstree-' + this.get_theme() + '-' + this.get_theme_variant() + ' ' + ( this.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ) + '\"><i class=\"jstree-icon jstree-er\"></i>' + txt + '<ins class=\"jstree-copy\" style=\"display:none;\">+</ins></div>');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this));\r\n\t\t\tif (this.settings.dnd.use_html5) {\r\n\t\t\t\tthis.element\r\n\t\t\t\t\t.on('dragover.jstree', function (e) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t$.vakata.dnd._trigger('move', e, { 'helper': $(), 'element': elm, 'data': drg });\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t//.on('dragenter.jstree', this.settings.dnd.large_drop_target ? '.jstree-node' : '.jstree-anchor', $.proxy(function (e) {\r\n\t\t\t\t\t//\t\te.preventDefault();\r\n\t\t\t\t\t//\t\t$.vakata.dnd._trigger('move', e, { 'helper': $(), 'element': elm, 'data': drg });\r\n\t\t\t\t\t//\t\treturn false;\r\n\t\t\t\t\t//\t}, this))\r\n\t\t\t\t\t.on('drop.jstree', $.proxy(function (e) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t$.vakata.dnd._trigger('stop', e, { 'helper': $(), 'element': elm, 'data': drg });\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}, this));\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.redraw_node = function(obj, deep, callback, force_render) {\r\n\t\t\tobj = parent.redraw_node.apply(this, arguments);\r\n\t\t\tif (obj && this.settings.dnd.use_html5) {\r\n\t\t\t\tif (this.settings.dnd.large_drag_target) {\r\n\t\t\t\t\tobj.setAttribute('draggable', true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar i, j, tmp = null;\r\n\t\t\t\t\tfor(i = 0, j = obj.childNodes.length; i < j; i++) {\r\n\t\t\t\t\t\tif(obj.childNodes[i] && obj.childNodes[i].className && obj.childNodes[i].className.indexOf(\"jstree-anchor\") !== -1) {\r\n\t\t\t\t\t\t\ttmp = obj.childNodes[i];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(tmp) {\r\n\t\t\t\t\t\ttmp.setAttribute('draggable', true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn obj;\r\n\t\t};\r\n\t};\r\n\r\n\t$(function() {\r\n\t\t// bind only once for all instances\r\n\t\tvar lastmv = false,\r\n\t\t\tlaster = false,\r\n\t\t\tlastev = false,\r\n\t\t\topento = false,\r\n\t\t\tmarker = $('<div id=\"jstree-marker\">&#160;</div>').hide(); //.appendTo('body');\r\n\r\n\t\t$(document)\r\n\t\t\t.on('dnd_start.vakata.jstree', function (e, data) {\r\n\t\t\t\tlastmv = false;\r\n\t\t\t\tlastev = false;\r\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\r\n\t\t\t\tmarker.appendTo(document.body); //.show();\r\n\t\t\t})\r\n\t\t\t.on('dnd_move.vakata.jstree', function (e, data) {\r\n\t\t\t\tvar isDifferentNode = data.event.target !== lastev.target;\r\n\t\t\t\tif(opento) {\r\n\t\t\t\t\tif (!data.event || data.event.type !== 'dragover' || isDifferentNode) {\r\n\t\t\t\t\t\tclearTimeout(opento);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\r\n\r\n\t\t\t\t// if we are hovering the marker image do nothing (can happen on \"inside\" drags)\r\n\t\t\t\tif(data.event.target.id && data.event.target.id === 'jstree-marker') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlastev = data.event;\r\n\r\n\t\t\t\tvar ins = $.jstree.reference(data.event.target),\r\n\t\t\t\t\tref = false,\r\n\t\t\t\t\toff = false,\r\n\t\t\t\t\trel = false,\r\n\t\t\t\t\ttmp, l, t, h, p, i, o, ok, t1, t2, op, ps, pr, ip, tm, is_copy, pn;\r\n\t\t\t\t// if we are over an instance\r\n\t\t\t\tif(ins && ins._data && ins._data.dnd) {\r\n\t\t\t\t\tmarker.attr('class', 'jstree-' + ins.get_theme() + ( ins.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ));\r\n\t\t\t\t\tis_copy = data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey)));\r\n\t\t\t\t\tdata.helper\r\n\t\t\t\t\t\t.children().attr('class', 'jstree-' + ins.get_theme() + ' jstree-' + ins.get_theme() + '-' + ins.get_theme_variant() + ' ' + ( ins.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ))\r\n\t\t\t\t\t\t.find('.jstree-copy').first()[ is_copy ? 'show' : 'hide' ]();\r\n\r\n\t\t\t\t\t// if are hovering the container itself add a new root node\r\n\t\t\t\t\t//console.log(data.event);\r\n\t\t\t\t\tif( (data.event.target === ins.element[0] || data.event.target === ins.get_container_ul()[0]) && ins.get_container_ul().children().length === 0) {\r\n\t\t\t\t\t\tok = true;\r\n\t\t\t\t\t\tfor(t1 = 0, t2 = data.data.nodes.length; t1 < t2; t1++) {\r\n\t\t\t\t\t\t\tok = ok && ins.check( (data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey)) ) ? \"copy_node\" : \"move_node\"), (data.data.origin && data.data.origin !== ins ? data.data.origin.get_node(data.data.nodes[t1]) : data.data.nodes[t1]), $.jstree.root, 'last', { 'dnd' : true, 'ref' : ins.get_node($.jstree.root), 'pos' : 'i', 'origin' : data.data.origin, 'is_multi' : (data.data.origin && data.data.origin !== ins), 'is_foreign' : (!data.data.origin) });\r\n\t\t\t\t\t\t\tif(!ok) { break; }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(ok) {\r\n\t\t\t\t\t\t\tlastmv = { 'ins' : ins, 'par' : $.jstree.root, 'pos' : 'last' };\r\n\t\t\t\t\t\t\tmarker.hide();\r\n\t\t\t\t\t\t\tdata.helper.find('.jstree-icon').first().removeClass('jstree-er').addClass('jstree-ok');\r\n\t\t\t\t\t\t\tif (data.event.originalEvent && data.event.originalEvent.dataTransfer) {\r\n\t\t\t\t\t\t\t\tdata.event.originalEvent.dataTransfer.dropEffect = is_copy ? 'copy' : 'move';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// if we are hovering a tree node\r\n\t\t\t\t\t\tref = ins.settings.dnd.large_drop_target ? $(data.event.target).closest('.jstree-node').children('.jstree-anchor') : $(data.event.target).closest('.jstree-anchor');\r\n\t\t\t\t\t\tif(ref && ref.length && ref.parent().is('.jstree-closed, .jstree-open, .jstree-leaf')) {\r\n\t\t\t\t\t\t\toff = ref.offset();\r\n\t\t\t\t\t\t\trel = (data.event.pageY !== undefined ? data.event.pageY : data.event.originalEvent.pageY) - off.top;\r\n\t\t\t\t\t\t\th = ref.outerHeight();\r\n\t\t\t\t\t\t\tif(rel < h / 3) {\r\n\t\t\t\t\t\t\t\to = ['b', 'i', 'a'];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if(rel > h - h / 3) {\r\n\t\t\t\t\t\t\t\to = ['a', 'i', 'b'];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\to = rel > h / 2 ? ['i', 'a', 'b'] : ['i', 'b', 'a'];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$.each(o, function (j, v) {\r\n\t\t\t\t\t\t\t\tswitch(v) {\r\n\t\t\t\t\t\t\t\t\tcase 'b':\r\n\t\t\t\t\t\t\t\t\t\tl = off.left - 6;\r\n\t\t\t\t\t\t\t\t\t\tt = off.top;\r\n\t\t\t\t\t\t\t\t\t\tp = ins.get_parent(ref);\r\n\t\t\t\t\t\t\t\t\t\ti = ref.parent().index();\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase 'i':\r\n\t\t\t\t\t\t\t\t\t\tip = ins.settings.dnd.inside_pos;\r\n\t\t\t\t\t\t\t\t\t\ttm = ins.get_node(ref.parent());\r\n\t\t\t\t\t\t\t\t\t\tl = off.left - 2;\r\n\t\t\t\t\t\t\t\t\t\tt = off.top + h / 2 + 1;\r\n\t\t\t\t\t\t\t\t\t\tp = tm.id;\r\n\t\t\t\t\t\t\t\t\t\ti = ip === 'first' ? 0 : (ip === 'last' ? tm.children.length : Math.min(ip, tm.children.length));\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\tcase 'a':\r\n\t\t\t\t\t\t\t\t\t\tl = off.left - 6;\r\n\t\t\t\t\t\t\t\t\t\tt = off.top + h;\r\n\t\t\t\t\t\t\t\t\t\tp = ins.get_parent(ref);\r\n\t\t\t\t\t\t\t\t\t\ti = ref.parent().index() + 1;\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tok = true;\r\n\t\t\t\t\t\t\t\tfor(t1 = 0, t2 = data.data.nodes.length; t1 < t2; t1++) {\r\n\t\t\t\t\t\t\t\t\top = data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey))) ? \"copy_node\" : \"move_node\";\r\n\t\t\t\t\t\t\t\t\tps = i;\r\n\t\t\t\t\t\t\t\t\tif(op === \"move_node\" && v === 'a' && (data.data.origin && data.data.origin === ins) && p === ins.get_parent(data.data.nodes[t1])) {\r\n\t\t\t\t\t\t\t\t\t\tpr = ins.get_node(p);\r\n\t\t\t\t\t\t\t\t\t\tif(ps > $.inArray(data.data.nodes[t1], pr.children)) {\r\n\t\t\t\t\t\t\t\t\t\t\tps -= 1;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tok = ok && ( (ins && ins.settings && ins.settings.dnd && ins.settings.dnd.check_while_dragging === false) || ins.check(op, (data.data.origin && data.data.origin !== ins ? data.data.origin.get_node(data.data.nodes[t1]) : data.data.nodes[t1]), p, ps, { 'dnd' : true, 'ref' : ins.get_node(ref.parent()), 'pos' : v, 'origin' : data.data.origin, 'is_multi' : (data.data.origin && data.data.origin !== ins), 'is_foreign' : (!data.data.origin) }) );\r\n\t\t\t\t\t\t\t\t\tif(!ok) {\r\n\t\t\t\t\t\t\t\t\t\tif(ins && ins.last_error) { laster = ins.last_error(); }\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(v === 'i' && ref.parent().is('.jstree-closed') && ins.settings.dnd.open_timeout) {\r\n\t\t\t\t\t\t\t\t\tif (!data.event || data.event.type !== 'dragover' || isDifferentNode) {\r\n\t\t\t\t\t\t\t\t\t\tif (opento) { clearTimeout(opento); }\r\n\t\t\t\t\t\t\t\t\t\topento = setTimeout((function (x, z) { return function () { x.open_node(z); }; }(ins, ref)), ins.settings.dnd.open_timeout);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(ok) {\r\n\t\t\t\t\t\t\t\t\tpn = ins.get_node(p, true);\r\n\t\t\t\t\t\t\t\t\tif (!pn.hasClass('.jstree-dnd-parent')) {\r\n\t\t\t\t\t\t\t\t\t\t$('.jstree-dnd-parent').removeClass('jstree-dnd-parent');\r\n\t\t\t\t\t\t\t\t\t\tpn.addClass('jstree-dnd-parent');\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tlastmv = { 'ins' : ins, 'par' : p, 'pos' : v === 'i' && ip === 'last' && i === 0 && !ins.is_loaded(tm) ? 'last' : i };\r\n\t\t\t\t\t\t\t\t\tmarker.css({ 'left' : l + 'px', 'top' : t + 'px' }).show();\r\n\t\t\t\t\t\t\t\t\tdata.helper.find('.jstree-icon').first().removeClass('jstree-er').addClass('jstree-ok');\r\n\t\t\t\t\t\t\t\t\tif (data.event.originalEvent && data.event.originalEvent.dataTransfer) {\r\n\t\t\t\t\t\t\t\t\t\tdata.event.originalEvent.dataTransfer.dropEffect = is_copy ? 'copy' : 'move';\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tlaster = {};\r\n\t\t\t\t\t\t\t\t\to = true;\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif(o === true) { return; }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t$('.jstree-dnd-parent').removeClass('jstree-dnd-parent');\r\n\t\t\t\tlastmv = false;\r\n\t\t\t\tdata.helper.find('.jstree-icon').removeClass('jstree-ok').addClass('jstree-er');\r\n\t\t\t\tif (data.event.originalEvent && data.event.originalEvent.dataTransfer) {\r\n\t\t\t\t\tdata.event.originalEvent.dataTransfer.dropEffect = 'none';\r\n\t\t\t\t}\r\n\t\t\t\tmarker.hide();\r\n\t\t\t})\r\n\t\t\t.on('dnd_scroll.vakata.jstree', function (e, data) {\r\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\r\n\t\t\t\tmarker.hide();\r\n\t\t\t\tlastmv = false;\r\n\t\t\t\tlastev = false;\r\n\t\t\t\tdata.helper.find('.jstree-icon').first().removeClass('jstree-ok').addClass('jstree-er');\r\n\t\t\t})\r\n\t\t\t.on('dnd_stop.vakata.jstree', function (e, data) {\r\n\t\t\t\t$('.jstree-dnd-parent').removeClass('jstree-dnd-parent');\r\n\t\t\t\tif(opento) { clearTimeout(opento); }\r\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\r\n\t\t\t\tmarker.hide().detach();\r\n\t\t\t\tvar i, j, nodes = [];\r\n\t\t\t\tif(lastmv) {\r\n\t\t\t\t\tfor(i = 0, j = data.data.nodes.length; i < j; i++) {\r\n\t\t\t\t\t\tnodes[i] = data.data.origin ? data.data.origin.get_node(data.data.nodes[i]) : data.data.nodes[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlastmv.ins[ data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey))) ? 'copy_node' : 'move_node' ](nodes, lastmv.par, lastmv.pos, false, false, false, data.data.origin);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ti = $(data.event.target).closest('.jstree');\r\n\t\t\t\t\tif(i.length && laster && laster.error && laster.error === 'check') {\r\n\t\t\t\t\t\ti = i.jstree(true);\r\n\t\t\t\t\t\tif(i) {\r\n\t\t\t\t\t\t\ti.settings.core.error.call(this, laster);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlastev = false;\r\n\t\t\t\tlastmv = false;\r\n\t\t\t})\r\n\t\t\t.on('keyup.jstree keydown.jstree', function (e, data) {\r\n\t\t\t\tdata = $.vakata.dnd._get();\r\n\t\t\t\tif(data && data.data && data.data.jstree) {\r\n\t\t\t\t\tif (e.type === \"keyup\" && e.which === 27) {\r\n\t\t\t\t\t\tif (opento) { clearTimeout(opento); }\r\n\t\t\t\t\t\tlastmv = false;\r\n\t\t\t\t\t\tlaster = false;\r\n\t\t\t\t\t\tlastev = false;\r\n\t\t\t\t\t\topento = false;\r\n\t\t\t\t\t\tmarker.hide().detach();\r\n\t\t\t\t\t\t$.vakata.dnd._clean();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata.helper.find('.jstree-copy').first()[ data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (e.metaKey || e.ctrlKey))) ? 'show' : 'hide' ]();\r\n\t\t\t\t\t\tif(lastev) {\r\n\t\t\t\t\t\t\tlastev.metaKey = e.metaKey;\r\n\t\t\t\t\t\t\tlastev.ctrlKey = e.ctrlKey;\r\n\t\t\t\t\t\t\t$.vakata.dnd._trigger('move', lastev);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t});\r\n\r\n\t// helpers\r\n\t(function ($) {\r\n\t\t$.vakata.html = {\r\n\t\t\tdiv : $('<div />'),\r\n\t\t\tescape : function (str) {\r\n\t\t\t\treturn $.vakata.html.div.text(str).html();\r\n\t\t\t},\r\n\t\t\tstrip : function (str) {\r\n\t\t\t\treturn $.vakata.html.div.empty().append($.parseHTML(str)).text();\r\n\t\t\t}\r\n\t\t};\r\n\t\t// private variable\r\n\t\tvar vakata_dnd = {\r\n\t\t\telement\t: false,\r\n\t\t\ttarget\t: false,\r\n\t\t\tis_down\t: false,\r\n\t\t\tis_drag\t: false,\r\n\t\t\thelper\t: false,\r\n\t\t\thelper_w: 0,\r\n\t\t\tdata\t: false,\r\n\t\t\tinit_x\t: 0,\r\n\t\t\tinit_y\t: 0,\r\n\t\t\tscroll_l: 0,\r\n\t\t\tscroll_t: 0,\r\n\t\t\tscroll_e: false,\r\n\t\t\tscroll_i: false,\r\n\t\t\tis_touch: false\r\n\t\t};\r\n\t\t$.vakata.dnd = {\r\n\t\t\tsettings : {\r\n\t\t\t\tscroll_speed\t\t: 10,\r\n\t\t\t\tscroll_proximity\t: 20,\r\n\t\t\t\thelper_left\t\t\t: 5,\r\n\t\t\t\thelper_top\t\t\t: 10,\r\n\t\t\t\tthreshold\t\t\t: 5,\r\n\t\t\t\tthreshold_touch\t\t: 10\r\n\t\t\t},\r\n\t\t\t_trigger : function (event_name, e, data) {\r\n\t\t\t\tif (data === undefined) {\r\n\t\t\t\t\tdata = $.vakata.dnd._get();\r\n\t\t\t\t}\r\n\t\t\t\tdata.event = e;\r\n\t\t\t\t$(document).trigger(\"dnd_\" + event_name + \".vakata\", data);\r\n\t\t\t},\r\n\t\t\t_get : function () {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"data\"\t\t: vakata_dnd.data,\r\n\t\t\t\t\t\"element\"\t: vakata_dnd.element,\r\n\t\t\t\t\t\"helper\"\t: vakata_dnd.helper\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\t_clean : function () {\r\n\t\t\t\tif(vakata_dnd.helper) { vakata_dnd.helper.remove(); }\r\n\t\t\t\tif(vakata_dnd.scroll_i) { clearInterval(vakata_dnd.scroll_i); vakata_dnd.scroll_i = false; }\r\n\t\t\t\tvakata_dnd = {\r\n\t\t\t\t\telement\t: false,\r\n\t\t\t\t\ttarget\t: false,\r\n\t\t\t\t\tis_down\t: false,\r\n\t\t\t\t\tis_drag\t: false,\r\n\t\t\t\t\thelper\t: false,\r\n\t\t\t\t\thelper_w: 0,\r\n\t\t\t\t\tdata\t: false,\r\n\t\t\t\t\tinit_x\t: 0,\r\n\t\t\t\t\tinit_y\t: 0,\r\n\t\t\t\t\tscroll_l: 0,\r\n\t\t\t\t\tscroll_t: 0,\r\n\t\t\t\t\tscroll_e: false,\r\n\t\t\t\t\tscroll_i: false,\r\n\t\t\t\t\tis_touch: false\r\n\t\t\t\t};\r\n\t\t\t\t$(document).off(\"mousemove.vakata.jstree touchmove.vakata.jstree\", $.vakata.dnd.drag);\r\n\t\t\t\t$(document).off(\"mouseup.vakata.jstree touchend.vakata.jstree\", $.vakata.dnd.stop);\r\n\t\t\t},\r\n\t\t\t_scroll : function (init_only) {\r\n\t\t\t\tif(!vakata_dnd.scroll_e || (!vakata_dnd.scroll_l && !vakata_dnd.scroll_t)) {\r\n\t\t\t\t\tif(vakata_dnd.scroll_i) { clearInterval(vakata_dnd.scroll_i); vakata_dnd.scroll_i = false; }\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif(!vakata_dnd.scroll_i) {\r\n\t\t\t\t\tvakata_dnd.scroll_i = setInterval($.vakata.dnd._scroll, 100);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif(init_only === true) { return false; }\r\n\r\n\t\t\t\tvar i = vakata_dnd.scroll_e.scrollTop(),\r\n\t\t\t\t\tj = vakata_dnd.scroll_e.scrollLeft();\r\n\t\t\t\tvakata_dnd.scroll_e.scrollTop(i + vakata_dnd.scroll_t * $.vakata.dnd.settings.scroll_speed);\r\n\t\t\t\tvakata_dnd.scroll_e.scrollLeft(j + vakata_dnd.scroll_l * $.vakata.dnd.settings.scroll_speed);\r\n\t\t\t\tif(i !== vakata_dnd.scroll_e.scrollTop() || j !== vakata_dnd.scroll_e.scrollLeft()) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * triggered on the document when a drag causes an element to scroll\r\n\t\t\t\t\t * @event\r\n\t\t\t\t\t * @plugin dnd\r\n\t\t\t\t\t * @name dnd_scroll.vakata\r\n\t\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\r\n\t\t\t\t\t * @param {DOM} element the DOM element being dragged\r\n\t\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\r\n\t\t\t\t\t * @param {jQuery} event the element that is scrolling\r\n\t\t\t\t\t */\r\n\t\t\t\t\t$.vakata.dnd._trigger(\"scroll\", vakata_dnd.scroll_e);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tstart : function (e, data, html) {\r\n\t\t\t\tif(e.type === \"touchstart\" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {\r\n\t\t\t\t\te.pageX = e.originalEvent.changedTouches[0].pageX;\r\n\t\t\t\t\te.pageY = e.originalEvent.changedTouches[0].pageY;\r\n\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);\r\n\t\t\t\t}\r\n\t\t\t\tif(vakata_dnd.is_drag) { $.vakata.dnd.stop({}); }\r\n\t\t\t\ttry {\r\n\t\t\t\t\te.currentTarget.unselectable = \"on\";\r\n\t\t\t\t\te.currentTarget.onselectstart = function() { return false; };\r\n\t\t\t\t\tif(e.currentTarget.style) {\r\n\t\t\t\t\t\te.currentTarget.style.touchAction = \"none\";\r\n\t\t\t\t\t\te.currentTarget.style.msTouchAction = \"none\";\r\n\t\t\t\t\t\te.currentTarget.style.MozUserSelect = \"none\";\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(ignore) { }\r\n\t\t\t\tvakata_dnd.init_x\t= e.pageX;\r\n\t\t\t\tvakata_dnd.init_y\t= e.pageY;\r\n\t\t\t\tvakata_dnd.data\t\t= data;\r\n\t\t\t\tvakata_dnd.is_down\t= true;\r\n\t\t\t\tvakata_dnd.element\t= e.currentTarget;\r\n\t\t\t\tvakata_dnd.target\t= e.target;\r\n\t\t\t\tvakata_dnd.is_touch\t= e.type === \"touchstart\";\r\n\t\t\t\tif(html !== false) {\r\n\t\t\t\t\tvakata_dnd.helper = $(\"<div id='vakata-dnd'></div>\").html(html).css({\r\n\t\t\t\t\t\t\"display\"\t\t: \"block\",\r\n\t\t\t\t\t\t\"margin\"\t\t: \"0\",\r\n\t\t\t\t\t\t\"padding\"\t\t: \"0\",\r\n\t\t\t\t\t\t\"position\"\t\t: \"absolute\",\r\n\t\t\t\t\t\t\"top\"\t\t\t: \"-2000px\",\r\n\t\t\t\t\t\t\"lineHeight\"\t: \"16px\",\r\n\t\t\t\t\t\t\"zIndex\"\t\t: \"10000\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t$(document).on(\"mousemove.vakata.jstree touchmove.vakata.jstree\", $.vakata.dnd.drag);\r\n\t\t\t\t$(document).on(\"mouseup.vakata.jstree touchend.vakata.jstree\", $.vakata.dnd.stop);\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tdrag : function (e) {\r\n\t\t\t\tif(e.type === \"touchmove\" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {\r\n\t\t\t\t\te.pageX = e.originalEvent.changedTouches[0].pageX;\r\n\t\t\t\t\te.pageY = e.originalEvent.changedTouches[0].pageY;\r\n\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);\r\n\t\t\t\t}\r\n\t\t\t\tif(!vakata_dnd.is_down) { return; }\r\n\t\t\t\tif(!vakata_dnd.is_drag) {\r\n\t\t\t\t\tif(\r\n\t\t\t\t\t\tMath.abs(e.pageX - vakata_dnd.init_x) > (vakata_dnd.is_touch ? $.vakata.dnd.settings.threshold_touch : $.vakata.dnd.settings.threshold) ||\r\n\t\t\t\t\t\tMath.abs(e.pageY - vakata_dnd.init_y) > (vakata_dnd.is_touch ? $.vakata.dnd.settings.threshold_touch : $.vakata.dnd.settings.threshold)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tif(vakata_dnd.helper) {\r\n\t\t\t\t\t\t\tvakata_dnd.helper.appendTo(document.body);\r\n\t\t\t\t\t\t\tvakata_dnd.helper_w = vakata_dnd.helper.outerWidth();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvakata_dnd.is_drag = true;\r\n\t\t\t\t\t\t$(vakata_dnd.target).one('click.vakata', false);\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * triggered on the document when a drag starts\r\n\t\t\t\t\t\t * @event\r\n\t\t\t\t\t\t * @plugin dnd\r\n\t\t\t\t\t\t * @name dnd_start.vakata\r\n\t\t\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\r\n\t\t\t\t\t\t * @param {DOM} element the DOM element being dragged\r\n\t\t\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\r\n\t\t\t\t\t\t * @param {Object} event the event that caused the start (probably mousemove)\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\t$.vakata.dnd._trigger(\"start\", e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse { return; }\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar d  = false, w  = false,\r\n\t\t\t\t\tdh = false, wh = false,\r\n\t\t\t\t\tdw = false, ww = false,\r\n\t\t\t\t\tdt = false, dl = false,\r\n\t\t\t\t\tht = false, hl = false;\r\n\r\n\t\t\t\tvakata_dnd.scroll_t = 0;\r\n\t\t\t\tvakata_dnd.scroll_l = 0;\r\n\t\t\t\tvakata_dnd.scroll_e = false;\r\n\t\t\t\t$($(e.target).parentsUntil(\"body\").addBack().get().reverse())\r\n\t\t\t\t\t.filter(function () {\r\n\t\t\t\t\t\treturn\t(/^auto|scroll$/).test($(this).css(\"overflow\")) &&\r\n\t\t\t\t\t\t\t\t(this.scrollHeight > this.offsetHeight || this.scrollWidth > this.offsetWidth);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.each(function () {\r\n\t\t\t\t\t\tvar t = $(this), o = t.offset();\r\n\t\t\t\t\t\tif(this.scrollHeight > this.offsetHeight) {\r\n\t\t\t\t\t\t\tif(o.top + t.height() - e.pageY < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_t = 1; }\r\n\t\t\t\t\t\t\tif(e.pageY - o.top < $.vakata.dnd.settings.scroll_proximity)\t\t\t\t{ vakata_dnd.scroll_t = -1; }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(this.scrollWidth > this.offsetWidth) {\r\n\t\t\t\t\t\t\tif(o.left + t.width() - e.pageX < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_l = 1; }\r\n\t\t\t\t\t\t\tif(e.pageX - o.left < $.vakata.dnd.settings.scroll_proximity)\t\t\t\t{ vakata_dnd.scroll_l = -1; }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(vakata_dnd.scroll_t || vakata_dnd.scroll_l) {\r\n\t\t\t\t\t\t\tvakata_dnd.scroll_e = $(this);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\tif(!vakata_dnd.scroll_e) {\r\n\t\t\t\t\td  = $(document); w = $(window);\r\n\t\t\t\t\tdh = d.height(); wh = w.height();\r\n\t\t\t\t\tdw = d.width(); ww = w.width();\r\n\t\t\t\t\tdt = d.scrollTop(); dl = d.scrollLeft();\r\n\t\t\t\t\tif(dh > wh && e.pageY - dt < $.vakata.dnd.settings.scroll_proximity)\t\t{ vakata_dnd.scroll_t = -1;  }\r\n\t\t\t\t\tif(dh > wh && wh - (e.pageY - dt) < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_t = 1; }\r\n\t\t\t\t\tif(dw > ww && e.pageX - dl < $.vakata.dnd.settings.scroll_proximity)\t\t{ vakata_dnd.scroll_l = -1; }\r\n\t\t\t\t\tif(dw > ww && ww - (e.pageX - dl) < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_l = 1; }\r\n\t\t\t\t\tif(vakata_dnd.scroll_t || vakata_dnd.scroll_l) {\r\n\t\t\t\t\t\tvakata_dnd.scroll_e = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(vakata_dnd.scroll_e) { $.vakata.dnd._scroll(true); }\r\n\r\n\t\t\t\tif(vakata_dnd.helper) {\r\n\t\t\t\t\tht = parseInt(e.pageY + $.vakata.dnd.settings.helper_top, 10);\r\n\t\t\t\t\thl = parseInt(e.pageX + $.vakata.dnd.settings.helper_left, 10);\r\n\t\t\t\t\tif(dh && ht + 25 > dh) { ht = dh - 50; }\r\n\t\t\t\t\tif(dw && hl + vakata_dnd.helper_w > dw) { hl = dw - (vakata_dnd.helper_w + 2); }\r\n\t\t\t\t\tvakata_dnd.helper.css({\r\n\t\t\t\t\t\tleft\t: hl + \"px\",\r\n\t\t\t\t\t\ttop\t\t: ht + \"px\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t/**\r\n\t\t\t\t * triggered on the document when a drag is in progress\r\n\t\t\t\t * @event\r\n\t\t\t\t * @plugin dnd\r\n\t\t\t\t * @name dnd_move.vakata\r\n\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\r\n\t\t\t\t * @param {DOM} element the DOM element being dragged\r\n\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\r\n\t\t\t\t * @param {Object} event the event that caused this to trigger (most likely mousemove)\r\n\t\t\t\t */\r\n\t\t\t\t$.vakata.dnd._trigger(\"move\", e);\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tstop : function (e) {\r\n\t\t\t\tif(e.type === \"touchend\" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {\r\n\t\t\t\t\te.pageX = e.originalEvent.changedTouches[0].pageX;\r\n\t\t\t\t\te.pageY = e.originalEvent.changedTouches[0].pageY;\r\n\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);\r\n\t\t\t\t}\r\n\t\t\t\tif(vakata_dnd.is_drag) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * triggered on the document when a drag stops (the dragged element is dropped)\r\n\t\t\t\t\t * @event\r\n\t\t\t\t\t * @plugin dnd\r\n\t\t\t\t\t * @name dnd_stop.vakata\r\n\t\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\r\n\t\t\t\t\t * @param {DOM} element the DOM element being dragged\r\n\t\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\r\n\t\t\t\t\t * @param {Object} event the event that caused the stop\r\n\t\t\t\t\t */\r\n\t\t\t\t\tif (e.target !== vakata_dnd.target) {\r\n\t\t\t\t\t\t$(vakata_dnd.target).off('click.vakata');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$.vakata.dnd._trigger(\"stop\", e);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif(e.type === \"touchend\" && e.target === vakata_dnd.target) {\r\n\t\t\t\t\t\tvar to = setTimeout(function () { $(e.target).click(); }, 100);\r\n\t\t\t\t\t\t$(e.target).one('click', function() { if(to) { clearTimeout(to); } });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t$.vakata.dnd._clean();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t}($));\r\n\r\n\t// include the dnd plugin by default\r\n\t// $.jstree.defaults.plugins.push(\"dnd\");\r\n\r\n\treturn $;\r\n\t\r\n});\r\n"]}