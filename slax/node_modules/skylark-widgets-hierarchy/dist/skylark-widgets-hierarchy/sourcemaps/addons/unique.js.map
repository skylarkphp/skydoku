{"version":3,"sources":["addons/unique.js"],"names":["define","langx","browser","eventer","noder","geom","$","jstree","plugins","unique","defaults","case_sensitive","trim_whitespace","duplicate","name","counter","options","parent","this","check","chk","obj","par","pos","more","call","id","get_node","children","i","j","t","n","text","c","s","settings","w","m","_model","data","length","toLowerCase","replace","push","inArray","_data","core","last_error","error","plugin","reason","JSON","stringify","is_multi","create_node","node","callback","is_loaded","undefined","root","toString","match","tmp","dpc","cb","get_string"],"mappings":"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","file":"../../addons/unique.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-query\",\r\n  \"../Hierarchy\"\r\n],function(langx,browser,eventer,noder,geom,$,jstree){\r\n\t\"use strict\";\r\n\r\n\tif($.jstree.plugins.unique) { return; }\r\n\r\n\t/**\r\n\t * stores all defaults for the unique plugin\r\n\t * @name $.jstree.defaults.unique\r\n\t * @plugin unique\r\n\t */\r\n\t$.jstree.defaults.unique = {\r\n\t\t/**\r\n\t\t * Indicates if the comparison should be case sensitive. Default is `false`.\r\n\t\t * @name $.jstree.defaults.unique.case_sensitive\r\n\t\t * @plugin unique\r\n\t\t */\r\n\t\tcase_sensitive : false,\r\n\t\t/**\r\n\t\t * Indicates if white space should be trimmed before the comparison. Default is `false`.\r\n\t\t * @name $.jstree.defaults.unique.trim_whitespace\r\n\t\t * @plugin unique\r\n\t\t */\r\n\t\ttrim_whitespace : false,\r\n\t\t/**\r\n\t\t * A callback executed in the instance's scope when a new node is created and the name is already taken, the two arguments are the conflicting name and the counter. The default will produce results like `New node (2)`.\r\n\t\t * @name $.jstree.defaults.unique.duplicate\r\n\t\t * @plugin unique\r\n\t\t */\r\n\t\tduplicate : function (name, counter) {\r\n\t\t\treturn name + ' (' + counter + ')';\r\n\t\t}\r\n\t};\r\n\r\n\t$.jstree.plugins.unique = function (options, parent) {\r\n\t\tthis.check = function (chk, obj, par, pos, more) {\r\n\t\t\tif(parent.check.call(this, chk, obj, par, pos, more) === false) { return false; }\r\n\t\t\tobj = obj && obj.id ? obj : this.get_node(obj);\r\n\t\t\tpar = par && par.id ? par : this.get_node(par);\r\n\t\t\tif(!par || !par.children) { return true; }\r\n\t\t\tvar n = chk === \"rename_node\" ? pos : obj.text,\r\n\t\t\t\tc = [],\r\n\t\t\t\ts = this.settings.unique.case_sensitive,\r\n\t\t\t\tw = this.settings.unique.trim_whitespace,\r\n\t\t\t\tm = this._model.data, i, j, t;\r\n\t\t\tfor(i = 0, j = par.children.length; i < j; i++) {\r\n\t\t\t\tt = m[par.children[i]].text;\r\n\t\t\t\tif (!s) {\r\n\t\t\t\t\tt = t.toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t\tif (w) {\r\n\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\r\n\t\t\t\t}\r\n\t\t\t\tc.push(t);\r\n\t\t\t}\r\n\t\t\tif(!s) { n = n.toLowerCase(); }\r\n\t\t\tif (w) { n = n.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, ''); }\r\n\t\t\tswitch(chk) {\r\n\t\t\t\tcase \"delete_node\":\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tcase \"rename_node\":\r\n\t\t\t\t\tt = obj.text || '';\r\n\t\t\t\t\tif (!s) {\r\n\t\t\t\t\t\tt = t.toLowerCase();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (w) {\r\n\t\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti = (langx.inArray(n, c) === -1 || (obj.text && t === n));\r\n\t\t\t\t\tif(!i) {\r\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_01', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn i;\r\n\t\t\t\tcase \"create_node\":\r\n\t\t\t\t\ti = (langx.inArray(n, c) === -1);\r\n\t\t\t\t\tif(!i) {\r\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_04', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn i;\r\n\t\t\t\tcase \"copy_node\":\r\n\t\t\t\t\ti = (langx.inArray(n, c) === -1);\r\n\t\t\t\t\tif(!i) {\r\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_02', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn i;\r\n\t\t\t\tcase \"move_node\":\r\n\t\t\t\t\ti = ( (obj.parent === par.id && (!more || !more.is_multi)) || langx.inArray(n, c) === -1);\r\n\t\t\t\t\tif(!i) {\r\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_03', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tthis.create_node = function (par, node, pos, callback, is_loaded) {\r\n\t\t\tif(!node || node.text === undefined) {\r\n\t\t\t\tif(par === null) {\r\n\t\t\t\t\tpar = $.jstree.root;\r\n\t\t\t\t}\r\n\t\t\t\tpar = this.get_node(par);\r\n\t\t\t\tif(!par) {\r\n\t\t\t\t\treturn parent.create_node.call(this, par, node, pos, callback, is_loaded);\r\n\t\t\t\t}\r\n\t\t\t\tpos = pos === undefined ? \"last\" : pos;\r\n\t\t\t\tif(!pos.toString().match(/^(before|after)$/) && !is_loaded && !this.is_loaded(par)) {\r\n\t\t\t\t\treturn parent.create_node.call(this, par, node, pos, callback, is_loaded);\r\n\t\t\t\t}\r\n\t\t\t\tif(!node) { node = {}; }\r\n\t\t\t\tvar tmp, n, dpc, i, j, m = this._model.data, s = this.settings.unique.case_sensitive, w = this.settings.unique.trim_whitespace, cb = this.settings.unique.duplicate, t;\r\n\t\t\t\tn = tmp = this.get_string('New node');\r\n\t\t\t\tdpc = [];\r\n\t\t\t\tfor(i = 0, j = par.children.length; i < j; i++) {\r\n\t\t\t\t\tt = m[par.children[i]].text;\r\n\t\t\t\t\tif (!s) {\r\n\t\t\t\t\t\tt = t.toLowerCase();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (w) {\r\n\t\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdpc.push(t);\r\n\t\t\t\t}\r\n\t\t\t\ti = 1;\r\n\t\t\t\tt = n;\r\n\t\t\t\tif (!s) {\r\n\t\t\t\t\tt = t.toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t\tif (w) {\r\n\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\r\n\t\t\t\t}\r\n\t\t\t\twhile(langx.inArray(t, dpc) !== -1) {\r\n\t\t\t\t\tn = cb.call(this, tmp, (++i)).toString();\r\n\t\t\t\t\tt = n;\r\n\t\t\t\t\tif (!s) {\r\n\t\t\t\t\t\tt = t.toLowerCase();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (w) {\r\n\t\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tnode.text = n;\r\n\t\t\t}\r\n\t\t\treturn parent.create_node.call(this, par, node, pos, callback, is_loaded);\r\n\t\t};\r\n\t};\r\n\r\n\t// include the unique plugin by default\r\n\t// $.jstree.defaults.plugins.push(\"unique\");\r\n\treturn $;\r\n\t\r\n});\r\n"]}