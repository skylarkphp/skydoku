{"version":3,"sources":["addons/massload.js"],"names":["define","langx","browser","eventer","noder","geom","$","jstree","plugins","massload","defaults","options","parent","this","init","el","_data","call","_load_nodes","nodes","callback","is_callback","force_reload","i","j","dom","s","settings","toLoad","JSON","stringify","m","_model","data","length","state","loaded","failed","push","get_node","addClass","attr","isFunction","proxy","hasOwnProperty","removeClass","url","extend","ajax","done","t","x","fail","f","_load_node","obj","id","rslt","parseHTML","filter","nodeType","status"],"mappings":"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","file":"../../addons/massload.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-query\",\r\n  \"../Hierarchy\"\r\n],function(langx,browser,eventer,noder,geom,$,jstree){\r\n\r\n\t\"use strict\";\r\n\r\n\tif($.jstree.plugins.massload) { return; }\r\n\r\n\t/**\r\n\t * massload configuration\r\n\t *\r\n\t * It is possible to set this to a standard jQuery-like AJAX config.\r\n\t * In addition to the standard jQuery ajax options here you can supply functions for `data` and `url`, the functions will be run in the current instance's scope and a param will be passed indicating which node IDs need to be loaded, the return value of those functions will be used.\r\n\t *\r\n\t * You can also set this to a function, that function will receive the node IDs being loaded as argument and a second param which is a function (callback) which should be called with the result.\r\n\t *\r\n\t * Both the AJAX and the function approach rely on the same return value - an object where the keys are the node IDs, and the value is the children of that node as an array.\r\n\t *\r\n\t *\t{\r\n\t *\t\t\"id1\" : [{ \"text\" : \"Child of ID1\", \"id\" : \"c1\" }, { \"text\" : \"Another child of ID1\", \"id\" : \"c2\" }],\r\n\t *\t\t\"id2\" : [{ \"text\" : \"Child of ID2\", \"id\" : \"c3\" }]\r\n\t *\t}\r\n\t * \r\n\t * @name $.jstree.defaults.massload\r\n\t * @plugin massload\r\n\t */\r\n\t$.jstree.defaults.massload = null;\r\n\t$.jstree.plugins.massload = function (options, parent) {\r\n\t\tthis.init = function (el, options) {\r\n\t\t\tthis._data.massload = {};\r\n\t\t\tparent.init.call(this, el, options);\r\n\t\t};\r\n\t\tthis._load_nodes = function (nodes, callback, is_callback, force_reload) {\r\n\t\t\tvar s = this.settings.massload,\r\n\t\t\t\tnodesString = JSON.stringify(nodes),\r\n\t\t\t\ttoLoad = [],\r\n\t\t\t\tm = this._model.data,\r\n\t\t\t\ti, j, dom;\r\n\t\t\tif (!is_callback) {\r\n\t\t\t\tfor(i = 0, j = nodes.length; i < j; i++) {\r\n\t\t\t\t\tif(!m[nodes[i]] || ( (!m[nodes[i]].state.loaded && !m[nodes[i]].state.failed) || force_reload) ) {\r\n\t\t\t\t\t\ttoLoad.push(nodes[i]);\r\n\t\t\t\t\t\tdom = this.get_node(nodes[i], true);\r\n\t\t\t\t\t\tif (dom && dom.length) {\r\n\t\t\t\t\t\t\tdom.addClass(\"jstree-loading\").attr('aria-busy',true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._data.massload = {};\r\n\t\t\t\tif (toLoad.length) {\r\n\t\t\t\t\tif($.isFunction(s)) {\r\n\t\t\t\t\t\treturn s.call(this, toLoad, $.proxy(function (data) {\r\n\t\t\t\t\t\t\tvar i, j;\r\n\t\t\t\t\t\t\tif(data) {\r\n\t\t\t\t\t\t\t\tfor(i in data) {\r\n\t\t\t\t\t\t\t\t\tif(data.hasOwnProperty(i)) {\r\n\t\t\t\t\t\t\t\t\t\tthis._data.massload[i] = data[i];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor(i = 0, j = nodes.length; i < j; i++) {\r\n\t\t\t\t\t\t\t\tdom = this.get_node(nodes[i], true);\r\n\t\t\t\t\t\t\t\tif (dom && dom.length) {\r\n\t\t\t\t\t\t\t\t\tdom.removeClass(\"jstree-loading\").attr('aria-busy',false);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tparent._load_nodes.call(this, nodes, callback, is_callback, force_reload);\r\n\t\t\t\t\t\t}, this));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(typeof s === 'object' && s && s.url) {\r\n\t\t\t\t\t\ts = $.extend(true, {}, s);\r\n\t\t\t\t\t\tif($.isFunction(s.url)) {\r\n\t\t\t\t\t\t\ts.url = s.url.call(this, toLoad);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif($.isFunction(s.data)) {\r\n\t\t\t\t\t\t\ts.data = s.data.call(this, toLoad);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn $.ajax(s)\r\n\t\t\t\t\t\t\t.done($.proxy(function (data,t,x) {\r\n\t\t\t\t\t\t\t\t\tvar i, j;\r\n\t\t\t\t\t\t\t\t\tif(data) {\r\n\t\t\t\t\t\t\t\t\t\tfor(i in data) {\r\n\t\t\t\t\t\t\t\t\t\t\tif(data.hasOwnProperty(i)) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tthis._data.massload[i] = data[i];\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tfor(i = 0, j = nodes.length; i < j; i++) {\r\n\t\t\t\t\t\t\t\t\t\tdom = this.get_node(nodes[i], true);\r\n\t\t\t\t\t\t\t\t\t\tif (dom && dom.length) {\r\n\t\t\t\t\t\t\t\t\t\t\tdom.removeClass(\"jstree-loading\").attr('aria-busy',false);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tparent._load_nodes.call(this, nodes, callback, is_callback, force_reload);\r\n\t\t\t\t\t\t\t\t}, this))\r\n\t\t\t\t\t\t\t.fail($.proxy(function (f) {\r\n\t\t\t\t\t\t\t\t\tparent._load_nodes.call(this, nodes, callback, is_callback, force_reload);\r\n\t\t\t\t\t\t\t\t}, this));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn parent._load_nodes.call(this, nodes, callback, is_callback, force_reload);\r\n\t\t};\r\n\t\tthis._load_node = function (obj, callback) {\r\n\t\t\tvar data = this._data.massload[obj.id],\r\n\t\t\t\trslt = null, dom;\r\n\t\t\tif(data) {\r\n\t\t\t\trslt = this[typeof data === 'string' ? '_append_html_data' : '_append_json_data'](\r\n\t\t\t\t\tobj,\r\n\t\t\t\t\ttypeof data === 'string' ? $($.parseHTML(data)).filter(function () { return this.nodeType !== 3; }) : data,\r\n\t\t\t\t\tfunction (status) { callback.call(this, status); }\r\n\t\t\t\t);\r\n\t\t\t\tdom = this.get_node(obj.id, true);\r\n\t\t\t\tif (dom && dom.length) {\r\n\t\t\t\t\tdom.removeClass(\"jstree-loading\").attr('aria-busy',false);\r\n\t\t\t\t}\r\n\t\t\t\tdelete this._data.massload[obj.id];\r\n\t\t\t\treturn rslt;\r\n\t\t\t}\r\n\t\t\treturn parent._load_node.call(this, obj, callback);\r\n\t\t};\r\n\t};\r\n\r\n\treturn $;\r\n\t\r\n});"]}