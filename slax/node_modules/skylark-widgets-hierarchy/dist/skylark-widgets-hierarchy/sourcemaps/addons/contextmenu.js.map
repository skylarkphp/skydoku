{"version":3,"sources":["addons/contextmenu.js"],"names":["define","langx","browser","eventer","noder","geom","$","menu","jstree","plugins","contextmenu","defaults","select_node","show_at_node","items","o","cb","create","separator_before","separator_after","_disabled","label","action","data","inst","reference","obj","get_node","create_node","new_node","edit","ex","setTimeout","rename","remove","icon","is_selected","delete_node","get_selected","ccp","submenu","cut","get_top_selected","copy","paste","can_paste","options","parent","this","bind","call","ey","last_ts","cto","element","on","proxy","get_container_ul","addClass","e","target","tagName","toLowerCase","preventDefault","ctrlKey","Date","clearTimeout","is_loading","currentTarget","show_contextmenu","pageX","pageY","_data","visible","hide","originalEvent","changedTouches","clientX","clientY","trigger","Math","abs","document","removeClass","teardown","x","y","id","root","s","settings","a","children","i","undefined","offset","left","top","core","li_height","activate_node","isFunction","_show_contextmenu","isPlainObject","one","cls","get_theme","popup","node"],"mappings":"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","file":"../../addons/contextmenu.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-query\",\r\n  \"./menu\",\r\n  \"../Hierarchy\"\r\n],function(langx,browser,eventer,noder,geom,$, menu,jstree){\r\n\r\n\t\"use strict\";\r\n\r\n\tif($.jstree.plugins.contextmenu) { return; }\r\n\r\n\t/**\r\n\t * stores all defaults for the contextmenu plugin\r\n\t * @name $.jstree.defaults.contextmenu\r\n\t * @plugin contextmenu\r\n\t */\r\n\t$.jstree.defaults.contextmenu = {\r\n\t\t/**\r\n\t\t * a boolean indicating if the node should be selected when the context menu is invoked on it. Defaults to `true`.\r\n\t\t * @name $.jstree.defaults.contextmenu.select_node\r\n\t\t * @plugin contextmenu\r\n\t\t */\r\n\t\tselect_node : true,\r\n\t\t/**\r\n\t\t * a boolean indicating if the menu should be shown aligned with the node. Defaults to `true`, otherwise the mouse coordinates are used.\r\n\t\t * @name $.jstree.defaults.contextmenu.show_at_node\r\n\t\t * @plugin contextmenu\r\n\t\t */\r\n\t\tshow_at_node : true,\r\n\t\t/**\r\n\t\t * an object of actions, or a function that accepts a node and a callback function and calls the callback function with an object of actions available for that node (you can also return the items too).\r\n\t\t *\r\n\t\t * Each action consists of a key (a unique name) and a value which is an object with the following properties (only label and action are required). Once a menu item is activated the `action` function will be invoked with an object containing the following keys: item - the contextmenu item definition as seen below, reference - the DOM node that was used (the tree node), element - the contextmenu DOM element, position - an object with x/y properties indicating the position of the menu.\r\n\t\t *\r\n\t\t * * `separator_before` - a boolean indicating if there should be a separator before this item\r\n\t\t * * `separator_after` - a boolean indicating if there should be a separator after this item\r\n\t\t * * `_disabled` - a boolean indicating if this action should be disabled\r\n\t\t * * `label` - a string - the name of the action (could be a function returning a string)\r\n\t\t * * `title` - a string - an optional tooltip for the item\r\n\t\t * * `action` - a function to be executed if this item is chosen, the function will receive \r\n\t\t * * `icon` - a string, can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class\r\n\t\t * * `shortcut` - keyCode which will trigger the action if the menu is open (for example `113` for rename, which equals F2)\r\n\t\t * * `shortcut_label` - shortcut label (like for example `F2` for rename)\r\n\t\t * * `submenu` - an object with the same structure as $.jstree.defaults.contextmenu.items which can be used to create a submenu - each key will be rendered as a separate option in a submenu that will appear once the current item is hovered\r\n\t\t *\r\n\t\t * @name $.jstree.defaults.contextmenu.items\r\n\t\t * @plugin contextmenu\r\n\t\t */\r\n\t\titems : function (o, cb) { // Could be an object directly\r\n\t\t\treturn {\r\n\t\t\t\t\"create\" : {\r\n\t\t\t\t\t\"separator_before\"\t: false,\r\n\t\t\t\t\t\"separator_after\"\t: true,\r\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"create_node\", data.reference, {}, \"last\")),\r\n\t\t\t\t\t\"label\"\t\t\t\t: \"Create\",\r\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\r\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\r\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\r\n\t\t\t\t\t\tinst.create_node(obj, {}, \"last\", function (new_node) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tinst.edit(new_node);\r\n\t\t\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\t\t\tsetTimeout(function () { inst.edit(new_node); },0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"rename\" : {\r\n\t\t\t\t\t\"separator_before\"\t: false,\r\n\t\t\t\t\t\"separator_after\"\t: false,\r\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"rename_node\", data.reference, this.get_parent(data.reference), \"\")),\r\n\t\t\t\t\t\"label\"\t\t\t\t: \"Rename\",\r\n\t\t\t\t\t/*!\r\n\t\t\t\t\t\"shortcut\"\t\t\t: 113,\r\n\t\t\t\t\t\"shortcut_label\"\t: 'F2',\r\n\t\t\t\t\t\"icon\"\t\t\t\t: \"glyphicon glyphicon-leaf\",\r\n\t\t\t\t\t*/\r\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\r\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\r\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\r\n\t\t\t\t\t\tinst.edit(obj);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"remove\" : {\r\n\t\t\t\t\t\"separator_before\"\t: false,\r\n\t\t\t\t\t\"icon\"\t\t\t\t: false,\r\n\t\t\t\t\t\"separator_after\"\t: false,\r\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"delete_node\", data.reference, this.get_parent(data.reference), \"\")),\r\n\t\t\t\t\t\"label\"\t\t\t\t: \"Delete\",\r\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\r\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\r\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\r\n\t\t\t\t\t\tif(inst.is_selected(obj)) {\r\n\t\t\t\t\t\t\tinst.delete_node(inst.get_selected());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tinst.delete_node(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"ccp\" : {\r\n\t\t\t\t\t\"separator_before\"\t: true,\r\n\t\t\t\t\t\"icon\"\t\t\t\t: false,\r\n\t\t\t\t\t\"separator_after\"\t: false,\r\n\t\t\t\t\t\"label\"\t\t\t\t: \"Edit\",\r\n\t\t\t\t\t\"action\"\t\t\t: false,\r\n\t\t\t\t\t\"submenu\" : {\r\n\t\t\t\t\t\t\"cut\" : {\r\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\r\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\r\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Cut\",\r\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\r\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\r\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\r\n\t\t\t\t\t\t\t\tif(inst.is_selected(obj)) {\r\n\t\t\t\t\t\t\t\t\tinst.cut(inst.get_top_selected());\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tinst.cut(obj);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"copy\" : {\r\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\r\n\t\t\t\t\t\t\t\"icon\"\t\t\t\t: false,\r\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\r\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Copy\",\r\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\r\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\r\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\r\n\t\t\t\t\t\t\t\tif(inst.is_selected(obj)) {\r\n\t\t\t\t\t\t\t\t\tinst.copy(inst.get_top_selected());\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tinst.copy(obj);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\"paste\" : {\r\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\r\n\t\t\t\t\t\t\t\"icon\"\t\t\t\t: false,\r\n\t\t\t\t\t\t\t\"_disabled\"\t\t\t: function (data) {\r\n\t\t\t\t\t\t\t\treturn !$.jstree.reference(data.reference).can_paste();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\r\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Paste\",\r\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\r\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\r\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\r\n\t\t\t\t\t\t\t\tinst.paste(obj);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t};\r\n\r\n\t$.jstree.plugins.contextmenu = function (options, parent) {\r\n\t\tthis.bind = function () {\r\n\t\t\tparent.bind.call(this);\r\n\r\n\t\t\tvar last_ts = 0, cto = null, ex, ey;\r\n\t\t\tthis.element\r\n\t\t\t\t.on(\"init.jstree loading.jstree ready.jstree\", langx.proxy(function () {\r\n\t\t\t\t\t\tthis.get_container_ul().addClass('jstree-contextmenu');\r\n\t\t\t\t\t}, this))\r\n\t\t\t\t.on(\"contextmenu.jstree\", \".jstree-anchor\", langx.proxy(function (e, data) {\r\n\t\t\t\t\t\tif (e.target.tagName.toLowerCase() === 'input') {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tlast_ts = e.ctrlKey ? +new Date() : 0;\r\n\t\t\t\t\t\tif(data || cto) {\r\n\t\t\t\t\t\t\tlast_ts = (+new Date()) + 10000;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(cto) {\r\n\t\t\t\t\t\t\tclearTimeout(cto);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(!this.is_loading(e.currentTarget)) {\r\n\t\t\t\t\t\t\tthis.show_contextmenu(e.currentTarget, e.pageX, e.pageY, e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this))\r\n\t\t\t\t.on(\"click.jstree\", \".jstree-anchor\", langx.proxy(function (e) {\r\n\t\t\t\t\t\tif(this._data.contextmenu.visible && (!last_ts || (+new Date()) - last_ts > 250)) { // work around safari & macOS ctrl+click\r\n\t\t\t\t\t\t\tmenu.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlast_ts = 0;\r\n\t\t\t\t\t}, this))\r\n\t\t\t\t.on(\"touchstart.jstree\", \".jstree-anchor\", function (e) {\r\n\t\t\t\t\t\tif(!e.originalEvent || !e.originalEvent.changedTouches || !e.originalEvent.changedTouches[0]) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tex = e.originalEvent.changedTouches[0].clientX;\r\n\t\t\t\t\t\tey = e.originalEvent.changedTouches[0].clientY;\r\n\t\t\t\t\t\tcto = setTimeout(function () {\r\n\t\t\t\t\t\t\t$(e.currentTarget).trigger('contextmenu', true);\r\n\t\t\t\t\t\t}, 750);\r\n\t\t\t\t\t})\r\n\t\t\t\t.on('touchmove.vakata.jstree', function (e) {\r\n\t\t\t\t\t\tif(cto && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0] && (Math.abs(ex - e.originalEvent.changedTouches[0].clientX) > 10 || Math.abs(ey - e.originalEvent.changedTouches[0].clientY) > 10)) {\r\n\t\t\t\t\t\t\tclearTimeout(cto);\r\n\t\t\t\t\t\t\tmenu.hide();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t.on('touchend.vakata.jstree', function (e) {\r\n\t\t\t\t\t\tif(cto) {\r\n\t\t\t\t\t\t\tclearTimeout(cto);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t/*!\r\n\t\t\tif(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {\r\n\t\t\t\tvar el = null, tm = null;\r\n\t\t\t\tthis.element\r\n\t\t\t\t\t.on(\"touchstart\", \".jstree-anchor\", function (e) {\r\n\t\t\t\t\t\tel = e.currentTarget;\r\n\t\t\t\t\t\ttm = +new Date();\r\n\t\t\t\t\t\t$(document).one(\"touchend\", function (e) {\r\n\t\t\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);\r\n\t\t\t\t\t\t\te.currentTarget = e.target;\r\n\t\t\t\t\t\t\ttm = ((+(new Date())) - tm);\r\n\t\t\t\t\t\t\tif(e.target === el && tm > 600 && tm < 1000) {\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t$(el).trigger('contextmenu', e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tel = null;\r\n\t\t\t\t\t\t\ttm = null;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t\t$(document).on(\"context_hide.sbswt.popup\", langx.proxy(function (e, data) {\r\n\t\t\t\tthis._data.contextmenu.visible = false;\r\n\t\t\t\t$(data.reference).removeClass('jstree-context');\r\n\t\t\t}, this));\r\n\t\t};\r\n\t\tthis.teardown = function () {\r\n\t\t\tif(this._data.contextmenu.visible) {\r\n\t\t\t\tmenu.hide();\r\n\t\t\t}\r\n\t\t\tparent.teardown.call(this);\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * prepare and show the context menu for a node\r\n\t\t * @name show_contextmenu(obj [, x, y])\r\n\t\t * @param {mixed} obj the node\r\n\t\t * @param {Number} x the x-coordinate relative to the document to show the menu at\r\n\t\t * @param {Number} y the y-coordinate relative to the document to show the menu at\r\n\t\t * @param {Object} e the event if available that triggered the contextmenu\r\n\t\t * @plugin contextmenu\r\n\t\t * @trigger show_contextmenu.jstree\r\n\t\t */\r\n\t\tthis.show_contextmenu = function (obj, x, y, e) {\r\n\t\t\tobj = this.get_node(obj);\r\n\t\t\tif(!obj || obj.id === $.jstree.root) { return false; }\r\n\t\t\tvar s = this.settings.contextmenu,\r\n\t\t\t\td = this.get_node(obj, true),\r\n\t\t\t\ta = d.children(\".jstree-anchor\"),\r\n\t\t\t\to = false,\r\n\t\t\t\ti = false;\r\n\t\t\tif(s.show_at_node || x === undefined || y === undefined) {\r\n\t\t\t\to = a.offset();\r\n\t\t\t\tx = o.left;\r\n\t\t\t\ty = o.top + this._data.core.li_height;\r\n\t\t\t}\r\n\t\t\tif(this.settings.contextmenu.select_node && !this.is_selected(obj)) {\r\n\t\t\t\tthis.activate_node(obj, e);\r\n\t\t\t}\r\n\r\n\t\t\ti = s.items;\r\n\t\t\tif(langx.isFunction(i)) {\r\n\t\t\t\ti = i.call(this, obj, langx.proxy(function (i) {\r\n\t\t\t\t\tthis._show_contextmenu(obj, x, y, i);\r\n\t\t\t\t}, this));\r\n\t\t\t}\r\n\t\t\tif(langx.isPlainObject(i)) {\r\n\t\t\t\tthis._show_contextmenu(obj, x, y, i);\r\n\t\t\t}\r\n\t\t};\r\n\t\t/**\r\n\t\t * show the prepared context menu for a node\r\n\t\t * @name _show_contextmenu(obj, x, y, i)\r\n\t\t * @param {mixed} obj the node\r\n\t\t * @param {Number} x the x-coordinate relative to the document to show the menu at\r\n\t\t * @param {Number} y the y-coordinate relative to the document to show the menu at\r\n\t\t * @param {Number} i the object of items to show\r\n\t\t * @plugin contextmenu\r\n\t\t * @trigger show_contextmenu.jstree\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis._show_contextmenu = function (obj, x, y, i) {\r\n\t\t\tvar d = this.get_node(obj, true),\r\n\t\t\t\ta = d.children(\".jstree-anchor\");\r\n\t\t\t$(document).one(\"context_show.sbswt.popup\", langx.proxy(function (e, data) {\r\n\t\t\t\tvar cls = 'jstree-contextmenu jstree-' + this.get_theme() + '-contextmenu';\r\n\t\t\t\t$(data.element).addClass(cls);\r\n\t\t\t\ta.addClass('jstree-context');\r\n\t\t\t}, this));\r\n\t\t\tthis._data.contextmenu.visible = true;\r\n\t\t\tmenu.popup(a, { 'x' : x, 'y' : y }, i);\r\n\t\t\t/**\r\n\t\t\t * triggered when the contextmenu is shown for a node\r\n\t\t\t * @event\r\n\t\t\t * @name show_contextmenu.jstree\r\n\t\t\t * @param {Object} node the node\r\n\t\t\t * @param {Number} x the x-coordinate of the menu relative to the document\r\n\t\t\t * @param {Number} y the y-coordinate of the menu relative to the document\r\n\t\t\t * @plugin contextmenu\r\n\t\t\t */\r\n\t\t\tthis.trigger('show_contextmenu', { \"node\" : obj, \"x\" : x, \"y\" : y });\r\n\t\t};\r\n\t};\r\n\r\n\t// $.jstree.defaults.plugins.push(\"contextmenu\");\r\n\r\n\treturn $;\r\n\t\r\n});\r\n"]}