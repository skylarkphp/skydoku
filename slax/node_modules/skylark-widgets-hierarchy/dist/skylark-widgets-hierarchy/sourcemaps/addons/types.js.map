{"version":3,"sources":["addons/types.js"],"names":["define","langx","browser","eventer","noder","geom","$","jstree","plugins","types","defaults","default","root","options","parent","this","init","el","i","j","hasOwnProperty","undefined","call","_model","data","type","refresh","skip_loading","forget_state","bind","element","on","proxy","e","k","m","dpc","nodes","t","settings","c","length","original","icon","li_attr","a_attr","get_json","obj","flat","opt","extend","no_id","tmp","isArray","id","_delete_ids","children","check","chk","par","pos","more","get_node","d","origin","reference","inArray","get_rules","max_children","_data","core","last_error","error","plugin","reason","JSON","stringify","valid_children","children_d","parents","Math","max","max_depth","get_type","rules","set_type","t1","t2","old_type","old_icon","a","slice","get_icon","set_icon","replace","removeClass","removeAttr","attr","addClass"],"mappings":";;;;;;;AAAAA,QACE,sBACA,uBACA,uBACA,qBACA,oBACA,qBACA,gBACA,SAASC,EAAMC,EAAQC,EAAQC,EAAMC,EAAKC,EAAEC,GAC7C,aAEA,IAAGD,EAAEC,OAAOC,QAAQC,MA+VpB,OA3UAH,EAAEC,OAAOG,SAASD,OACjBE,YAEDL,EAAEC,OAAOG,SAASD,MAAMH,EAAEC,OAAOK,SAEjCN,EAAEC,OAAOC,QAAQC,MAAQ,SAAUI,EAASC,GAC3CC,KAAKC,KAAO,SAAUC,EAAIJ,GACzB,IAAIK,EAAGC,EACP,GAAGN,GAAWA,EAAQJ,OAASI,EAAQJ,MAAe,QACrD,IAAIS,KAAKL,EAAQJ,MAChB,GAAS,YAANS,GAAmBA,IAAMZ,EAAEC,OAAOK,MAAQC,EAAQJ,MAAMW,eAAeF,GACzE,IAAIC,KAAKN,EAAQJ,MAAe,QAC5BI,EAAQJ,MAAe,QAAEW,eAAeD,SAA8BE,IAAxBR,EAAQJ,MAAMS,GAAGC,KACjEN,EAAQJ,MAAMS,GAAGC,GAAKN,EAAQJ,MAAe,QAAEU,IAMpDL,EAAOE,KAAKM,KAAKP,KAAME,EAAIJ,GAC3BE,KAAKQ,OAAOC,KAAKlB,EAAEC,OAAOK,MAAMa,KAAOnB,EAAEC,OAAOK,MAEjDG,KAAKW,QAAU,SAAUC,EAAcC,GACtCd,EAAOY,QAAQJ,KAAKP,KAAMY,EAAcC,GACxCb,KAAKQ,OAAOC,KAAKlB,EAAEC,OAAOK,MAAMa,KAAOnB,EAAEC,OAAOK,MAEjDG,KAAKc,KAAO,WACXd,KAAKe,QACHC,GAAG,eAAgBzB,EAAE0B,MAAM,SAAUC,EAAGT,GACvC,IAGCN,EAAGC,EAAkBe,EAHlBC,EAAIpB,KAAKQ,OAAOC,KACnBY,EAAMZ,EAAKa,MACXC,EAAIvB,KAAKwB,SAAS9B,MACZ+B,EAAI,UACX,IAAItB,EAAI,EAAGC,EAAIiB,EAAIK,OAAQvB,EAAIC,EAAGD,IAAK,CAYtC,GAXAsB,EAAI,UACDL,EAAEC,EAAIlB,IAAIwB,UAAYP,EAAEC,EAAIlB,IAAIwB,SAASjB,MAAQa,EAAEH,EAAEC,EAAIlB,IAAIwB,SAASjB,QACxEe,EAAIL,EAAEC,EAAIlB,IAAIwB,SAASjB,MAErBU,EAAEC,EAAIlB,IAAIM,MAAQW,EAAEC,EAAIlB,IAAIM,KAAKjB,QAAU4B,EAAEC,EAAIlB,IAAIM,KAAKjB,OAAOkB,MAAQa,EAAEH,EAAEC,EAAIlB,IAAIM,KAAKjB,OAAOkB,QACnGe,EAAIL,EAAEC,EAAIlB,IAAIM,KAAKjB,OAAOkB,MAE3BU,EAAEC,EAAIlB,IAAIO,KAAOe,GACK,IAAnBL,EAAEC,EAAIlB,IAAIyB,WAA+BtB,IAAdiB,EAAEE,GAAGG,OAClCR,EAAEC,EAAIlB,IAAIyB,KAAOL,EAAEE,GAAGG,WAEHtB,IAAjBiB,EAAEE,GAAGI,SAAiD,iBAAjBN,EAAEE,GAAGI,QAC5C,IAAKV,KAAKI,EAAEE,GAAGI,QACd,GAAIN,EAAEE,GAAGI,QAAQxB,eAAec,GAAI,CACnC,GAAU,OAANA,EACH,cAEiCb,IAAzBc,EAAEC,EAAIlB,IAAI0B,QAAQV,GAC1BC,EAAEC,EAAIlB,IAAI0B,QAAQV,GAAKI,EAAEE,GAAGI,QAAQV,GAEtB,UAANA,IACRC,EAAEC,EAAIlB,IAAI0B,QAAe,MAAIN,EAAEE,GAAGI,QAAe,MAAI,IAAMT,EAAEC,EAAIlB,IAAI0B,QAAe,OAKxF,QAAmBvB,IAAhBiB,EAAEE,GAAGK,QAA+C,iBAAhBP,EAAEE,GAAGK,OAC3C,IAAKX,KAAKI,EAAEE,GAAGK,OACd,GAAIP,EAAEE,GAAGK,OAAOzB,eAAec,GAAI,CAClC,GAAU,OAANA,EACH,cAEgCb,IAAxBc,EAAEC,EAAIlB,IAAI2B,OAAOX,GACzBC,EAAEC,EAAIlB,IAAI2B,OAAOX,GAAKI,EAAEE,GAAGK,OAAOX,GAEpB,SAANA,GAAwC,MAAxBC,EAAEC,EAAIlB,IAAI2B,OAAOX,GACzCC,EAAEC,EAAIlB,IAAI2B,OAAa,KAAIP,EAAEE,GAAGK,OAAa,KAE/B,UAANX,IACRC,EAAEC,EAAIlB,IAAI2B,OAAc,MAAIP,EAAEE,GAAGK,OAAc,MAAI,IAAMV,EAAEC,EAAIlB,IAAI2B,OAAc,QAMtFV,EAAE7B,EAAEC,OAAOK,MAAMa,KAAOnB,EAAEC,OAAOK,MAC/BG,OACLD,EAAOe,KAAKP,KAAKP,OAElBA,KAAK+B,SAAW,SAAUC,EAAKlC,EAASmC,GACvC,IAAI9B,EAAGC,EACNgB,EAAIpB,KAAKQ,OAAOC,KAChByB,EAAMpC,EAAUP,EAAE4C,QAAO,KAAUrC,GAAUsC,OAAM,OACnDC,EAAMtC,EAAOgC,SAASxB,KAAKP,KAAMgC,EAAKE,EAAKD,GAC5C,IAAW,IAARI,EAAiB,OAAO,EAC3B,GAAG9C,EAAE+C,QAAQD,GACZ,IAAIlC,EAAI,EAAGC,EAAIiC,EAAIX,OAAQvB,EAAIC,EAAGD,IACjCkC,EAAIlC,GAAGO,KAAO2B,EAAIlC,GAAGoC,IAAMnB,EAAEiB,EAAIlC,GAAGoC,KAAOnB,EAAEiB,EAAIlC,GAAGoC,IAAI7B,KAAOU,EAAEiB,EAAIlC,GAAGoC,IAAI7B,KAAO,UAChFZ,GAAWA,EAAQsC,eACdC,EAAIlC,GAAGoC,GACXF,EAAIlC,GAAG0B,SAAWQ,EAAIlC,GAAG0B,QAAQU,WAC5BF,EAAIlC,GAAG0B,QAAQU,GAEpBF,EAAIlC,GAAG2B,QAAUO,EAAIlC,GAAG2B,OAAOS,WAC1BF,EAAIlC,GAAG2B,OAAOS,SAMxBF,EAAI3B,KAAO2B,EAAIE,IAAMnB,EAAEiB,EAAIE,KAAOnB,EAAEiB,EAAIE,IAAI7B,KAAOU,EAAEiB,EAAIE,IAAI7B,KAAO,UACjEZ,GAAWA,EAAQsC,QACrBC,EAAMrC,KAAKwC,YAAYH,IAGzB,OAAOA,GAERrC,KAAKwC,YAAc,SAAUH,GAC5B,GAAG9C,EAAE+C,QAAQD,GAAM,CAClB,IAAI,IAAIlC,EAAI,EAAGC,EAAIiC,EAAIX,OAAQvB,EAAIC,EAAGD,IACrCkC,EAAIlC,GAAKH,KAAKwC,YAAYH,EAAIlC,IAE/B,OAAOkC,EAYR,cAVOA,EAAIE,GACRF,EAAIR,SAAWQ,EAAIR,QAAQU,WACtBF,EAAIR,QAAQU,GAEjBF,EAAIP,QAAUO,EAAIP,OAAOS,WACpBF,EAAIP,OAAOS,GAEhBF,EAAII,UAAYlD,EAAE+C,QAAQD,EAAII,YAChCJ,EAAII,SAAWzC,KAAKwC,YAAYH,EAAII,WAE9BJ,GAERrC,KAAK0C,MAAQ,SAAUC,EAAKX,EAAKY,EAAKC,EAAKC,GAC1C,IAAyD,IAAtD/C,EAAO2C,MAAMnC,KAAKP,KAAM2C,EAAKX,EAAKY,EAAKC,EAAKC,GAAmB,OAAO,EACzEd,EAAMA,GAAOA,EAAIO,GAAKP,EAAMhC,KAAK+C,SAASf,GAC1CY,EAAMA,GAAOA,EAAIL,GAAKK,EAAM5C,KAAK+C,SAASH,GAC1C,IAAiGP,EAAKW,EAAG7C,EAAGC,EAAxGgB,EAAIY,GAAOA,EAAIO,GAAMO,GAAQA,EAAKG,OAASH,EAAKG,OAAS1D,EAAEC,OAAO0D,UAAUlB,EAAIO,IAAO,KAE3F,OADAnB,EAAIA,GAAKA,EAAEZ,QAAUY,EAAEZ,OAAOC,KAAOW,EAAEZ,OAAOC,KAAO,KAC9CkC,GACN,IAAK,cACL,IAAK,YACL,IAAK,YACJ,GAAW,cAARA,IAA4D,IAArCpD,EAAE4D,QAAQnB,EAAIO,GAAIK,EAAIH,UAAkB,CAEjE,QAAwBnC,KADxB+B,EAAMrC,KAAKoD,UAAUR,IACdS,eAAoD,IAAtBhB,EAAIgB,cAAuBhB,EAAIgB,eAAiBT,EAAIH,SAASf,OAEjG,OADA1B,KAAKsD,MAAMC,KAAKC,YAAeC,MAAU,QAASC,OAAW,QAASnB,GAAO,WAAYoB,OAAW,mCAAqChB,EAAKlC,KAASmD,KAAKC,WAAYlB,IAAQA,EAAKE,IAAQA,EAAKb,OAAQA,IAAOA,EAAIO,KAAKP,EAAIO,GAAYK,OAAQA,IAAOA,EAAIL,KAAKK,EAAIL,OAC/P,EAER,QAA0BjC,IAAvB+B,EAAIyB,iBAAwD,IAAxBzB,EAAIyB,iBAAqF,IAA5DvE,EAAE4D,QAASnB,EAAItB,MAAQ,UAAY2B,EAAIyB,gBAE1G,OADA9D,KAAKsD,MAAMC,KAAKC,YAAeC,MAAU,QAASC,OAAW,QAASnB,GAAO,WAAYoB,OAAW,qCAAuChB,EAAKlC,KAASmD,KAAKC,WAAYlB,IAAQA,EAAKE,IAAQA,EAAKb,OAAQA,IAAOA,EAAIO,KAAKP,EAAIO,GAAYK,OAAQA,IAAOA,EAAIL,KAAKK,EAAIL,OACjQ,EAER,GAAGnB,GAAKY,EAAI+B,YAAc/B,EAAIgC,QAAS,CAEtC,IADAhB,EAAI,EACA7C,EAAI,EAAGC,EAAI4B,EAAI+B,WAAWrC,OAAQvB,EAAIC,EAAGD,IAC5C6C,EAAIiB,KAAKC,IAAIlB,EAAG5B,EAAEY,EAAI+B,WAAW5D,IAAI6D,QAAQtC,QAE9CsB,EAAIA,EAAIhB,EAAIgC,QAAQtC,OAAS,GAE3BsB,GAAK,QAAW1C,IAAN0C,KAAmBA,EAAI,GACpC,EAAG,CACF,QAAqB1C,IAAlB+B,EAAI8B,YAA8C,IAAnB9B,EAAI8B,WAAoB9B,EAAI8B,UAAYnB,EAEzE,OADAhD,KAAKsD,MAAMC,KAAKC,YAAeC,MAAU,QAASC,OAAW,QAASnB,GAAO,WAAYoB,OAAW,gCAAkChB,EAAKlC,KAASmD,KAAKC,WAAYlB,IAAQA,EAAKE,IAAQA,EAAKb,OAAQA,IAAOA,EAAIO,KAAKP,EAAIO,GAAYK,OAAQA,IAAOA,EAAIL,KAAKK,EAAIL,OAC5P,EAERK,EAAM5C,KAAK+C,SAASH,EAAI7C,QACxBsC,EAAMrC,KAAKoD,UAAUR,GACrBI,UACOJ,IAIX,OAAO,GASR5C,KAAKoD,UAAY,SAAUpB,GAE1B,KADAA,EAAMhC,KAAK+C,SAASf,IACT,OAAO,EAClB,IAAIK,EAAMrC,KAAKoE,SAASpC,GAAK,GAI7B,YAHqB1B,IAAlB+B,EAAI8B,YAA2B9B,EAAI8B,WAAa,QAC3B7D,IAArB+B,EAAIgB,eAA8BhB,EAAIgB,cAAgB,QAC/B/C,IAAvB+B,EAAIyB,iBAAgCzB,EAAIyB,gBAAkB,GACtDzB,GAURrC,KAAKoE,SAAW,SAAUpC,EAAKqC,GAE9B,SADArC,EAAMhC,KAAK+C,SAASf,MACMqC,EAAQ9E,EAAE4C,QAASzB,KAASsB,EAAItB,MAAQV,KAAKwB,SAAS9B,MAAMsC,EAAItB,OAASsB,EAAItB,OASxGV,KAAKsE,SAAW,SAAUtC,EAAKtB,GAC9B,IAA0Ba,EAAGgD,EAAIC,EAAIC,EAAUC,EAAUvD,EAAG6B,EAAG2B,EAA3DvD,EAAIpB,KAAKQ,OAAOC,KACpB,GAAGlB,EAAE+C,QAAQN,GAAM,CAElB,IAAIuC,EAAK,EAAGC,GADZxC,EAAMA,EAAI4C,SACWlD,OAAQ6C,EAAKC,EAAID,IACrCvE,KAAKsE,SAAStC,EAAIuC,GAAK7D,GAExB,OAAO,EAIR,GAFAa,EAAIvB,KAAKwB,SAAS9B,MAClBsC,EAAMhC,KAAK+C,SAASf,IAChBT,EAAEb,KAAUsB,EAAO,OAAO,EAa9B,IAZAgB,EAAIhD,KAAK+C,SAASf,GAAK,KACdgB,EAAEtB,SACViD,EAAI3B,EAAEP,SAAS,mBAEhBgC,EAAWzC,EAAItB,KACfgE,EAAW1E,KAAK6E,SAAS7C,GACzBA,EAAItB,KAAOA,IACK,IAAbgE,IAAsBnD,EAAEkD,SAAmCnE,IAArBiB,EAAEkD,GAAU7C,MAAsB8C,IAAanD,EAAEkD,GAAU7C,OACnG5B,KAAK8E,SAAS9C,OAAsB1B,IAAjBiB,EAAEb,GAAMkB,MAAqBL,EAAEb,GAAMkB,MAItDL,EAAEkD,SAAqCnE,IAAxBiB,EAAEkD,GAAU5C,SAAwD,iBAAxBN,EAAEkD,GAAU5C,QACzE,IAAKV,KAAKI,EAAEkD,GAAU5C,QACrB,GAAIN,EAAEkD,GAAU5C,QAAQxB,eAAec,GAAI,CAC1C,GAAU,OAANA,EACH,SAEc,UAANA,GACRC,EAAEY,EAAIO,IAAIV,QAAe,OAAKT,EAAEY,EAAIO,IAAIV,QAAe,OAAK,IAAIkD,QAAQxD,EAAEkD,GAAU5C,QAAQV,GAAI,IAC5F6B,GAAKA,EAAEgC,YAAYzD,EAAEkD,GAAU5C,QAAQV,KAEnCC,EAAEY,EAAIO,IAAIV,QAAQV,KAAOI,EAAEkD,GAAU5C,QAAQV,KACrDC,EAAEY,EAAIO,IAAIV,QAAQV,GAAK,KACnB6B,GAAKA,EAAEiC,WAAW9D,IAK1B,GAAGI,EAAEkD,SAAoCnE,IAAvBiB,EAAEkD,GAAU3C,QAAsD,iBAAvBP,EAAEkD,GAAU3C,OACxE,IAAKX,KAAKI,EAAEkD,GAAU3C,OACrB,GAAIP,EAAEkD,GAAU3C,OAAOzB,eAAec,GAAI,CACzC,GAAU,OAANA,EACH,SAEc,UAANA,GACRC,EAAEY,EAAIO,IAAIT,OAAc,OAAKV,EAAEY,EAAIO,IAAIT,OAAc,OAAK,IAAIiD,QAAQxD,EAAEkD,GAAU3C,OAAOX,GAAI,IACzFwD,GAAKA,EAAEK,YAAYzD,EAAEkD,GAAU3C,OAAOX,KAElCC,EAAEY,EAAIO,IAAIT,OAAOX,KAAOI,EAAEkD,GAAU3C,OAAOX,KACzC,SAANA,GACHC,EAAEY,EAAIO,IAAIT,OAAOX,GAAK,IAClBwD,GAAKA,EAAEO,KAAK,OAAQ,cAGjB9D,EAAEY,EAAIO,IAAIT,OAAOX,GACpBwD,GAAKA,EAAEM,WAAW9D,KAQ3B,QAAuBb,IAApBiB,EAAEb,GAAMmB,SAAoD,iBAApBN,EAAEb,GAAMmB,QAClD,IAAKV,KAAKI,EAAEb,GAAMmB,QACjB,GAAIN,EAAEb,GAAMmB,QAAQxB,eAAec,GAAI,CACtC,GAAU,OAANA,EACH,cAEiCb,IAAzBc,EAAEY,EAAIO,IAAIV,QAAQV,IAC1BC,EAAEY,EAAIO,IAAIV,QAAQV,GAAKI,EAAEb,GAAMmB,QAAQV,GACnC6B,IACO,UAAN7B,EACH6B,EAAEmC,SAAS5D,EAAEb,GAAMmB,QAAQV,IAG3B6B,EAAEkC,KAAK/D,EAAGI,EAAEb,GAAMmB,QAAQV,MAId,UAANA,IACRC,EAAEY,EAAIO,IAAIV,QAAe,MAAIN,EAAEb,GAAMmB,QAAQV,GAAK,IAAMC,EAAEY,EAAIO,IAAIV,QAAe,MAC7EmB,GAAKA,EAAEmC,SAAS5D,EAAEb,GAAMmB,QAAQV,KAKxC,QAAsBb,IAAnBiB,EAAEb,GAAMoB,QAAkD,iBAAnBP,EAAEb,GAAMoB,OACjD,IAAKX,KAAKI,EAAEb,GAAMoB,OACjB,GAAIP,EAAEb,GAAMoB,OAAOzB,eAAec,GAAI,CACrC,GAAU,OAANA,EACH,cAEgCb,IAAxBc,EAAEY,EAAIO,IAAIT,OAAOX,IACzBC,EAAEY,EAAIO,IAAIT,OAAOX,GAAKI,EAAEb,GAAMoB,OAAOX,GACjCwD,IACO,UAANxD,EACHwD,EAAEQ,SAAS5D,EAAEb,GAAMoB,OAAOX,IAG1BwD,EAAEO,KAAK/D,EAAGI,EAAEb,GAAMoB,OAAOX,MAIb,SAANA,GAAwC,MAAxBC,EAAEY,EAAIO,IAAIT,OAAOX,IACzCC,EAAEY,EAAIO,IAAIT,OAAa,KAAIP,EAAEb,GAAMoB,OAAa,KAC5C6C,GAAKA,EAAEO,KAAK,OAAQ3D,EAAEb,GAAMoB,OAAa,OAE/B,UAANX,IACRC,EAAEY,EAAIO,IAAIT,OAAc,MAAIP,EAAEb,GAAMoB,OAAc,MAAI,IAAMV,EAAEY,EAAIO,IAAIT,OAAc,MAChF6C,GAAKA,EAAEQ,SAAS5D,EAAEb,GAAMoB,OAAOX,KAMvC,OAAO,IAKF5B","file":"../../addons/types.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-query\",\r\n  \"../Hierarchy\"\r\n],function(langx,browser,eventer,noder,geom,$,jstree){\r\n\t\"use strict\";\r\n\r\n\tif($.jstree.plugins.types) { return; }\r\n\r\n\t/**\r\n\t * An object storing all types as key value pairs, where the key is the type name and the value is an object that could contain following keys (all optional).\r\n\t *\r\n\t * * `max_children` the maximum number of immediate children this node type can have. Do not specify or set to `-1` for unlimited.\r\n\t * * `max_depth` the maximum number of nesting this node type can have. A value of `1` would mean that the node can have children, but no grandchildren. Do not specify or set to `-1` for unlimited.\r\n\t * * `valid_children` an array of node type strings, that nodes of this type can have as children. Do not specify or set to `-1` for no limits.\r\n\t * * `icon` a string - can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class. Omit to use the default icon from your theme.\r\n\t * * `li_attr` an object of values which will be used to add HTML attributes on the resulting LI DOM node (merged with the node's own data)\r\n\t * * `a_attr` an object of values which will be used to add HTML attributes on the resulting A DOM node (merged with the node's own data)\r\n\t *\r\n\t * There are two predefined types:\r\n\t *\r\n\t * * `#` represents the root of the tree, for example `max_children` would control the maximum number of root nodes.\r\n\t * * `default` represents the default node - any settings here will be applied to all nodes that do not have a type specified.\r\n\t *\r\n\t * @name $.jstree.defaults.types\r\n\t * @plugin types\r\n\t */\r\n\t$.jstree.defaults.types = {\r\n\t\t'default' : {}\r\n\t};\r\n\t$.jstree.defaults.types[$.jstree.root] = {};\r\n\r\n\t$.jstree.plugins.types = function (options, parent) {\r\n\t\tthis.init = function (el, options) {\r\n\t\t\tvar i, j;\r\n\t\t\tif(options && options.types && options.types['default']) {\r\n\t\t\t\tfor(i in options.types) {\r\n\t\t\t\t\tif(i !== \"default\" && i !== $.jstree.root && options.types.hasOwnProperty(i)) {\r\n\t\t\t\t\t\tfor(j in options.types['default']) {\r\n\t\t\t\t\t\t\tif(options.types['default'].hasOwnProperty(j) && options.types[i][j] === undefined) {\r\n\t\t\t\t\t\t\t\toptions.types[i][j] = options.types['default'][j];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparent.init.call(this, el, options);\r\n\t\t\tthis._model.data[$.jstree.root].type = $.jstree.root;\r\n\t\t};\r\n\t\tthis.refresh = function (skip_loading, forget_state) {\r\n\t\t\tparent.refresh.call(this, skip_loading, forget_state);\r\n\t\t\tthis._model.data[$.jstree.root].type = $.jstree.root;\r\n\t\t};\r\n\t\tthis.bind = function () {\r\n\t\t\tthis.element\r\n\t\t\t\t.on('model.jstree', $.proxy(function (e, data) {\r\n\t\t\t\t\t\tvar m = this._model.data,\r\n\t\t\t\t\t\t\tdpc = data.nodes,\r\n\t\t\t\t\t\t\tt = this.settings.types,\r\n\t\t\t\t\t\t\ti, j, c = 'default', k;\r\n\t\t\t\t\t\tfor(i = 0, j = dpc.length; i < j; i++) {\r\n\t\t\t\t\t\t\tc = 'default';\r\n\t\t\t\t\t\t\tif(m[dpc[i]].original && m[dpc[i]].original.type && t[m[dpc[i]].original.type]) {\r\n\t\t\t\t\t\t\t\tc = m[dpc[i]].original.type;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(m[dpc[i]].data && m[dpc[i]].data.jstree && m[dpc[i]].data.jstree.type && t[m[dpc[i]].data.jstree.type]) {\r\n\t\t\t\t\t\t\t\tc = m[dpc[i]].data.jstree.type;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tm[dpc[i]].type = c;\r\n\t\t\t\t\t\t\tif(m[dpc[i]].icon === true && t[c].icon !== undefined) {\r\n\t\t\t\t\t\t\t\tm[dpc[i]].icon = t[c].icon;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(t[c].li_attr !== undefined && typeof t[c].li_attr === 'object') {\r\n\t\t\t\t\t\t\t\tfor (k in t[c].li_attr) {\r\n\t\t\t\t\t\t\t\t\tif (t[c].li_attr.hasOwnProperty(k)) {\r\n\t\t\t\t\t\t\t\t\t\tif (k === 'id') {\r\n\t\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse if (m[dpc[i]].li_attr[k] === undefined) {\r\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].li_attr[k] = t[c].li_attr[k];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse if (k === 'class') {\r\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].li_attr['class'] = t[c].li_attr['class'] + ' ' + m[dpc[i]].li_attr['class'];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(t[c].a_attr !== undefined && typeof t[c].a_attr === 'object') {\r\n\t\t\t\t\t\t\t\tfor (k in t[c].a_attr) {\r\n\t\t\t\t\t\t\t\t\tif (t[c].a_attr.hasOwnProperty(k)) {\r\n\t\t\t\t\t\t\t\t\t\tif (k === 'id') {\r\n\t\t\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse if (m[dpc[i]].a_attr[k] === undefined) {\r\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].a_attr[k] = t[c].a_attr[k];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse if (k === 'href' && m[dpc[i]].a_attr[k] === '#') {\r\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].a_attr['href'] = t[c].a_attr['href'];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse if (k === 'class') {\r\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].a_attr['class'] = t[c].a_attr['class'] + ' ' + m[dpc[i]].a_attr['class'];\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tm[$.jstree.root].type = $.jstree.root;\r\n\t\t\t\t\t}, this));\r\n\t\t\tparent.bind.call(this);\r\n\t\t};\r\n\t\tthis.get_json = function (obj, options, flat) {\r\n\t\t\tvar i, j,\r\n\t\t\t\tm = this._model.data,\r\n\t\t\t\topt = options ? $.extend(true, {}, options, {no_id:false}) : {},\r\n\t\t\t\ttmp = parent.get_json.call(this, obj, opt, flat);\r\n\t\t\tif(tmp === false) { return false; }\r\n\t\t\tif($.isArray(tmp)) {\r\n\t\t\t\tfor(i = 0, j = tmp.length; i < j; i++) {\r\n\t\t\t\t\ttmp[i].type = tmp[i].id && m[tmp[i].id] && m[tmp[i].id].type ? m[tmp[i].id].type : \"default\";\r\n\t\t\t\t\tif(options && options.no_id) {\r\n\t\t\t\t\t\tdelete tmp[i].id;\r\n\t\t\t\t\t\tif(tmp[i].li_attr && tmp[i].li_attr.id) {\r\n\t\t\t\t\t\t\tdelete tmp[i].li_attr.id;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(tmp[i].a_attr && tmp[i].a_attr.id) {\r\n\t\t\t\t\t\t\tdelete tmp[i].a_attr.id;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttmp.type = tmp.id && m[tmp.id] && m[tmp.id].type ? m[tmp.id].type : \"default\";\r\n\t\t\t\tif(options && options.no_id) {\r\n\t\t\t\t\ttmp = this._delete_ids(tmp);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn tmp;\r\n\t\t};\r\n\t\tthis._delete_ids = function (tmp) {\r\n\t\t\tif($.isArray(tmp)) {\r\n\t\t\t\tfor(var i = 0, j = tmp.length; i < j; i++) {\r\n\t\t\t\t\ttmp[i] = this._delete_ids(tmp[i]);\r\n\t\t\t\t}\r\n\t\t\t\treturn tmp;\r\n\t\t\t}\r\n\t\t\tdelete tmp.id;\r\n\t\t\tif(tmp.li_attr && tmp.li_attr.id) {\r\n\t\t\t\tdelete tmp.li_attr.id;\r\n\t\t\t}\r\n\t\t\tif(tmp.a_attr && tmp.a_attr.id) {\r\n\t\t\t\tdelete tmp.a_attr.id;\r\n\t\t\t}\r\n\t\t\tif(tmp.children && $.isArray(tmp.children)) {\r\n\t\t\t\ttmp.children = this._delete_ids(tmp.children);\r\n\t\t\t}\r\n\t\t\treturn tmp;\r\n\t\t};\r\n\t\tthis.check = function (chk, obj, par, pos, more) {\r\n\t\t\tif(parent.check.call(this, chk, obj, par, pos, more) === false) { return false; }\r\n\t\t\tobj = obj && obj.id ? obj : this.get_node(obj);\r\n\t\t\tpar = par && par.id ? par : this.get_node(par);\r\n\t\t\tvar m = obj && obj.id ? (more && more.origin ? more.origin : $.jstree.reference(obj.id)) : null, tmp, d, i, j;\r\n\t\t\tm = m && m._model && m._model.data ? m._model.data : null;\r\n\t\t\tswitch(chk) {\r\n\t\t\t\tcase \"create_node\":\r\n\t\t\t\tcase \"move_node\":\r\n\t\t\t\tcase \"copy_node\":\r\n\t\t\t\t\tif(chk !== 'move_node' || $.inArray(obj.id, par.children) === -1) {\r\n\t\t\t\t\t\ttmp = this.get_rules(par);\r\n\t\t\t\t\t\tif(tmp.max_children !== undefined && tmp.max_children !== -1 && tmp.max_children === par.children.length) {\r\n\t\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_01', 'reason' : 'max_children prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(tmp.valid_children !== undefined && tmp.valid_children !== -1 && $.inArray((obj.type || 'default'), tmp.valid_children) === -1) {\r\n\t\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_02', 'reason' : 'valid_children prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(m && obj.children_d && obj.parents) {\r\n\t\t\t\t\t\t\td = 0;\r\n\t\t\t\t\t\t\tfor(i = 0, j = obj.children_d.length; i < j; i++) {\r\n\t\t\t\t\t\t\t\td = Math.max(d, m[obj.children_d[i]].parents.length);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\td = d - obj.parents.length + 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(d <= 0 || d === undefined) { d = 1; }\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\tif(tmp.max_depth !== undefined && tmp.max_depth !== -1 && tmp.max_depth < d) {\r\n\t\t\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_03', 'reason' : 'max_depth prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tpar = this.get_node(par.parent);\r\n\t\t\t\t\t\t\ttmp = this.get_rules(par);\r\n\t\t\t\t\t\t\td++;\r\n\t\t\t\t\t\t} while(par);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\t/**\r\n\t\t * used to retrieve the type settings object for a node\r\n\t\t * @name get_rules(obj)\r\n\t\t * @param {mixed} obj the node to find the rules for\r\n\t\t * @return {Object}\r\n\t\t * @plugin types\r\n\t\t */\r\n\t\tthis.get_rules = function (obj) {\r\n\t\t\tobj = this.get_node(obj);\r\n\t\t\tif(!obj) { return false; }\r\n\t\t\tvar tmp = this.get_type(obj, true);\r\n\t\t\tif(tmp.max_depth === undefined) { tmp.max_depth = -1; }\r\n\t\t\tif(tmp.max_children === undefined) { tmp.max_children = -1; }\r\n\t\t\tif(tmp.valid_children === undefined) { tmp.valid_children = -1; }\r\n\t\t\treturn tmp;\r\n\t\t};\r\n\t\t/**\r\n\t\t * used to retrieve the type string or settings object for a node\r\n\t\t * @name get_type(obj [, rules])\r\n\t\t * @param {mixed} obj the node to find the rules for\r\n\t\t * @param {Boolean} rules if set to `true` instead of a string the settings object will be returned\r\n\t\t * @return {String|Object}\r\n\t\t * @plugin types\r\n\t\t */\r\n\t\tthis.get_type = function (obj, rules) {\r\n\t\t\tobj = this.get_node(obj);\r\n\t\t\treturn (!obj) ? false : ( rules ? $.extend({ 'type' : obj.type }, this.settings.types[obj.type]) : obj.type);\r\n\t\t};\r\n\t\t/**\r\n\t\t * used to change a node's type\r\n\t\t * @name set_type(obj, type)\r\n\t\t * @param {mixed} obj the node to change\r\n\t\t * @param {String} type the new type\r\n\t\t * @plugin types\r\n\t\t */\r\n\t\tthis.set_type = function (obj, type) {\r\n\t\t\tvar m = this._model.data, t, t1, t2, old_type, old_icon, k, d, a;\r\n\t\t\tif($.isArray(obj)) {\r\n\t\t\t\tobj = obj.slice();\r\n\t\t\t\tfor(t1 = 0, t2 = obj.length; t1 < t2; t1++) {\r\n\t\t\t\t\tthis.set_type(obj[t1], type);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tt = this.settings.types;\r\n\t\t\tobj = this.get_node(obj);\r\n\t\t\tif(!t[type] || !obj) { return false; }\r\n\t\t\td = this.get_node(obj, true);\r\n\t\t\tif (d && d.length) {\r\n\t\t\t\ta = d.children('.jstree-anchor');\r\n\t\t\t}\r\n\t\t\told_type = obj.type;\r\n\t\t\told_icon = this.get_icon(obj);\r\n\t\t\tobj.type = type;\r\n\t\t\tif(old_icon === true || !t[old_type] || (t[old_type].icon !== undefined && old_icon === t[old_type].icon)) {\r\n\t\t\t\tthis.set_icon(obj, t[type].icon !== undefined ? t[type].icon : true);\r\n\t\t\t}\r\n\r\n\t\t\t// remove old type props\r\n\t\t\tif(t[old_type] && t[old_type].li_attr !== undefined && typeof t[old_type].li_attr === 'object') {\r\n\t\t\t\tfor (k in t[old_type].li_attr) {\r\n\t\t\t\t\tif (t[old_type].li_attr.hasOwnProperty(k)) {\r\n\t\t\t\t\t\tif (k === 'id') {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (k === 'class') {\r\n\t\t\t\t\t\t\tm[obj.id].li_attr['class'] = (m[obj.id].li_attr['class'] || '').replace(t[old_type].li_attr[k], '');\r\n\t\t\t\t\t\t\tif (d) { d.removeClass(t[old_type].li_attr[k]); }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (m[obj.id].li_attr[k] === t[old_type].li_attr[k]) {\r\n\t\t\t\t\t\t\tm[obj.id].li_attr[k] = null;\r\n\t\t\t\t\t\t\tif (d) { d.removeAttr(k); }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(t[old_type] && t[old_type].a_attr !== undefined && typeof t[old_type].a_attr === 'object') {\r\n\t\t\t\tfor (k in t[old_type].a_attr) {\r\n\t\t\t\t\tif (t[old_type].a_attr.hasOwnProperty(k)) {\r\n\t\t\t\t\t\tif (k === 'id') {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (k === 'class') {\r\n\t\t\t\t\t\t\tm[obj.id].a_attr['class'] = (m[obj.id].a_attr['class'] || '').replace(t[old_type].a_attr[k], '');\r\n\t\t\t\t\t\t\tif (a) { a.removeClass(t[old_type].a_attr[k]); }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (m[obj.id].a_attr[k] === t[old_type].a_attr[k]) {\r\n\t\t\t\t\t\t\tif (k === 'href') {\r\n\t\t\t\t\t\t\t\tm[obj.id].a_attr[k] = '#';\r\n\t\t\t\t\t\t\t\tif (a) { a.attr('href', '#'); }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tdelete m[obj.id].a_attr[k];\r\n\t\t\t\t\t\t\t\tif (a) { a.removeAttr(k); }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// add new props\r\n\t\t\tif(t[type].li_attr !== undefined && typeof t[type].li_attr === 'object') {\r\n\t\t\t\tfor (k in t[type].li_attr) {\r\n\t\t\t\t\tif (t[type].li_attr.hasOwnProperty(k)) {\r\n\t\t\t\t\t\tif (k === 'id') {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (m[obj.id].li_attr[k] === undefined) {\r\n\t\t\t\t\t\t\tm[obj.id].li_attr[k] = t[type].li_attr[k];\r\n\t\t\t\t\t\t\tif (d) {\r\n\t\t\t\t\t\t\t\tif (k === 'class') {\r\n\t\t\t\t\t\t\t\t\td.addClass(t[type].li_attr[k]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\td.attr(k, t[type].li_attr[k]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (k === 'class') {\r\n\t\t\t\t\t\t\tm[obj.id].li_attr['class'] = t[type].li_attr[k] + ' ' + m[obj.id].li_attr['class'];\r\n\t\t\t\t\t\t\tif (d) { d.addClass(t[type].li_attr[k]); }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(t[type].a_attr !== undefined && typeof t[type].a_attr === 'object') {\r\n\t\t\t\tfor (k in t[type].a_attr) {\r\n\t\t\t\t\tif (t[type].a_attr.hasOwnProperty(k)) {\r\n\t\t\t\t\t\tif (k === 'id') {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (m[obj.id].a_attr[k] === undefined) {\r\n\t\t\t\t\t\t\tm[obj.id].a_attr[k] = t[type].a_attr[k];\r\n\t\t\t\t\t\t\tif (a) {\r\n\t\t\t\t\t\t\t\tif (k === 'class') {\r\n\t\t\t\t\t\t\t\t\ta.addClass(t[type].a_attr[k]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\ta.attr(k, t[type].a_attr[k]);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (k === 'href' && m[obj.id].a_attr[k] === '#') {\r\n\t\t\t\t\t\t\tm[obj.id].a_attr['href'] = t[type].a_attr['href'];\r\n\t\t\t\t\t\t\tif (a) { a.attr('href', t[type].a_attr['href']); }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (k === 'class') {\r\n\t\t\t\t\t\t\tm[obj.id].a_attr['class'] = t[type].a_attr['class'] + ' ' + m[obj.id].a_attr['class'];\r\n\t\t\t\t\t\t\tif (a) { a.addClass(t[type].a_attr[k]); }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t};\r\n\t};\r\n\t// include the types plugin by default\r\n\t// $.jstree.defaults.plugins.push(\"types\");\r\n\treturn $;\r\n\t\r\n});\r\n"]}