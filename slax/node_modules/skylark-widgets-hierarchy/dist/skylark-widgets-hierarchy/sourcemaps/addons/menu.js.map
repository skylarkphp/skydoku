{"version":3,"sources":["addons/menu.js"],"names":["define","langx","browser","eventer","noder","geom","$","right_to_left","popup","Menu","Evented","inherit","klassName","init","elm","options","$el","self","this","_options","mixin","hide_onmouseleave","icons","to","on","e","stopImmediatePropagation","contains","relatedTarget","clearTimeout","find","removeClass","end","siblings","hide","parentsUntil","addBack","addClass","_show_submenu","setTimeout","preventDefault","blur","parent","hasClass","_execute","attr","o","which","type","currentTarget","trigger","last","closest","first","children","focus","prevAll","length","show","nextAll","a","not","click","render","items","_parse","html","width","_trigger","event_name","document","reference","element","position","x","position_x","y","position_y","i","_disabled","isFunction","item","action","call","is_callback","tmp","str","sep","each","val","push","separator_before","_class","shortcut","title","icon","indexOf","label","shortcut_label","submenu","separator_after","replace","xl","offset","left","outerWidth","top","w","h","height","dw","window","scrollLeft","dh","scrollTop","css","data","outerHeight","appendTo","body","is_visible","detach","target"],"mappings":"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","file":"../../addons/menu.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-query\"\r\n],function(langx,browser,eventer,noder,geom,$){\r\n\r\n\tvar popup = null;\r\n\tvar right_to_left ;\r\n\r\n\tvar Menu = langx.Evented.inherit({\r\n        klassName: \"Menu\",\r\n\r\n        init : function(elm,options) {\r\n        \tif (!options) {\r\n        \t\toptions = elm;\r\n        \t\telm = null;\r\n        \t}\r\n\t\t\tvar self = this,$el;\r\n\r\n\t\t\tthis._options = langx.mixin({\r\n\t\t\t\t\thide_onmouseleave\t: 0,\r\n\t\t\t\t\ticons\t\t\t\t: true\r\n\r\n\t\t\t},options);\r\n\r\n\t\t\tif (!elm) {\r\n\t\t\t\t$el = this.$el = $(\"<ul class='vakata-context'></ul>\");\r\n\t\t\t} else {\r\n\t\t\t\t$el = this.$el = $(elm);\r\n\t\t\t}\r\n\r\n\t\t\tvar to = false;\r\n\t\t\t$el.on(\"mouseenter\", \"li\", function (e) {\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) {\r\n\t\t\t\t\t\t// премахнато заради delegate mouseleave по-долу\r\n\t\t\t\t\t\t// $(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(to) { clearTimeout(to); }\r\n\t\t\t\t\t$el.find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end();\r\n\r\n\t\t\t\t\t$(this)\r\n\t\t\t\t\t\t.siblings().find(\"ul\").hide().end().end()\r\n\t\t\t\t\t\t.parentsUntil(\".vakata-context\", \"li\").addBack().addClass(\"vakata-context-hover\");\r\n\t\t\t\t\tself._show_submenu(this);\r\n\t\t\t\t})\r\n\t\t\t\t// тестово - дали не натоварва?\r\n\t\t\t\t.on(\"mouseleave\", \"li\", function (e) {\r\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) { return; }\r\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").addBack().removeClass(\"vakata-context-hover\");\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"mouseleave\", function (e) {\r\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\r\n\t\t\t\t\tif(self._options.hide_onmouseleave) {\r\n\t\t\t\t\t\tto = setTimeout(\r\n\t\t\t\t\t\t\t(function (t) {\r\n\t\t\t\t\t\t\t\treturn function () { self.hide(); };\r\n\t\t\t\t\t\t\t}(this)), self._options.hide_onmouseleave);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", \"a\", function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t//})\r\n\t\t\t\t//.on(\"mouseup\", \"a\", function (e) {\r\n\t\t\t\t\tif(!$(this).blur().parent().hasClass(\"vakata-context-disabled\") && self._execute($(this).attr(\"rel\")) !== false) {\r\n\t\t\t\t\t\tself.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.on('keydown', 'a', function (e) {\r\n\t\t\t\t\t\tvar o = null;\r\n\t\t\t\t\t\tswitch(e.which) {\r\n\t\t\t\t\t\t\tcase 13:\r\n\t\t\t\t\t\t\tcase 32:\r\n\t\t\t\t\t\t\t\te.type = \"click\";\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t$(e.currentTarget).trigger(e);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 37:\r\n\t\t\t\t\t\t\t\tself.$el.find(\".vakata-context-hover\").last().closest(\"li\").first().find(\"ul\").hide().find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end().end().children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 38:\r\n\t\t\t\t\t\t\t\to = self.$el.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").prevAll(\"li:not(.vakata-context-separator)\").first();\r\n\t\t\t\t\t\t\t\tif(!o.length) { o = self.$el.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").last(); }\r\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 39:\r\n\t\t\t\t\t\t\t\tself.$el.find(\".vakata-context-hover\").last().children(\"ul\").show().children(\"li:not(.vakata-context-separator)\").removeClass(\"vakata-context-hover\").first().addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 40:\r\n\t\t\t\t\t\t\t\to = self.$el.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").nextAll(\"li:not(.vakata-context-separator)\").first();\r\n\t\t\t\t\t\t\t\tif(!o.length) { o = self.$el.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").first(); }\r\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 27:\r\n\t\t\t\t\t\t\t\tself.hide();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t//console.log(e.which);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t.on('keydown', function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar a = self.$el.find('.vakata-contextmenu-shortcut-' + e.which).parent();\r\n\t\t\t\t\tif(a.parent().not('.vakata-context-disabled')) {\r\n\t\t\t\t\t\ta.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tthis.render();\r\n        },\r\n\r\n        render : function() {\r\n        \tvar items = this._options.items;\r\n\t\t\tif(this._parse(items)) {\r\n\t\t\t\tthis.$el.html(this.html);\r\n\t\t\t}\r\n\t\t\tthis.$el.width('');\r\n        },\r\n\r\n\t\t_trigger : function (event_name) {\r\n\t\t\t$(document).trigger(\"context_\" + event_name + \".sbswt\", {\r\n\t\t\t\t\"reference\"\t: this.reference,\r\n\t\t\t\t\"element\"\t: this.$el,\r\n\t\t\t\t\"position\"\t: {\r\n\t\t\t\t\t\"x\" : this.position_x,\r\n\t\t\t\t\t\"y\" : this.position_y\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},        \r\n\r\n\t\t_execute : function (i) {\r\n\t\t\ti = this.items[i];\r\n\t\t\treturn i && (!i._disabled || (langx.isFunction(i._disabled) && !i._disabled({ \"item\" : i, \"reference\" : this.reference, \"element\" : this.$el }))) && i.action ? i.action.call(null, {\r\n\t\t\t\t\t\t\"item\"\t\t: i,\r\n\t\t\t\t\t\t\"reference\"\t: this.reference,\r\n\t\t\t\t\t\t\"element\"\t: this.$el,\r\n\t\t\t\t\t\t\"position\"\t: {\r\n\t\t\t\t\t\t\t\"x\" : this.position_x,\r\n\t\t\t\t\t\t\t\"y\" : this.position_y\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}) : false;\r\n\t\t},\r\n\t\t_parse : function (o, is_callback) {\r\n\t\t\tvar self = this,\r\n\t\t\t\treference = self._options.reference;\r\n\r\n\t\t\tif(!o) { return false; }\r\n\t\t\tif(!is_callback) {\r\n\t\t\t\tself.html\t\t= \"\";\r\n\t\t\t\tself.items\t= [];\r\n\t\t\t}\r\n\t\t\tvar str = \"\",\r\n\t\t\t\tsep = false,\r\n\t\t\t\ttmp;\r\n\r\n\t\t\tif(is_callback) { str += \"<\"+\"ul>\"; }\r\n\t\t\tlangx.each(o, function (i, val) {\r\n\t\t\t\tif(!val) { return true; }\r\n\t\t\t\tself.items.push(val);\r\n\t\t\t\tif(!sep && val.separator_before) {\r\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (self._options.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\r\n\t\t\t\t}\r\n\t\t\t\tsep = false;\r\n\t\t\t\tstr += \"<\"+\"li class='\" + (val._class || \"\") + (val._disabled === true || (langx.isFunction(val._disabled) && val._disabled({ \"item\" : val, \"reference\" : reference, \"element\" : self.$el })) ? \" vakata-contextmenu-disabled \" : \"\") + \"' \"+(val.shortcut?\" data-shortcut='\"+val.shortcut+\"' \":'')+\">\";\r\n\t\t\t\tstr += \"<\"+\"a href='#' rel='\" + (self.items.length - 1) + \"' \" + (val.title ? \"title='\" + val.title + \"'\" : \"\") + \">\";\r\n\t\t\t\tif(self._options.icons) {\r\n\t\t\t\t\tstr += \"<\"+\"i \";\r\n\t\t\t\t\tif(val.icon) {\r\n\t\t\t\t\t\tif(val.icon.indexOf(\"/\") !== -1 || val.icon.indexOf(\".\") !== -1) { str += \" style='background:url(\\\"\" + val.icon + \"\\\") center center no-repeat' \"; }\r\n\t\t\t\t\t\telse { str += \" class='\" + val.icon + \"' \"; }\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstr += \"><\"+\"/i><\"+\"span class='vakata-contextmenu-sep'>&#160;<\"+\"/span>\";\r\n\t\t\t\t}\r\n\t\t\t\tstr += (langx.isFunction(val.label) ? val.label({ \"item\" : i, \"reference\" : reference, \"element\" : self.$el }) : val.label) + (val.shortcut?' <span class=\"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+val.shortcut+'\">'+ (val.shortcut_label || '') +'</span>':'') + \"<\"+\"/a>\";\r\n\t\t\t\tif(val.submenu) {\r\n\t\t\t\t\ttmp = self._parse(val.submenu, true);\r\n\t\t\t\t\tif(tmp) { str += tmp; }\r\n\t\t\t\t}\r\n\t\t\t\tstr += \"<\"+\"/li>\";\r\n\t\t\t\tif(val.separator_after) {\r\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (self._options.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\r\n\t\t\t\t\tsep = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tstr  = str.replace(/<li class\\='vakata-context-separator'\\><\\/li\\>$/,\"\");\r\n\t\t\tif(is_callback) { str += \"</ul>\"; }\r\n\t\t\t/**\r\n\t\t\t * triggered on the document when the contextmenu is parsed (HTML is built)\r\n\t\t\t * @event\r\n\t\t\t * @plugin contextmenu\r\n\t\t\t * @name context_parse.vakata\r\n\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t */\r\n\t\t\tif(!is_callback) { self.html = str; self._trigger(\"parse\"); }\r\n\t\t\treturn str.length > 10 ? str : false;\r\n\t\t},\r\n\t\t_show_submenu : function (o) {\r\n\t\t\to = $(o);\r\n\t\t\tif(!o.length || !o.children(\"ul\").length) { return; }\r\n\t\t\tvar e = o.children(\"ul\"),\r\n\t\t\t\txl = o.offset().left,\r\n\t\t\t\tx = xl + o.outerWidth(),\r\n\t\t\t\ty = o.offset().top,\r\n\t\t\t\tw = e.width(),\r\n\t\t\t\th = e.height(),\r\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft(),\r\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\r\n\t\t\t// може да се спести е една проверка - дали няма някой от класовете вече нагоре\r\n\t\t\tif(right_to_left) {\r\n\t\t\t\to[x - (w + 10 + o.outerWidth()) < 0 ? \"addClass\" : \"removeClass\"](\"vakata-context-left\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\to[x + w > dw  && xl > dw - x ? \"addClass\" : \"removeClass\"](\"vakata-context-right\");\r\n\t\t\t}\r\n\t\t\tif(y + h + 10 > dh) {\r\n\t\t\t\te.css(\"bottom\",\"-1px\");\r\n\t\t\t}\r\n\r\n\t\t\t//if does not fit - stick it to the side\r\n\t\t\tif (o.hasClass('vakata-context-right')) {\r\n\t\t\t\tif (xl < w) {\r\n\t\t\t\t\te.css(\"margin-right\", xl - w);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (dw - x < w) {\r\n\t\t\t\t\te.css(\"margin-left\", dw - x - w);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\te.show();\r\n\t\t},\r\n\t\tshow : function (reference, position, data) {\r\n\t\t\tvar o, e, x, y, w, h, dw, dh, cond = true;\r\n\t\t\tswitch(cond) {\r\n\t\t\t\tcase (!position && !reference):\r\n\t\t\t\t\treturn false;\r\n\t\t\t\tcase (!!position && !!reference):\r\n\t\t\t\t\tthis.reference\t= reference;\r\n\t\t\t\t\tthis.position_x\t= position.x;\r\n\t\t\t\t\tthis.position_y\t= position.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase (!position && !!reference):\r\n\t\t\t\t\tthis.reference\t= reference;\r\n\t\t\t\t\to = reference.offset();\r\n\t\t\t\t\tthis.position_x\t= o.left + reference.outerHeight();\r\n\t\t\t\t\tthis.position_y\t= o.top;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase (!!position && !reference):\r\n\t\t\t\t\tthis.position_x\t= position.x;\r\n\t\t\t\t\tthis.position_y\t= position.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!!reference && !data && $(reference).data('vakata_contextmenu')) {\r\n\t\t\t\tdata = $(reference).data('vakata_contextmenu');\r\n\t\t\t}\r\n\r\n\t\t\tif(this.items.length) {\r\n\t\t\t\tthis.$el.appendTo(document.body);\r\n\t\t\t\te = this.$el;\r\n\t\t\t\tx = this.position_x;\r\n\t\t\t\ty = this.position_y;\r\n\t\t\t\tw = e.width();\r\n\t\t\t\th = e.height();\r\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft();\r\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\r\n\t\t\t\tif(right_to_left) {\r\n\t\t\t\t\tx -= (e.outerWidth() - $(reference).outerWidth());\r\n\t\t\t\t\tif(x < $(window).scrollLeft() + 20) {\r\n\t\t\t\t\t\tx = $(window).scrollLeft() + 20;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(x + w + 20 > dw) {\r\n\t\t\t\t\tx = dw - (w + 20);\r\n\t\t\t\t}\r\n\t\t\t\tif(y + h + 20 > dh) {\r\n\t\t\t\t\ty = dh - (h + 20);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.$el\r\n\t\t\t\t\t.css({ \"left\" : x, \"top\" : y })\r\n\t\t\t\t\t.show()\r\n\t\t\t\t\t.find('a').first().focus().parent().addClass(\"vakata-context-hover\");\r\n\t\t\t\tthis.is_visible = true;\r\n\r\n\t\t\t\tpopup = this;\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * triggered on the document when the contextmenu is shown\r\n\t\t\t\t * @event\r\n\t\t\t\t * @plugin contextmenu\r\n\t\t\t\t * @name context_show.vakata\r\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t\t */\r\n\t\t\t\tthis._trigger(\"show\");\r\n\t\t\t}\r\n\t\t},\r\n\t\thide : function () {\r\n\t\t\tif(this.is_visible) {\r\n\t\t\t\tthis.$el.hide().find(\"ul\").hide().end().find(':focus').blur().end().detach();\r\n\t\t\t\tthis.is_visible = false;\r\n\t\t\t\tpopup = null;\r\n\t\t\t\t/**\r\n\t\t\t\t * triggered on the document when the contextmenu is hidden\r\n\t\t\t\t * @event\r\n\t\t\t\t * @plugin contextmenu\r\n\t\t\t\t * @name context_hide.vakata\r\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t\t */\r\n\t\t\t\tthis._trigger(\"hide\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n    });\t\r\n\r\n\t$(function () {\r\n\t\tright_to_left = $(document.body).css(\"direction\") === \"rtl\";\r\n\r\n\t\t$(document)\r\n\t\t\t.on(\"mousedown.sbswt.popup\", function (e) {\r\n\t\t\t\tif(popup && popup.$el[0] !== e.target  && !noder.contains(popup.$el[0], e.target)) {\r\n\t\t\t\t\tpopup.hide();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on(\"context_show.sbswt.popup\", function (e, data) {\r\n\t\t\t\tpopup.$el.find(\"li:has(ul)\").children(\"a\").addClass(\"vakata-context-parent\");\r\n\t\t\t\tif(right_to_left) {\r\n\t\t\t\t\tpopup.$el.addClass(\"vakata-context-rtl\").css(\"direction\", \"rtl\");\r\n\t\t\t\t}\r\n\t\t\t\t// also apply a RTL class?\r\n\t\t\t\tpopup.$el.find(\"ul\").hide().end();\r\n\t\t\t});\r\n\t});\r\n\r\n\tMenu.popup = function (reference, position, data) {\r\n\t\tvar m = new Menu({\r\n\t\t\treference : reference,\r\n\t\t\titems : data\r\n\t\t});\r\n\t\tm.show(reference,position);\r\n\t};\r\n\r\n\tMenu.hide = function() {\r\n\t\tif (popup) {\r\n\t\t\tpopup.hide();\r\n\t\t}\r\n\t}\r\n\r\n\treturn Menu;\r\n\r\n});"]}