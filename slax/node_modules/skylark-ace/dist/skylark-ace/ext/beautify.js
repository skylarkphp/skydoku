/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(t,e,r){"use strict";var a=t("../token_iterator").TokenIterator;function s(t,e){return t.type.lastIndexOf(e+".xml")>-1}e.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],e.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],e.beautify=function(t){for(var r,n,o,i=new a(t,0,0),c=i.getCurrentToken(),m=t.getTabString(),u=e.singletonTags,l=e.blockTags,p=!1,h=!1,f=!1,g="",b="",d="",y=0,$=0,k=0,w=0,v=0,x=0,T=0,R=0,O=0,C=!1,I=!1,q=!1,S=!1,_={0:0},B=[],F=function(){r&&r.value&&"string.regexp"!==r.type&&(r.value=r.value.trim())},K=function(){g=g.replace(/ +$/,"")},L=function(){g=g.trimRight(),p=!1};null!==c;){if(R=i.getCurrentTokenRow(),i.$rowTokens,r=i.stepForward(),void 0!==c){if(b=c.value,v=0,q="style"===d||"ace/mode/css"===t.$modeId,s(c,"tag-open")?(I=!0,r&&(S=-1!==l.indexOf(r.value)),"</"===b&&(S&&!p&&O<1&&O++,q&&(O=1),v=1,S=!1)):s(c,"tag-close")?I=!1:s(c,"comment.start")?S=!0:s(c,"comment.end")&&(S=!1),I||O||"paren.rparen"!==c.type||"}"!==c.value.substr(0,1)||O++,R!==n&&(O=R,n&&(O-=n)),O){for(L();O>0;O--)g+="\n";p=!0,s(c,"comment")||c.type.match(/^(comment|string)$/)||(b=b.trimLeft())}if(b){if("keyword"===c.type&&b.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(B[y]=b,F(),f=!0,b.match(/^(else|elseif)$/)&&g.match(/\}[\s]*$/)&&(L(),h=!0)):"paren.lparen"===c.type?(F(),"{"===b.substr(-1)&&(f=!0,C=!1,I||(O=1)),"{"===b.substr(0,1)&&(h=!0,"["!==g.substr(-1)&&"["===g.trimRight().substr(-1)?(L(),h=!1):")"===g.trimRight().substr(-1)?L():K())):"paren.rparen"===c.type?(v=1,"}"===b.substr(0,1)&&("case"===B[y-1]&&v++,"{"===g.trimRight().substr(-1)?L():(h=!0,q&&(O+=2))),"]"===b.substr(0,1)&&"}"!==g.substr(-1)&&"}"===g.trimRight().substr(-1)&&(h=!1,w++,L()),")"===b.substr(0,1)&&"("!==g.substr(-1)&&"("===g.trimRight().substr(-1)&&(h=!1,w++,L()),K()):"keyword.operator"!==c.type&&"keyword"!==c.type||!b.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===c.type&&";"===b?(L(),F(),f=!0,q&&O++):"punctuation.operator"===c.type&&b.match(/^(:|,)$/)?(L(),F(),b.match(/^(,)$/)&&T>0&&0===x?O++:(f=!0,p=!1)):"support.php_tag"!==c.type||"?>"!==b||p?s(c,"attribute-name")&&g.substr(-1).match(/^\s$/)?h=!0:s(c,"attribute-equals")?(K(),F()):s(c,"tag-close")&&(K(),"/>"===b&&(h=!0)):(L(),h=!0):(L(),F(),h=!0,f=!0),p&&(!c.type.match(/^(comment)$/)||b.substr(0,1).match(/^[/#]$/))&&(!c.type.match(/^(string)$/)||b.substr(0,1).match(/^['"]$/))){if(w=k,y>$)for(w++,o=y;o>$;o--)_[o]=w;else y<$&&(w=_[y]);for($=y,k=w,v&&(w-=v),C&&!x&&(w++,C=!1),o=0;o<w;o++)g+=m}if("keyword"===c.type&&b.match(/^(case|default)$/)&&(B[y]=b,y++),"keyword"===c.type&&b.match(/^(break)$/)&&B[y-1]&&B[y-1].match(/^(case|default)$/)&&y--,"paren.lparen"===c.type&&(x+=(b.match(/\(/g)||[]).length,T+=(b.match(/\{/g)||[]).length,y+=b.length),"keyword"===c.type&&b.match(/^(if|else|elseif|for|while)$/)?(C=!0,x=0):!x&&b.trim()&&"comment"!==c.type&&(C=!1),"paren.rparen"===c.type)for(x-=(b.match(/\)/g)||[]).length,T-=(b.match(/\}/g)||[]).length,o=0;o<b.length;o++)y--,"}"===b.substr(o,1)&&"case"===B[y]&&y--;h&&!p&&(K(),"\n"!==g.substr(-1)&&(g+=" ")),g+=b,f&&(g+=" "),p=!1,h=!1,f=!1,(s(c,"tag-close")&&(S||-1!==l.indexOf(d))||s(c,"doctype")&&">"===b)&&(O=S&&r&&"</"===r.value?-1:1),s(c,"tag-open")&&"</"===b?y--:s(c,"tag-open")&&"<"===b&&-1===u.indexOf(r.value)?y++:s(c,"tag-name")?d=b:s(c,"tag-close")&&"/>"===b&&-1===u.indexOf(d)&&y--,n=R}}c=r}g=g.trim(),t.doc.setValue(g)},e.commands=[{name:"beautify",exec:function(t){e.beautify(t.session)},bindKey:"Ctrl-Shift-B"}]});
//# sourceMappingURL=../sourcemaps/ext/beautify.js.map
