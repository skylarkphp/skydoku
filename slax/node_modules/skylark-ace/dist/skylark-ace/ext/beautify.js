/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var t=require("../token_iterator").TokenIterator;function e(t,e){return t.type.lastIndexOf(e+".xml")>-1}exports.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],exports.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],exports.beautify=function(r){for(var a,s,n,o=new t(r,0,0),i=o.getCurrentToken(),c=r.getTabString(),m=exports.singletonTags,u=exports.blockTags,l=!1,p=!1,h=!1,f="",g="",b="",d=0,y=0,$=0,k=0,w=0,v=0,x=0,T=0,R=0,O=!1,C=!1,I=!1,q=!1,S={0:0},_=[],B=function(){a&&a.value&&"string.regexp"!==a.type&&(a.value=a.value.trim())},F=function(){f=f.replace(/ +$/,"")},K=function(){f=f.trimRight(),l=!1};null!==i;){if(T=o.getCurrentTokenRow(),o.$rowTokens,a=o.stepForward(),void 0!==i){if(g=i.value,w=0,I="style"===b||"ace/mode/css"===r.$modeId,e(i,"tag-open")?(C=!0,a&&(q=-1!==u.indexOf(a.value)),"</"===g&&(q&&!l&&R<1&&R++,I&&(R=1),w=1,q=!1)):e(i,"tag-close")?C=!1:e(i,"comment.start")?q=!0:e(i,"comment.end")&&(q=!1),C||R||"paren.rparen"!==i.type||"}"!==i.value.substr(0,1)||R++,T!==s&&(R=T,s&&(R-=s)),R){for(K();R>0;R--)f+="\n";l=!0,e(i,"comment")||i.type.match(/^(comment|string)$/)||(g=g.trimLeft())}if(g){if("keyword"===i.type&&g.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(_[d]=g,B(),h=!0,g.match(/^(else|elseif)$/)&&f.match(/\}[\s]*$/)&&(K(),p=!0)):"paren.lparen"===i.type?(B(),"{"===g.substr(-1)&&(h=!0,O=!1,C||(R=1)),"{"===g.substr(0,1)&&(p=!0,"["!==f.substr(-1)&&"["===f.trimRight().substr(-1)?(K(),p=!1):")"===f.trimRight().substr(-1)?K():F())):"paren.rparen"===i.type?(w=1,"}"===g.substr(0,1)&&("case"===_[d-1]&&w++,"{"===f.trimRight().substr(-1)?K():(p=!0,I&&(R+=2))),"]"===g.substr(0,1)&&"}"!==f.substr(-1)&&"}"===f.trimRight().substr(-1)&&(p=!1,k++,K()),")"===g.substr(0,1)&&"("!==f.substr(-1)&&"("===f.trimRight().substr(-1)&&(p=!1,k++,K()),F()):"keyword.operator"!==i.type&&"keyword"!==i.type||!g.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===i.type&&";"===g?(K(),B(),h=!0,I&&R++):"punctuation.operator"===i.type&&g.match(/^(:|,)$/)?(K(),B(),g.match(/^(,)$/)&&x>0&&0===v?R++:(h=!0,l=!1)):"support.php_tag"!==i.type||"?>"!==g||l?e(i,"attribute-name")&&f.substr(-1).match(/^\s$/)?p=!0:e(i,"attribute-equals")?(F(),B()):e(i,"tag-close")&&(F(),"/>"===g&&(p=!0)):(K(),p=!0):(K(),B(),p=!0,h=!0),l&&(!i.type.match(/^(comment)$/)||g.substr(0,1).match(/^[/#]$/))&&(!i.type.match(/^(string)$/)||g.substr(0,1).match(/^['"]$/))){if(k=$,d>y)for(k++,n=d;n>y;n--)S[n]=k;else d<y&&(k=S[d]);for(y=d,$=k,w&&(k-=w),O&&!v&&(k++,O=!1),n=0;n<k;n++)f+=c}if("keyword"===i.type&&g.match(/^(case|default)$/)&&(_[d]=g,d++),"keyword"===i.type&&g.match(/^(break)$/)&&_[d-1]&&_[d-1].match(/^(case|default)$/)&&d--,"paren.lparen"===i.type&&(v+=(g.match(/\(/g)||[]).length,x+=(g.match(/\{/g)||[]).length,d+=g.length),"keyword"===i.type&&g.match(/^(if|else|elseif|for|while)$/)?(O=!0,v=0):!v&&g.trim()&&"comment"!==i.type&&(O=!1),"paren.rparen"===i.type)for(v-=(g.match(/\)/g)||[]).length,x-=(g.match(/\}/g)||[]).length,n=0;n<g.length;n++)d--,"}"===g.substr(n,1)&&"case"===_[d]&&d--;p&&!l&&(F(),"\n"!==f.substr(-1)&&(f+=" ")),f+=g,h&&(f+=" "),l=!1,p=!1,h=!1,(e(i,"tag-close")&&(q||-1!==u.indexOf(b))||e(i,"doctype")&&">"===g)&&(R=q&&a&&"</"===a.value?-1:1),e(i,"tag-open")&&"</"===g?d--:e(i,"tag-open")&&"<"===g&&-1===m.indexOf(a.value)?d++:e(i,"tag-name")?b=g:e(i,"tag-close")&&"/>"===g&&-1===m.indexOf(b)&&d--,s=T}}i=a}f=f.trim(),r.doc.setValue(f)},exports.commands=[{name:"beautify",exec:function(t){exports.beautify(t.session)},bindKey:"Ctrl-Shift-B"}]});
//# sourceMappingURL=../sourcemaps/ext/beautify.js.map
