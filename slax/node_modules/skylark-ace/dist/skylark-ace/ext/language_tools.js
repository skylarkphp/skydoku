/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e=require("../snippets").snippetManager,t=require("../autocomplete").Autocomplete,o=require("../config"),n=require("../lib/lang"),i=require("../autocomplete/util"),p=require("../autocomplete/text_completer"),s={getCompletions:function(e,t,o,n,i){if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,o,n,i);var p=e.session.getState(o.row);i(null,t.$mode.getCompletions(p,t,o,n))}},a={getCompletions:function(t,o,n,i,p){var s=[],a=o.getTokenAt(n.row,n.column);a&&a.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?s.push("html-tag"):s=e.getActiveScopes(t);var c=e.snippetMap,m=[];s.forEach(function(e){for(var t=c[e]||[],o=t.length;o--;){var n=t[o],i=n.name||n.tabTrigger;i&&m.push({caption:i,snippet:n.content,meta:n.tabTrigger&&!n.name?n.tabTrigger+"â‡¥ ":"snippet",type:"snippet"})}},this),p(null,m)},getDocTooltip:function(e){"snippet"!=e.type||e.docHTML||(e.docHTML=["<b>",n.escapeHTML(e.caption),"</b>","<hr></hr>",n.escapeHTML(e.snippet)].join(""))}},c=[a,p,s];exports.setCompleters=function(e){c.length=0,e&&c.push.apply(c,e)},exports.addCompleter=function(e){c.push(e)},exports.textCompleter=p,exports.keyWordCompleter=s,exports.snippetCompleter=a;var m={name:"expandSnippet",exec:function(t){return e.expandWithTab(t)},bindKey:"Tab"},r=function(e,t){l(t.session.$mode)},l=function(t){var o=t.$id;e.files||(e.files={}),d(o),t.modes&&t.modes.forEach(l)},d=function(t){if(t&&!e.files[t]){var n=t.replace("mode","snippets");e.files[t]={},o.loadModule(n,function(o){o&&(e.files[t]=o,!o.snippets&&o.snippetText&&(o.snippets=e.parseSnippetFile(o.snippetText)),e.register(o.snippets||[],o.scope),o.includeScopes&&(e.snippetMap[o.scope].includeScopes=o.includeScopes,o.includeScopes.forEach(function(e){d("ace/mode/"+e)})))})}},u=function(e){var o=e.editor,n=o.completer&&o.completer.activated;if("backspace"===e.command.name)n&&!i.getCompletionPrefix(o)&&o.completer.detach();else if("insertstring"===e.command.name){i.getCompletionPrefix(o)&&!n&&(o.completer||(o.completer=new t),o.completer.autoInsert=!1,o.completer.showPopup(o))}},f=require("../editor").Editor;require("../config").defineOptions(f.prototype,"editor",{enableBasicAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:c),this.commands.addCommand(t.startCommand)):this.commands.removeCommand(t.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:c),this.commands.on("afterExec",u)):this.commands.removeListener("afterExec",u)},value:!1},enableSnippets:{set:function(e){e?(this.commands.addCommand(m),this.on("changeMode",r),r(0,this)):(this.commands.removeCommand(m),this.off("changeMode",r))},value:!1}})});
//# sourceMappingURL=../sourcemaps/ext/language_tools.js.map
