/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,o){"use strict";var n=e("../snippets").snippetManager,i=e("../autocomplete").Autocomplete,p=e("../config"),s=e("../lib/lang"),a=e("../autocomplete/util"),c=e("../autocomplete/text_completer"),m={getCompletions:function(e,t,o,n,i){if(t.$mode.completer)return t.$mode.completer.getCompletions(e,t,o,n,i);var p=e.session.getState(o.row);i(null,t.$mode.getCompletions(p,t,o,n))}},r={getCompletions:function(e,t,o,i,p){var s=[],a=t.getTokenAt(o.row,o.column);a&&a.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?s.push("html-tag"):s=n.getActiveScopes(e);var c=n.snippetMap,m=[];s.forEach(function(e){for(var t=c[e]||[],o=t.length;o--;){var n=t[o],i=n.name||n.tabTrigger;i&&m.push({caption:i,snippet:n.content,meta:n.tabTrigger&&!n.name?n.tabTrigger+"â‡¥ ":"snippet",type:"snippet"})}},this),p(null,m)},getDocTooltip:function(e){"snippet"!=e.type||e.docHTML||(e.docHTML=["<b>",s.escapeHTML(e.caption),"</b>","<hr></hr>",s.escapeHTML(e.snippet)].join(""))}},l=[r,c,m];t.setCompleters=function(e){l.length=0,e&&l.push.apply(l,e)},t.addCompleter=function(e){l.push(e)},t.textCompleter=c,t.keyWordCompleter=m,t.snippetCompleter=r;var d={name:"expandSnippet",exec:function(e){return n.expandWithTab(e)},bindKey:"Tab"},u=function(e,t){f(t.session.$mode)},f=function(e){var t=e.$id;n.files||(n.files={}),h(t),e.modes&&e.modes.forEach(f)},h=function(e){if(e&&!n.files[e]){var t=e.replace("mode","snippets");n.files[e]={},p.loadModule(t,function(t){t&&(n.files[e]=t,!t.snippets&&t.snippetText&&(t.snippets=n.parseSnippetFile(t.snippetText)),n.register(t.snippets||[],t.scope),t.includeScopes&&(n.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach(function(e){h("ace/mode/"+e)})))})}},g=function(e){var t=e.editor,o=t.completer&&t.completer.activated;if("backspace"===e.command.name)o&&!a.getCompletionPrefix(t)&&t.completer.detach();else if("insertstring"===e.command.name){a.getCompletionPrefix(t)&&!o&&(t.completer||(t.completer=new i),t.completer.autoInsert=!1,t.completer.showPopup(t))}},v=e("../editor").Editor;e("../config").defineOptions(v.prototype,"editor",{enableBasicAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:l),this.commands.addCommand(i.startCommand)):this.commands.removeCommand(i.startCommand)},value:!1},enableLiveAutocompletion:{set:function(e){e?(this.completers||(this.completers=Array.isArray(e)?e:l),this.commands.on("afterExec",g)):this.commands.removeListener("afterExec",g)},value:!1},enableSnippets:{set:function(e){e?(this.commands.addCommand(d),this.on("changeMode",u),u(0,this)):(this.commands.removeCommand(d),this.off("changeMode",u))},value:!1}})});
//# sourceMappingURL=../sourcemaps/ext/language_tools.js.map
