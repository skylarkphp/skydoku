/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var t,e,n=require("ace/keyboard/hash_handler").HashHandler,i=require("ace/editor").Editor,s=require("ace/snippets").snippetManager,o=require("ace/range").Range;function a(){}a.prototype={setupContext:function(e){this.ace=e,this.indentation=e.session.getTabString(),t||(t=window.emmet),(t.resources||t.require("resources")).setVariable("indentation",this.indentation),this.$syntax=null,this.$syntax=this.getSyntax()},getSelectionRange:function(){var t=this.ace.getSelectionRange(),e=this.ace.session.doc;return{start:e.positionToIndex(t.start),end:e.positionToIndex(t.end)}},createSelection:function(t,e){var n=this.ace.session.doc;this.ace.selection.setRange({start:n.indexToPosition(t),end:n.indexToPosition(e)})},getCurrentLineRange:function(){var t=this.ace,e=t.getCursorPosition().row,n=t.session.getLine(e).length,i=t.session.doc.positionToIndex({row:e,column:0});return{start:i,end:i+n}},getCaretPos:function(){var t=this.ace.getCursorPosition();return this.ace.session.doc.positionToIndex(t)},setCaretPos:function(t){var e=this.ace.session.doc.indexToPosition(t);this.ace.selection.moveToPosition(e)},getCurrentLine:function(){var t=this.ace.getCursorPosition().row;return this.ace.session.getLine(t)},replaceContent:function(t,e,n,i){null==n&&(n=null==e?this.getContent().length:e),null==e&&(e=0);var a=this.ace,r=a.session.doc,c=o.fromPoints(r.indexToPosition(e),r.indexToPosition(n));a.session.remove(c),c.end=c.start,t=this.$updateTabstops(t),s.insertSnippet(a,t)},getContent:function(){return this.ace.getValue()},getSyntax:function(){if(this.$syntax)return this.$syntax;var t=this.ace.session.$modeId.split("/").pop();if("html"==t||"php"==t){var e=this.ace.getCursorPosition(),n=this.ace.session.getState(e.row);"string"!=typeof n&&(n=n[0]),n&&((n=n.split("-")).length>1?t=n[0]:"php"==t&&(t="html"))}return t},getProfileName:function(){var e=t.resources||t.require("resources");switch(this.getSyntax()){case"css":return"css";case"xml":case"xsl":return"xml";case"html":var n=e.getVariable("profile");return n||(n=-1!=this.ace.session.getLines(0,2).join("").search(/<!DOCTYPE[^>]+XHTML/i)?"xhtml":"html"),n;default:var i=this.ace.session.$mode;return i.emmetConfig&&i.emmetConfig.profile||"xhtml"}},prompt:function(t){return prompt(t)},getSelection:function(){return this.ace.session.getTextRange()},getFilePath:function(){return""},$updateTabstops:function(e){var n=0,i=null,s=t.tabStops||t.require("tabStops"),o=(t.resources||t.require("resources")).getVocabulary("user"),a={tabstop:function(t){var e=parseInt(t.group,10),o=0===e;o?e=++n:e+=1e3;var r=t.placeholder;r&&(r=s.processText(r,a));var c="${"+e+(r?":"+r:"")+"}";return o&&(i=[t.start,c]),c},escape:function(t){return"$"==t?"\\$":"\\"==t?"\\\\":t}};if(e=s.processText(e,a),o.variables.insert_final_tabstop&&!/\$\{0\}$/.test(e))e+="${0}";else if(i){e=(t.utils?t.utils.common:t.require("utils")).replaceSubstring(e,"${0}",i[0],i[1])}return e}};var r={expand_abbreviation:{mac:"ctrl+alt+e",win:"alt+e"},match_pair_outward:{mac:"ctrl+d",win:"ctrl+,"},match_pair_inward:{mac:"ctrl+j",win:"ctrl+shift+0"},matching_pair:{mac:"ctrl+alt+j",win:"alt+j"},next_edit_point:"alt+right",prev_edit_point:"alt+left",toggle_comment:{mac:"command+/",win:"ctrl+/"},split_join_tag:{mac:"shift+command+'",win:"shift+ctrl+`"},remove_tag:{mac:"command+'",win:"shift+ctrl+;"},evaluate_math_expression:{mac:"shift+command+y",win:"shift+ctrl+y"},increment_number_by_1:"ctrl+up",decrement_number_by_1:"ctrl+down",increment_number_by_01:"alt+up",decrement_number_by_01:"alt+down",increment_number_by_10:{mac:"alt+command+up",win:"shift+alt+up"},decrement_number_by_10:{mac:"alt+command+down",win:"shift+alt+down"},select_next_item:{mac:"shift+command+.",win:"shift+ctrl+."},select_previous_item:{mac:"shift+command+,",win:"shift+ctrl+,"},reflect_css_value:{mac:"shift+command+r",win:"shift+ctrl+r"},encode_decode_data_url:{mac:"shift+ctrl+d",win:"ctrl+'"},expand_abbreviation_with_tab:"Tab",wrap_with_abbreviation:{mac:"shift+ctrl+a",win:"shift+ctrl+a"}},c=new a;for(var u in exports.commands=new n,exports.runEmmetCommand=function e(n){try{c.setupContext(n);var i=t.actions||t.require("actions");if("expand_abbreviation_with_tab"==this.action){if(!n.selection.isEmpty())return!1;var s=n.selection.lead,o=n.session.getTokenAt(s.row,s.column);if(o&&/\btag\b/.test(o.type))return!1}if("wrap_with_abbreviation"==this.action)return setTimeout(function(){i.run("wrap_with_abbreviation",c)},0);var a=i.run(this.action,c)}catch(i){if(!t)return exports.load(e.bind(this,n)),!0;n._signal("changeStatus","string"==typeof i?i:i.message),console.log(i),a=!1}return a},r)exports.commands.addCommand({name:"emmet:"+u,action:u,bindKey:r[u],exec:exports.runEmmetCommand,multiSelectAction:"forEach"});exports.updateCommands=function(t,e){e?t.keyBinding.addKeyboardHandler(exports.commands):t.keyBinding.removeKeyboardHandler(exports.commands)},exports.isSupportedMode=function(t){if(!t)return!1;if(t.emmetConfig)return!0;var e=t.$id||t;return/css|less|scss|sass|stylus|html|php|twig|ejs|handlebars/.test(e)},exports.isAvailable=function(t,e){if(/(evaluate_math_expression|expand_abbreviation)$/.test(e))return!0;var n=t.session.$mode,i=exports.isSupportedMode(n);if(i&&n.$modes)try{c.setupContext(t),/js|php/.test(c.getSyntax())&&(i=!1)}catch(t){}return i};var m=function(t,e){var n=e;if(n){var i=exports.isSupportedMode(n.session.$mode);!1===t.enableEmmet&&(i=!1),i&&exports.load(),exports.updateCommands(n,i)}};exports.load=function(t){"string"==typeof e&&require("ace/config").loadModule(e,function(){e=null,t&&t()})},exports.AceEmmetEditor=a,require("ace/config").defineOptions(i.prototype,"editor",{enableEmmet:{set:function(t){this[t?"on":"removeListener"]("changeMode",m),m({enableEmmet:!!t},this)},value:!0}}),exports.setCore=function(n){"string"==typeof n?e=n:t=n}});
//# sourceMappingURL=../sourcemaps/ext/emmet.js.map
