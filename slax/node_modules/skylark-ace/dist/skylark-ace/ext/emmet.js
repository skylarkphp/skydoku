/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(t,e,n){"use strict";var i,s,o=t("ace/keyboard/hash_handler").HashHandler,a=t("ace/editor").Editor,r=t("ace/snippets").snippetManager,c=t("ace/range").Range;function u(){}u.prototype={setupContext:function(t){this.ace=t,this.indentation=t.session.getTabString(),i||(i=window.emmet),(i.resources||i.require("resources")).setVariable("indentation",this.indentation),this.$syntax=null,this.$syntax=this.getSyntax()},getSelectionRange:function(){var t=this.ace.getSelectionRange(),e=this.ace.session.doc;return{start:e.positionToIndex(t.start),end:e.positionToIndex(t.end)}},createSelection:function(t,e){var n=this.ace.session.doc;this.ace.selection.setRange({start:n.indexToPosition(t),end:n.indexToPosition(e)})},getCurrentLineRange:function(){var t=this.ace,e=t.getCursorPosition().row,n=t.session.getLine(e).length,i=t.session.doc.positionToIndex({row:e,column:0});return{start:i,end:i+n}},getCaretPos:function(){var t=this.ace.getCursorPosition();return this.ace.session.doc.positionToIndex(t)},setCaretPos:function(t){var e=this.ace.session.doc.indexToPosition(t);this.ace.selection.moveToPosition(e)},getCurrentLine:function(){var t=this.ace.getCursorPosition().row;return this.ace.session.getLine(t)},replaceContent:function(t,e,n,i){null==n&&(n=null==e?this.getContent().length:e),null==e&&(e=0);var s=this.ace,o=s.session.doc,a=c.fromPoints(o.indexToPosition(e),o.indexToPosition(n));s.session.remove(a),a.end=a.start,t=this.$updateTabstops(t),r.insertSnippet(s,t)},getContent:function(){return this.ace.getValue()},getSyntax:function(){if(this.$syntax)return this.$syntax;var t=this.ace.session.$modeId.split("/").pop();if("html"==t||"php"==t){var e=this.ace.getCursorPosition(),n=this.ace.session.getState(e.row);"string"!=typeof n&&(n=n[0]),n&&((n=n.split("-")).length>1?t=n[0]:"php"==t&&(t="html"))}return t},getProfileName:function(){var t=i.resources||i.require("resources");switch(this.getSyntax()){case"css":return"css";case"xml":case"xsl":return"xml";case"html":var e=t.getVariable("profile");return e||(e=-1!=this.ace.session.getLines(0,2).join("").search(/<!DOCTYPE[^>]+XHTML/i)?"xhtml":"html"),e;default:var n=this.ace.session.$mode;return n.emmetConfig&&n.emmetConfig.profile||"xhtml"}},prompt:function(t){return prompt(t)},getSelection:function(){return this.ace.session.getTextRange()},getFilePath:function(){return""},$updateTabstops:function(t){var e=0,n=null,s=i.tabStops||i.require("tabStops"),o=(i.resources||i.require("resources")).getVocabulary("user"),a={tabstop:function(t){var i=parseInt(t.group,10),o=0===i;o?i=++e:i+=1e3;var r=t.placeholder;r&&(r=s.processText(r,a));var c="${"+i+(r?":"+r:"")+"}";return o&&(n=[t.start,c]),c},escape:function(t){return"$"==t?"\\$":"\\"==t?"\\\\":t}};if(t=s.processText(t,a),o.variables.insert_final_tabstop&&!/\$\{0\}$/.test(t))t+="${0}";else if(n){t=(i.utils?i.utils.common:i.require("utils")).replaceSubstring(t,"${0}",n[0],n[1])}return t}};var m={expand_abbreviation:{mac:"ctrl+alt+e",win:"alt+e"},match_pair_outward:{mac:"ctrl+d",win:"ctrl+,"},match_pair_inward:{mac:"ctrl+j",win:"ctrl+shift+0"},matching_pair:{mac:"ctrl+alt+j",win:"alt+j"},next_edit_point:"alt+right",prev_edit_point:"alt+left",toggle_comment:{mac:"command+/",win:"ctrl+/"},split_join_tag:{mac:"shift+command+'",win:"shift+ctrl+`"},remove_tag:{mac:"command+'",win:"shift+ctrl+;"},evaluate_math_expression:{mac:"shift+command+y",win:"shift+ctrl+y"},increment_number_by_1:"ctrl+up",decrement_number_by_1:"ctrl+down",increment_number_by_01:"alt+up",decrement_number_by_01:"alt+down",increment_number_by_10:{mac:"alt+command+up",win:"shift+alt+up"},decrement_number_by_10:{mac:"alt+command+down",win:"shift+alt+down"},select_next_item:{mac:"shift+command+.",win:"shift+ctrl+."},select_previous_item:{mac:"shift+command+,",win:"shift+ctrl+,"},reflect_css_value:{mac:"shift+command+r",win:"shift+ctrl+r"},encode_decode_data_url:{mac:"shift+ctrl+d",win:"ctrl+'"},expand_abbreviation_with_tab:"Tab",wrap_with_abbreviation:{mac:"shift+ctrl+a",win:"shift+ctrl+a"}},l=new u;for(var d in e.commands=new o,e.runEmmetCommand=function t(n){try{l.setupContext(n);var s=i.actions||i.require("actions");if("expand_abbreviation_with_tab"==this.action){if(!n.selection.isEmpty())return!1;var o=n.selection.lead,a=n.session.getTokenAt(o.row,o.column);if(a&&/\btag\b/.test(a.type))return!1}if("wrap_with_abbreviation"==this.action)return setTimeout(function(){s.run("wrap_with_abbreviation",l)},0);var r=s.run(this.action,l)}catch(s){if(!i)return e.load(t.bind(this,n)),!0;n._signal("changeStatus","string"==typeof s?s:s.message),console.log(s),r=!1}return r},m)e.commands.addCommand({name:"emmet:"+d,action:d,bindKey:m[d],exec:e.runEmmetCommand,multiSelectAction:"forEach"});e.updateCommands=function(t,n){n?t.keyBinding.addKeyboardHandler(e.commands):t.keyBinding.removeKeyboardHandler(e.commands)},e.isSupportedMode=function(t){if(!t)return!1;if(t.emmetConfig)return!0;var e=t.$id||t;return/css|less|scss|sass|stylus|html|php|twig|ejs|handlebars/.test(e)},e.isAvailable=function(t,n){if(/(evaluate_math_expression|expand_abbreviation)$/.test(n))return!0;var i=t.session.$mode,s=e.isSupportedMode(i);if(s&&i.$modes)try{l.setupContext(t),/js|php/.test(l.getSyntax())&&(s=!1)}catch(t){}return s};var h=function(t,n){var i=n;if(i){var s=e.isSupportedMode(i.session.$mode);!1===t.enableEmmet&&(s=!1),s&&e.load(),e.updateCommands(i,s)}};e.load=function(e){"string"==typeof s&&t("ace/config").loadModule(s,function(){s=null,e&&e()})},e.AceEmmetEditor=u,t("ace/config").defineOptions(a.prototype,"editor",{enableEmmet:{set:function(t){this[t?"on":"removeListener"]("changeMode",h),h({enableEmmet:!!t},this)},value:!0}}),e.setCore=function(t){"string"==typeof t?s=t:i=t}});
//# sourceMappingURL=../sourcemaps/ext/emmet.js.map
