/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e=require("../line_widgets").LineWidgets,r=require("../lib/dom"),o=require("../range").Range;exports.showErrorMarker=function(t,n){var a=t.session;a.widgetManager||(a.widgetManager=new e(a),a.widgetManager.attach(t));var i=t.getCursorPosition(),d=i.row,s=a.widgetManager.getWidgetsAtRow(d).filter(function(e){return"errorMarker"==e.type})[0];s?s.destroy():d-=n;var l,g=function(e,r,t){var n=e.getAnnotations().sort(o.comparePoints);if(n.length){var a=function(e,r,o){for(var t=0,n=e.length-1;t<=n;){var a=t+n>>1,i=o(r,e[a]);if(i>0)t=a+1;else{if(!(i<0))return a;n=a-1}}return-(t+1)}(n,{row:r,column:-1},o.comparePoints);a<0&&(a=-a-1),a>=n.length?a=t>0?0:n.length-1:0===a&&t<0&&(a=n.length-1);var i=n[a];if(i&&t){if(i.row===r){do{i=n[a+=t]}while(i&&i.row===r);if(!i)return n.slice()}var d=[];r=i.row;do{d[t<0?"unshift":"push"](i),i=n[a+=t]}while(i&&i.row==r);return d.length&&d}}}(a,d,n);if(g){var c=g[0];i.column=(c.pos&&"number"!=typeof c.column?c.pos.sc:c.column)||0,i.row=c.row,l=t.renderer.$gutterLayer.$annotations[i.row]}else{if(s)return;l={text:["Looks good!"],className:"ace_ok"}}t.session.unfold(i.row),t.selection.moveToPosition(i);var w={row:i.row,fixedWidth:!0,coverGutter:!0,el:r.createElement("div"),type:"errorMarker"},p=w.el.appendChild(r.createElement("div")),u=w.el.appendChild(r.createElement("div"));u.className="error_widget_arrow "+l.className;var f=t.renderer.$cursorLayer.getPixelPosition(i).left;u.style.left=f+t.renderer.gutterWidth-5+"px",w.el.className="error_widget_wrapper",p.className="error_widget "+l.className,p.innerHTML=l.text.join("<br>"),p.appendChild(r.createElement("div"));var m=function(e,r,o){if(0===r&&("esc"===o||"return"===o))return w.destroy(),{command:"null"}};w.destroy=function(){t.$mouseHandler.isMousePressed||(t.keyBinding.removeKeyboardHandler(m),a.widgetManager.removeLineWidget(w),t.off("changeSelection",w.destroy),t.off("changeSession",w.destroy),t.off("mouseup",w.destroy),t.off("change",w.destroy))},t.keyBinding.addKeyboardHandler(m),t.on("changeSelection",w.destroy),t.on("changeSession",w.destroy),t.on("mouseup",w.destroy),t.on("change",w.destroy),t.session.widgetManager.addLineWidget(w),w.el.onmousedown=t.focus.bind(t),t.renderer.scrollCursorIntoView(null,.5,{bottom:w.el.offsetHeight})},r.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }","")});
//# sourceMappingURL=../sourcemaps/ext/error_marker.js.map
