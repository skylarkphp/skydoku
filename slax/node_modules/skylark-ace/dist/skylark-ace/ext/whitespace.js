/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e=require("../lib/lang");exports.$detectIndentation=function(e,t){for(var n=[],r=[],i=0,o=0,s=Math.min(e.length,1e3),a=0;a<s;a++){var c=e[a];if(/^\s*[^*+\-\s]/.test(c)){if("\t"==c[0])i++,o=-Number.MAX_VALUE;else{var g=c.match(/^ */)[0].length;if(g&&"\t"!=c[g]){var h=g-o;!(h>0)||o%h||g%h||(r[h]=(r[h]||0)+1),n[g]=(n[g]||0)+1}o=g}for(;a<s&&"\\"==c[c.length-1];)c=e[a++]}}function l(e){for(var t=0,r=e;r<n.length;r+=e)t+=n[r]||0;return t}var u=r.reduce(function(e,t){return e+t},0),f={score:0,length:0},v=0;for(a=1;a<12;a++){var d=l(a);1==a?(v=d,d=n[1]?.9:.8,n.length||(d=0)):d/=v,r[a]&&(d+=r[a]/u),d>f.score&&(f={score:d,length:a})}if(f.score&&f.score>1.4)var m=f.length;return i>v+1?((1==m||v<i/4||f.score<1.8)&&(m=void 0),{ch:"\t",length:m}):v>i+1?{ch:" ",length:m}:void 0},exports.detectIndentation=function(e){var t=e.getLines(0,1e3),n=exports.$detectIndentation(t)||{};return n.ch&&e.setUseSoftTabs(" "==n.ch),n.length&&e.setTabSize(n.length),n},exports.trimTrailingSpace=function(e,t){var n=e.getDocument(),r=n.getAllLines(),i=t&&t.trimEmpty?-1:0,o=[],s=-1;t&&t.keepCursorPosition&&(e.selection.rangeCount?e.selection.rangeList.ranges.forEach(function(e,t,n){var r=n[t+1];r&&r.cursor.row==e.cursor.row||o.push(e.cursor)}):o.push(e.selection.getCursor()),s=0);for(var a=o[s]&&o[s].row,c=0,g=r.length;c<g;c++){var h=r[c],l=h.search(/\s+$/);c==a&&(l<o[s].column&&l>i&&(l=o[s].column),a=o[++s]?o[s].row:-1),l>i&&n.removeInLine(c,l,h.length)}},exports.convertIndentation=function(t,n,r){var i=t.getTabString()[0],o=t.getTabSize();r||(r=o),n||(n=i);for(var s="\t"==n?n:e.stringRepeat(n,r),a=t.doc,c=a.getAllLines(),g={},h={},l=0,u=c.length;l<u;l++){var f=c[l].match(/^\s*/)[0];if(f){var v=t.$getStringScreenWidth(f)[0],d=Math.floor(v/o),m=v%o,p=g[d]||(g[d]=e.stringRepeat(s,d));(p+=h[m]||(h[m]=e.stringRepeat(" ",m)))!=f&&(a.removeInLine(l,0,f.length),a.insertInLine({row:l,column:0},p))}}t.setTabSize(r),t.setUseSoftTabs(" "==n)},exports.$parseStringArg=function(e){var t={};/t/.test(e)?t.ch="\t":/s/.test(e)&&(t.ch=" ");var n=e.match(/\d+/);return n&&(t.length=parseInt(n[0],10)),t},exports.$parseArg=function(e){return e?"string"==typeof e?exports.$parseStringArg(e):"string"==typeof e.text?exports.$parseStringArg(e.text):e:{}},exports.commands=[{name:"detectIndentation",exec:function(e){exports.detectIndentation(e.session)}},{name:"trimTrailingSpace",exec:function(e,t){exports.trimTrailingSpace(e.session,t)}},{name:"convertIndentation",exec:function(e,t){var n=exports.$parseArg(t);exports.convertIndentation(e.session,n.ch,n.length)}},{name:"setIndentation",exec:function(e,t){var n=exports.$parseArg(t);n.length&&e.session.setTabSize(n.length),n.ch&&e.session.setUseSoftTabs(" "==n.ch)}}]});
//# sourceMappingURL=../sourcemaps/ext/whitespace.js.map
