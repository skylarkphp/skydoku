/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,o){"use strict";var r=e("../virtual_renderer").VirtualRenderer,i=e("../editor").Editor,n=e("../range").Range,a=e("../lib/event"),s=e("../lib/lang"),c=e("../lib/dom");c.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}","autocompletion.css"),t.AcePopup=function(e){var t=c.createElement("div"),o=new function(e){var t=new r(e);t.$maxLines=4;var o=new i(t);return o.setHighlightActiveLine(!1),o.setShowPrintMargin(!1),o.renderer.setShowGutter(!1),o.renderer.setHighlightGutterLine(!1),o.$mouseHandler.$focusTimeout=0,o.$highlightTagPending=!0,o}(t);e&&e.appendChild(t),t.style.display="none",o.renderer.content.style.cursor="default",o.renderer.setStyle("ace_autocomplete"),o.setOption("displayIndentGuides",!1),o.setOption("dragDelay",150);var l,d=function(){};o.focus=d,o.$isFocused=!0,o.renderer.$cursorLayer.restartTimer=d,o.renderer.$cursorLayer.element.style.opacity=0,o.renderer.$maxLines=8,o.renderer.$keepTextAreaAtCursor=!1,o.setHighlightActiveLine(!1),o.session.highlight(""),o.session.$searchHighlight.clazz="ace_highlight-marker",o.on("mousedown",function(e){var t=e.getDocumentPosition();o.selection.moveToPosition(t),h.start.row=h.end.row=t.row,e.stop()});var u=new n(-1,0,-1,1/0),h=new n(-1,0,-1,1/0);h.id=o.session.addMarker(h,"ace_active-line","fullLine"),o.setSelectOnHover=function(e){e?u.id&&(o.session.removeMarker(u.id),u.id=null):u.id=o.session.addMarker(u,"ace_line-hover","fullLine")},o.setSelectOnHover(!1),o.on("mousemove",function(e){if(l){if(l.x!=e.x||l.y!=e.y){(l=e).scrollTop=o.renderer.scrollTop;var t=l.getDocumentPosition().row;u.start.row!=t&&(u.id||o.setRow(t),p(t))}}else l=e}),o.renderer.on("beforeRender",function(){if(l&&-1!=u.start.row){l.$pos=null;var e=l.getDocumentPosition().row;u.id||o.setRow(e),p(e,!0)}}),o.renderer.on("afterRender",function(){var e=o.getRow(),t=o.renderer.$textLayer,r=t.element.childNodes[e-t.config.firstRow];r!==t.selectedNode&&t.selectedNode&&c.removeCssClass(t.selectedNode,"ace_selected"),t.selectedNode=r,r&&c.addCssClass(r,"ace_selected")});var g=function(){p(-1)},p=function(e,t){e!==u.start.row&&(u.start.row=u.end.row=e,t||o.session._emit("changeBackMarker"),o._emit("changeHoverMarker"))};o.getHoveredRow=function(){return u.start.row},a.addListener(o.container,"mouseout",g),o.on("hide",g),o.on("changeSelection",g),o.session.doc.getLength=function(){return o.data.length},o.session.doc.getLine=function(e){var t=o.data[e];return"string"==typeof t?t:t&&t.value||""};var f=o.session.bgTokenizer;return f.$tokenizeRow=function(e){var t=o.data[e],r=[];if(!t)return r;"string"==typeof t&&(t={value:t});var i=t.caption||t.value||t.name;function n(e,o){e&&r.push({type:(t.className||"")+(o||""),value:e})}for(var a=i.toLowerCase(),s=(o.filterText||"").toLowerCase(),c=0,l=0,d=0;d<=s.length;d++)if(d!=l&&(t.matchMask&1<<d||d==s.length)){var u=s.slice(l,d);l=d;var h=a.indexOf(u,c);if(-1==h)continue;n(i.slice(c,h),""),c=h+u.length,n(i.slice(h,c),"completion-highlight")}return n(i.slice(c,i.length),""),t.meta&&r.push({type:"completion-meta",value:t.meta}),r},f.$updateOnChange=d,f.start=d,o.session.$computeWidth=function(){return this.screenWidth=0},o.isOpen=!1,o.isTopdown=!1,o.autoSelect=!0,o.filterText="",o.data=[],o.setData=function(e,t){o.filterText=t||"",o.setValue(s.stringRepeat("\n",e.length),-1),o.data=e||[],o.setRow(0)},o.getData=function(e){return o.data[e]},o.getRow=function(){return h.start.row},o.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length,e)),h.start.row!=e&&(o.selection.clearSelection(),h.start.row=h.end.row=e||0,o.session._emit("changeBackMarker"),o.moveCursorTo(e||0,0),o.isOpen&&o._signal("select"))},o.on("changeSelection",function(){o.isOpen&&o.setRow(o.selection.lead.row),o.renderer.scrollCursorIntoView()}),o.hide=function(){this.container.style.display="none",this._signal("hide"),o.isOpen=!1},o.show=function(e,t,r){var i=this.container,n=window.innerHeight,a=window.innerWidth,s=this.renderer,c=s.$maxLines*t*1.4,d=e.top+this.$borderSize;d>n/2&&!r&&d+t+c>n?(s.$maxPixelHeight=d-2*this.$borderSize,i.style.top="",i.style.bottom=n-d+"px",o.isTopdown=!1):(d+=t,s.$maxPixelHeight=n-d-.2*t,i.style.top=d+"px",i.style.bottom="",o.isTopdown=!0),i.style.display="";var u=e.left;u+i.offsetWidth>a&&(u=a-i.offsetWidth),i.style.left=u+"px",this._signal("show"),l=null,o.isOpen=!0},o.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},o.$imageSize=0,o.$borderSize=1,o}});
//# sourceMappingURL=../sourcemaps/autocomplete/popup.js.map
