/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e=require("../virtual_renderer").VirtualRenderer,t=require("../editor").Editor,o=require("../range").Range,r=require("../lib/event"),i=require("../lib/lang"),n=require("../lib/dom");n.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}","autocompletion.css"),exports.AcePopup=function(a){var s=n.createElement("div"),c=new function(o){var r=new e(o);r.$maxLines=4;var i=new t(r);return i.setHighlightActiveLine(!1),i.setShowPrintMargin(!1),i.renderer.setShowGutter(!1),i.renderer.setHighlightGutterLine(!1),i.$mouseHandler.$focusTimeout=0,i.$highlightTagPending=!0,i}(s);a&&a.appendChild(s),s.style.display="none",c.renderer.content.style.cursor="default",c.renderer.setStyle("ace_autocomplete"),c.setOption("displayIndentGuides",!1),c.setOption("dragDelay",150);var l,d=function(){};c.focus=d,c.$isFocused=!0,c.renderer.$cursorLayer.restartTimer=d,c.renderer.$cursorLayer.element.style.opacity=0,c.renderer.$maxLines=8,c.renderer.$keepTextAreaAtCursor=!1,c.setHighlightActiveLine(!1),c.session.highlight(""),c.session.$searchHighlight.clazz="ace_highlight-marker",c.on("mousedown",function(e){var t=e.getDocumentPosition();c.selection.moveToPosition(t),h.start.row=h.end.row=t.row,e.stop()});var u=new o(-1,0,-1,1/0),h=new o(-1,0,-1,1/0);h.id=c.session.addMarker(h,"ace_active-line","fullLine"),c.setSelectOnHover=function(e){e?u.id&&(c.session.removeMarker(u.id),u.id=null):u.id=c.session.addMarker(u,"ace_line-hover","fullLine")},c.setSelectOnHover(!1),c.on("mousemove",function(e){if(l){if(l.x!=e.x||l.y!=e.y){(l=e).scrollTop=c.renderer.scrollTop;var t=l.getDocumentPosition().row;u.start.row!=t&&(u.id||c.setRow(t),p(t))}}else l=e}),c.renderer.on("beforeRender",function(){if(l&&-1!=u.start.row){l.$pos=null;var e=l.getDocumentPosition().row;u.id||c.setRow(e),p(e,!0)}}),c.renderer.on("afterRender",function(){var e=c.getRow(),t=c.renderer.$textLayer,o=t.element.childNodes[e-t.config.firstRow];o!==t.selectedNode&&t.selectedNode&&n.removeCssClass(t.selectedNode,"ace_selected"),t.selectedNode=o,o&&n.addCssClass(o,"ace_selected")});var g=function(){p(-1)},p=function(e,t){e!==u.start.row&&(u.start.row=u.end.row=e,t||c.session._emit("changeBackMarker"),c._emit("changeHoverMarker"))};c.getHoveredRow=function(){return u.start.row},r.addListener(c.container,"mouseout",g),c.on("hide",g),c.on("changeSelection",g),c.session.doc.getLength=function(){return c.data.length},c.session.doc.getLine=function(e){var t=c.data[e];return"string"==typeof t?t:t&&t.value||""};var f=c.session.bgTokenizer;return f.$tokenizeRow=function(e){var t=c.data[e],o=[];if(!t)return o;"string"==typeof t&&(t={value:t});var r=t.caption||t.value||t.name;function i(e,r){e&&o.push({type:(t.className||"")+(r||""),value:e})}for(var n=r.toLowerCase(),a=(c.filterText||"").toLowerCase(),s=0,l=0,d=0;d<=a.length;d++)if(d!=l&&(t.matchMask&1<<d||d==a.length)){var u=a.slice(l,d);l=d;var h=n.indexOf(u,s);if(-1==h)continue;i(r.slice(s,h),""),s=h+u.length,i(r.slice(h,s),"completion-highlight")}return i(r.slice(s,r.length),""),t.meta&&o.push({type:"completion-meta",value:t.meta}),o},f.$updateOnChange=d,f.start=d,c.session.$computeWidth=function(){return this.screenWidth=0},c.isOpen=!1,c.isTopdown=!1,c.autoSelect=!0,c.filterText="",c.data=[],c.setData=function(e,t){c.filterText=t||"",c.setValue(i.stringRepeat("\n",e.length),-1),c.data=e||[],c.setRow(0)},c.getData=function(e){return c.data[e]},c.getRow=function(){return h.start.row},c.setRow=function(e){e=Math.max(this.autoSelect?0:-1,Math.min(this.data.length,e)),h.start.row!=e&&(c.selection.clearSelection(),h.start.row=h.end.row=e||0,c.session._emit("changeBackMarker"),c.moveCursorTo(e||0,0),c.isOpen&&c._signal("select"))},c.on("changeSelection",function(){c.isOpen&&c.setRow(c.selection.lead.row),c.renderer.scrollCursorIntoView()}),c.hide=function(){this.container.style.display="none",this._signal("hide"),c.isOpen=!1},c.show=function(e,t,o){var r=this.container,i=window.innerHeight,n=window.innerWidth,a=this.renderer,s=a.$maxLines*t*1.4,d=e.top+this.$borderSize;d>i/2&&!o&&d+t+s>i?(a.$maxPixelHeight=d-2*this.$borderSize,r.style.top="",r.style.bottom=i-d+"px",c.isTopdown=!1):(d+=t,a.$maxPixelHeight=i-d-.2*t,r.style.top=d+"px",r.style.bottom="",c.isTopdown=!0),r.style.display="";var u=e.left;u+r.offsetWidth>n&&(u=n-r.offsetWidth),r.style.left=u+"px",this._signal("show"),l=null,c.isOpen=!0},c.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},c.$imageSize=0,c.$borderSize=1,c}});
//# sourceMappingURL=../sourcemaps/autocomplete/popup.js.map
