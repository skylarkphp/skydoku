{"version":3,"sources":["token_iterator.js"],"names":["define","require","exports","module","Range","TokenIterator","session","initialRow","initialColumn","this","$session","$row","$rowTokens","getTokens","token","getTokenAt","$tokenIndex","index","stepBackward","length","stepForward","rowCount","getLength","getCurrentToken","getCurrentTokenRow","getCurrentTokenColumn","rowTokens","tokenIndex","column","start","undefined","value","getCurrentTokenPosition","row","getCurrentTokenRange","call","prototype"],"mappings":";;;;;;;AA8BAA,OAAO,SAASC,QAASC,QAASC,QAClC,aAEA,IAAIC,EAAQH,QAAQ,WAAWG,MAiB3BC,EAAgB,SAASC,EAASC,EAAYC,GAC9CC,KAAKC,SAAWJ,EAChBG,KAAKE,KAAOJ,EACZE,KAAKG,WAAaN,EAAQO,UAAUN,GAEpC,IAAIO,EAAQR,EAAQS,WAAWR,EAAYC,GAC3CC,KAAKO,YAAcF,EAAQA,EAAMG,OAAS,IAG9C,WAMIR,KAAKS,aAAe,WAGhB,IAFAT,KAAKO,aAAe,EAEbP,KAAKO,YAAc,GAAG,CAEzB,GADAP,KAAKE,MAAQ,EACTF,KAAKE,KAAO,EAEZ,OADAF,KAAKE,KAAO,EACL,KAGXF,KAAKG,WAAaH,KAAKC,SAASG,UAAUJ,KAAKE,MAC/CF,KAAKO,YAAcP,KAAKG,WAAWO,OAAS,EAGhD,OAAOV,KAAKG,WAAWH,KAAKO,cAOhCP,KAAKW,YAAc,WAEf,IAAIC,EACJ,IAFAZ,KAAKO,aAAe,EAEbP,KAAKO,aAAeP,KAAKG,WAAWO,QAAQ,CAI/C,GAHAV,KAAKE,MAAQ,EACRU,IACDA,EAAWZ,KAAKC,SAASY,aACzBb,KAAKE,MAAQU,EAEb,OADAZ,KAAKE,KAAOU,EAAW,EAChB,KAGXZ,KAAKG,WAAaH,KAAKC,SAASG,UAAUJ,KAAKE,MAC/CF,KAAKO,YAAc,EAGvB,OAAOP,KAAKG,WAAWH,KAAKO,cAQhCP,KAAKc,gBAAkB,WACnB,OAAOd,KAAKG,WAAWH,KAAKO,cAQhCP,KAAKe,mBAAqB,WACtB,OAAOf,KAAKE,MAQhBF,KAAKgB,sBAAwB,WACzB,IAAIC,EAAYjB,KAAKG,WACjBe,EAAalB,KAAKO,YAGlBY,EAASF,EAAUC,GAAYE,MACnC,QAAeC,IAAXF,EACA,OAAOA,EAGX,IADAA,EAAS,EACFD,EAAa,GAEhBC,GAAUF,EADVC,GAAc,GACkBI,MAAMZ,OAG1C,OAAOS,GAOXnB,KAAKuB,wBAA0B,WAC3B,OAAQC,IAAKxB,KAAKE,KAAMiB,OAAQnB,KAAKgB,0BAOzChB,KAAKyB,qBAAuB,WACxB,IAAIpB,EAAQL,KAAKG,WAAWH,KAAKO,aAC7BY,EAASnB,KAAKgB,wBAClB,OAAO,IAAIrB,EAAMK,KAAKE,KAAMiB,EAAQnB,KAAKE,KAAMiB,EAASd,EAAMiB,MAAMZ,WAGzEgB,KAAK9B,EAAc+B,WAEtBlC,QAAQG,cAAgBA","file":"../token_iterator.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n * \r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n * \r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar Range = require(\"./range\").Range;\r\n\r\n/**\r\n * \r\n *\r\n * This class provides an essay way to treat the document as a stream of tokens, and provides methods to iterate over these tokens.\r\n * @class TokenIterator\r\n **/\r\n\r\n/**\r\n * Creates a new token iterator object. The inital token index is set to the provided row and column coordinates.\r\n * @param {EditSession} session The session to associate with\r\n * @param {Number} initialRow The row to start the tokenizing at\r\n * @param {Number} initialColumn The column to start the tokenizing at\r\n *\r\n * @constructor\r\n **/\r\nvar TokenIterator = function(session, initialRow, initialColumn) {\r\n    this.$session = session;\r\n    this.$row = initialRow;\r\n    this.$rowTokens = session.getTokens(initialRow);\r\n\r\n    var token = session.getTokenAt(initialRow, initialColumn);\r\n    this.$tokenIndex = token ? token.index : -1;\r\n};\r\n\r\n(function() {\r\n   \r\n    /**\r\n     * Tokenizes all the items from the current point to the row prior in the document. \r\n     * @returns {[String]} If the current point is not at the top of the file, this function returns `null`. Otherwise, it returns an array of the tokenized strings.\r\n     **/ \r\n    this.stepBackward = function() {\r\n        this.$tokenIndex -= 1;\r\n        \r\n        while (this.$tokenIndex < 0) {\r\n            this.$row -= 1;\r\n            if (this.$row < 0) {\r\n                this.$row = 0;\r\n                return null;\r\n            }\r\n                \r\n            this.$rowTokens = this.$session.getTokens(this.$row);\r\n            this.$tokenIndex = this.$rowTokens.length - 1;\r\n        }\r\n            \r\n        return this.$rowTokens[this.$tokenIndex];\r\n    };\r\n  \r\n    /**\r\n     * Tokenizes all the items from the current point until the next row in the document. If the current point is at the end of the file, this function returns `null`. Otherwise, it returns the tokenized string.\r\n     * @returns {String}\r\n     **/   \r\n    this.stepForward = function() {\r\n        this.$tokenIndex += 1;\r\n        var rowCount;\r\n        while (this.$tokenIndex >= this.$rowTokens.length) {\r\n            this.$row += 1;\r\n            if (!rowCount)\r\n                rowCount = this.$session.getLength();\r\n            if (this.$row >= rowCount) {\r\n                this.$row = rowCount - 1;\r\n                return null;\r\n            }\r\n\r\n            this.$rowTokens = this.$session.getTokens(this.$row);\r\n            this.$tokenIndex = 0;\r\n        }\r\n            \r\n        return this.$rowTokens[this.$tokenIndex];\r\n    };\r\n \r\n    /**\r\n     * \r\n     * Returns the current tokenized string.\r\n     * @returns {String}\r\n     **/      \r\n    this.getCurrentToken = function () {\r\n        return this.$rowTokens[this.$tokenIndex];\r\n    };\r\n\r\n    /**\r\n     * \r\n     * Returns the current row.\r\n     * @returns {Number}\r\n     **/      \r\n    this.getCurrentTokenRow = function () {\r\n        return this.$row;\r\n    };\r\n\r\n    /**\r\n     * \r\n     * Returns the current column.\r\n     * @returns {Number}\r\n     **/     \r\n    this.getCurrentTokenColumn = function() {\r\n        var rowTokens = this.$rowTokens;\r\n        var tokenIndex = this.$tokenIndex;\r\n        \r\n        // If a column was cached by EditSession.getTokenAt, then use it\r\n        var column = rowTokens[tokenIndex].start;\r\n        if (column !== undefined)\r\n            return column;\r\n            \r\n        column = 0;\r\n        while (tokenIndex > 0) {\r\n            tokenIndex -= 1;\r\n            column += rowTokens[tokenIndex].value.length;\r\n        }\r\n        \r\n        return column;  \r\n    };\r\n\r\n    /**\r\n     * Return the current token position.\r\n     * @returns {Position}\r\n     */\r\n    this.getCurrentTokenPosition = function() {\r\n        return {row: this.$row, column: this.getCurrentTokenColumn()};\r\n    };\r\n    \r\n    /**\r\n     * Return the current token range.\r\n     * @returns {Range}\r\n     */\r\n    this.getCurrentTokenRange = function() {\r\n        var token = this.$rowTokens[this.$tokenIndex];\r\n        var column = this.getCurrentTokenColumn();\r\n        return new Range(this.$row, column, this.$row, column + token.value.length);\r\n    };\r\n    \r\n}).call(TokenIterator.prototype);\r\n\r\nexports.TokenIterator = TokenIterator;\r\n});\r\n"]}