{"version":3,"sources":["ext/static_highlight.js"],"names":["define","require","exports","module","EditSession","TextLayer","Text","baseStyles","config","dom","escapeHTML","Element","type","this","style","textContent","prototype","cloneNode","appendChild","child","toString","stringBuilder","push","className","styleStr","key","length","join","simpleDom","createTextNode","element","createElement","createFragment","SimpleTextLayer","highlight","el","opts","callback","m","match","mode","theme","data","nodes","firstElementChild","textLen","i","childNodes","ch","nodeType","trim","render","firstLineNumber","showGutter","highlighted","importCssString","css","innerHTML","html","container","firstChild","pos","session","doc","indexToPosition","node","lineEl","children","row","input","lineStart","disableGutter","modeOptions","waiting","modeCache","$modes","done","result","renderSync","loadModule","getTokenizer","path","Mode","parseInt","setUseWorker","setMode","textLayer","setSession","Object","keys","$tabStrings","forEach","k","setValue","getLength","outerEl","cssClass","innerEl","ix","gutterEl","$renderLine","cssText"],"mappings":"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","file":"../../ext/static_highlight.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar EditSession = require(\"../edit_session\").EditSession;\r\nvar TextLayer = require(\"../layer/text\").Text;\r\nvar baseStyles = require(\"../requirejs/text!./static.css\");\r\nvar config = require(\"../config\");\r\nvar dom = require(\"../lib/dom\");\r\nvar escapeHTML = require(\"../lib/lang\").escapeHTML;\r\n\r\nfunction Element(type) {\r\n    this.type = type;\r\n    this.style = {};\r\n    this.textContent = \"\";\r\n}\r\nElement.prototype.cloneNode = function() {\r\n    return this;\r\n};\r\nElement.prototype.appendChild = function(child) {\r\n    this.textContent += child.toString();\r\n};\r\nElement.prototype.toString = function() {\r\n    var stringBuilder = [];\r\n    if (this.type != \"fragment\") {\r\n        stringBuilder.push(\"<\", this.type);\r\n        if (this.className)\r\n            stringBuilder.push(\" class='\", this.className, \"'\");\r\n        var styleStr = [];\r\n        for (var key in this.style) {\r\n            styleStr.push(key, \":\", this.style[key]);\r\n        }\r\n        if (styleStr.length)\r\n            stringBuilder.push(\" style='\", styleStr.join(\"\"), \"'\");\r\n        stringBuilder.push(\">\");\r\n    }\r\n\r\n    if (this.textContent) {\r\n        stringBuilder.push(this.textContent);\r\n    }\r\n\r\n    if (this.type != \"fragment\") {\r\n        stringBuilder.push(\"</\", this.type, \">\");\r\n    }\r\n    \r\n    return stringBuilder.join(\"\");\r\n};\r\n\r\n\r\nvar simpleDom = {\r\n    createTextNode: function(textContent, element) {\r\n        return escapeHTML(textContent);\r\n    },\r\n    createElement: function(type) {\r\n        return new Element(type);\r\n    },\r\n    createFragment: function() {\r\n        return new Element(\"fragment\");\r\n    }\r\n};\r\n\r\nvar SimpleTextLayer = function() {\r\n    this.config = {};\r\n    this.dom = simpleDom;\r\n};\r\nSimpleTextLayer.prototype = TextLayer.prototype;\r\n\r\nvar highlight = function(el, opts, callback) {\r\n    var m = el.className.match(/lang-(\\w+)/);\r\n    var mode = opts.mode || m && (\"ace/mode/\" + m[1]);\r\n    if (!mode)\r\n        return false;\r\n    var theme = opts.theme || \"ace/theme/textmate\";\r\n    \r\n    var data = \"\";\r\n    var nodes = [];\r\n\r\n    if (el.firstElementChild) {\r\n        var textLen = 0;\r\n        for (var i = 0; i < el.childNodes.length; i++) {\r\n            var ch = el.childNodes[i];\r\n            if (ch.nodeType == 3) {\r\n                textLen += ch.data.length;\r\n                data += ch.data;\r\n            } else {\r\n                nodes.push(textLen, ch);\r\n            }\r\n        }\r\n    } else {\r\n        data = el.textContent;\r\n        if (opts.trim)\r\n            data = data.trim();\r\n    }\r\n    \r\n    highlight.render(data, mode, theme, opts.firstLineNumber, !opts.showGutter, function (highlighted) {\r\n        dom.importCssString(highlighted.css, \"ace_highlight\");\r\n        el.innerHTML = highlighted.html;\r\n        var container = el.firstChild.firstChild;\r\n        for (var i = 0; i < nodes.length; i += 2) {\r\n            var pos = highlighted.session.doc.indexToPosition(nodes[i]);\r\n            var node = nodes[i + 1];\r\n            var lineEl = container.children[pos.row];\r\n            lineEl && lineEl.appendChild(node);\r\n        }\r\n        callback && callback();\r\n    });\r\n};\r\n\r\n/**\r\n * Transforms a given input code snippet into HTML using the given mode\r\n *\r\n * @param {string} input Code snippet\r\n * @param {string|mode} mode String specifying the mode to load such as\r\n *  `ace/mode/javascript` or, a mode loaded from `/ace/mode`\r\n *  (use 'ServerSideHiglighter.getMode').\r\n * @param {string|theme} theme String specifying the theme to load such as\r\n *  `ace/theme/twilight` or, a theme loaded from `/ace/theme`.\r\n * @param {number} lineStart A number indicating the first line number. Defaults\r\n *  to 1.\r\n * @param {boolean} disableGutter Specifies whether or not to disable the gutter.\r\n *  `true` disables the gutter, `false` enables the gutter. Defaults to `false`.\r\n * @param {function} callback When specifying the mode or theme as a string,\r\n *  this method has no return value and you must specify a callback function. The\r\n *  callback will receive the rendered object containing the properties `html`\r\n *  and `css`.\r\n * @returns {object} An object containing the properties `html` and `css`.\r\n */\r\nhighlight.render = function(input, mode, theme, lineStart, disableGutter, callback) {\r\n    var waiting = 1;\r\n    var modeCache = EditSession.prototype.$modes;\r\n\r\n    // if either the theme or the mode were specified as objects\r\n    // then we need to lazily load them.\r\n    if (typeof theme == \"string\") {\r\n        waiting++;\r\n        config.loadModule(['theme', theme], function(m) {\r\n            theme = m;\r\n            --waiting || done();\r\n        });\r\n    }\r\n    // allow setting mode options e.h {path: \"ace/mode/php\", inline:true}\r\n    var modeOptions;\r\n    if (mode && typeof mode === \"object\" && !mode.getTokenizer) {\r\n        modeOptions = mode;\r\n        mode = modeOptions.path;\r\n    }\r\n    if (typeof mode == \"string\") {\r\n        waiting++;\r\n        config.loadModule(['mode', mode], function(m) {\r\n            if (!modeCache[mode] || modeOptions)\r\n                modeCache[mode] = new m.Mode(modeOptions);\r\n            mode = modeCache[mode];\r\n            --waiting || done();\r\n        });\r\n    }\r\n\r\n    // loads or passes the specified mode module then calls renderer\r\n    function done() {\r\n        var result = highlight.renderSync(input, mode, theme, lineStart, disableGutter);\r\n        return callback ? callback(result) : result;\r\n    }\r\n    return --waiting || done();\r\n};\r\n\r\n/**\r\n * Transforms a given input code snippet into HTML using the given mode\r\n * @param {string} input Code snippet\r\n * @param {mode} mode Mode loaded from /ace/mode (use 'ServerSideHiglighter.getMode')\r\n * @param {string} r Code snippet\r\n * @returns {object} An object containing: html, css\r\n */\r\nhighlight.renderSync = function(input, mode, theme, lineStart, disableGutter) {\r\n    lineStart = parseInt(lineStart || 1, 10);\r\n\r\n    var session = new EditSession(\"\");\r\n    session.setUseWorker(false);\r\n    session.setMode(mode);\r\n\r\n    var textLayer = new SimpleTextLayer();\r\n    textLayer.setSession(session);\r\n    Object.keys(textLayer.$tabStrings).forEach(function(k) {\r\n        if (typeof textLayer.$tabStrings[k] == \"string\") {\r\n            var el = simpleDom.createFragment();\r\n            el.textContent = textLayer.$tabStrings[k];\r\n            textLayer.$tabStrings[k] = el;\r\n        }\r\n    });\r\n\r\n    session.setValue(input);\r\n    var length =  session.getLength();\r\n    \r\n    var outerEl = simpleDom.createElement(\"div\");\r\n    outerEl.className = theme.cssClass;\r\n    \r\n    var innerEl = simpleDom.createElement(\"div\");\r\n    innerEl.className = \"ace_static_highlight\" + (disableGutter ? \"\" : \" ace_show_gutter\");\r\n    innerEl.style[\"counter-reset\"] = \"ace_line \" + (lineStart - 1);\r\n\r\n    for (var ix = 0; ix < length; ix++) {\r\n        var lineEl = simpleDom.createElement(\"div\");\r\n        lineEl.className = \"ace_line\";\r\n        \r\n        if (!disableGutter) {\r\n            var gutterEl = simpleDom.createElement(\"span\");\r\n            gutterEl.className =\"ace_gutter ace_gutter-cell\";\r\n            gutterEl.textContent = \"\"; /*(ix + lineStart) + */\r\n            lineEl.appendChild(gutterEl);\r\n        }\r\n        textLayer.$renderLine(lineEl, ix, false);\r\n        lineEl.textContent += \"\\n\";\r\n        innerEl.appendChild(lineEl);\r\n    }\r\n\r\n    //console.log(JSON.stringify(outerEl, null, 2));\r\n    //console.log(outerEl.toString());\r\n    outerEl.appendChild(innerEl);\r\n\r\n    return {\r\n        css: baseStyles + theme.cssText,\r\n        html: outerEl.toString(),\r\n        session: session\r\n    };\r\n};\r\n\r\nmodule.exports = highlight;\r\nmodule.exports.highlight = highlight;\r\n});\r\n"]}