{"version":3,"sources":["ext/searchbox.js"],"names":["define","require","exports","module","dom","lang","event","searchboxCss","HashHandler","keyUtil","importCssString","SearchBox","editor","range","showReplaceForm","div","createElement","buildDom","class","action","placeholder","spellcheck","title","style","this","element","firstChild","setSession","bind","$init","setEditor","container","searchBox","renderer","scroller","appendChild","e","searchRange","$syncOptions","$initElements","sb","querySelector","replaceBox","searchOption","replaceOption","regExpOption","caseSensitiveOption","wholeWordOption","searchInput","replaceInput","searchCounter","_this","addListener","setTimeout","activeInput","focus","stopPropagation","target","srcElement","getAttribute","$searchBarKb","commands","exec","addCommandKeyListener","hashId","keyCode","keyString","keyCodeToString","command","findKeyCommand","stopEvent","$onChange","delayedCall","find","schedule","value","highlight","$closeSearchBarKb","bindKey","name","hide","bindKeys","Ctrl-f|Command-f","isReplace","display","checked","Ctrl-H|Command-Option-F","getReadOnly","Ctrl-G|Command-G","findNext","Ctrl-Shift-G|Command-Shift-G","findPrev","esc","Return","replace","Shift-Return","Alt-Return","replaceAll","findAll","Tab","addCommands","win","mac","setSearchRange","getSelectionRange","searchRangeMarker","session","addMarker","removeMarker","preventScroll","setCssClass","textContent","readOnly","re","$search","$options","updateBackMarkers","skipCurrent","backwards","noMatch","wrap","regExp","caseSensitive","wholeWord","_emit","match","updateCounter","regex","all","before","getTextRange","getValue","offset","doc","positionToIndex","selection","anchor","start","m","last","lastIndex","index","length","MAX_COUNT","replaceAndFindNext","active","off","keyBinding","removeKeyboardHandler","show","on","select","addKeyboardHandler","isFocused","el","document","activeElement","call","prototype","Search"],"mappings":"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","file":"../../ext/searchbox.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar dom = require(\"../lib/dom\");\r\nvar lang = require(\"../lib/lang\");\r\nvar event = require(\"../lib/event\");\r\nvar searchboxCss = require(\"../requirejs/text!./searchbox.css\");\r\nvar HashHandler = require(\"../keyboard/hash_handler\").HashHandler;\r\nvar keyUtil = require(\"../lib/keys\");\r\n\r\nvar MAX_COUNT = 999;\r\n\r\ndom.importCssString(searchboxCss, \"ace_searchbox\");\r\n\r\nvar SearchBox = function(editor, range, showReplaceForm) {\r\n    var div = dom.createElement(\"div\");\r\n    dom.buildDom([\"div\", {class:\"ace_search right\"},\r\n        [\"span\", {action: \"hide\", class: \"ace_searchbtn_close\"}],\r\n        [\"div\", {class: \"ace_search_form\"},\r\n            [\"input\", {class: \"ace_search_field\", placeholder: \"Search for\", spellcheck: \"false\"}],\r\n            [\"span\", {action: \"findPrev\", class: \"ace_searchbtn prev\"}, \"\\u200b\"],\r\n            [\"span\", {action: \"findNext\", class: \"ace_searchbtn next\"}, \"\\u200b\"],\r\n            [\"span\", {action: \"findAll\", class: \"ace_searchbtn\", title: \"Alt-Enter\"}, \"All\"]\r\n        ],\r\n        [\"div\", {class: \"ace_replace_form\"},\r\n            [\"input\", {class: \"ace_search_field\", placeholder: \"Replace with\", spellcheck: \"false\"}],\r\n            [\"span\", {action: \"replaceAndFindNext\", class: \"ace_searchbtn\"}, \"Replace\"],\r\n            [\"span\", {action: \"replaceAll\", class: \"ace_searchbtn\"}, \"All\"]\r\n        ],\r\n        [\"div\", {class: \"ace_search_options\"},\r\n            [\"span\", {action: \"toggleReplace\", class: \"ace_button\", title: \"Toggle Replace mode\",\r\n                style: \"float:left;margin-top:-2px;padding:0 5px;\"}, \"+\"],\r\n            [\"span\", {class: \"ace_search_counter\"}],\r\n            [\"span\", {action: \"toggleRegexpMode\", class: \"ace_button\", title: \"RegExp Search\"}, \".*\"],\r\n            [\"span\", {action: \"toggleCaseSensitive\", class: \"ace_button\", title: \"CaseSensitive Search\"}, \"Aa\"],\r\n            [\"span\", {action: \"toggleWholeWords\", class: \"ace_button\", title: \"Whole Word Search\"}, \"\\\\b\"],\r\n            [\"span\", {action: \"searchInSelection\", class: \"ace_button\", title: \"Search In Selection\"}, \"S\"]\r\n        ]\r\n    ], div);\r\n    this.element = div.firstChild;\r\n    \r\n    this.setSession = this.setSession.bind(this);\r\n\r\n    this.$init();\r\n    this.setEditor(editor);\r\n    dom.importCssString(searchboxCss, \"ace_searchbox\", editor.container);\r\n};\r\n\r\n(function() {\r\n    this.setEditor = function(editor) {\r\n        editor.searchBox = this;\r\n        editor.renderer.scroller.appendChild(this.element);\r\n        this.editor = editor;\r\n    };\r\n    \r\n    this.setSession = function(e) {\r\n        this.searchRange = null;\r\n        this.$syncOptions(true);\r\n    };\r\n\r\n    this.$initElements = function(sb) {\r\n        this.searchBox = sb.querySelector(\".ace_search_form\");\r\n        this.replaceBox = sb.querySelector(\".ace_replace_form\");\r\n        this.searchOption = sb.querySelector(\"[action=searchInSelection]\");\r\n        this.replaceOption = sb.querySelector(\"[action=toggleReplace]\");\r\n        this.regExpOption = sb.querySelector(\"[action=toggleRegexpMode]\");\r\n        this.caseSensitiveOption = sb.querySelector(\"[action=toggleCaseSensitive]\");\r\n        this.wholeWordOption = sb.querySelector(\"[action=toggleWholeWords]\");\r\n        this.searchInput = this.searchBox.querySelector(\".ace_search_field\");\r\n        this.replaceInput = this.replaceBox.querySelector(\".ace_search_field\");\r\n        this.searchCounter = sb.querySelector(\".ace_search_counter\");\r\n    };\r\n    \r\n    this.$init = function() {\r\n        var sb = this.element;\r\n        \r\n        this.$initElements(sb);\r\n        \r\n        var _this = this;\r\n        event.addListener(sb, \"mousedown\", function(e) {\r\n            setTimeout(function(){\r\n                _this.activeInput.focus();\r\n            }, 0);\r\n            event.stopPropagation(e);\r\n        });\r\n        event.addListener(sb, \"click\", function(e) {\r\n            var t = e.target || e.srcElement;\r\n            var action = t.getAttribute(\"action\");\r\n            if (action && _this[action])\r\n                _this[action]();\r\n            else if (_this.$searchBarKb.commands[action])\r\n                _this.$searchBarKb.commands[action].exec(_this);\r\n            event.stopPropagation(e);\r\n        });\r\n\r\n        event.addCommandKeyListener(sb, function(e, hashId, keyCode) {\r\n            var keyString = keyUtil.keyCodeToString(keyCode);\r\n            var command = _this.$searchBarKb.findKeyCommand(hashId, keyString);\r\n            if (command && command.exec) {\r\n                command.exec(_this);\r\n                event.stopEvent(e);\r\n            }\r\n        });\r\n\r\n        this.$onChange = lang.delayedCall(function() {\r\n            _this.find(false, false);\r\n        });\r\n\r\n        event.addListener(this.searchInput, \"input\", function() {\r\n            _this.$onChange.schedule(20);\r\n        });\r\n        event.addListener(this.searchInput, \"focus\", function() {\r\n            _this.activeInput = _this.searchInput;\r\n            _this.searchInput.value && _this.highlight();\r\n        });\r\n        event.addListener(this.replaceInput, \"focus\", function() {\r\n            _this.activeInput = _this.replaceInput;\r\n            _this.searchInput.value && _this.highlight();\r\n        });\r\n    };\r\n\r\n    //keybinding outside of the searchbox\r\n    this.$closeSearchBarKb = new HashHandler([{\r\n        bindKey: \"Esc\",\r\n        name: \"closeSearchBar\",\r\n        exec: function(editor) {\r\n            editor.searchBox.hide();\r\n        }\r\n    }]);\r\n\r\n    //keybinding outside of the searchbox\r\n    this.$searchBarKb = new HashHandler();\r\n    this.$searchBarKb.bindKeys({\r\n        \"Ctrl-f|Command-f\": function(sb) {\r\n            var isReplace = sb.isReplace = !sb.isReplace;\r\n            sb.replaceBox.style.display = isReplace ? \"\" : \"none\";\r\n            sb.replaceOption.checked = false;\r\n            sb.$syncOptions();\r\n            sb.searchInput.focus();\r\n        },\r\n        \"Ctrl-H|Command-Option-F\": function(sb) {\r\n            if (sb.editor.getReadOnly())\r\n                return;\r\n            sb.replaceOption.checked = true;\r\n            sb.$syncOptions();\r\n            sb.replaceInput.focus();\r\n        },\r\n        \"Ctrl-G|Command-G\": function(sb) {\r\n            sb.findNext();\r\n        },\r\n        \"Ctrl-Shift-G|Command-Shift-G\": function(sb) {\r\n            sb.findPrev();\r\n        },\r\n        \"esc\": function(sb) {\r\n            setTimeout(function() { sb.hide();});\r\n        },\r\n        \"Return\": function(sb) {\r\n            if (sb.activeInput == sb.replaceInput)\r\n                sb.replace();\r\n            sb.findNext();\r\n        },\r\n        \"Shift-Return\": function(sb) {\r\n            if (sb.activeInput == sb.replaceInput)\r\n                sb.replace();\r\n            sb.findPrev();\r\n        },\r\n        \"Alt-Return\": function(sb) {\r\n            if (sb.activeInput == sb.replaceInput)\r\n                sb.replaceAll();\r\n            sb.findAll();\r\n        },\r\n        \"Tab\": function(sb) {\r\n            (sb.activeInput == sb.replaceInput ? sb.searchInput : sb.replaceInput).focus();\r\n        }\r\n    });\r\n\r\n    this.$searchBarKb.addCommands([{\r\n        name: \"toggleRegexpMode\",\r\n        bindKey: {win: \"Alt-R|Alt-/\", mac: \"Ctrl-Alt-R|Ctrl-Alt-/\"},\r\n        exec: function(sb) {\r\n            sb.regExpOption.checked = !sb.regExpOption.checked;\r\n            sb.$syncOptions();\r\n        }\r\n    }, {\r\n        name: \"toggleCaseSensitive\",\r\n        bindKey: {win: \"Alt-C|Alt-I\", mac: \"Ctrl-Alt-R|Ctrl-Alt-I\"},\r\n        exec: function(sb) {\r\n            sb.caseSensitiveOption.checked = !sb.caseSensitiveOption.checked;\r\n            sb.$syncOptions();\r\n        }\r\n    }, {\r\n        name: \"toggleWholeWords\",\r\n        bindKey: {win: \"Alt-B|Alt-W\", mac: \"Ctrl-Alt-B|Ctrl-Alt-W\"},\r\n        exec: function(sb) {\r\n            sb.wholeWordOption.checked = !sb.wholeWordOption.checked;\r\n            sb.$syncOptions();\r\n        }\r\n    }, {\r\n        name: \"toggleReplace\",\r\n        exec: function(sb) {\r\n            sb.replaceOption.checked = !sb.replaceOption.checked;\r\n            sb.$syncOptions();\r\n        }\r\n    }, {\r\n        name: \"searchInSelection\",\r\n        exec: function(sb) {\r\n            sb.searchOption.checked = !sb.searchRange;\r\n            sb.setSearchRange(sb.searchOption.checked && sb.editor.getSelectionRange());\r\n            sb.$syncOptions();\r\n        }\r\n    }]);\r\n    \r\n    this.setSearchRange = function(range) {\r\n        this.searchRange = range;\r\n        if (range) {\r\n            this.searchRangeMarker = this.editor.session.addMarker(range, \"ace_active-line\");\r\n        } else if (this.searchRangeMarker) {\r\n            this.editor.session.removeMarker(this.searchRangeMarker);\r\n            this.searchRangeMarker = null;\r\n        }\r\n    };\r\n\r\n    this.$syncOptions = function(preventScroll) {\r\n        dom.setCssClass(this.replaceOption, \"checked\", this.searchRange);\r\n        dom.setCssClass(this.searchOption, \"checked\", this.searchOption.checked);\r\n        this.replaceOption.textContent = this.replaceOption.checked ? \"-\" : \"+\";\r\n        dom.setCssClass(this.regExpOption, \"checked\", this.regExpOption.checked);\r\n        dom.setCssClass(this.wholeWordOption, \"checked\", this.wholeWordOption.checked);\r\n        dom.setCssClass(this.caseSensitiveOption, \"checked\", this.caseSensitiveOption.checked);\r\n        var readOnly = this.editor.getReadOnly();\r\n        this.replaceOption.style.display = readOnly ? \"none\" : \"\";\r\n        this.replaceBox.style.display = this.replaceOption.checked && !readOnly ? \"\" : \"none\";\r\n        this.find(false, false, preventScroll);\r\n    };\r\n\r\n    this.highlight = function(re) {\r\n        this.editor.session.highlight(re || this.editor.$search.$options.re);\r\n        this.editor.renderer.updateBackMarkers();\r\n    };\r\n    this.find = function(skipCurrent, backwards, preventScroll) {\r\n        var range = this.editor.find(this.searchInput.value, {\r\n            skipCurrent: skipCurrent,\r\n            backwards: backwards,\r\n            wrap: true,\r\n            regExp: this.regExpOption.checked,\r\n            caseSensitive: this.caseSensitiveOption.checked,\r\n            wholeWord: this.wholeWordOption.checked,\r\n            preventScroll: preventScroll,\r\n            range: this.searchRange\r\n        });\r\n        var noMatch = !range && this.searchInput.value;\r\n        dom.setCssClass(this.searchBox, \"ace_nomatch\", noMatch);\r\n        this.editor._emit(\"findSearchBox\", { match: !noMatch });\r\n        this.highlight();\r\n        this.updateCounter();\r\n    };\r\n    this.updateCounter = function() {\r\n        var editor = this.editor;\r\n        var regex = editor.$search.$options.re;\r\n        var all = 0;\r\n        var before = 0;\r\n        if (regex) {\r\n            var value = this.searchRange\r\n                ? editor.session.getTextRange(this.searchRange)\r\n                : editor.getValue();\r\n            \r\n            var offset = editor.session.doc.positionToIndex(editor.selection.anchor);\r\n            if (this.searchRange)\r\n                offset -= editor.session.doc.positionToIndex(this.searchRange.start);\r\n                \r\n            var last = regex.lastIndex = 0;\r\n            var m;\r\n            while ((m = regex.exec(value))) {\r\n                all++;\r\n                last = m.index;\r\n                if (last <= offset)\r\n                    before++;\r\n                if (all > MAX_COUNT)\r\n                    break;\r\n                if (!m[0]) {\r\n                    regex.lastIndex = last += 1;\r\n                    if (last >= value.length)\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        this.searchCounter.textContent = before + \" of \" + (all > MAX_COUNT ? MAX_COUNT + \"+\" : all);\r\n    };\r\n    this.findNext = function() {\r\n        this.find(true, false);\r\n    };\r\n    this.findPrev = function() {\r\n        this.find(true, true);\r\n    };\r\n    this.findAll = function(){\r\n        var range = this.editor.findAll(this.searchInput.value, {            \r\n            regExp: this.regExpOption.checked,\r\n            caseSensitive: this.caseSensitiveOption.checked,\r\n            wholeWord: this.wholeWordOption.checked\r\n        });\r\n        var noMatch = !range && this.searchInput.value;\r\n        dom.setCssClass(this.searchBox, \"ace_nomatch\", noMatch);\r\n        this.editor._emit(\"findSearchBox\", { match: !noMatch });\r\n        this.highlight();\r\n        this.hide();\r\n    };\r\n    this.replace = function() {\r\n        if (!this.editor.getReadOnly())\r\n            this.editor.replace(this.replaceInput.value);\r\n    };    \r\n    this.replaceAndFindNext = function() {\r\n        if (!this.editor.getReadOnly()) {\r\n            this.editor.replace(this.replaceInput.value);\r\n            this.findNext();\r\n        }\r\n    };\r\n    this.replaceAll = function() {\r\n        if (!this.editor.getReadOnly())\r\n            this.editor.replaceAll(this.replaceInput.value);\r\n    };\r\n\r\n    this.hide = function() {\r\n        this.active = false;\r\n        this.setSearchRange(null);\r\n        this.editor.off(\"changeSession\", this.setSession);\r\n        \r\n        this.element.style.display = \"none\";\r\n        this.editor.keyBinding.removeKeyboardHandler(this.$closeSearchBarKb);\r\n        this.editor.focus();\r\n    };\r\n    this.show = function(value, isReplace) {\r\n        this.active = true;\r\n        this.editor.on(\"changeSession\", this.setSession);\r\n        this.element.style.display = \"\";\r\n        this.replaceOption.checked = isReplace;\r\n        \r\n        if (value)\r\n            this.searchInput.value = value;\r\n        \r\n        this.searchInput.focus();\r\n        this.searchInput.select();\r\n\r\n        this.editor.keyBinding.addKeyboardHandler(this.$closeSearchBarKb);\r\n        \r\n        this.$syncOptions(true);\r\n    };\r\n\r\n    this.isFocused = function() {\r\n        var el = document.activeElement;\r\n        return el == this.searchInput || el == this.replaceInput;\r\n    };\r\n}).call(SearchBox.prototype);\r\n\r\nexports.SearchBox = SearchBox;\r\n\r\nexports.Search = function(editor, isReplace) {\r\n    var sb = editor.searchBox || new SearchBox(editor);\r\n    sb.show(editor.session.getTextRange(), isReplace);\r\n};\r\n\r\n});\r\n\r\n\r\n/* ------------------------------------------------------------------------------------------\r\n * TODO\r\n * --------------------------------------------------------------------------------------- */\r\n/*\r\n- move search form to the left if it masks current word\r\n- include all options that search has. ex: regex\r\n- searchbox.searchbox is not that pretty. We should have just searchbox\r\n- disable prev button if it makes sense\r\n*/\r\n"]}