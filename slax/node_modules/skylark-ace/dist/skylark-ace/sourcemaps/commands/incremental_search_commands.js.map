{"version":3,"sources":["commands/incremental_search_commands.js"],"names":["define","require","exports","module","config","oop","HashHandler","occurStartCommand","IncrementalSearchKeyboardHandler","iSearch","this","$iSearch","iSearchStartCommands","name","bindKey","win","mac","exec","editor","options","loadModule","e","IncrementalSearch","activate","backwards","jumpToFirstMatch","next","readOnly","jumpToNext","execCommand","useCurrentOrPrevSearch","iSearchCommands","cancelSearch","string","addString","removeChar","deactivate","mixin","$options","$editor","ed","range","selection","getRangeOfMovements","sel","moveCursorWordRight","session","getTextRange","moveCursorRight","hl","$isearchHighlight","ranges","cache","reduce","ea","concat","forEach","addRange","bind","convertNeedleToRegExp","map","cmd","isIncrementalSearchCommand","scrollIntoView","inherits","attach","call","commands","platform","$commandExecHandler","addEventListener","command","stopPropagation","preventDefault","scrollTop","getScrollTop","result","args","renderer","scrollCursorIntoView","animateScrolling","detach","removeEventListener","handleKeyboard$super","handleKeyboard","data","hashId","key","keyCode","extendCmd","extendSearchTerm","prototype"],"mappings":"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","file":"../../commands/incremental_search_commands.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\r\nvar config = require(\"../config\");\r\nvar oop = require(\"../lib/oop\");\r\nvar HashHandler = require(\"../keyboard/hash_handler\").HashHandler;\r\nvar occurStartCommand = require(\"./occur_commands\").occurStartCommand;\r\n\r\n// These commands can be installed in a normal key handler to start iSearch:\r\nexports.iSearchStartCommands = [{\r\n    name: \"iSearch\",\r\n    bindKey: {win: \"Ctrl-F\", mac: \"Command-F\"},\r\n    exec: function(editor, options) {\r\n        config.loadModule([\"core\", \"ace/incremental_search\"], function(e) {\r\n            var iSearch = e.iSearch = e.iSearch || new e.IncrementalSearch();\r\n            iSearch.activate(editor, options.backwards);\r\n            if (options.jumpToFirstMatch) iSearch.next(options);\r\n        });\r\n    },\r\n    readOnly: true\r\n}, {\r\n    name: \"iSearchBackwards\",\r\n    exec: function(editor, jumpToNext) { editor.execCommand('iSearch', {backwards: true}); },\r\n    readOnly: true\r\n}, {\r\n    name: \"iSearchAndGo\",\r\n    bindKey: {win: \"Ctrl-K\", mac: \"Command-G\"},\r\n    exec: function(editor, jumpToNext) { editor.execCommand('iSearch', {jumpToFirstMatch: true, useCurrentOrPrevSearch: true}); },\r\n    readOnly: true\r\n}, {\r\n    name: \"iSearchBackwardsAndGo\",\r\n    bindKey: {win: \"Ctrl-Shift-K\", mac: \"Command-Shift-G\"},\r\n    exec: function(editor) { editor.execCommand('iSearch', {jumpToFirstMatch: true, backwards: true, useCurrentOrPrevSearch: true}); },\r\n    readOnly: true\r\n}];\r\n\r\n// These commands are only available when incremental search mode is active:\r\nexports.iSearchCommands = [{\r\n    name: \"restartSearch\",\r\n    bindKey: {win: \"Ctrl-F\", mac: \"Command-F\"},\r\n    exec: function(iSearch) {\r\n        iSearch.cancelSearch(true);\r\n    }\r\n}, {\r\n    name: \"searchForward\",\r\n    bindKey: {win: \"Ctrl-S|Ctrl-K\", mac: \"Ctrl-S|Command-G\"},\r\n    exec: function(iSearch, options) {\r\n        options.useCurrentOrPrevSearch = true;\r\n        iSearch.next(options);\r\n    }\r\n}, {\r\n    name: \"searchBackward\",\r\n    bindKey: {win: \"Ctrl-R|Ctrl-Shift-K\", mac: \"Ctrl-R|Command-Shift-G\"},\r\n    exec: function(iSearch, options) {\r\n        options.useCurrentOrPrevSearch = true;\r\n        options.backwards = true;\r\n        iSearch.next(options);\r\n    }\r\n}, {\r\n    name: \"extendSearchTerm\",\r\n    exec: function(iSearch, string) {\r\n        iSearch.addString(string);\r\n    }\r\n}, {\r\n    name: \"extendSearchTermSpace\",\r\n    bindKey: \"space\",\r\n    exec: function(iSearch) { iSearch.addString(' '); }\r\n}, {\r\n    name: \"shrinkSearchTerm\",\r\n    bindKey: \"backspace\",\r\n    exec: function(iSearch) {\r\n        iSearch.removeChar();\r\n    }\r\n}, {\r\n    name: 'confirmSearch',\r\n    bindKey: 'return',\r\n    exec: function(iSearch) { iSearch.deactivate(); }\r\n}, {\r\n    name: 'cancelSearch',\r\n    bindKey: 'esc|Ctrl-G',\r\n    exec: function(iSearch) { iSearch.deactivate(true); }\r\n}, {\r\n    name: 'occurisearch',\r\n    bindKey: 'Ctrl-O',\r\n    exec: function(iSearch) {\r\n        var options = oop.mixin({}, iSearch.$options);\r\n        iSearch.deactivate();\r\n        occurStartCommand.exec(iSearch.$editor, options);\r\n    }\r\n}, {\r\n    name: \"yankNextWord\",\r\n    bindKey: \"Ctrl-w\",\r\n    exec: function(iSearch) {\r\n        var ed = iSearch.$editor,\r\n            range = ed.selection.getRangeOfMovements(function(sel) { sel.moveCursorWordRight(); }),\r\n            string = ed.session.getTextRange(range);\r\n        iSearch.addString(string);\r\n    }\r\n}, {\r\n    name: \"yankNextChar\",\r\n    bindKey: \"Ctrl-Alt-y\",\r\n    exec: function(iSearch) {\r\n        var ed = iSearch.$editor,\r\n            range = ed.selection.getRangeOfMovements(function(sel) { sel.moveCursorRight(); }),\r\n            string = ed.session.getTextRange(range);\r\n        iSearch.addString(string);\r\n    }\r\n}, {\r\n    name: 'recenterTopBottom',\r\n    bindKey: 'Ctrl-l',\r\n    exec: function(iSearch) { iSearch.$editor.execCommand('recenterTopBottom'); }\r\n}, {\r\n    name: 'selectAllMatches',\r\n    bindKey: 'Ctrl-space',\r\n    exec: function(iSearch) {\r\n        var ed = iSearch.$editor,\r\n            hl = ed.session.$isearchHighlight,\r\n            ranges = hl && hl.cache ? hl.cache\r\n                .reduce(function(ranges, ea) {\r\n                    return ranges.concat(ea ? ea : []); }, []) : [];\r\n        iSearch.deactivate(false);\r\n        ranges.forEach(ed.selection.addRange.bind(ed.selection));\r\n    }\r\n}, {\r\n    name: 'searchAsRegExp',\r\n    bindKey: 'Alt-r',\r\n    exec: function(iSearch) {\r\n        iSearch.convertNeedleToRegExp();\r\n    }\r\n}].map(function(cmd) {\r\n    cmd.readOnly = true;\r\n    cmd.isIncrementalSearchCommand = true;\r\n    cmd.scrollIntoView = \"animate-cursor\";\r\n    return cmd;\r\n});\r\n\r\nfunction IncrementalSearchKeyboardHandler(iSearch) {\r\n    this.$iSearch = iSearch;\r\n}\r\n\r\noop.inherits(IncrementalSearchKeyboardHandler, HashHandler);\r\n\r\n(function() {\r\n\r\n    this.attach = function(editor) {\r\n        var iSearch = this.$iSearch;\r\n        HashHandler.call(this, exports.iSearchCommands, editor.commands.platform);\r\n        this.$commandExecHandler = editor.commands.addEventListener('exec', function(e) {\r\n            if (!e.command.isIncrementalSearchCommand)\r\n                return iSearch.deactivate();\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n            var scrollTop = editor.session.getScrollTop();\r\n            var result = e.command.exec(iSearch, e.args || {});\r\n            editor.renderer.scrollCursorIntoView(null, 0.5);\r\n            editor.renderer.animateScrolling(scrollTop);\r\n            return result;\r\n        });\r\n    };\r\n\r\n    this.detach = function(editor) {\r\n        if (!this.$commandExecHandler) return;\r\n        editor.commands.removeEventListener('exec', this.$commandExecHandler);\r\n        delete this.$commandExecHandler;\r\n    };\r\n\r\n    var handleKeyboard$super = this.handleKeyboard;\r\n    this.handleKeyboard = function(data, hashId, key, keyCode) {\r\n        if (((hashId === 1/*ctrl*/ || hashId === 8/*command*/) && key === 'v')\r\n         || (hashId === 1/*ctrl*/ && key === 'y')) return null;\r\n        var cmd = handleKeyboard$super.call(this, data, hashId, key, keyCode);\r\n        if (cmd.command) { return cmd; }\r\n        if (hashId == -1) {\r\n            var extendCmd = this.commands.extendSearchTerm;\r\n            if (extendCmd) { return {command: extendCmd, args: key}; }\r\n        }\r\n        return false;\r\n    };\r\n\r\n}).call(IncrementalSearchKeyboardHandler.prototype);\r\n\r\n\r\nexports.IncrementalSearchKeyboardHandler = IncrementalSearchKeyboardHandler;\r\n\r\n});\r\n"]}