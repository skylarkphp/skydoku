{"version":3,"sources":["autocomplete/popup.js"],"names":["define","require","exports","module","Renderer","VirtualRenderer","Editor","Range","event","lang","dom","importCssString","AcePopup","parentNode","el","createElement","popup","renderer","$maxLines","editor","setHighlightActiveLine","setShowPrintMargin","setShowGutter","setHighlightGutterLine","$mouseHandler","$focusTimeout","$highlightTagPending","appendChild","style","display","content","cursor","setStyle","setOption","lastMouseEvent","noop","focus","$isFocused","$cursorLayer","restartTimer","element","opacity","$keepTextAreaAtCursor","session","highlight","$searchHighlight","clazz","on","e","pos","getDocumentPosition","selection","moveToPosition","selectionMarker","start","row","end","stop","hoverMarker","Infinity","id","addMarker","setSelectOnHover","val","removeMarker","x","y","scrollTop","setRow","setHoverMarker","$pos","getRow","t","$textLayer","selected","childNodes","config","firstRow","selectedNode","removeCssClass","addCssClass","hideHoverMarker","suppressRedraw","_emit","getHoveredRow","addListener","container","doc","getLength","data","length","getLine","i","value","bgTokenizer","$tokenizeRow","tokens","caption","name","addToken","className","push","type","lower","toLowerCase","filterText","lastIndex","lastI","matchMask","sub","slice","index","indexOf","meta","$updateOnChange","$computeWidth","this","screenWidth","isOpen","isTopdown","autoSelect","setData","list","setValue","stringRepeat","getData","line","Math","max","min","clearSelection","moveCursorTo","_signal","lead","scrollCursorIntoView","hide","show","lineHeight","topdownOnly","screenHeight","window","innerHeight","innerWidth","maxH","top","$borderSize","$maxPixelHeight","bottom","left","offsetWidth","getTextLeftOffset","$padding","$imageSize"],"mappings":"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","file":"../../autocomplete/popup.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2012, Ajax.org B.V.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar Renderer = require(\"../virtual_renderer\").VirtualRenderer;\r\nvar Editor = require(\"../editor\").Editor;\r\nvar Range = require(\"../range\").Range;\r\nvar event = require(\"../lib/event\");\r\nvar lang = require(\"../lib/lang\");\r\nvar dom = require(\"../lib/dom\");\r\n\r\nvar $singleLineEditor = function(el) {\r\n    var renderer = new Renderer(el);\r\n\r\n    renderer.$maxLines = 4;\r\n\r\n    var editor = new Editor(renderer);\r\n\r\n    editor.setHighlightActiveLine(false);\r\n    editor.setShowPrintMargin(false);\r\n    editor.renderer.setShowGutter(false);\r\n    editor.renderer.setHighlightGutterLine(false);\r\n\r\n    editor.$mouseHandler.$focusTimeout = 0;\r\n    editor.$highlightTagPending = true;\r\n\r\n    return editor;\r\n};\r\n\r\nvar AcePopup = function(parentNode) {\r\n    var el = dom.createElement(\"div\");\r\n    var popup = new $singleLineEditor(el);\r\n\r\n    if (parentNode)\r\n        parentNode.appendChild(el);\r\n    el.style.display = \"none\";\r\n    popup.renderer.content.style.cursor = \"default\";\r\n    popup.renderer.setStyle(\"ace_autocomplete\");\r\n\r\n    popup.setOption(\"displayIndentGuides\", false);\r\n    popup.setOption(\"dragDelay\", 150);\r\n\r\n    var noop = function(){};\r\n\r\n    popup.focus = noop;\r\n    popup.$isFocused = true;\r\n\r\n    popup.renderer.$cursorLayer.restartTimer = noop;\r\n    popup.renderer.$cursorLayer.element.style.opacity = 0;\r\n\r\n    popup.renderer.$maxLines = 8;\r\n    popup.renderer.$keepTextAreaAtCursor = false;\r\n\r\n    popup.setHighlightActiveLine(false);\r\n    // set default highlight color\r\n    popup.session.highlight(\"\");\r\n    popup.session.$searchHighlight.clazz = \"ace_highlight-marker\";\r\n\r\n    popup.on(\"mousedown\", function(e) {\r\n        var pos = e.getDocumentPosition();\r\n        popup.selection.moveToPosition(pos);\r\n        selectionMarker.start.row = selectionMarker.end.row = pos.row;\r\n        e.stop();\r\n    });\r\n\r\n    var lastMouseEvent;\r\n    var hoverMarker = new Range(-1,0,-1,Infinity);\r\n    var selectionMarker = new Range(-1,0,-1,Infinity);\r\n    selectionMarker.id = popup.session.addMarker(selectionMarker, \"ace_active-line\", \"fullLine\");\r\n    popup.setSelectOnHover = function(val) {\r\n        if (!val) {\r\n            hoverMarker.id = popup.session.addMarker(hoverMarker, \"ace_line-hover\", \"fullLine\");\r\n        } else if (hoverMarker.id) {\r\n            popup.session.removeMarker(hoverMarker.id);\r\n            hoverMarker.id = null;\r\n        }\r\n    };\r\n    popup.setSelectOnHover(false);\r\n    popup.on(\"mousemove\", function(e) {\r\n        if (!lastMouseEvent) {\r\n            lastMouseEvent = e;\r\n            return;\r\n        }\r\n        if (lastMouseEvent.x == e.x && lastMouseEvent.y == e.y) {\r\n            return;\r\n        }\r\n        lastMouseEvent = e;\r\n        lastMouseEvent.scrollTop = popup.renderer.scrollTop;\r\n        var row = lastMouseEvent.getDocumentPosition().row;\r\n        if (hoverMarker.start.row != row) {\r\n            if (!hoverMarker.id)\r\n                popup.setRow(row);\r\n            setHoverMarker(row);\r\n        }\r\n    });\r\n    popup.renderer.on(\"beforeRender\", function() {\r\n        if (lastMouseEvent && hoverMarker.start.row != -1) {\r\n            lastMouseEvent.$pos = null;\r\n            var row = lastMouseEvent.getDocumentPosition().row;\r\n            if (!hoverMarker.id)\r\n                popup.setRow(row);\r\n            setHoverMarker(row, true);\r\n        }\r\n    });\r\n    popup.renderer.on(\"afterRender\", function() {\r\n        var row = popup.getRow();\r\n        var t = popup.renderer.$textLayer;\r\n        var selected = t.element.childNodes[row - t.config.firstRow];\r\n        if (selected !== t.selectedNode && t.selectedNode)\r\n            dom.removeCssClass(t.selectedNode, \"ace_selected\");\r\n        t.selectedNode = selected;\r\n        if (selected)\r\n            dom.addCssClass(selected, \"ace_selected\");\r\n    });\r\n    var hideHoverMarker = function() { setHoverMarker(-1); };\r\n    var setHoverMarker = function(row, suppressRedraw) {\r\n        if (row !== hoverMarker.start.row) {\r\n            hoverMarker.start.row = hoverMarker.end.row = row;\r\n            if (!suppressRedraw)\r\n                popup.session._emit(\"changeBackMarker\");\r\n            popup._emit(\"changeHoverMarker\");\r\n        }\r\n    };\r\n    popup.getHoveredRow = function() {\r\n        return hoverMarker.start.row;\r\n    };\r\n\r\n    event.addListener(popup.container, \"mouseout\", hideHoverMarker);\r\n    popup.on(\"hide\", hideHoverMarker);\r\n    popup.on(\"changeSelection\", hideHoverMarker);\r\n\r\n    popup.session.doc.getLength = function() {\r\n        return popup.data.length;\r\n    };\r\n    popup.session.doc.getLine = function(i) {\r\n        var data = popup.data[i];\r\n        if (typeof data == \"string\")\r\n            return data;\r\n        return (data && data.value) || \"\";\r\n    };\r\n\r\n    var bgTokenizer = popup.session.bgTokenizer;\r\n    bgTokenizer.$tokenizeRow = function(row) {\r\n        var data = popup.data[row];\r\n        var tokens = [];\r\n        if (!data)\r\n            return tokens;\r\n        if (typeof data == \"string\")\r\n            data = {value: data};\r\n        var caption = data.caption || data.value || data.name;\r\n\r\n        function addToken(value, className) {\r\n            value && tokens.push({\r\n                type: (data.className || \"\") + (className || \"\"), \r\n                value: value\r\n            });\r\n        }\r\n        \r\n        var lower = caption.toLowerCase();\r\n        var filterText = (popup.filterText || \"\").toLowerCase();\r\n        var lastIndex = 0;\r\n        var lastI = 0;\r\n        for (var i = 0; i <= filterText.length; i++) {\r\n            if (i != lastI && (data.matchMask & (1 << i) || i == filterText.length)) {\r\n                var sub = filterText.slice(lastI, i);\r\n                lastI = i;\r\n                var index = lower.indexOf(sub, lastIndex);\r\n                if (index == -1) continue;\r\n                addToken(caption.slice(lastIndex, index), \"\");\r\n                lastIndex = index + sub.length;\r\n                addToken(caption.slice(index, lastIndex), \"completion-highlight\");\r\n            }\r\n        }\r\n        addToken(caption.slice(lastIndex, caption.length), \"\");\r\n        \r\n        if (data.meta)\r\n            tokens.push({type: \"completion-meta\", value: data.meta});\r\n\r\n        return tokens;\r\n    };\r\n    bgTokenizer.$updateOnChange = noop;\r\n    bgTokenizer.start = noop;\r\n\r\n    popup.session.$computeWidth = function() {\r\n        return this.screenWidth = 0;\r\n    };\r\n\r\n    // public\r\n    popup.isOpen = false;\r\n    popup.isTopdown = false;\r\n    popup.autoSelect = true;\r\n    popup.filterText = \"\";\r\n\r\n    popup.data = [];\r\n    popup.setData = function(list, filterText) {\r\n        popup.filterText = filterText || \"\";\r\n        popup.setValue(lang.stringRepeat(\"\\n\", list.length), -1);\r\n        popup.data = list || [];\r\n        popup.setRow(0);\r\n    };\r\n    popup.getData = function(row) {\r\n        return popup.data[row];\r\n    };\r\n\r\n    popup.getRow = function() {\r\n        return selectionMarker.start.row;\r\n    };\r\n    popup.setRow = function(line) {\r\n        line = Math.max(this.autoSelect ? 0 : -1, Math.min(this.data.length, line));\r\n        if (selectionMarker.start.row != line) {\r\n            popup.selection.clearSelection();\r\n            selectionMarker.start.row = selectionMarker.end.row = line || 0;\r\n            popup.session._emit(\"changeBackMarker\");\r\n            popup.moveCursorTo(line || 0, 0);\r\n            if (popup.isOpen)\r\n                popup._signal(\"select\");\r\n        }\r\n    };\r\n\r\n    popup.on(\"changeSelection\", function() {\r\n        if (popup.isOpen)\r\n            popup.setRow(popup.selection.lead.row);\r\n        popup.renderer.scrollCursorIntoView();\r\n    });\r\n\r\n    popup.hide = function() {\r\n        this.container.style.display = \"none\";\r\n        this._signal(\"hide\");\r\n        popup.isOpen = false;\r\n    };\r\n    popup.show = function(pos, lineHeight, topdownOnly) {\r\n        var el = this.container;\r\n        var screenHeight = window.innerHeight;\r\n        var screenWidth = window.innerWidth;\r\n        var renderer = this.renderer;\r\n        // var maxLines = Math.min(renderer.$maxLines, this.session.getLength());\r\n        var maxH = renderer.$maxLines * lineHeight * 1.4;\r\n        var top = pos.top + this.$borderSize;\r\n        var allowTopdown = top > screenHeight / 2 && !topdownOnly;\r\n        if (allowTopdown && top + lineHeight + maxH > screenHeight) {\r\n            renderer.$maxPixelHeight = top - 2 * this.$borderSize;\r\n            el.style.top = \"\";\r\n            el.style.bottom = screenHeight - top + \"px\";\r\n            popup.isTopdown = false;\r\n        } else {\r\n            top += lineHeight;\r\n            renderer.$maxPixelHeight = screenHeight - top - 0.2 * lineHeight;\r\n            el.style.top = top + \"px\";\r\n            el.style.bottom = \"\";\r\n            popup.isTopdown = true;\r\n        }\r\n\r\n        el.style.display = \"\";\r\n\r\n        var left = pos.left;\r\n        if (left + el.offsetWidth > screenWidth)\r\n            left = screenWidth - el.offsetWidth;\r\n\r\n        el.style.left = left + \"px\";\r\n\r\n        this._signal(\"show\");\r\n        lastMouseEvent = null;\r\n        popup.isOpen = true;\r\n    };\r\n\r\n    popup.getTextLeftOffset = function() {\r\n        return this.$borderSize + this.renderer.$padding + this.$imageSize;\r\n    };\r\n\r\n    popup.$imageSize = 0;\r\n    popup.$borderSize = 1;\r\n\r\n    return popup;\r\n};\r\n\r\ndom.importCssString(\"\\\r\n.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\\\r\n    background-color: #CAD6FA;\\\r\n    z-index: 1;\\\r\n}\\\r\n.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\\\r\n    background-color: #3a674e;\\\r\n}\\\r\n.ace_editor.ace_autocomplete .ace_line-hover {\\\r\n    border: 1px solid #abbffe;\\\r\n    margin-top: -1px;\\\r\n    background: rgba(233,233,253,0.4);\\\r\n    position: absolute;\\\r\n    z-index: 2;\\\r\n}\\\r\n.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {\\\r\n    border: 1px solid rgba(109, 150, 13, 0.8);\\\r\n    background: rgba(58, 103, 78, 0.62);\\\r\n}\\\r\n.ace_completion-meta {\\\r\n    opacity: 0.5;\\\r\n    margin: 0.9em;\\\r\n}\\\r\n.ace_editor.ace_autocomplete .ace_completion-highlight{\\\r\n    color: #2d69c7;\\\r\n}\\\r\n.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{\\\r\n    color: #93ca12;\\\r\n}\\\r\n.ace_editor.ace_autocomplete {\\\r\n    width: 300px;\\\r\n    z-index: 200000;\\\r\n    border: 1px lightgray solid;\\\r\n    position: fixed;\\\r\n    box-shadow: 2px 3px 5px rgba(0,0,0,.2);\\\r\n    line-height: 1.4;\\\r\n    background: #fefefe;\\\r\n    color: #111;\\\r\n}\\\r\n.ace_dark.ace_editor.ace_autocomplete {\\\r\n    border: 1px #484747 solid;\\\r\n    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);\\\r\n    line-height: 1.4;\\\r\n    background: #25282c;\\\r\n    color: #c1c1c1;\\\r\n}\", \"autocompletion.css\");\r\n\r\nexports.AcePopup = AcePopup;\r\n\r\n});\r\n\r\n\r\n"]}