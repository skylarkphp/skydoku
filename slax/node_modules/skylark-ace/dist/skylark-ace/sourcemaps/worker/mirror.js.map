{"version":3,"sources":["worker/mirror.js"],"names":["define","require","exports","module","Range","Document","lang","Mirror","sender","this","doc","deferredUpdate","delayedCall","onUpdate","bind","_self","on","e","data","start","applyDeltas","i","length","Array","isArray","d","action","lines","end","applyDelta","$timeout","schedule","setTimeout","timeout","setValue","value","getValue","callbackId","callback","isPending","call","prototype"],"mappings":";;;;;;;AAAAA,OAAO,SAASC,EAASC,EAASC,GAClC,aAEYF,EAAQ,YAAYG,MAAhC,IACIC,EAAWJ,EAAQ,eAAeI,SAClCC,EAAOL,EAAQ,eAEfM,EAASL,EAAQK,OAAS,SAASC,GACnCC,KAAKD,OAASA,EACd,IAAIE,EAAMD,KAAKC,IAAM,IAAIL,EAAS,IAE9BM,EAAiBF,KAAKE,eAAiBL,EAAKM,YAAYH,KAAKI,SAASC,KAAKL,OAE3EM,EAAQN,KACZD,EAAOQ,GAAG,SAAU,SAASC,GACzB,IAAIC,EAAOD,EAAEC,KACb,GAAIA,EAAK,GAAGC,MACRT,EAAIU,YAAYF,QAEhB,IAAK,IAAIG,EAAI,EAAGA,EAAIH,EAAKI,OAAQD,GAAK,EAAG,CACrC,GAAIE,MAAMC,QAAQN,EAAKG,EAAE,IACrB,IAAII,GAAKC,OAAQ,SAAUP,MAAOD,EAAKG,GAAIM,MAAOT,EAAKG,EAAE,SAErDI,GAAKC,OAAQ,SAAUP,MAAOD,EAAKG,GAAIO,IAAKV,EAAKG,EAAE,IAE3DX,EAAImB,WAAWJ,GAAG,GAG1B,GAAIV,EAAMe,SACN,OAAOnB,EAAeoB,SAAShB,EAAMe,UACzCf,EAAMF,eAId,WAEIJ,KAAKqB,SAAW,IAEhBrB,KAAKuB,WAAa,SAASC,GACvBxB,KAAKqB,SAAWG,GAGpBxB,KAAKyB,SAAW,SAASC,GACrB1B,KAAKC,IAAIwB,SAASC,GAClB1B,KAAKE,eAAeoB,SAAStB,KAAKqB,WAGtCrB,KAAK2B,SAAW,SAASC,GACrB5B,KAAKD,OAAO8B,SAAS7B,KAAKC,IAAI0B,WAAYC,IAG9C5B,KAAKI,SAAW,aAIhBJ,KAAK8B,UAAY,WACb,OAAO9B,KAAKE,eAAe4B,eAGhCC,KAAKjC,EAAOkC","file":"../../worker/mirror.js","sourcesContent":["define(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar Range = require(\"../range\").Range;\r\nvar Document = require(\"../document\").Document;\r\nvar lang = require(\"../lib/lang\");\r\n    \r\nvar Mirror = exports.Mirror = function(sender) {\r\n    this.sender = sender;\r\n    var doc = this.doc = new Document(\"\");\r\n    \r\n    var deferredUpdate = this.deferredUpdate = lang.delayedCall(this.onUpdate.bind(this));\r\n    \r\n    var _self = this;\r\n    sender.on(\"change\", function(e) {\r\n        var data = e.data;\r\n        if (data[0].start) {\r\n            doc.applyDeltas(data);\r\n        } else {\r\n            for (var i = 0; i < data.length; i += 2) {\r\n                if (Array.isArray(data[i+1])) {\r\n                    var d = {action: \"insert\", start: data[i], lines: data[i+1]};\r\n                } else {\r\n                    var d = {action: \"remove\", start: data[i], end: data[i+1]};\r\n                }\r\n                doc.applyDelta(d, true);\r\n            }\r\n        }\r\n        if (_self.$timeout)\r\n            return deferredUpdate.schedule(_self.$timeout);\r\n        _self.onUpdate();\r\n    });\r\n};\r\n\r\n(function() {\r\n    \r\n    this.$timeout = 500;\r\n    \r\n    this.setTimeout = function(timeout) {\r\n        this.$timeout = timeout;\r\n    };\r\n    \r\n    this.setValue = function(value) {\r\n        this.doc.setValue(value);\r\n        this.deferredUpdate.schedule(this.$timeout);\r\n    };\r\n    \r\n    this.getValue = function(callbackId) {\r\n        this.sender.callback(this.doc.getValue(), callbackId);\r\n    };\r\n    \r\n    this.onUpdate = function() {\r\n        // abstract method\r\n    };\r\n    \r\n    this.isPending = function() {\r\n        return this.deferredUpdate.isPending();\r\n    };\r\n    \r\n}).call(Mirror.prototype);\r\n\r\n});\r\n"]}