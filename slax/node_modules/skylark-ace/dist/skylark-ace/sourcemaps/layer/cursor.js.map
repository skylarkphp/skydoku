{"version":3,"sources":["layer/cursor.js"],"names":["define","require","exports","module","dom","Cursor","parentEl","this","element","createElement","className","appendChild","isVisible","isBlinking","blinkInterval","smoothBlinking","cursors","cursor","addCursor","addCssClass","$updateCursors","$updateOpacity","bind","val","i","length","setStyle","style","$startCssAnimation","animationDuration","setTimeout","$stopCssAnimation","removeCssClass","$padding","setPadding","padding","setSession","session","setBlinking","blinking","restartTimer","setBlinkInterval","setSmoothBlinking","setCssClass","el","push","removeCursor","pop","parentNode","removeChild","hideCursor","showCursor","update","clearInterval","intervalId","clearTimeout","timeoutId","HAS_CSS_ANIMATION","blink","setInterval","getPixelPosition","position","onScreen","config","left","top","selection","getCursor","pos","documentToScreenPosition","$bidiHandler","isBidiRow","row","getPosLeft","column","characterWidth","firstRowScreen","lineHeight","isCursorInView","pixelPos","maxHeight","selections","$selectionMarkers","cursorIndex","undefined","n","height","offset","drawCursor","translate","Math","round","overwrite","getOverwrite","$setOverwrite","$pixelPos","destroy","call","prototype"],"mappings":"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","file":"../../layer/cursor.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n * \r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n * \r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar dom = require(\"../lib/dom\");\r\n\r\nvar Cursor = function(parentEl) {\r\n    this.element = dom.createElement(\"div\");\r\n    this.element.className = \"ace_layer ace_cursor-layer\";\r\n    parentEl.appendChild(this.element);\r\n    \r\n    this.isVisible = false;\r\n    this.isBlinking = true;\r\n    this.blinkInterval = 1000;\r\n    this.smoothBlinking = false;\r\n\r\n    this.cursors = [];\r\n    this.cursor = this.addCursor();\r\n    dom.addCssClass(this.element, \"ace_hidden-cursors\");\r\n    this.$updateCursors = this.$updateOpacity.bind(this);\r\n};\r\n\r\n(function() {\r\n    \r\n    this.$updateOpacity = function(val) {\r\n        var cursors = this.cursors;\r\n        for (var i = cursors.length; i--; )\r\n            dom.setStyle(cursors[i].style, \"opacity\", val ? \"\" : \"0\");\r\n    };\r\n\r\n    this.$startCssAnimation = function() {\r\n        var cursors = this.cursors;\r\n        for (var i = cursors.length; i--; )\r\n            cursors[i].style.animationDuration = this.blinkInterval + \"ms\";\r\n\r\n        setTimeout(function() {\r\n            dom.addCssClass(this.element, \"ace_animate-blinking\");\r\n        }.bind(this));\r\n    };\r\n    \r\n    this.$stopCssAnimation = function() {\r\n        dom.removeCssClass(this.element, \"ace_animate-blinking\");\r\n    };\r\n\r\n    this.$padding = 0;\r\n    this.setPadding = function(padding) {\r\n        this.$padding = padding;\r\n    };\r\n\r\n    this.setSession = function(session) {\r\n        this.session = session;\r\n    };\r\n\r\n    this.setBlinking = function(blinking) {\r\n        if (blinking != this.isBlinking) {\r\n            this.isBlinking = blinking;\r\n            this.restartTimer();\r\n        }\r\n    };\r\n\r\n    this.setBlinkInterval = function(blinkInterval) {\r\n        if (blinkInterval != this.blinkInterval) {\r\n            this.blinkInterval = blinkInterval;\r\n            this.restartTimer();\r\n        }\r\n    };\r\n\r\n    this.setSmoothBlinking = function(smoothBlinking) {\r\n        if (smoothBlinking != this.smoothBlinking) {\r\n            this.smoothBlinking = smoothBlinking;\r\n            dom.setCssClass(this.element, \"ace_smooth-blinking\", smoothBlinking);\r\n            this.$updateCursors(true);\r\n            this.restartTimer();\r\n        }\r\n    };\r\n\r\n    this.addCursor = function() {\r\n        var el = dom.createElement(\"div\");\r\n        el.className = \"ace_cursor\";\r\n        this.element.appendChild(el);\r\n        this.cursors.push(el);\r\n        return el;\r\n    };\r\n\r\n    this.removeCursor = function() {\r\n        if (this.cursors.length > 1) {\r\n            var el = this.cursors.pop();\r\n            el.parentNode.removeChild(el);\r\n            return el;\r\n        }\r\n    };\r\n\r\n    this.hideCursor = function() {\r\n        this.isVisible = false;\r\n        dom.addCssClass(this.element, \"ace_hidden-cursors\");\r\n        this.restartTimer();\r\n    };\r\n\r\n    this.showCursor = function() {\r\n        this.isVisible = true;\r\n        dom.removeCssClass(this.element, \"ace_hidden-cursors\");\r\n        this.restartTimer();\r\n    };\r\n\r\n    this.restartTimer = function() {\r\n        var update = this.$updateCursors;\r\n        clearInterval(this.intervalId);\r\n        clearTimeout(this.timeoutId);\r\n        this.$stopCssAnimation();\r\n\r\n        if (this.smoothBlinking) {\r\n            dom.removeCssClass(this.element, \"ace_smooth-blinking\");\r\n        }\r\n        \r\n        update(true);\r\n\r\n        if (!this.isBlinking || !this.blinkInterval || !this.isVisible) {\r\n            this.$stopCssAnimation();\r\n            return;\r\n        }\r\n\r\n        if (this.smoothBlinking) {\r\n            setTimeout(function(){\r\n                dom.addCssClass(this.element, \"ace_smooth-blinking\");\r\n            }.bind(this));\r\n        }\r\n        \r\n        if (dom.HAS_CSS_ANIMATION) {\r\n            this.$startCssAnimation();\r\n        } else {\r\n            var blink = function(){\r\n                this.timeoutId = setTimeout(function() {\r\n                    update(false);\r\n                }, 0.6 * this.blinkInterval);\r\n            }.bind(this);\r\n    \r\n            this.intervalId = setInterval(function() {\r\n                update(true);\r\n                blink();\r\n            }, this.blinkInterval);\r\n            blink();\r\n        }\r\n    };\r\n\r\n    this.getPixelPosition = function(position, onScreen) {\r\n        if (!this.config || !this.session)\r\n            return {left : 0, top : 0};\r\n\r\n        if (!position)\r\n            position = this.session.selection.getCursor();\r\n        var pos = this.session.documentToScreenPosition(position);\r\n        var cursorLeft = this.$padding + (this.session.$bidiHandler.isBidiRow(pos.row, position.row)\r\n            ? this.session.$bidiHandler.getPosLeft(pos.column)\r\n            : pos.column * this.config.characterWidth);\r\n\r\n        var cursorTop = (pos.row - (onScreen ? this.config.firstRowScreen : 0)) *\r\n            this.config.lineHeight;\r\n\r\n        return {left : cursorLeft, top : cursorTop};\r\n    };\r\n\r\n    this.isCursorInView = function(pixelPos, config) {\r\n        return pixelPos.top >= 0 && pixelPos.top < config.maxHeight;\r\n    };\r\n\r\n    this.update = function(config) {\r\n        this.config = config;\r\n\r\n        var selections = this.session.$selectionMarkers;\r\n        var i = 0, cursorIndex = 0;\r\n\r\n        if (selections === undefined || selections.length === 0){\r\n            selections = [{cursor: null}];\r\n        }\r\n\r\n        for (var i = 0, n = selections.length; i < n; i++) {\r\n            var pixelPos = this.getPixelPosition(selections[i].cursor, true);\r\n            if ((pixelPos.top > config.height + config.offset ||\r\n                 pixelPos.top < 0) && i > 1) {\r\n                continue;\r\n            }\r\n\r\n            var element = this.cursors[cursorIndex++] || this.addCursor();\r\n            var style = element.style;\r\n            \r\n            if (!this.drawCursor) {\r\n                if (!this.isCursorInView(pixelPos, config)) {\r\n                    dom.setStyle(style, \"display\", \"none\");\r\n                } else {\r\n                    dom.setStyle(style, \"display\", \"block\");\r\n                    dom.translate(element, pixelPos.left, pixelPos.top);\r\n                    dom.setStyle(style, \"width\", Math.round(config.characterWidth) + \"px\");\r\n                    dom.setStyle(style, \"height\", config.lineHeight + \"px\");\r\n                }\r\n            } else {\r\n                this.drawCursor(element, pixelPos, config, selections[i], this.session);\r\n            }\r\n        }\r\n        while (this.cursors.length > cursorIndex)\r\n            this.removeCursor();\r\n\r\n        var overwrite = this.session.getOverwrite();\r\n        this.$setOverwrite(overwrite);\r\n\r\n        // cache for textarea and gutter highlight\r\n        this.$pixelPos = pixelPos;\r\n        this.restartTimer();\r\n    };\r\n    \r\n    this.drawCursor = null;\r\n\r\n    this.$setOverwrite = function(overwrite) {\r\n        if (overwrite != this.overwrite) {\r\n            this.overwrite = overwrite;\r\n            if (overwrite)\r\n                dom.addCssClass(this.element, \"ace_overwrite-cursors\");\r\n            else\r\n                dom.removeCssClass(this.element, \"ace_overwrite-cursors\");\r\n        }\r\n    };\r\n\r\n    this.destroy = function() {\r\n        clearInterval(this.intervalId);\r\n        clearTimeout(this.timeoutId);\r\n    };\r\n\r\n}).call(Cursor.prototype);\r\n\r\nexports.Cursor = Cursor;\r\n\r\n});\r\n"]}