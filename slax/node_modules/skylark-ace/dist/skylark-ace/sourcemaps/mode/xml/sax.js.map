{"version":3,"sources":["mode/xml/sax.js"],"names":["define","require","exports","module","nameStartChar","nameChar","RegExp","source","slice","tagNamePattern","S_TAG","S_ATTR","S_ATTR_S","S_EQ","S_V","S_E","S_S","S_C","XMLReader","copyLocator","f","t","lineNumber","columnNumber","parseElementStartPart","start","el","entityReplacer","errorHandler","attrName","p","s","c","charAt","Error","indexOf","value","replace","add","warning","setTagName","closed","error","appendElement","domBuilder","parseStack","tagName","localNSMap","currentNSMap","length","i","a","qName","nsp","prefix","localName","nsPrefix","_copy","uri","startPrefixMapping","ns","startElement","endElement","endPrefixMapping","push","parseHtmlSpecialContent","elStartEnd","test","elEndStart","text","substring","characters","fixSelfClosed","closeMap","pos","lastIndexOf","target","n","parseDCC","end","comment","substr","startCDATA","endCDATA","matchs","match","buf","reg","lastIndex","exec","split","len","name","pubid","sysid","lastMatch","startDTD","endDTD","index","parseInstruction","processingInstruction","ElementAttributes","_set_proto_","thiz","parent","__proto__","prototype","parse","defaultNSMap","entityMap","this","startDocument","defaultNSMapCopy","k","code","surrogate1","surrogate2","String","fromCharCode","fixedFromCharCode","parseInt","appendText","xt","locator","position","m","endPos","linePattern","startPos","doc","document","createTextNode","appendChild","currentElement","config","fatalError","pop","backup","offset","nbsp","e","endDocument","getLocalName","getOffset","getQName","getURI","getValue"],"mappings":"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","file":"../../../mode/xml/sax.js","sourcesContent":["define(function(require, exports, module) {\r\n\r\n//[4]   \tNameStartChar\t   ::=   \t\":\" | [A-Z] | \"_\" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\r\n//[4a]   \tNameChar\t   ::=   \tNameStartChar | \"-\" | \".\" | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]\r\n//[5]   \tName\t   ::=   \tNameStartChar (NameChar)*\r\nvar nameStartChar = /[A-Z_a-z\\xC0-\\xD6\\xD8-\\xF6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD]///\\u10000-\\uEFFFF\r\nvar nameChar = new RegExp(\"[\\\\-\\\\.0-9\"+nameStartChar.source.slice(1,-1)+\"\\u00B7\\u0300-\\u036F\\\\ux203F-\\u2040]\");\r\nvar tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\\:'+nameStartChar.source+nameChar.source+'*)?$');\r\n//var tagNamePattern = /^[a-zA-Z_][\\w\\-\\.]*(?:\\:[a-zA-Z_][\\w\\-\\.]*)?$/\r\n//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')\r\n\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_V\r\n//S_ATTR_S,\tS_E,\tS_S,\tS_C\r\nvar S_TAG = 0;//tag name offerring\r\nvar S_ATTR = 1;//attr name offerring \r\nvar S_ATTR_S=2;//attr name end and space offer\r\nvar S_EQ = 3;//=space?\r\nvar S_V = 4;//attr value(no quot value only)\r\nvar S_E = 5;//attr value end and no space(quot end)\r\nvar S_S = 6;//(attr value end || tag end ) && (space offer)\r\nvar S_C = 7;//closed el<el />\r\n\r\nfunction XMLReader(){\r\n\t\r\n}\r\n\r\nXMLReader.prototype = {\r\n\tparse:function(source,defaultNSMap,entityMap){\r\n\t\tvar domBuilder = this.domBuilder;\r\n\t\tdomBuilder.startDocument();\r\n\t\t_copy(defaultNSMap ,defaultNSMap = {})\r\n\t\tparse(source,defaultNSMap,entityMap,\r\n\t\t\t\tdomBuilder,this.errorHandler);\r\n\t\tdomBuilder.endDocument();\r\n\t}\r\n}\r\nfunction parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){\r\n  function fixedFromCharCode(code) {\r\n\t\t// String.prototype.fromCharCode does not supports\r\n\t\t// > 2 bytes unicode chars directly\r\n\t\tif (code > 0xffff) {\r\n\t\t\tcode -= 0x10000;\r\n\t\t\tvar surrogate1 = 0xd800 + (code >> 10)\r\n\t\t\t\t, surrogate2 = 0xdc00 + (code & 0x3ff);\r\n\r\n\t\t\treturn String.fromCharCode(surrogate1, surrogate2);\r\n\t\t} else {\r\n\t\t\treturn String.fromCharCode(code);\r\n\t\t}\r\n\t}\r\n\tfunction entityReplacer(a){\r\n\t\tvar k = a.slice(1,-1);\r\n\t\tif(k in entityMap){\r\n\t\t\treturn entityMap[k]; \r\n\t\t}else if(k.charAt(0) === '#'){\r\n\t\t\treturn fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))\r\n\t\t}else{\r\n\t\t\terrorHandler.error('entity not found:'+a);\r\n\t\t\treturn a;\r\n\t\t}\r\n\t}\r\n\tfunction appendText(end){//has some bugs\r\n\t\tvar xt = source.substring(start,end).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\tlocator&&position(start);\r\n\t\tdomBuilder.characters(xt,0,end-start);\r\n\t\tstart = end\r\n\t}\r\n\tfunction position(start,m){\r\n\t\twhile(start>=endPos && (m = linePattern.exec(source))){\r\n\t\t\tstartPos = m.index;\r\n\t\t\tendPos = startPos + m[0].length;\r\n\t\t\tlocator.lineNumber++;\r\n\t\t\t//console.log('line++:',locator,startPos,endPos)\r\n\t\t}\r\n\t\tlocator.columnNumber = start-startPos+1;\r\n\t}\r\n\tvar startPos = 0;\r\n\tvar endPos = 0;\r\n\tvar linePattern = /.+(?:\\r\\n?|\\n)|.*$/g\r\n\tvar locator = domBuilder.locator;\r\n\t\r\n\tvar parseStack = [{currentNSMap:defaultNSMapCopy}]\r\n\tvar closeMap = {};\r\n\tvar start = 0;\r\n\twhile(true){\r\n\t\tvar i = source.indexOf('<',start);\r\n\t\tif(i<0){\r\n\t\t\tif(!source.substr(start).match(/^\\s*$/)){\r\n\t\t\t\tvar doc = domBuilder.document;\r\n    \t\t\tvar text = doc.createTextNode(source.substr(start));\r\n    \t\t\tdoc.appendChild(text);\r\n    \t\t\tdomBuilder.currentElement = text;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif(i>start){\r\n\t\t\tappendText(i);\r\n\t\t}\r\n\t\tswitch(source.charAt(i+1)){\r\n\t\tcase '/':\r\n\t\t\tvar end = source.indexOf('>',i+3);\r\n\t\t\tvar tagName = source.substring(i+2,end);\r\n\t\t\tvar config;\r\n\t\t\tif (parseStack.length > 1) {\r\n\t\t\t\tconfig = parseStack.pop();\r\n\t\t\t} else {\r\n\t\t\t\terrorHandler.fatalError(\"end tag name not found for: \"+tagName);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tvar localNSMap = config.localNSMap;\r\n\t\t\t\r\n\t        if(config.tagName != tagName){\r\n\t            errorHandler.fatalError(\"end tag name: \" + tagName + \" does not match the current start tagName: \"+config.tagName );\r\n\t        }\r\n\t\t\tdomBuilder.endElement(config.uri,config.localName,tagName);\r\n\t\t\tif(localNSMap){\r\n\t\t\t\tfor(var prefix in localNSMap){\r\n\t\t\t\t\tdomBuilder.endPrefixMapping(prefix) ;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tend++;\r\n\t\t\tbreak;\r\n\t\t\t// end elment\r\n\t\tcase '?':// <?...?>\r\n\t\t\tlocator&&position(i);\r\n\t\t\tend = parseInstruction(source,i,domBuilder);\r\n\t\t\tbreak;\r\n\t\tcase '!':// <!doctype,<![CDATA,<!--\r\n\t\t\tlocator&&position(i);\r\n\t\t\tend = parseDCC(source,i,domBuilder,errorHandler);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\ttry{\r\n\t\t\t\tlocator&&position(i);\r\n\t\t\t\t\r\n\t\t\t\tvar el = new ElementAttributes();\r\n\t\t\t\t\r\n\t\t\t\t//elStartEnd\r\n\t\t\t\tvar end = parseElementStartPart(source,i,el,entityReplacer,errorHandler);\r\n\t\t\t\tvar len = el.length;\r\n\t\t\t\t//position fixed\r\n\t\t\t\tif(len && locator){\r\n\t\t\t\t\tvar backup = copyLocator(locator,{});\r\n\t\t\t\t\tfor(var i = 0;i<len;i++){\r\n\t\t\t\t\t\tvar a = el[i];\r\n\t\t\t\t\t\tposition(a.offset);\r\n\t\t\t\t\t\ta.offset = copyLocator(locator,{});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcopyLocator(backup,locator);\r\n\t\t\t\t}\r\n\t\t\t\tif(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){\r\n\t\t\t\t\tel.closed = true;\r\n\t\t\t\t\tif(!entityMap.nbsp){\r\n\t\t\t\t\t\terrorHandler.warning('unclosed xml attribute');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tappendElement(el,domBuilder,parseStack);\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif(el.uri === 'http://www.w3.org/1999/xhtml' && !el.closed){\r\n\t\t\t\t\tend = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tend++;\r\n\t\t\t\t}\r\n\t\t\t}catch(e){\r\n\t\t\t\terrorHandler.error('element parse error: '+e);\r\n\t\t\t\tend = -1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tif(end<0){\r\n\t\t\t//TODO: 这里有可能sax回退，有位置错误风险\r\n\t\t\tappendText(i+1);\r\n\t\t}else{\r\n\t\t\tstart = end;\r\n\t\t}\r\n\t}\r\n}\r\nfunction copyLocator(f,t){\r\n\tt.lineNumber = f.lineNumber;\r\n\tt.columnNumber = f.columnNumber;\r\n\treturn t;\r\n\t\r\n}\r\n\r\n/**\r\n * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);\r\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\r\n */\r\nfunction parseElementStartPart(source,start,el,entityReplacer,errorHandler){\r\n\tvar attrName;\r\n\tvar value;\r\n\tvar p = ++start;\r\n\tvar s = S_TAG;//status\r\n\twhile(true){\r\n\t\tvar c = source.charAt(p);\r\n\t\tswitch(c){\r\n\t\tcase '=':\r\n\t\t\tif(s === S_ATTR){//attrName\r\n\t\t\t\tattrName = source.slice(start,p);\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else if(s === S_ATTR_S){\r\n\t\t\t\ts = S_EQ;\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: equal must after attrName or space after attrName\r\n\t\t\t\tthrow new Error('attribute equal must after attrName');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '\\'':\r\n\t\tcase '\"':\r\n\t\t\tif(s === S_EQ){//equal\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\tp = source.indexOf(c,start)\r\n\t\t\t\tif(p>0){\r\n\t\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\tel.add(attrName,value,start-1);\r\n\t\t\t\t\ts = S_E;\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//fatalError: no end quot match\r\n\t\t\t\t\tthrow new Error('attribute value no end \\''+c+'\\' match');\r\n\t\t\t\t}\r\n\t\t\t}else if(s == S_V){\r\n\t\t\t\tvalue = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t//console.log(attrName,value,start,p)\r\n\t\t\t\tel.add(attrName,value,start);\r\n\t\t\t\t//console.dir(el)\r\n\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed start quot('+c+')!!');\r\n\t\t\t\tstart = p+1;\r\n\t\t\t\ts = S_E\r\n\t\t\t}else{\r\n\t\t\t\t//fatalError: no equal before\r\n\t\t\t\tthrow new Error('attribute value must after \"=\"');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase '/':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_E:\r\n\t\t\tcase S_S:\r\n\t\t\tcase S_C:\r\n\t\t\t\ts = S_C;\r\n\t\t\t\tel.closed = true;\r\n\t\t\tcase S_V:\r\n\t\t\tcase S_ATTR:\r\n\t\t\tcase S_ATTR_S:\r\n\t\t\t\tbreak;\r\n\t\t\t//case S_EQ:\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"attribute invalid close char('/')\")\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase ''://end document\r\n\t\t\t//throw new Error('unexpected end of input')\r\n\t\t\terrorHandler.error('unexpected end of input');\r\n\t\tcase '>':\r\n\t\t\tswitch(s){\r\n\t\t\tcase S_TAG:\r\n\t\t\t\tel.setTagName(source.slice(start,p));\r\n\t\t\tcase S_E:\r\n\t\t\tcase S_S:\r\n\t\t\tcase S_C:\r\n\t\t\t\tbreak;//normal\r\n\t\t\tcase S_V://Compatible state\r\n\t\t\tcase S_ATTR:\r\n\t\t\t\tvalue = source.slice(start,p);\r\n\t\t\t\tif(value.slice(-1) === '/'){\r\n\t\t\t\t\tel.closed  = true;\r\n\t\t\t\t\tvalue = value.slice(0,-1)\r\n\t\t\t\t}\r\n\t\t\tcase S_ATTR_S:\r\n\t\t\t\tif(s === S_ATTR_S){\r\n\t\t\t\t\tvalue = attrName;\r\n\t\t\t\t}\r\n\t\t\t\tif(s == S_V){\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value.replace(/&#?\\w+;/g,entityReplacer),start)\r\n\t\t\t\t}else{\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed value!! \"'+value+'\" instead!!')\r\n\t\t\t\t\tel.add(value,value,start)\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase S_EQ:\r\n\t\t\t\tthrow new Error('attribute value missed!!');\r\n\t\t\t}\r\n//\t\t\tconsole.log(tagName,tagNamePattern,tagNamePattern.test(tagName))\r\n\t\t\treturn p;\r\n\t\t/*xml space '\\x20' | #x9 | #xD | #xA; */\r\n\t\tcase '\\u0080':\r\n\t\t\tc = ' ';\r\n\t\tdefault:\r\n\t\t\tif(c<= ' '){//space\r\n\t\t\t\tswitch(s){\r\n\t\t\t\tcase S_TAG:\r\n\t\t\t\t\tel.setTagName(source.slice(start,p));//tagName\r\n\t\t\t\t\ts = S_S;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_ATTR:\r\n\t\t\t\t\tattrName = source.slice(start,p)\r\n\t\t\t\t\ts = S_ATTR_S;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_V:\r\n\t\t\t\t\tvar value = source.slice(start,p).replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+value+'\" missed quot(\")!!');\r\n\t\t\t\t\tel.add(attrName,value,start)\r\n\t\t\t\tcase S_E:\r\n\t\t\t\t\ts = S_S;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t//case S_S:\r\n\t\t\t\t//case S_EQ:\r\n\t\t\t\t//case S_ATTR_S:\r\n\t\t\t\t//\tvoid();break;\r\n\t\t\t\t//case S_C:\r\n\t\t\t\t\t//ignore warning\r\n\t\t\t\t}\r\n\t\t\t}else{//not space\r\n//S_TAG,\tS_ATTR,\tS_EQ,\tS_V\r\n//S_ATTR_S,\tS_E,\tS_S,\tS_C\r\n\t\t\t\tswitch(s){\r\n\t\t\t\t//case S_TAG:void();break;\r\n\t\t\t\t//case S_ATTR:void();break;\r\n\t\t\t\t//case S_V:void();break;\r\n\t\t\t\tcase S_ATTR_S:\r\n\t\t\t\t\terrorHandler.warning('attribute \"'+attrName+'\" missed value!! \"'+attrName+'\" instead!!')\r\n\t\t\t\t\tel.add(attrName,attrName,start);\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_E:\r\n\t\t\t\t\terrorHandler.warning('attribute space is required\"'+attrName+'\"!!')\r\n\t\t\t\tcase S_S:\r\n\t\t\t\t\ts = S_ATTR;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_EQ:\r\n\t\t\t\t\ts = S_V;\r\n\t\t\t\t\tstart = p;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase S_C:\r\n\t\t\t\t\tthrow new Error(\"elements closed character '/' and '>' must be connected to\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tp++;\r\n\t}\r\n}\r\n/**\r\n * @return end of the elementStartPart(end of elementEndPart for selfClosed el)\r\n */\r\nfunction appendElement(el,domBuilder,parseStack){\r\n\tvar tagName = el.tagName;\r\n\tvar localNSMap = null;\r\n\tvar currentNSMap = parseStack[parseStack.length-1].currentNSMap;\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\tvar a = el[i];\r\n\t\tvar qName = a.qName;\r\n\t\tvar value = a.value;\r\n\t\tvar nsp = qName.indexOf(':');\r\n\t\tif(nsp>0){\r\n\t\t\tvar prefix = a.prefix = qName.slice(0,nsp);\r\n\t\t\tvar localName = qName.slice(nsp+1);\r\n\t\t\tvar nsPrefix = prefix === 'xmlns' && localName\r\n\t\t}else{\r\n\t\t\tlocalName = qName;\r\n\t\t\tprefix = null\r\n\t\t\tnsPrefix = qName === 'xmlns' && ''\r\n\t\t}\r\n\t\t//can not set prefix,because prefix !== ''\r\n\t\ta.localName = localName ;\r\n\t\t//prefix == null for no ns prefix attribute \r\n\t\tif(nsPrefix !== false){//hack!!\r\n\t\t\tif(localNSMap == null){\r\n\t\t\t\tlocalNSMap = {}\r\n\t\t\t\t//console.log(currentNSMap,0)\r\n\t\t\t\t_copy(currentNSMap,currentNSMap={})\r\n\t\t\t\t//console.log(currentNSMap,1)\r\n\t\t\t}\r\n\t\t\tcurrentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;\r\n\t\t\ta.uri = 'http://www.w3.org/2000/xmlns/'\r\n\t\t\tdomBuilder.startPrefixMapping(nsPrefix, value) \r\n\t\t}\r\n\t}\r\n\tvar i = el.length;\r\n\twhile(i--){\r\n\t\ta = el[i];\r\n\t\tvar prefix = a.prefix;\r\n\t\tif(prefix){//no prefix attribute has no namespace\r\n\t\t\tif(prefix === 'xml'){\r\n\t\t\t\ta.uri = 'http://www.w3.org/XML/1998/namespace';\r\n\t\t\t}if(prefix !== 'xmlns'){\r\n\t\t\t\ta.uri = currentNSMap[prefix]\r\n\t\t\t\t\r\n\t\t\t\t//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tvar nsp = tagName.indexOf(':');\r\n\tif(nsp>0){\r\n\t\tprefix = el.prefix = tagName.slice(0,nsp);\r\n\t\tlocalName = el.localName = tagName.slice(nsp+1);\r\n\t}else{\r\n\t\tprefix = null;//important!!\r\n\t\tlocalName = el.localName = tagName;\r\n\t}\r\n\t//no prefix element has default namespace\r\n\tvar ns = el.uri = currentNSMap[prefix || ''];\r\n\tdomBuilder.startElement(ns,localName,tagName,el);\r\n\t//endPrefixMapping and startPrefixMapping have not any help for dom builder\r\n\t//localNSMap = null\r\n\tif(el.closed){\r\n\t\tdomBuilder.endElement(ns,localName,tagName);\r\n\t\tif(localNSMap){\r\n\t\t\tfor(prefix in localNSMap){\r\n\t\t\t\tdomBuilder.endPrefixMapping(prefix) \r\n\t\t\t}\r\n\t\t}\r\n\t}else{\r\n\t\tel.currentNSMap = currentNSMap;\r\n\t\tel.localNSMap = localNSMap;\r\n\t\tparseStack.push(el);\r\n\t}\r\n}\r\nfunction parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){\r\n\tif(/^(?:script|textarea)$/i.test(tagName)){\r\n\t\tvar elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);\r\n\t\tvar text = source.substring(elStartEnd+1,elEndStart);\r\n\t\tif(/[&<]/.test(text)){\r\n\t\t\tif(/^script$/i.test(tagName)){\r\n\t\t\t\t//if(!/\\]\\]>/.test(text)){\r\n\t\t\t\t\t//lexHandler.startCDATA();\r\n\t\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\t\t//lexHandler.endCDATA();\r\n\t\t\t\t\treturn elEndStart;\r\n\t\t\t\t//}\r\n\t\t\t}//}else{//text area\r\n\t\t\t\ttext = text.replace(/&#?\\w+;/g,entityReplacer);\r\n\t\t\t\tdomBuilder.characters(text,0,text.length);\r\n\t\t\t\treturn elEndStart;\r\n\t\t\t//}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\treturn elStartEnd+1;\r\n}\r\nfunction fixSelfClosed(source,elStartEnd,tagName,closeMap){\r\n\t//if(tagName in closeMap){\r\n\tvar pos = closeMap[tagName];\r\n\tif(pos == null){\r\n\t\t//console.log(tagName)\r\n\t\tpos = closeMap[tagName] = source.lastIndexOf('</'+tagName+'>')\r\n\t}\r\n\treturn pos<elStartEnd;\r\n\t//} \r\n}\r\nfunction _copy(source,target){\r\n\tfor(var n in source){target[n] = source[n]}\r\n}\r\nfunction parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'\r\n\tvar next= source.charAt(start+2)\r\n\tswitch(next){\r\n\tcase '-':\r\n\t\tif(source.charAt(start + 3) === '-'){\r\n\t\t\tvar end = source.indexOf('-->',start+4);\r\n\t\t\t//append comment source.substring(4,end)//<!--\r\n\t\t\tif(end>start){\r\n\t\t\t\tdomBuilder.comment(source,start+4,end-start-4);\r\n\t\t\t\treturn end+3;\r\n\t\t\t}else{\r\n\t\t\t\terrorHandler.error(\"Unclosed comment\");\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\tdefault:\r\n\t\tif(source.substr(start+3,6) == 'CDATA['){\r\n\t\t\tvar end = source.indexOf(']]>',start+9);\r\n\t\t\tdomBuilder.startCDATA();\r\n\t\t\tdomBuilder.characters(source,start+9,end-start-9);\r\n\t\t\tdomBuilder.endCDATA() \r\n\t\t\treturn end+3;\r\n\t\t}\r\n\t\t//<!DOCTYPE\r\n\t\t//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId) \r\n\t\tvar matchs = split(source,start);\r\n\t\tvar len = matchs.length;\r\n\t\tif(len>1 && /!doctype/i.test(matchs[0][0])){\r\n\t\t\tvar name = matchs[1][0];\r\n\t\t\tvar pubid = len>3 && /^public$/i.test(matchs[2][0]) && matchs[3][0]\r\n\t\t\tvar sysid = len>4 && matchs[4][0];\r\n\t\t\tvar lastMatch = matchs[len-1]\r\n\t\t\tdomBuilder.startDTD(name,pubid && pubid.replace(/^(['\"])(.*?)\\1$/,'$2'),\r\n\t\t\t\t\tsysid && sysid.replace(/^(['\"])(.*?)\\1$/,'$2'));\r\n\t\t\tdomBuilder.endDTD();\r\n\t\t\t\r\n\t\t\treturn lastMatch.index+lastMatch[0].length\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n\r\n\r\nfunction parseInstruction(source,start,domBuilder){\r\n\tvar end = source.indexOf('?>',start);\r\n\tif(end){\r\n\t\tvar match = source.substring(start,end).match(/^<\\?(\\S*)\\s*([\\s\\S]*?)\\s*$/);\r\n\t\tif(match){\r\n\t\t\tvar len = match[0].length;\r\n\t\t\tdomBuilder.processingInstruction(match[1], match[2]) ;\r\n\t\t\treturn end+2;\r\n\t\t}else{//error\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\treturn -1;\r\n}\r\n\r\n/**\r\n * @param source\r\n */\r\nfunction ElementAttributes(source){\r\n\t\r\n}\r\nElementAttributes.prototype = {\r\n\tsetTagName:function(tagName){\r\n\t\tif(!tagNamePattern.test(tagName)){\r\n\t\t\tthrow new Error('invalid tagName:'+tagName)\r\n\t\t}\r\n\t\tthis.tagName = tagName\r\n\t},\r\n\tadd:function(qName,value,offset){\r\n\t\tif(!tagNamePattern.test(qName)){\r\n\t\t\tthrow new Error('invalid attribute:'+qName)\r\n\t\t}\r\n\t\tthis[this.length++] = {qName:qName,value:value,offset:offset}\r\n\t},\r\n\tlength:0,\r\n\tgetLocalName:function(i){return this[i].localName},\r\n\tgetOffset:function(i){return this[i].offset},\r\n\tgetQName:function(i){return this[i].qName},\r\n\tgetURI:function(i){return this[i].uri},\r\n\tgetValue:function(i){return this[i].value}\r\n//\t,getIndex:function(uri, localName)){\r\n//\t\tif(localName){\r\n//\t\t\t\r\n//\t\t}else{\r\n//\t\t\tvar qName = uri\r\n//\t\t}\r\n//\t},\r\n//\tgetValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},\r\n//\tgetType:function(uri,localName){}\r\n//\tgetType:function(i){},\r\n}\r\n\r\n\r\n\r\n\r\nfunction _set_proto_(thiz,parent){\r\n\tthiz.__proto__ = parent;\r\n\treturn thiz;\r\n}\r\nif(!(_set_proto_({},_set_proto_.prototype) instanceof _set_proto_)){\r\n\t_set_proto_ = function(thiz,parent){\r\n\t\tfunction p(){};\r\n\t\tp.prototype = parent;\r\n\t\tp = new p();\r\n\t\tfor(parent in thiz){\r\n\t\t\tp[parent] = thiz[parent];\r\n\t\t}\r\n\t\treturn p;\r\n\t}\r\n}\r\n\r\nfunction split(source,start){\r\n\tvar match;\r\n\tvar buf = [];\r\n\tvar reg = /'[^']+'|\"[^\"]+\"|[^\\s<>\\/=]+=?|(\\/?\\s*>|<)/g;\r\n\treg.lastIndex = start;\r\n\treg.exec(source);//skip <\r\n\twhile(match = reg.exec(source)){\r\n\t\tbuf.push(match);\r\n\t\tif(match[1])return buf;\r\n\t}\r\n}\r\n\r\nreturn XMLReader;\r\n});\r\n\r\n\r\n"]}