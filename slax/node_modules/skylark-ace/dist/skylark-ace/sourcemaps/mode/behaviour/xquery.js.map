{"version":3,"sources":["mode/behaviour/xquery.js"],"names":["define","require","exports","module","oop","Behaviour","CstyleBehaviour","XmlBehaviour","TokenIterator","hasType","token","type","typeList","split","forEach","needle","indexOf","XQueryBehaviour","this","inherit","add","state","action","editor","session","text","position","getCursorPosition","iterator","row","column","getCurrentToken","atCursor","JSON","parse","pop","value","match","stepBackward","previous","tag","substring","start","selection","inherits"],"mappings":";;;;;;;AA6BAA,OAAO,SAASC,EAASC,EAASC,GAClC,aAEE,IAAIC,EAAMH,EAAQ,iBACdI,EAAYJ,EAAQ,gBAAgBI,UACpCC,EAAkBL,EAAQ,YAAYK,gBACtCC,EAAeN,EAAQ,oBAAoBM,aAC3CC,EAAgBP,EAAQ,wBAAwBO,cAEtD,SAASC,EAAQC,EAAOC,GACpB,IAAIF,GAAU,EACVG,EAAWF,EAAMC,KAAKE,MAAM,KAQhC,OAPiBF,EAAKE,MAAM,KACjBC,QAAQ,SAASC,GACxB,IAAiC,GAA7BH,EAASI,QAAQD,GAEjB,OADAN,GAAU,GACH,IAGRA,EAGT,IAAIQ,EAAkB,WAElBC,KAAKC,QAAQb,GAAkB,SAAU,SAAU,mBACnDY,KAAKC,QAAQZ,GAEbW,KAAKE,IAAI,cAAe,YAAa,SAAUC,EAAOC,EAAQC,EAAQC,EAASC,GAC7E,GAAY,KAARA,EAAa,CACb,IAAIC,EAAWH,EAAOI,oBAClBC,EAAW,IAAIpB,EAAcgB,EAASE,EAASG,IAAKH,EAASI,QAC7DpB,EAAQkB,EAASG,kBACjBC,GAAW,EACXX,EAAQY,KAAKC,MAAMb,GAAOc,MAC9B,GAAKzB,GAAyB,MAAhBA,EAAM0B,OAA4B,aAAVf,EAAsB,OAC5D,GAAKX,IAAUD,EAAQC,EAAO,aAAiBD,EAAQC,EAAO,SAAWA,EAAM0B,MAAMC,MAAM,MAKvFL,GAAW,OAJX,GACItB,EAAQkB,EAASU,qBACZ5B,IAAUD,EAAQC,EAAO,WAAaD,EAAQC,EAAO,qBAAuBD,EAAQC,EAAO,0BAA4BD,EAAQC,EAAO,UAInJ,IAAI6B,EAAWX,EAASU,eACxB,IAAK5B,IAAUD,EAAQC,EAAO,aAA6B,OAAb6B,GAAqBA,EAASH,MAAMC,MAAM,KACpF,OAEJ,IAAIG,EAAM9B,EAAM0B,MAAMK,UAAU,GAChC,GAAIT,EACIQ,EAAMA,EAAIC,UAAU,EAAGf,EAASI,OAASpB,EAAMgC,OAGvD,OACGjB,KAAM,MAAae,EAAM,IACzBG,WAAY,EAAG,QAM5BvC,EAAIwC,SAAS3B,EAAiBZ,GAE9BH,EAAQe,gBAAkBA","file":"../../../mode/behaviour/xquery.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n * \r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n * \r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\n  var oop = require(\"../../lib/oop\");\r\n  var Behaviour = require('../behaviour').Behaviour;\r\n  var CstyleBehaviour = require('./cstyle').CstyleBehaviour;\r\n  var XmlBehaviour = require(\"../behaviour/xml\").XmlBehaviour;\r\n  var TokenIterator = require(\"../../token_iterator\").TokenIterator;\r\n\r\nfunction hasType(token, type) {\r\n    var hasType = true;\r\n    var typeList = token.type.split('.');\r\n    var needleList = type.split('.');\r\n    needleList.forEach(function(needle){\r\n        if (typeList.indexOf(needle) == -1) {\r\n            hasType = false;\r\n            return false;\r\n        }\r\n    });\r\n    return hasType;\r\n}\r\n \r\n  var XQueryBehaviour = function () {\r\n      \r\n      this.inherit(CstyleBehaviour, [\"braces\", \"parens\", \"string_dquotes\"]); // Get string behaviour\r\n      this.inherit(XmlBehaviour); // Get xml behaviour\r\n      \r\n      this.add(\"autoclosing\", \"insertion\", function (state, action, editor, session, text) {\r\n        if (text == '>') {\r\n            var position = editor.getCursorPosition();\r\n            var iterator = new TokenIterator(session, position.row, position.column);\r\n            var token = iterator.getCurrentToken();\r\n            var atCursor = false;\r\n            var state = JSON.parse(state).pop();\r\n            if ((token && token.value === '>') || state !== \"StartTag\") return;\r\n            if (!token || !hasType(token, 'meta.tag') && !(hasType(token, 'text') && token.value.match('/'))){\r\n                do {\r\n                    token = iterator.stepBackward();\r\n                } while (token && (hasType(token, 'string') || hasType(token, 'keyword.operator') || hasType(token, 'entity.attribute-name') || hasType(token, 'text')));\r\n            } else {\r\n                atCursor = true;\r\n            }\r\n            var previous = iterator.stepBackward();\r\n            if (!token || !hasType(token, 'meta.tag') || (previous !== null && previous.value.match('/'))) {\r\n                return;\r\n            }\r\n            var tag = token.value.substring(1);\r\n            if (atCursor){\r\n                var tag = tag.substring(0, position.column - token.start);\r\n            }\r\n\r\n            return {\r\n               text: '>' + '</' + tag + '>',\r\n               selection: [1, 1]\r\n            };\r\n        }\r\n    });\r\n\r\n  };\r\n  oop.inherits(XQueryBehaviour, Behaviour);\r\n\r\n  exports.XQueryBehaviour = XQueryBehaviour;\r\n});\r\n"]}