{"version":3,"sources":["mode/sjs_highlight_rules.js"],"names":["define","require","exports","module","oop","JavaScriptHighlightRules","TextHighlightRules","SJSHighlightRules","parent","noES6","escapedRe","contextAware","f","isContextAware","ctxBegin","opts","token","regex","next","currentState","stack","length","unshift","ctxEnd","shift","this","$rules","no_regex","concat","block_arguments","function_arguments","bstring","defaultToken","qqstring","embeddableRules","i","rule","String","indexOf","push","string_interp","bstring_interp_single","bstring_interp_single_call","inherits"],"mappings":";;;;;;;AA8BAA,OAAO,SAASC,QAASC,QAASC,QAClC,aAEA,IAAIC,EAAMH,QAAQ,cACdI,EAA2BJ,QAAQ,gCAAgCI,yBACnEC,EAAqBL,QAAQ,0BAA0BK,mBAEvDC,EAAoB,WACpB,IAAIC,EAAS,IAAIH,GAA0BI,OAAO,IAC9CC,EAAY,8FAQZC,EAAe,SAASC,GAExB,OADAA,EAAEC,gBAAiB,EACZD,GAGPE,EAAW,SAASC,GACpB,OACIC,MAAOD,EAAKC,MACZC,MAAOF,EAAKE,MACZC,KAAMP,EAAa,SAASQ,EAAcC,GAItC,OAHqB,IAAjBA,EAAMC,QACND,EAAME,QAAQH,GAClBC,EAAME,QAAQP,EAAKG,MACZH,EAAKG,SAKpBK,EAAS,SAASR,GAClB,OACIC,MAAOD,EAAKC,MACZC,MAAOF,EAAKE,MACZC,KAAMP,EAAa,SAASQ,EAAcC,GAEtC,OADAA,EAAMI,QACCJ,EAAM,IAAM,YAK/BK,KAAKC,OAASlB,EAAOkB,OACrBD,KAAKC,OAAOC,WAEJX,MAAO,UACPC,MAAO,+CAGPD,MAAO,mBACPC,MAAO,mBAGPD,MAAO,oBACPC,MAAO,qBAEXH,GACIE,MAAO,SACPC,MAAO,IACPC,KAAM,YAEVJ,GACIE,MAAO,SACPC,MAAO,IACPC,KAAM,aAEVJ,GACIE,MAAO,SACPC,MAAO,IACPC,KAAM,cAGNF,OAAQ,eAAgB,OAAQ,gBAChCC,MAAO,mBACPC,KAAM,oBAGZU,OAAOH,KAAKC,OAAOC,UAErBF,KAAKC,OAAOG,kBAEJb,MAAO,eACPC,MAAO,MACPC,KAAM,aAEZU,OAAOH,KAAKC,OAAOI,oBAErBL,KAAKC,OAAOK,UAEJf,MAAQ,2BACRC,MAAQP,IAGRM,MAAQ,SACRC,MAAQ,QACRC,KAAM,WAEVJ,GACIE,MAAQ,eACRC,MAAQ,SACRC,KAAM,kBAEVJ,GACIE,MAAQ,eACRC,MAAQ,MACRC,KAAM,0BAEVK,GACIP,MAAQ,SACRC,MAAQ,OAGRe,aAAc,WAItBP,KAAKC,OAAOO,WAEJjB,MAAQ,2BACRC,MAAQP,IAGRM,MAAQ,SACRC,MAAQ,QACRC,KAAM,YAEVJ,GACIE,MAAQ,eACRC,MAAQ,OACRC,KAAM,kBAEVK,GACIP,MAAQ,SACRC,MAAQ,OAGRe,aAAc,WAStB,IADA,IAAIE,KACKC,EAAE,EAAGA,EAAIV,KAAKC,OAAOC,SAASN,OAAQc,IAAK,CAChD,IAAIC,EAAOX,KAAKC,OAAOC,SAASQ,IAED,GADnBE,OAAOD,EAAKpB,OACdsB,QAAQ,UAAoBF,EAAKlB,OAAQkB,EAAKlB,KAAKL,gBACzDqB,EAAgBK,KAAKH,GAI7BX,KAAKC,OAAOc,eACRjB,GACIP,MAAO,eACPC,MAAO,QAEXH,GACIE,MAAO,eACPC,MAAO,IACPC,KAAM,mBAEZU,OAAOM,GAITT,KAAKC,OAAOe,wBAEJzB,OAAQ,aAAc,gBACtBC,MAAO,cACPC,KAAM,8BAGVK,GACIP,MAAQ,aACRC,MAAQ,UAOhBQ,KAAKC,OAAOgB,4BACR5B,GACIE,MAAO,eACPC,MAAO,MACPC,KAAM,+BAEVK,GACIP,MAAO,eACPC,MAAO,SAEbW,OAAOM,IAEb9B,EAAIuC,SAASpC,EAAmBD,GAEhCJ,QAAQK,kBAAoBA","file":"../../mode/sjs_highlight_rules.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar oop = require(\"../lib/oop\");\r\nvar JavaScriptHighlightRules = require(\"./javascript_highlight_rules\").JavaScriptHighlightRules;\r\nvar TextHighlightRules = require(\"./text_highlight_rules\").TextHighlightRules;\r\n\r\nvar SJSHighlightRules = function() {\r\n    var parent = new JavaScriptHighlightRules({noES6: true});\r\n    var escapedRe = \"\\\\\\\\(?:x[0-9a-fA-F]{2}|\" + // hex\r\n        \"u[0-9a-fA-F]{4}|\" + // unicode\r\n        \"[0-2][0-7]{0,2}|\" + // oct\r\n        \"3[0-6][0-7]?|\" + // oct\r\n        \"37[0-7]?|\" + // oct\r\n        \"[4-7][0-7]?|\" + //oct\r\n        \".)\";\r\n\r\n    var contextAware = function(f) {\r\n        f.isContextAware = true;\r\n        return f;\r\n    };\r\n\r\n    var ctxBegin = function(opts) {\r\n        return {\r\n            token: opts.token,\r\n            regex: opts.regex,\r\n            next: contextAware(function(currentState, stack) {\r\n                if (stack.length === 0)\r\n                    stack.unshift(currentState);\r\n                stack.unshift(opts.next);\r\n                return opts.next;\r\n            })\r\n        };\r\n    };\r\n\r\n    var ctxEnd = function(opts) {\r\n        return {\r\n            token: opts.token,\r\n            regex: opts.regex,\r\n            next: contextAware(function(currentState, stack) {\r\n                stack.shift();\r\n                return stack[0] || \"start\";\r\n            })\r\n        };\r\n    };\r\n\r\n    this.$rules = parent.$rules;\r\n    this.$rules.no_regex = [\r\n        {\r\n            token: \"keyword\",\r\n            regex: \"(waitfor|or|and|collapse|spawn|retract)\\\\b\"\r\n        },\r\n        {\r\n            token: \"keyword.operator\",\r\n            regex: \"(->|=>|\\\\.\\\\.)\"\r\n        },\r\n        {\r\n            token: \"variable.language\",\r\n            regex: \"(hold|default)\\\\b\"\r\n        },\r\n        ctxBegin({\r\n            token: \"string\",\r\n            regex: \"`\",\r\n            next: \"bstring\"\r\n        }),\r\n        ctxBegin({\r\n            token: \"string\",\r\n            regex: '\"',\r\n            next: \"qqstring\"\r\n        }),\r\n        ctxBegin({\r\n            token: \"string\",\r\n            regex: '\"',\r\n            next: \"qqstring\"\r\n        }),\r\n        {\r\n            token: [\"paren.lparen\", \"text\", \"paren.rparen\"],\r\n            regex: \"(\\\\{)(\\\\s*)(\\\\|)\",\r\n            next: \"block_arguments\"\r\n        }\r\n\r\n    ].concat(this.$rules.no_regex);\r\n\r\n    this.$rules.block_arguments = [\r\n        {\r\n            token: \"paren.rparen\",\r\n            regex: \"\\\\|\",\r\n            next: \"no_regex\"\r\n        }\r\n    ].concat(this.$rules.function_arguments);\r\n\r\n    this.$rules.bstring = [\r\n        {\r\n            token : \"constant.language.escape\",\r\n            regex : escapedRe\r\n        },\r\n        {\r\n            token : \"string\",\r\n            regex : \"\\\\\\\\$\",\r\n            next: \"bstring\"\r\n        },\r\n        ctxBegin({\r\n            token : \"paren.lparen\",\r\n            regex : \"\\\\$\\\\{\",\r\n            next: \"string_interp\"\r\n        }),\r\n        ctxBegin({\r\n            token : \"paren.lparen\",\r\n            regex : \"\\\\$\",\r\n            next: \"bstring_interp_single\"\r\n        }),\r\n        ctxEnd({\r\n            token : \"string\",\r\n            regex : \"`\"\r\n        }),\r\n        {\r\n            defaultToken: \"string\"\r\n        }\r\n    ];\r\n    \r\n    this.$rules.qqstring = [\r\n        {\r\n            token : \"constant.language.escape\",\r\n            regex : escapedRe\r\n        },\r\n        {\r\n            token : \"string\",\r\n            regex : \"\\\\\\\\$\",\r\n            next: \"qqstring\"\r\n        },\r\n        ctxBegin({\r\n            token : \"paren.lparen\",\r\n            regex : \"#\\\\{\",\r\n            next: \"string_interp\"\r\n        }),\r\n        ctxEnd({\r\n            token : \"string\",\r\n            regex : '\"'\r\n        }),\r\n        {\r\n            defaultToken: \"string\"\r\n        }\r\n    ];\r\n\r\n    // collect all context-aware (or stateless), brace-less\r\n    // states. This gives us most normal highlighting\r\n    // for use within interpreted contexts\r\n    // without interfering with context nesting\r\n    var embeddableRules = [];\r\n    for (var i=0; i < this.$rules.no_regex.length; i++) {\r\n        var rule = this.$rules.no_regex[i];\r\n        var token = String(rule.token);\r\n        if (token.indexOf('paren') == -1 && (!rule.next || rule.next.isContextAware)) {\r\n            embeddableRules.push(rule);\r\n        }\r\n    }\r\n\r\n    this.$rules.string_interp = [\r\n        ctxEnd({\r\n            token: \"paren.rparen\",\r\n            regex: \"\\\\}\"\r\n        }),\r\n        ctxBegin({\r\n            token: \"paren.lparen\",\r\n            regex: '{',\r\n            next: \"string_interp\"\r\n        })\r\n    ].concat(embeddableRules);\r\n\r\n    // backtick strings can have single interpolation, which accept\r\n    // \\w+ followed by an optional set of function call parens\r\n    this.$rules.bstring_interp_single = [\r\n        {\r\n            token: [\"identifier\", \"paren.lparen\"],\r\n            regex: '(\\\\w+)(\\\\()',\r\n            next: 'bstring_interp_single_call'\r\n        },\r\n        // identifier-only match ends this interp\r\n        ctxEnd({\r\n            token : \"identifier\",\r\n            regex : \"\\\\w*\"\r\n        })\r\n    ];\r\n    \r\n    // the call part of a bstring_interp_single\r\n    // is terminated by a close paren `)`, but\r\n    // can have nested parens.\r\n    this.$rules.bstring_interp_single_call = [\r\n        ctxBegin({\r\n            token: \"paren.lparen\",\r\n            regex: \"\\\\(\",\r\n            next: \"bstring_interp_single_call\"\r\n        }),\r\n        ctxEnd({\r\n            token: \"paren.rparen\",\r\n            regex: \"\\\\)\"\r\n        })\r\n    ].concat(embeddableRules);\r\n};\r\noop.inherits(SJSHighlightRules, TextHighlightRules);\r\n\r\nexports.SJSHighlightRules = SJSHighlightRules;\r\n});\r\n"]}