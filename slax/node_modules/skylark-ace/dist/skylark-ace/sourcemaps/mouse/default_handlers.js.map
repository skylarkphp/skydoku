{"version":3,"sources":["mouse/default_handlers.js"],"names":["define","require","exports","module","useragent","DefaultHandlers","mouseHandler","$clickSelection","editor","setDefaultHandler","this","onMouseDown","bind","onDoubleClick","onTripleClick","onQuadClick","onMouseWheel","onTouchMove","forEach","x","selectByLines","extendSelectionBy","selectByWords","calcRangeOrientation","range","cursor","start","row","end","cmp","column","anchor","ev","inSelection","pos","getDocumentPosition","mousedownEvent","button","getButton","getSelectionRange","isEmpty","selection","moveToPosition","textInput","onContextMenu","domEvent","isMozilla","preventDefault","time","Date","now","isFocused","focus","$focusTimeout","inMultiSelectMode","captureMouse","startSelect","_clicks","setState","waitForClickSelection","renderer","screenToTextCoordinates","y","getShiftKey","selectToPosition","select","scroller","setCapture","setStyle","comparePoint","orientedRange","setSelectionAnchor","scrollCursorIntoView","unitName","cmpStart","cmpEnd","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","unsetStyle","releaseCapture","focusWait","ax","ay","bx","by","distance","Math","sqrt","pow","session","getBracketRange","getWordRange","isMultiLine","contains","getLineRange","selectAll","getAccelKey","wheelY","wheelX","$lastScroll","t","vx","vy","allowed","prevScroll","timeStamp","dt","direction","abs","canScroll","isScrollableBy","speed","scrollBy","stop","_emit","call","prototype"],"mappings":"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","file":"../../mouse/default_handlers.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n * \r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n * \r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar useragent = require(\"../lib/useragent\");\r\n\r\nvar DRAG_OFFSET = 0; // pixels\r\nvar SCROLL_COOLDOWN_T = 550; // milliseconds\r\n\r\nfunction DefaultHandlers(mouseHandler) {\r\n    mouseHandler.$clickSelection = null;\r\n\r\n    var editor = mouseHandler.editor;\r\n    editor.setDefaultHandler(\"mousedown\", this.onMouseDown.bind(mouseHandler));\r\n    editor.setDefaultHandler(\"dblclick\", this.onDoubleClick.bind(mouseHandler));\r\n    editor.setDefaultHandler(\"tripleclick\", this.onTripleClick.bind(mouseHandler));\r\n    editor.setDefaultHandler(\"quadclick\", this.onQuadClick.bind(mouseHandler));\r\n    editor.setDefaultHandler(\"mousewheel\", this.onMouseWheel.bind(mouseHandler));\r\n    editor.setDefaultHandler(\"touchmove\", this.onTouchMove.bind(mouseHandler));\r\n\r\n    var exports = [\"select\", \"startSelect\", \"selectEnd\", \"selectAllEnd\", \"selectByWordsEnd\",\r\n        \"selectByLinesEnd\", \"dragWait\", \"dragWaitEnd\", \"focusWait\"];\r\n\r\n    exports.forEach(function(x) {\r\n        mouseHandler[x] = this[x];\r\n    }, this);\r\n\r\n    mouseHandler.selectByLines = this.extendSelectionBy.bind(mouseHandler, \"getLineRange\");\r\n    mouseHandler.selectByWords = this.extendSelectionBy.bind(mouseHandler, \"getWordRange\");\r\n}\r\n\r\n(function() {\r\n\r\n    this.onMouseDown = function(ev) {\r\n        var inSelection = ev.inSelection();\r\n        var pos = ev.getDocumentPosition();\r\n        this.mousedownEvent = ev;\r\n        var editor = this.editor;\r\n\r\n        var button = ev.getButton();\r\n        if (button !== 0) {\r\n            var selectionRange = editor.getSelectionRange();\r\n            var selectionEmpty = selectionRange.isEmpty();\r\n            if (selectionEmpty || button == 1)\r\n                editor.selection.moveToPosition(pos);\r\n            // 2: contextmenu, 1: linux paste\r\n            if (button == 2) {\r\n                editor.textInput.onContextMenu(ev.domEvent);\r\n                if (!useragent.isMozilla)\r\n                    ev.preventDefault();\r\n            }\r\n            // stopping event here breaks contextmenu on ff mac\r\n            // not stoping breaks it on chrome mac\r\n            return;\r\n        }\r\n\r\n        this.mousedownEvent.time = Date.now();\r\n        // if this click caused the editor to be focused should not clear the\r\n        // selection\r\n        if (inSelection && !editor.isFocused()) {\r\n            editor.focus();\r\n            if (this.$focusTimeout && !this.$clickSelection && !editor.inMultiSelectMode) {\r\n                this.setState(\"focusWait\");\r\n                this.captureMouse(ev);\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.captureMouse(ev);\r\n        this.startSelect(pos, ev.domEvent._clicks > 1);\r\n        return ev.preventDefault();\r\n    };\r\n\r\n    this.startSelect = function(pos, waitForClickSelection) {\r\n        pos = pos || this.editor.renderer.screenToTextCoordinates(this.x, this.y);\r\n        var editor = this.editor;\r\n        if (!this.mousedownEvent) return;\r\n        // allow double/triple click handlers to change selection\r\n        if (this.mousedownEvent.getShiftKey())\r\n            editor.selection.selectToPosition(pos);\r\n        else if (!waitForClickSelection)\r\n            editor.selection.moveToPosition(pos);\r\n        if (!waitForClickSelection)\r\n            this.select();\r\n        if (editor.renderer.scroller.setCapture) {\r\n            editor.renderer.scroller.setCapture();\r\n        }\r\n        editor.setStyle(\"ace_selecting\");\r\n        this.setState(\"select\");\r\n    };\r\n\r\n    this.select = function() {\r\n        var anchor, editor = this.editor;\r\n        var cursor = editor.renderer.screenToTextCoordinates(this.x, this.y);\r\n        if (this.$clickSelection) {\r\n            var cmp = this.$clickSelection.comparePoint(cursor);\r\n\r\n            if (cmp == -1) {\r\n                anchor = this.$clickSelection.end;\r\n            } else if (cmp == 1) {\r\n                anchor = this.$clickSelection.start;\r\n            } else {\r\n                var orientedRange = calcRangeOrientation(this.$clickSelection, cursor);\r\n                cursor = orientedRange.cursor;\r\n                anchor = orientedRange.anchor;\r\n            }\r\n            editor.selection.setSelectionAnchor(anchor.row, anchor.column);\r\n        }\r\n        editor.selection.selectToPosition(cursor);\r\n        editor.renderer.scrollCursorIntoView();\r\n    };\r\n\r\n    this.extendSelectionBy = function(unitName) {\r\n        var anchor, editor = this.editor;\r\n        var cursor = editor.renderer.screenToTextCoordinates(this.x, this.y);\r\n        var range = editor.selection[unitName](cursor.row, cursor.column);\r\n        if (this.$clickSelection) {\r\n            var cmpStart = this.$clickSelection.comparePoint(range.start);\r\n            var cmpEnd = this.$clickSelection.comparePoint(range.end);\r\n\r\n            if (cmpStart == -1 && cmpEnd <= 0) {\r\n                anchor = this.$clickSelection.end;\r\n                if (range.end.row != cursor.row || range.end.column != cursor.column)\r\n                    cursor = range.start;\r\n            } else if (cmpEnd == 1 && cmpStart >= 0) {\r\n                anchor = this.$clickSelection.start;\r\n                if (range.start.row != cursor.row || range.start.column != cursor.column)\r\n                    cursor = range.end;\r\n            } else if (cmpStart == -1 && cmpEnd == 1) {\r\n                cursor = range.end;\r\n                anchor = range.start;\r\n            } else {\r\n                var orientedRange = calcRangeOrientation(this.$clickSelection, cursor);\r\n                cursor = orientedRange.cursor;\r\n                anchor = orientedRange.anchor;\r\n            }\r\n            editor.selection.setSelectionAnchor(anchor.row, anchor.column);\r\n        }\r\n        editor.selection.selectToPosition(cursor);\r\n        editor.renderer.scrollCursorIntoView();\r\n    };\r\n\r\n    this.selectEnd =\r\n    this.selectAllEnd =\r\n    this.selectByWordsEnd =\r\n    this.selectByLinesEnd = function() {\r\n        this.$clickSelection = null;\r\n        this.editor.unsetStyle(\"ace_selecting\");\r\n        if (this.editor.renderer.scroller.releaseCapture) {\r\n            this.editor.renderer.scroller.releaseCapture();\r\n        }\r\n    };\r\n\r\n    this.focusWait = function() {\r\n        var distance = calcDistance(this.mousedownEvent.x, this.mousedownEvent.y, this.x, this.y);\r\n        var time = Date.now();\r\n\r\n        if (distance > DRAG_OFFSET || time - this.mousedownEvent.time > this.$focusTimeout)\r\n            this.startSelect(this.mousedownEvent.getDocumentPosition());\r\n    };\r\n\r\n    this.onDoubleClick = function(ev) {\r\n        var pos = ev.getDocumentPosition();\r\n        var editor = this.editor;\r\n        var session = editor.session;\r\n\r\n        var range = session.getBracketRange(pos);\r\n        if (range) {\r\n            if (range.isEmpty()) {\r\n                range.start.column--;\r\n                range.end.column++;\r\n            }\r\n            this.setState(\"select\");\r\n        } else {\r\n            range = editor.selection.getWordRange(pos.row, pos.column);\r\n            this.setState(\"selectByWords\");\r\n        }\r\n        this.$clickSelection = range;\r\n        this.select();\r\n    };\r\n\r\n    this.onTripleClick = function(ev) {\r\n        var pos = ev.getDocumentPosition();\r\n        var editor = this.editor;\r\n\r\n        this.setState(\"selectByLines\");\r\n        var range = editor.getSelectionRange();\r\n        if (range.isMultiLine() && range.contains(pos.row, pos.column)) {\r\n            this.$clickSelection = editor.selection.getLineRange(range.start.row);\r\n            this.$clickSelection.end = editor.selection.getLineRange(range.end.row).end;\r\n        } else {\r\n            this.$clickSelection = editor.selection.getLineRange(pos.row);\r\n        }\r\n        this.select();\r\n    };\r\n\r\n    this.onQuadClick = function(ev) {\r\n        var editor = this.editor;\r\n\r\n        editor.selectAll();\r\n        this.$clickSelection = editor.getSelectionRange();\r\n        this.setState(\"selectAll\");\r\n    };\r\n\r\n    this.onMouseWheel = function(ev) {\r\n        if (ev.getAccelKey())\r\n            return;\r\n\r\n        // shift wheel to horizontal scroll\r\n        if (ev.getShiftKey() && ev.wheelY && !ev.wheelX) {\r\n            ev.wheelX = ev.wheelY;\r\n            ev.wheelY = 0;\r\n        }\r\n        \r\n        var editor = this.editor;\r\n        \r\n        if (!this.$lastScroll)\r\n            this.$lastScroll = { t: 0, vx: 0, vy: 0, allowed: 0 };\r\n        \r\n        var prevScroll = this.$lastScroll;\r\n        var t = ev.domEvent.timeStamp;\r\n        var dt = t - prevScroll.t;\r\n        var vx = dt ? ev.wheelX / dt : prevScroll.vx;\r\n        var vy = dt ? ev.wheelY / dt : prevScroll.vy;\r\n        \r\n        // touchbar keeps sending scroll events after touchend, if we do not stop these events,\r\n        // users can't scrol editor without scrolling the parent node\r\n        if (dt < SCROLL_COOLDOWN_T) {\r\n            vx = (vx + prevScroll.vx) / 2;\r\n            vy = (vy + prevScroll.vy) / 2;\r\n        }\r\n        \r\n        var direction = Math.abs(vx / vy);\r\n        \r\n        var canScroll = false;\r\n        if (direction >= 1 && editor.renderer.isScrollableBy(ev.wheelX * ev.speed, 0))\r\n            canScroll = true;\r\n        if (direction <= 1 && editor.renderer.isScrollableBy(0, ev.wheelY * ev.speed))\r\n            canScroll = true;\r\n            \r\n        if (canScroll) {\r\n            prevScroll.allowed = t;\r\n        } else if (t - prevScroll.allowed < SCROLL_COOLDOWN_T) {\r\n            var isSlower = Math.abs(vx) <= 1.5 * Math.abs(prevScroll.vx)\r\n                && Math.abs(vy) <= 1.5 * Math.abs(prevScroll.vy);\r\n            if (isSlower) {\r\n                canScroll = true;\r\n                prevScroll.allowed = t;\r\n            }\r\n            else {\r\n                prevScroll.allowed = 0;\r\n            }\r\n        }\r\n        \r\n        prevScroll.t = t;\r\n        prevScroll.vx = vx;\r\n        prevScroll.vy = vy;\r\n\r\n        if (canScroll) {\r\n            editor.renderer.scrollBy(ev.wheelX * ev.speed, ev.wheelY * ev.speed);\r\n            return ev.stop();\r\n        }\r\n    };\r\n    \r\n    this.onTouchMove = function(ev) {\r\n        this.editor._emit(\"mousewheel\", ev);\r\n    };\r\n\r\n}).call(DefaultHandlers.prototype);\r\n\r\nexports.DefaultHandlers = DefaultHandlers;\r\n\r\nfunction calcDistance(ax, ay, bx, by) {\r\n    return Math.sqrt(Math.pow(bx - ax, 2) + Math.pow(by - ay, 2));\r\n}\r\n\r\nfunction calcRangeOrientation(range, cursor) {\r\n    if (range.start.row == range.end.row)\r\n        var cmp = 2 * cursor.column - range.start.column - range.end.column;\r\n    else if (range.start.row == range.end.row - 1 && !range.start.column && !range.end.column)\r\n        var cmp = cursor.column - 4;\r\n    else\r\n        var cmp = 2 * cursor.row - range.start.row - range.end.row;\r\n\r\n    if (cmp < 0)\r\n        return {cursor: range.start, anchor: range.end};\r\n    else\r\n        return {cursor: range.end, anchor: range.start};\r\n}\r\n\r\n});\r\n"]}