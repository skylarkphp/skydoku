{"version":3,"sources":["autocomplete.js"],"names":["define","require","exports","module","HashHandler","AcePopup","util","lang","dom","snippetManager","Autocomplete","this","autoInsert","autoSelect","exactMatch","gatherCompletionsId","keyboardHandler","bindKeys","commands","blurListener","bind","changeListener","mousedownListener","mousewheelListener","changeTimer","delayedCall","updateCompletions","tooltipTimer","updateDocTooltip","$init","popup","document","body","documentElement","on","e","insertMatch","stop","focus","editor","getPopup","openPopup","prefix","keepPopupPosition","setData","completions","filtered","filterText","keyBinding","addKeyboardHandler","renderer","setRow","detach","setTheme","getTheme","setFontSize","getFontSize","lineHeight","layerConfig","pos","$cursorLayer","getPixelPosition","base","left","getTextLeftOffset","rect","container","getBoundingClientRect","top","offset","scrollLeft","gutterWidth","show","removeKeyboardHandler","off","cancel","hideDocTooltip","isOpen","hide","activated","cursor","selection","lead","row","column","schedule","el","activeElement","text","textInput","getElement","fromTooltip","relatedTarget","tooltipNode","contains","parentNode","goTo","where","getRow","max","session","getLength","data","options","getData","completer","range","ranges","getAllRanges","i","start","length","remove","snippet","insertSnippet","execCommand","value","Up","Down","Ctrl-Up|Ctrl-Home","Ctrl-Down|Ctrl-End","Esc","Return","Shift-Return","deleteSuffix","Tab","result","tabstopManager","PageUp","gotoPageUp","PageDown","gotoPageDown","gatherCompletions","callback","getSession","getCursorPosition","getCompletionPrefix","doc","createAnchor","$insertRight","matches","total","completers","forEach","getCompletions","err","results","concat","finished","showPopup","getTextRange","end","setFilter","_id","detachIfFinished","indexOf","FilteredList","cancelContextMenu","$mouseHandler","all","selected","getHoveredRow","some","getDocTooltip","docText","docHTML","showDocTooltip","item","createElement","className","style","margin","pointerEvents","tabIndex","onblur","onclick","onTooltipClick","innerHTML","textContent","appendChild","bottom","display","window","innerWidth","right","isTopdown","offsetTop","offsetHeight","isFocused","removeChild","a","target","nodeName","href","rel","call","prototype","startCommand","name","exec","bindKey","array","str","lastIndexOf","prev","filterCompletions","sort","b","$score","caption","filter","items","needle","upper","toUpperCase","lower","toLowerCase","loop","index","distance","lastIndex","matchMask","penalty","substr","fullMatchIndex","j","i1","i2","score","push"],"mappings":"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","file":"../autocomplete.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2012, Ajax.org B.V.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar HashHandler = require(\"./keyboard/hash_handler\").HashHandler;\r\nvar AcePopup = require(\"./autocomplete/popup\").AcePopup;\r\nvar util = require(\"./autocomplete/util\");\r\nvar event = require(\"./lib/event\");\r\nvar lang = require(\"./lib/lang\");\r\nvar dom = require(\"./lib/dom\");\r\nvar snippetManager = require(\"./snippets\").snippetManager;\r\n\r\nvar Autocomplete = function() {\r\n    this.autoInsert = false;\r\n    this.autoSelect = true;\r\n    this.exactMatch = false;\r\n    this.gatherCompletionsId = 0;\r\n    this.keyboardHandler = new HashHandler();\r\n    this.keyboardHandler.bindKeys(this.commands);\r\n\r\n    this.blurListener = this.blurListener.bind(this);\r\n    this.changeListener = this.changeListener.bind(this);\r\n    this.mousedownListener = this.mousedownListener.bind(this);\r\n    this.mousewheelListener = this.mousewheelListener.bind(this);\r\n\r\n    this.changeTimer = lang.delayedCall(function() {\r\n        this.updateCompletions(true);\r\n    }.bind(this));\r\n\r\n    this.tooltipTimer = lang.delayedCall(this.updateDocTooltip.bind(this), 50);\r\n};\r\n\r\n(function() {\r\n\r\n    this.$init = function() {\r\n        this.popup = new AcePopup(document.body || document.documentElement);\r\n        this.popup.on(\"click\", function(e) {\r\n            this.insertMatch();\r\n            e.stop();\r\n        }.bind(this));\r\n        this.popup.focus = this.editor.focus.bind(this.editor);\r\n        this.popup.on(\"show\", this.tooltipTimer.bind(null, null));\r\n        this.popup.on(\"select\", this.tooltipTimer.bind(null, null));\r\n        this.popup.on(\"changeHoverMarker\", this.tooltipTimer.bind(null, null));\r\n        return this.popup;\r\n    };\r\n\r\n    this.getPopup = function() {\r\n        return this.popup || this.$init();\r\n    };\r\n\r\n    this.openPopup = function(editor, prefix, keepPopupPosition) {\r\n        if (!this.popup)\r\n            this.$init();\r\n\r\n        this.popup.autoSelect = this.autoSelect;\r\n\r\n        this.popup.setData(this.completions.filtered, this.completions.filterText);\r\n\r\n        editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\r\n        \r\n        var renderer = editor.renderer;\r\n        this.popup.setRow(this.autoSelect ? 0 : -1);\r\n        if (!keepPopupPosition) {\r\n            this.popup.setTheme(editor.getTheme());\r\n            this.popup.setFontSize(editor.getFontSize());\r\n\r\n            var lineHeight = renderer.layerConfig.lineHeight;\r\n\r\n            var pos = renderer.$cursorLayer.getPixelPosition(this.base, true);\r\n            pos.left -= this.popup.getTextLeftOffset();\r\n\r\n            var rect = editor.container.getBoundingClientRect();\r\n            pos.top += rect.top - renderer.layerConfig.offset;\r\n            pos.left += rect.left - editor.renderer.scrollLeft;\r\n            pos.left += renderer.gutterWidth;\r\n\r\n            this.popup.show(pos, lineHeight);\r\n        } else if (keepPopupPosition && !prefix) {\r\n            this.detach();\r\n        }\r\n    };\r\n\r\n    this.detach = function() {\r\n        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);\r\n        this.editor.off(\"changeSelection\", this.changeListener);\r\n        this.editor.off(\"blur\", this.blurListener);\r\n        this.editor.off(\"mousedown\", this.mousedownListener);\r\n        this.editor.off(\"mousewheel\", this.mousewheelListener);\r\n        this.changeTimer.cancel();\r\n        this.hideDocTooltip();\r\n\r\n        this.gatherCompletionsId += 1;\r\n        if (this.popup && this.popup.isOpen)\r\n            this.popup.hide();\r\n\r\n        if (this.base)\r\n            this.base.detach();\r\n        this.activated = false;\r\n        this.completions = this.base = null;\r\n    };\r\n\r\n    this.changeListener = function(e) {\r\n        var cursor = this.editor.selection.lead;\r\n        if (cursor.row != this.base.row || cursor.column < this.base.column) {\r\n            this.detach();\r\n        }\r\n        if (this.activated)\r\n            this.changeTimer.schedule();\r\n        else\r\n            this.detach();\r\n    };\r\n\r\n    this.blurListener = function(e) {\r\n        // we have to check if activeElement is a child of popup because\r\n        // on IE preventDefault doesn't stop scrollbar from being focussed\r\n        var el = document.activeElement;\r\n        var text = this.editor.textInput.getElement();\r\n        var fromTooltip = e.relatedTarget && this.tooltipNode && this.tooltipNode.contains(e.relatedTarget);\r\n        var container = this.popup && this.popup.container;\r\n        if (el != text && el.parentNode != container && !fromTooltip\r\n            && el != this.tooltipNode && e.relatedTarget != text\r\n        ) {\r\n            this.detach();\r\n        }\r\n    };\r\n\r\n    this.mousedownListener = function(e) {\r\n        this.detach();\r\n    };\r\n\r\n    this.mousewheelListener = function(e) {\r\n        this.detach();\r\n    };\r\n\r\n    this.goTo = function(where) {\r\n        var row = this.popup.getRow();\r\n        var max = this.popup.session.getLength() - 1;\r\n\r\n        switch(where) {\r\n            case \"up\": row = row <= 0 ? max : row - 1; break;\r\n            case \"down\": row = row >= max ? -1 : row + 1; break;\r\n            case \"start\": row = 0; break;\r\n            case \"end\": row = max; break;\r\n        }\r\n\r\n        this.popup.setRow(row);\r\n    };\r\n\r\n    this.insertMatch = function(data, options) {\r\n        if (!data)\r\n            data = this.popup.getData(this.popup.getRow());\r\n        if (!data)\r\n            return false;\r\n\r\n        if (data.completer && data.completer.insertMatch) {\r\n            data.completer.insertMatch(this.editor, data);\r\n        } else {\r\n            // TODO add support for options.deleteSuffix\r\n            if (this.completions.filterText) {\r\n                var ranges = this.editor.selection.getAllRanges();\r\n                for (var i = 0, range; range = ranges[i]; i++) {\r\n                    range.start.column -= this.completions.filterText.length;\r\n                    this.editor.session.remove(range);\r\n                }\r\n            }\r\n            if (data.snippet)\r\n                snippetManager.insertSnippet(this.editor, data.snippet);\r\n            else\r\n                this.editor.execCommand(\"insertstring\", data.value || data);\r\n        }\r\n        this.detach();\r\n    };\r\n\r\n\r\n    this.commands = {\r\n        \"Up\": function(editor) { editor.completer.goTo(\"up\"); },\r\n        \"Down\": function(editor) { editor.completer.goTo(\"down\"); },\r\n        \"Ctrl-Up|Ctrl-Home\": function(editor) { editor.completer.goTo(\"start\"); },\r\n        \"Ctrl-Down|Ctrl-End\": function(editor) { editor.completer.goTo(\"end\"); },\r\n\r\n        \"Esc\": function(editor) { editor.completer.detach(); },\r\n        \"Return\": function(editor) { return editor.completer.insertMatch(); },\r\n        \"Shift-Return\": function(editor) { editor.completer.insertMatch(null, {deleteSuffix: true}); },\r\n        \"Tab\": function(editor) {\r\n            var result = editor.completer.insertMatch();\r\n            if (!result && !editor.tabstopManager)\r\n                editor.completer.goTo(\"down\");\r\n            else\r\n                return result;\r\n        },\r\n\r\n        \"PageUp\": function(editor) { editor.completer.popup.gotoPageUp(); },\r\n        \"PageDown\": function(editor) { editor.completer.popup.gotoPageDown(); }\r\n    };\r\n\r\n    this.gatherCompletions = function(editor, callback) {\r\n        var session = editor.getSession();\r\n        var pos = editor.getCursorPosition();\r\n\r\n        var prefix = util.getCompletionPrefix(editor);\r\n\r\n        this.base = session.doc.createAnchor(pos.row, pos.column - prefix.length);\r\n        this.base.$insertRight = true;\r\n\r\n        var matches = [];\r\n        var total = editor.completers.length;\r\n        editor.completers.forEach(function(completer, i) {\r\n            completer.getCompletions(editor, session, pos, prefix, function(err, results) {\r\n                if (!err && results)\r\n                    matches = matches.concat(results);\r\n                // Fetch prefix again, because they may have changed by now\r\n                callback(null, {\r\n                    prefix: util.getCompletionPrefix(editor),\r\n                    matches: matches,\r\n                    finished: (--total === 0)\r\n                });\r\n            });\r\n        });\r\n        return true;\r\n    };\r\n\r\n    this.showPopup = function(editor) {\r\n        if (this.editor)\r\n            this.detach();\r\n\r\n        this.activated = true;\r\n\r\n        this.editor = editor;\r\n        if (editor.completer != this) {\r\n            if (editor.completer)\r\n                editor.completer.detach();\r\n            editor.completer = this;\r\n        }\r\n\r\n        editor.on(\"changeSelection\", this.changeListener);\r\n        editor.on(\"blur\", this.blurListener);\r\n        editor.on(\"mousedown\", this.mousedownListener);\r\n        editor.on(\"mousewheel\", this.mousewheelListener);\r\n\r\n        this.updateCompletions();\r\n    };\r\n\r\n    this.updateCompletions = function(keepPopupPosition) {\r\n        if (keepPopupPosition && this.base && this.completions) {\r\n            var pos = this.editor.getCursorPosition();\r\n            var prefix = this.editor.session.getTextRange({start: this.base, end: pos});\r\n            if (prefix == this.completions.filterText)\r\n                return;\r\n            this.completions.setFilter(prefix);\r\n            if (!this.completions.filtered.length)\r\n                return this.detach();\r\n            if (this.completions.filtered.length == 1\r\n            && this.completions.filtered[0].value == prefix\r\n            && !this.completions.filtered[0].snippet)\r\n                return this.detach();\r\n            this.openPopup(this.editor, prefix, keepPopupPosition);\r\n            return;\r\n        }\r\n\r\n        // Save current gatherCompletions session, session is close when a match is insert\r\n        var _id = this.gatherCompletionsId;\r\n        this.gatherCompletions(this.editor, function(err, results) {\r\n            // Only detach if result gathering is finished\r\n            var detachIfFinished = function() {\r\n                if (!results.finished) return;\r\n                return this.detach();\r\n            }.bind(this);\r\n\r\n            var prefix = results.prefix;\r\n            var matches = results && results.matches;\r\n\r\n            if (!matches || !matches.length)\r\n                return detachIfFinished();\r\n\r\n            // Wrong prefix or wrong session -> ignore\r\n            if (prefix.indexOf(results.prefix) !== 0 || _id != this.gatherCompletionsId)\r\n                return;\r\n\r\n            this.completions = new FilteredList(matches);\r\n\r\n            if (this.exactMatch)\r\n                this.completions.exactMatch = true;\r\n\r\n            this.completions.setFilter(prefix);\r\n            var filtered = this.completions.filtered;\r\n\r\n            // No results\r\n            if (!filtered.length)\r\n                return detachIfFinished();\r\n\r\n            // One result equals to the prefix\r\n            if (filtered.length == 1 && filtered[0].value == prefix && !filtered[0].snippet)\r\n                return detachIfFinished();\r\n\r\n            // Autoinsert if one result\r\n            if (this.autoInsert && filtered.length == 1 && results.finished)\r\n                return this.insertMatch(filtered[0]);\r\n\r\n            this.openPopup(this.editor, prefix, keepPopupPosition);\r\n        }.bind(this));\r\n    };\r\n\r\n    this.cancelContextMenu = function() {\r\n        this.editor.$mouseHandler.cancelContextMenu();\r\n    };\r\n\r\n    this.updateDocTooltip = function() {\r\n        var popup = this.popup;\r\n        var all = popup.data;\r\n        var selected = all && (all[popup.getHoveredRow()] || all[popup.getRow()]);\r\n        var doc = null;\r\n        if (!selected || !this.editor || !this.popup.isOpen)\r\n            return this.hideDocTooltip();\r\n        this.editor.completers.some(function(completer) {\r\n            if (completer.getDocTooltip)\r\n                doc = completer.getDocTooltip(selected);\r\n            return doc;\r\n        });\r\n        if (!doc)\r\n            doc = selected;\r\n\r\n        if (typeof doc == \"string\")\r\n            doc = {docText: doc};\r\n        if (!doc || !(doc.docHTML || doc.docText))\r\n            return this.hideDocTooltip();\r\n        this.showDocTooltip(doc);\r\n    };\r\n\r\n    this.showDocTooltip = function(item) {\r\n        if (!this.tooltipNode) {\r\n            this.tooltipNode = dom.createElement(\"div\");\r\n            this.tooltipNode.className = \"ace_tooltip ace_doc-tooltip\";\r\n            this.tooltipNode.style.margin = 0;\r\n            this.tooltipNode.style.pointerEvents = \"auto\";\r\n            this.tooltipNode.tabIndex = -1;\r\n            this.tooltipNode.onblur = this.blurListener.bind(this);\r\n            this.tooltipNode.onclick = this.onTooltipClick.bind(this);\r\n        }\r\n\r\n        var tooltipNode = this.tooltipNode;\r\n        if (item.docHTML) {\r\n            tooltipNode.innerHTML = item.docHTML;\r\n        } else if (item.docText) {\r\n            tooltipNode.textContent = item.docText;\r\n        }\r\n\r\n        if (!tooltipNode.parentNode)\r\n            document.body.appendChild(tooltipNode);\r\n        var popup = this.popup;\r\n        var rect = popup.container.getBoundingClientRect();\r\n        tooltipNode.style.top = popup.container.style.top;\r\n        tooltipNode.style.bottom = popup.container.style.bottom;\r\n\r\n        tooltipNode.style.display = \"block\";\r\n        if (window.innerWidth - rect.right < 320) {\r\n            if (rect.left < 320) {\r\n                if(popup.isTopdown) {\r\n                    tooltipNode.style.top = rect.bottom + \"px\";\r\n                    tooltipNode.style.left = rect.left + \"px\";\r\n                    tooltipNode.style.right = \"\";\r\n                    tooltipNode.style.bottom = \"\";\r\n                } else {\r\n                    tooltipNode.style.top = popup.container.offsetTop - tooltipNode.offsetHeight + \"px\";\r\n                    tooltipNode.style.left = rect.left + \"px\";\r\n                    tooltipNode.style.right = \"\";\r\n                    tooltipNode.style.bottom = \"\";\r\n                }\r\n            } else {\r\n                tooltipNode.style.right = window.innerWidth - rect.left + \"px\";\r\n                tooltipNode.style.left = \"\";\r\n            }\r\n        } else {\r\n            tooltipNode.style.left = (rect.right + 1) + \"px\";\r\n            tooltipNode.style.right = \"\";\r\n        }\r\n    };\r\n\r\n    this.hideDocTooltip = function() {\r\n        this.tooltipTimer.cancel();\r\n        if (!this.tooltipNode) return;\r\n        var el = this.tooltipNode;\r\n        if (!this.editor.isFocused() && document.activeElement == el)\r\n            this.editor.focus();\r\n        this.tooltipNode = null;\r\n        if (el.parentNode)\r\n            el.parentNode.removeChild(el);\r\n    };\r\n    \r\n    this.onTooltipClick = function(e) {\r\n        var a = e.target;\r\n        while (a && a != this.tooltipNode) {\r\n            if (a.nodeName == \"A\" && a.href) {\r\n                a.rel = \"noreferrer\";\r\n                a.target = \"_blank\";\r\n                break;\r\n            }\r\n            a = a.parentNode;\r\n        }\r\n    };\r\n\r\n}).call(Autocomplete.prototype);\r\n\r\nAutocomplete.startCommand = {\r\n    name: \"startAutocomplete\",\r\n    exec: function(editor) {\r\n        if (!editor.completer)\r\n            editor.completer = new Autocomplete();\r\n        editor.completer.autoInsert = false;\r\n        editor.completer.autoSelect = true;\r\n        editor.completer.showPopup(editor);\r\n        // prevent ctrl-space opening context menu on firefox on mac\r\n        editor.completer.cancelContextMenu();\r\n    },\r\n    bindKey: \"Ctrl-Space|Ctrl-Shift-Space|Alt-Space\"\r\n};\r\n\r\nvar FilteredList = function(array, filterText) {\r\n    this.all = array;\r\n    this.filtered = array;\r\n    this.filterText = filterText || \"\";\r\n    this.exactMatch = false;\r\n};\r\n(function(){\r\n    this.setFilter = function(str) {\r\n        if (str.length > this.filterText && str.lastIndexOf(this.filterText, 0) === 0)\r\n            var matches = this.filtered;\r\n        else\r\n            var matches = this.all;\r\n\r\n        this.filterText = str;\r\n        matches = this.filterCompletions(matches, this.filterText);\r\n        matches = matches.sort(function(a, b) {\r\n            return b.exactMatch - a.exactMatch || b.$score - a.$score \r\n                || (a.caption || a.value) < (b.caption || b.value);\r\n        });\r\n\r\n        // make unique\r\n        var prev = null;\r\n        matches = matches.filter(function(item){\r\n            var caption = item.snippet || item.caption || item.value;\r\n            if (caption === prev) return false;\r\n            prev = caption;\r\n            return true;\r\n        });\r\n\r\n        this.filtered = matches;\r\n    };\r\n    this.filterCompletions = function(items, needle) {\r\n        var results = [];\r\n        var upper = needle.toUpperCase();\r\n        var lower = needle.toLowerCase();\r\n        loop: for (var i = 0, item; item = items[i]; i++) {\r\n            var caption = item.caption || item.value || item.snippet;\r\n            if (!caption) continue;\r\n            var lastIndex = -1;\r\n            var matchMask = 0;\r\n            var penalty = 0;\r\n            var index, distance;\r\n\r\n            if (this.exactMatch) {\r\n                if (needle !== caption.substr(0, needle.length))\r\n                    continue loop;\r\n            } else {\r\n                /**\r\n                 * It is for situation then, for example, we find some like 'tab' in item.value=\"Check the table\"\r\n                 * and want to see \"Check the TABle\" but see \"Check The tABle\".\r\n                 */\r\n                var fullMatchIndex = caption.toLowerCase().indexOf(lower);\r\n                if (fullMatchIndex > -1) {\r\n                    penalty = fullMatchIndex;\r\n                } else {\r\n                    // caption char iteration is faster in Chrome but slower in Firefox, so lets use indexOf\r\n                    for (var j = 0; j < needle.length; j++) {\r\n                        // TODO add penalty on case mismatch\r\n                        var i1 = caption.indexOf(lower[j], lastIndex + 1);\r\n                        var i2 = caption.indexOf(upper[j], lastIndex + 1);\r\n                        index = (i1 >= 0) ? ((i2 < 0 || i1 < i2) ? i1 : i2) : i2;\r\n                        if (index < 0)\r\n                            continue loop;\r\n                        distance = index - lastIndex - 1;\r\n                        if (distance > 0) {\r\n                            // first char mismatch should be more sensitive\r\n                            if (lastIndex === -1)\r\n                                penalty += 10;\r\n                            penalty += distance;\r\n                            matchMask = matchMask | (1 << j);\r\n                        }\r\n                        lastIndex = index;\r\n                    }\r\n                }\r\n            }\r\n            item.matchMask = matchMask;\r\n            item.exactMatch = penalty ? 0 : 1;\r\n            item.$score = (item.score || 0) - penalty;\r\n            results.push(item);\r\n        }\r\n        return results;\r\n    };\r\n}).call(FilteredList.prototype);\r\n\r\nexports.Autocomplete = Autocomplete;\r\nexports.FilteredList = FilteredList;\r\n\r\n});\r\n"]}