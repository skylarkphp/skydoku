{"version":3,"sources":["edit_session/fold.js"],"names":["define","require","exports","module","Range","RangeList","oop","Fold","range","placeholder","this","foldLine","start","end","sameRow","row","subFolds","ranges","consumePoint","point","anchor","column","restorePoint","inherits","toString","setFoldLine","forEach","fold","clone","subFold","push","collapseChildren","addSubFold","isEqual","containsRange","Error","i","cmp","length","compare","afterStart","j","splice","restoreRange","call","prototype"],"mappings":";;;;;;;AA8BAA,OAAO,SAASC,QAASC,QAASC,QAClC,aAEYF,QAAQ,YAAYG,MAAhC,IACIC,EAAYJ,QAAQ,iBAAiBI,UACrCC,EAAML,QAAQ,cAIdM,EAAOL,QAAQK,KAAO,SAASC,EAAOC,GACtCC,KAAKC,SAAW,KAChBD,KAAKD,YAAcA,EACnBC,KAAKF,MAAQA,EACbE,KAAKE,MAAQJ,EAAMI,MACnBF,KAAKG,IAAML,EAAMK,IAEjBH,KAAKI,QAAUN,EAAMI,MAAMG,KAAOP,EAAMK,IAAIE,IAC5CL,KAAKM,SAAWN,KAAKO,WAyEzB,SAASC,EAAaC,EAAOC,GACzBD,EAAMJ,KAAOK,EAAOL,IACH,GAAbI,EAAMJ,MACNI,EAAME,QAAUD,EAAOC,QAM/B,SAASC,EAAaH,EAAOC,GACR,GAAbD,EAAMJ,MACNI,EAAME,QAAUD,EAAOC,QAC3BF,EAAMJ,KAAOK,EAAOL,IAlFxBT,EAAIiB,SAAShB,EAAMF,GAEnB,WAEIK,KAAKc,SAAW,WACZ,MAAO,IAAMd,KAAKD,YAAc,KAAOC,KAAKF,MAAMgB,YAGtDd,KAAKe,YAAc,SAASd,GACxBD,KAAKC,SAAWA,EAChBD,KAAKM,SAASU,QAAQ,SAASC,GAC3BA,EAAKF,YAAYd,MAIzBD,KAAKkB,MAAQ,WACT,IAAIpB,EAAQE,KAAKF,MAAMoB,QACnBD,EAAO,IAAIpB,EAAKC,EAAOE,KAAKD,aAKhC,OAJAC,KAAKM,SAASU,QAAQ,SAASG,GAC3BF,EAAKX,SAASc,KAAKD,EAAQD,WAE/BD,EAAKI,iBAAmBrB,KAAKqB,iBACtBJ,GAGXjB,KAAKsB,WAAa,SAASL,GACvB,IAAIjB,KAAKF,MAAMyB,QAAQN,GAAvB,CAGA,IAAKjB,KAAKF,MAAM0B,cAAcP,GAC1B,MAAM,IAAIQ,MAAM,+CAAiDR,EAAKnB,MAAQE,KAAKF,OA6C/F,IAAsBA,EAAOY,EAAPZ,EA1CDmB,EA0CQP,EA1CFV,KAAKE,MA2C5BM,EAAaV,EAAMI,MAAOQ,GAC1BF,EAAaV,EAAMK,IAAKO,GAzCpB,IADA,IAAIL,EAAMY,EAAKf,MAAMG,IAAKM,EAASM,EAAKf,MAAMS,OACrCe,EAAI,EAAGC,GAAO,EAAGD,EAAI1B,KAAKM,SAASsB,QAE7B,IADXD,EAAM3B,KAAKM,SAASoB,GAAG5B,MAAM+B,QAAQxB,EAAKM,IADMe,KAKpD,IAAII,EAAa9B,KAAKM,SAASoB,GAE/B,GAAW,GAAPC,EACA,OAAOG,EAAWR,WAAWL,GAG7BZ,EAAMY,EAAKnB,MAAMK,IAAIE,IAAKM,EAASM,EAAKnB,MAAMK,IAAIQ,OAAtD,IACSoB,EAAIL,EAAb,IAAgBC,GAAO,EAAGI,EAAI/B,KAAKM,SAASsB,QAE7B,IADXD,EAAM3B,KAAKM,SAASyB,GAAGjC,MAAM+B,QAAQxB,EAAKM,IADMoB,KAKrC/B,KAAKM,SAASyB,GAE7B,GAAW,GAAPJ,EACA,MAAM,IAAIF,MAAM,+CAAiDR,EAAKnB,MAAQE,KAAKF,OAEnEE,KAAKM,SAAS0B,OAAON,EAAGK,EAAIL,EAAGT,GAGnD,OAFAA,EAAKF,YAAYf,KAAKC,UAEfgB,IAGXjB,KAAKiC,aAAe,SAASnC,GACzB,OAmBR,SAAsBA,EAAOY,GACzBE,EAAad,EAAMI,MAAOQ,GAC1BE,EAAad,EAAMK,IAAKO,GArBbuB,CAAanC,EAAOE,KAAKE,SAGrCgC,KAAKrC,EAAKsC","file":"../../edit_session/fold.js","sourcesContent":["/* ***** BEGIN LICENSE BLOCK *****\r\n * Distributed under the BSD license:\r\n *\r\n * Copyright (c) 2010, Ajax.org B.V.\r\n * All rights reserved.\r\n * \r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *     * Redistributions of source code must retain the above copyright\r\n *       notice, this list of conditions and the following disclaimer.\r\n *     * Redistributions in binary form must reproduce the above copyright\r\n *       notice, this list of conditions and the following disclaimer in the\r\n *       documentation and/or other materials provided with the distribution.\r\n *     * Neither the name of Ajax.org B.V. nor the\r\n *       names of its contributors may be used to endorse or promote products\r\n *       derived from this software without specific prior written permission.\r\n * \r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\r\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n *\r\n * ***** END LICENSE BLOCK ***** */\r\n\r\ndefine(function(require, exports, module) {\r\n\"use strict\";\r\n\r\nvar Range = require(\"../range\").Range;\r\nvar RangeList = require(\"../range_list\").RangeList;\r\nvar oop = require(\"../lib/oop\");\r\n/*\r\n * Simple fold-data struct.\r\n **/\r\nvar Fold = exports.Fold = function(range, placeholder) {\r\n    this.foldLine = null;\r\n    this.placeholder = placeholder;\r\n    this.range = range;\r\n    this.start = range.start;\r\n    this.end = range.end;\r\n\r\n    this.sameRow = range.start.row == range.end.row;\r\n    this.subFolds = this.ranges = [];\r\n};\r\n\r\noop.inherits(Fold, RangeList);\r\n\r\n(function() {\r\n\r\n    this.toString = function() {\r\n        return '\"' + this.placeholder + '\" ' + this.range.toString();\r\n    };\r\n\r\n    this.setFoldLine = function(foldLine) {\r\n        this.foldLine = foldLine;\r\n        this.subFolds.forEach(function(fold) {\r\n            fold.setFoldLine(foldLine);\r\n        });\r\n    };\r\n\r\n    this.clone = function() {\r\n        var range = this.range.clone();\r\n        var fold = new Fold(range, this.placeholder);\r\n        this.subFolds.forEach(function(subFold) {\r\n            fold.subFolds.push(subFold.clone());\r\n        });\r\n        fold.collapseChildren = this.collapseChildren;\r\n        return fold;\r\n    };\r\n\r\n    this.addSubFold = function(fold) {\r\n        if (this.range.isEqual(fold))\r\n            return;\r\n\r\n        if (!this.range.containsRange(fold))\r\n            throw new Error(\"A fold can't intersect already existing fold\" + fold.range + this.range);\r\n\r\n        // transform fold to local coordinates\r\n        consumeRange(fold, this.start);\r\n\r\n        var row = fold.start.row, column = fold.start.column;\r\n        for (var i = 0, cmp = -1; i < this.subFolds.length; i++) {\r\n            cmp = this.subFolds[i].range.compare(row, column);\r\n            if (cmp != 1)\r\n                break;\r\n        }\r\n        var afterStart = this.subFolds[i];\r\n\r\n        if (cmp == 0)\r\n            return afterStart.addSubFold(fold);\r\n\r\n        // cmp == -1\r\n        var row = fold.range.end.row, column = fold.range.end.column;\r\n        for (var j = i, cmp = -1; j < this.subFolds.length; j++) {\r\n            cmp = this.subFolds[j].range.compare(row, column);\r\n            if (cmp != 1)\r\n                break;\r\n        }\r\n        var afterEnd = this.subFolds[j];\r\n\r\n        if (cmp == 0)\r\n            throw new Error(\"A fold can't intersect already existing fold\" + fold.range + this.range);\r\n\r\n        var consumedFolds = this.subFolds.splice(i, j - i, fold);\r\n        fold.setFoldLine(this.foldLine);\r\n\r\n        return fold;\r\n    };\r\n    \r\n    this.restoreRange = function(range) {\r\n        return restoreRange(range, this.start);\r\n    };\r\n\r\n}).call(Fold.prototype);\r\n\r\nfunction consumePoint(point, anchor) {\r\n    point.row -= anchor.row;\r\n    if (point.row == 0)\r\n        point.column -= anchor.column;\r\n}\r\nfunction consumeRange(range, anchor) {\r\n    consumePoint(range.start, anchor);\r\n    consumePoint(range.end, anchor);\r\n}\r\nfunction restorePoint(point, anchor) {\r\n    if (point.row == 0)\r\n        point.column += anchor.column;\r\n    point.row += anchor.row;\r\n}\r\nfunction restoreRange(range, anchor) {\r\n    restorePoint(range.start, anchor);\r\n    restorePoint(range.end, anchor);\r\n}\r\n\r\n});\r\n"]}