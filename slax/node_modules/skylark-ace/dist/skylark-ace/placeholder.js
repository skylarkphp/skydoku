/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(t,s,e){"use strict";var o=t("./range").Range,i=t("./lib/event_emitter").EventEmitter,n=t("./lib/oop"),h=function(t,s,e,o,i,n){var h=this;this.length=s,this.session=t,this.doc=t.getDocument(),this.mainClass=i,this.othersClass=n,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate),this.$others=o,this.$onCursorChange=function(){setTimeout(function(){h.onCursorChange()})},this.$pos=e;var r=t.getUndoManager().$undoStack||t.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=r.length,this.setup(),t.selection.on("changeCursor",this.$onCursorChange)};(function(){n.implement(this,i),this.setup=function(){var t=this,s=this.doc,e=this.session;this.selectionBefore=e.selection.toJSON(),e.selection.inMultiSelectMode&&e.selection.toSingleRange(),this.pos=s.createAnchor(this.$pos.row,this.$pos.column);var i=this.pos;i.$insertRight=!0,i.detach(),i.markerId=e.addMarker(new o(i.row,i.column,i.row,i.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(e){var o=s.createAnchor(e.row,e.column);o.$insertRight=!0,o.detach(),t.others.push(o)}),e.setUndoSelect(!1)},this.showOtherMarkers=function(){if(!this.othersActive){var t=this.session,s=this;this.othersActive=!0,this.others.forEach(function(e){e.markerId=t.addMarker(new o(e.row,e.column,e.row,e.column+s.length),s.othersClass,null,!1)})}},this.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var t=0;t<this.others.length;t++)this.session.removeMarker(this.others[t].markerId)}},this.onUpdate=function(t){if(this.$updating)return this.updateAnchors(t);var s=t;if(s.start.row===s.end.row&&s.start.row===this.pos.row){this.$updating=!0;var e="insert"===t.action?s.end.column-s.start.column:s.start.column-s.end.column,i=s.start.column>=this.pos.column&&s.start.column<=this.pos.column+this.length+1,n=s.start.column-this.pos.column;if(this.updateAnchors(t),i&&(this.length+=e),i&&!this.session.$fromUndo)if("insert"===t.action)for(var h=this.others.length-1;h>=0;h--){var r={row:(a=this.others[h]).row,column:a.column+n};this.doc.insertMergedLines(r,t.lines)}else if("remove"===t.action)for(h=this.others.length-1;h>=0;h--){var a;r={row:(a=this.others[h]).row,column:a.column+n};this.doc.remove(new o(r.row,r.column,r.row,r.column-e))}this.$updating=!1,this.updateMarkers()}},this.updateAnchors=function(t){this.pos.onChange(t);for(var s=this.others.length;s--;)this.others[s].onChange(t);this.updateMarkers()},this.updateMarkers=function(){if(!this.$updating){var t=this,s=this.session,e=function(e,i){s.removeMarker(e.markerId),e.markerId=s.addMarker(new o(e.row,e.column,e.row,e.column+t.length),i,null,!1)};e(this.pos,this.mainClass);for(var i=this.others.length;i--;)e(this.others[i],this.othersClass)}},this.onCursorChange=function(t){if(!this.$updating&&this.session){var s=this.session.selection.getCursor();s.row===this.pos.row&&s.column>=this.pos.column&&s.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",t)):(this.hideOtherMarkers(),this._emit("cursorLeave",t))}},this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.removeEventListener("change",this.$onUpdate),this.session.selection.removeEventListener("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(-1!==this.$undoStackDepth){for(var t=this.session.getUndoManager(),s=(t.$undoStack||t.$undostack).length-this.$undoStackDepth,e=0;e<s;e++)t.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}}).call(h.prototype),s.PlaceHolder=h});
//# sourceMappingURL=sourcemaps/placeholder.js.map
