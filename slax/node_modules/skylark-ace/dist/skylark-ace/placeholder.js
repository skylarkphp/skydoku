/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var t=require("./range").Range,s=require("./lib/event_emitter").EventEmitter,e=require("./lib/oop"),o=function(t,s,e,o,i,n){var h=this;this.length=s,this.session=t,this.doc=t.getDocument(),this.mainClass=i,this.othersClass=n,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate),this.$others=o,this.$onCursorChange=function(){setTimeout(function(){h.onCursorChange()})},this.$pos=e;var r=t.getUndoManager().$undoStack||t.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=r.length,this.setup(),t.selection.on("changeCursor",this.$onCursorChange)};(function(){e.implement(this,s),this.setup=function(){var s=this,e=this.doc,o=this.session;this.selectionBefore=o.selection.toJSON(),o.selection.inMultiSelectMode&&o.selection.toSingleRange(),this.pos=e.createAnchor(this.$pos.row,this.$pos.column);var i=this.pos;i.$insertRight=!0,i.detach(),i.markerId=o.addMarker(new t(i.row,i.column,i.row,i.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(t){var o=e.createAnchor(t.row,t.column);o.$insertRight=!0,o.detach(),s.others.push(o)}),o.setUndoSelect(!1)},this.showOtherMarkers=function(){if(!this.othersActive){var s=this.session,e=this;this.othersActive=!0,this.others.forEach(function(o){o.markerId=s.addMarker(new t(o.row,o.column,o.row,o.column+e.length),e.othersClass,null,!1)})}},this.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var t=0;t<this.others.length;t++)this.session.removeMarker(this.others[t].markerId)}},this.onUpdate=function(s){if(this.$updating)return this.updateAnchors(s);var e=s;if(e.start.row===e.end.row&&e.start.row===this.pos.row){this.$updating=!0;var o="insert"===s.action?e.end.column-e.start.column:e.start.column-e.end.column,i=e.start.column>=this.pos.column&&e.start.column<=this.pos.column+this.length+1,n=e.start.column-this.pos.column;if(this.updateAnchors(s),i&&(this.length+=o),i&&!this.session.$fromUndo)if("insert"===s.action)for(var h=this.others.length-1;h>=0;h--){var r={row:(a=this.others[h]).row,column:a.column+n};this.doc.insertMergedLines(r,s.lines)}else if("remove"===s.action)for(h=this.others.length-1;h>=0;h--){var a;r={row:(a=this.others[h]).row,column:a.column+n};this.doc.remove(new t(r.row,r.column,r.row,r.column-o))}this.$updating=!1,this.updateMarkers()}},this.updateAnchors=function(t){this.pos.onChange(t);for(var s=this.others.length;s--;)this.others[s].onChange(t);this.updateMarkers()},this.updateMarkers=function(){if(!this.$updating){var s=this,e=this.session,o=function(o,i){e.removeMarker(o.markerId),o.markerId=e.addMarker(new t(o.row,o.column,o.row,o.column+s.length),i,null,!1)};o(this.pos,this.mainClass);for(var i=this.others.length;i--;)o(this.others[i],this.othersClass)}},this.onCursorChange=function(t){if(!this.$updating&&this.session){var s=this.session.selection.getCursor();s.row===this.pos.row&&s.column>=this.pos.column&&s.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",t)):(this.hideOtherMarkers(),this._emit("cursorLeave",t))}},this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.removeEventListener("change",this.$onUpdate),this.session.selection.removeEventListener("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},this.cancel=function(){if(-1!==this.$undoStackDepth){for(var t=this.session.getUndoManager(),s=(t.$undoStack||t.$undostack).length-this.$undoStackDepth,e=0;e<s;e++)t.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}}}).call(o.prototype),exports.PlaceHolder=o});
//# sourceMappingURL=sourcemaps/placeholder.js.map
