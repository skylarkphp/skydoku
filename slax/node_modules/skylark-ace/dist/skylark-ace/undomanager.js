/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var t=function(){this.$maxRev=0,this.$fromUndo=!1,this.reset()};(function(){this.addSession=function(t){this.$session=t},this.add=function(t,n,s){this.$fromUndo||t!=this.$lastDelta&&(!1!==n&&this.lastDeltas||(this.lastDeltas=[],this.$undoStack.push(this.lastDeltas),t.id=this.$rev=++this.$maxRev),"remove"!=t.action&&"insert"!=t.action||(this.$lastDelta=t),this.lastDeltas.push(t))},this.addSelection=function(t,n){this.selections.push({value:t,rev:n||this.$rev})},this.startNewGroup=function(){return this.lastDeltas=null,this.$rev},this.markIgnored=function(t,n){null==n&&(n=this.$rev+1);for(var s=this.$undoStack,e=s.length;e--;){var r=s[e][0];if(r.id<=t)break;r.id<n&&(r.ignore=!0)}this.lastDeltas=null},this.getSelection=function(t,n){for(var s=this.selections,e=s.length;e--;){var r=s[e];if(r.rev<t)return n&&(r=s[e+1]),r}},this.getRevision=function(){return this.$rev},this.getDeltas=function(t,n){null==n&&(n=this.$rev+1);for(var s=this.$undoStack,e=null,r=0,i=s.length;i--;){var a=s[i][0];if(a.id<n&&!e&&(e=i+1),a.id<=t){r=i+1;break}}return s.slice(r,e)},this.getChangedRanges=function(t,n){null==n&&(n=this.$rev+1)},this.getChangedLines=function(t,n){null==n&&(n=this.$rev+1)},this.undo=function(t,n){this.lastDeltas=null;var s=this.$undoStack;if(function(t,n){for(var s=n;s--;){var e=t[s];if(e&&!e[0].ignore){for(;s<n-1;){var r=o(t[s],t[s+1]);t[s]=r[0],t[s+1]=r[1],s++}return!0}}}(s,s.length)){t||(t=this.$session),this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0;var e=s.pop(),r=null;return e&&e.length&&(r=t.undoChanges(e,n),this.$redoStack.push(e),this.$syncRev()),this.$fromUndo=!1,r}},this.redo=function(t,n){if(this.lastDeltas=null,t||(t=this.$session),this.$fromUndo=!0,this.$redoStackBaseRev!=this.$rev){var s=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);!function(t,n){for(var s=0;s<n.length;s++)for(var e=n[s],r=0;r<e.length;r++)f(t,e[r])}(this.$redoStack,s),this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(t){t[0].id=++this.$maxRev},this)}var e=this.$redoStack.pop(),r=null;return e&&(r=t.redoChanges(e,n),this.$undoStack.push(e),this.$syncRev()),this.$fromUndo=!1,r},this.$syncRev=function(){var t=this.$undoStack,n=t[t.length-1],s=n&&n[0].id||0;this.$redoStackBaseRev=s,this.$rev=s},this.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},this.canUndo=function(){return this.$undoStack.length>0},this.canRedo=function(){return this.$redoStack.length>0},this.bookmark=function(t){void 0==t&&(t=this.$rev),this.mark=t},this.isAtBookmark=function(){return this.$rev===this.mark},this.toJSON=function(){},this.fromJSON=function(){},this.hasUndo=this.canUndo,this.hasRedo=this.canRedo,this.isClean=this.isAtBookmark,this.markClean=this.bookmark,this.$prettyPrint=function(t){return t?r(t):r(this.$undoStack)+"\n---\n"+r(this.$redoStack)}}).call(t.prototype);var n=require("./range").Range,s=n.comparePoints;n.comparePoints;function e(t){return{row:t.row,column:t.column}}function r(t){if(t=t||this,Array.isArray(t))return t.map(r).join("\n");var n="";return t.action?(n="insert"==t.action?"+":"-",n+="["+t.lines+"]"):t.value&&(n=Array.isArray(t.value)?t.value.map(i).join("\n"):i(t.value)),t.start&&(n+=i(t)),(t.id||t.rev)&&(n+="\t("+(t.id||t.rev)+")"),n}function i(t){return t.start.row+":"+t.start.column+"=>"+t.end.row+":"+t.end.column}function a(t,n){var e="insert"==t.action,r="insert"==n.action;if(e&&r)if(s(n.start,t.end)>=0)l(n,t,-1);else{if(!(s(n.start,t.start)<=0))return null;l(t,n,1)}else if(e&&!r)if(s(n.start,t.end)>=0)l(n,t,-1);else{if(!(s(n.end,t.start)<=0))return null;l(t,n,-1)}else if(!e&&r)if(s(n.start,t.start)>=0)l(n,t,1);else{if(!(s(n.start,t.start)<=0))return null;l(t,n,1)}else if(!e&&!r)if(s(n.start,t.start)>=0)l(n,t,1);else{if(!(s(n.end,t.start)<=0))return null;l(t,n,-1)}return[n,t]}function o(t,n){for(var s=t.length;s--;)for(var e=0;e<n.length;e++)if(!a(t[s],n[e])){for(;s<t.length;){for(;e--;)a(n[e],t[s]);e=n.length,s++}return[t,n]}return t.selectionBefore=n.selectionBefore=t.selectionAfter=n.selectionAfter=null,[n,t]}function h(t,e){var r="insert"==t.action,i="insert"==e.action;if(r&&i)s(t.start,e.start)<0?l(e,t,1):l(t,e,1);else if(r&&!i)s(t.start,e.end)>=0?l(t,e,-1):s(t.start,e.start)<=0?l(e,t,1):(l(t,n.fromPoints(e.start,t.start),-1),l(e,t,1));else if(!r&&i)s(e.start,t.end)>=0?l(e,t,-1):s(e.start,t.start)<=0?l(t,e,1):(l(e,n.fromPoints(t.start,e.start),-1),l(t,e,1));else if(!r&&!i)if(s(e.start,t.end)>=0)l(e,t,-1);else{var a,o;if(!(s(e.end,t.start)<=0))return s(t.start,e.start)<0&&(a=t,t=c(t,e.start)),s(t.end,e.end)>0&&(o=c(t,e.end)),u(e.end,t.start,t.end,-1),o&&!a&&(t.lines=o.lines,t.start=o.start,t.end=o.end,o=t),[e,a,o].filter(Boolean);l(t,e,-1)}return[e,t]}function l(t,n,s){u(t.start,n.start,n.end,s),u(t.end,n.start,n.end,s)}function u(t,n,s,e){t.row==(1==e?n:s).row&&(t.column+=e*(s.column-n.column)),t.row+=e*(s.row-n.row)}function c(t,n){var s=t.lines,r=t.end;t.end=e(n);var i=t.end.row-t.start.row,a=s.splice(i,s.length),o=i?n.column:n.column-t.start.column;return s.push(a[0].substring(0,o)),a[0]=a[0].substr(o),{start:e(n),end:r,lines:a,action:t.action}}function f(t,n){n=function(t){return{start:e(t.start),end:e(t.end),action:t.action,lines:t.lines.slice()}}(n);for(var s=t.length;s--;){for(var r=t[s],i=0;i<r.length;i++){var a=h(r[i],n);n=a[0],2!=a.length&&(a[2]?(r.splice(i+1,1,a[1],a[2]),i++):a[1]||(r.splice(i,1),i--))}r.length||t.splice(s,1)}return t}exports.UndoManager=t});
//# sourceMappingURL=sourcemaps/undomanager.js.map
