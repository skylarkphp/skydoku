/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(t,n,s){"use strict";var e=function(){this.$maxRev=0,this.$fromUndo=!1,this.reset()};(function(){this.addSession=function(t){this.$session=t},this.add=function(t,n,s){this.$fromUndo||t!=this.$lastDelta&&(!1!==n&&this.lastDeltas||(this.lastDeltas=[],this.$undoStack.push(this.lastDeltas),t.id=this.$rev=++this.$maxRev),"remove"!=t.action&&"insert"!=t.action||(this.$lastDelta=t),this.lastDeltas.push(t))},this.addSelection=function(t,n){this.selections.push({value:t,rev:n||this.$rev})},this.startNewGroup=function(){return this.lastDeltas=null,this.$rev},this.markIgnored=function(t,n){null==n&&(n=this.$rev+1);for(var s=this.$undoStack,e=s.length;e--;){var r=s[e][0];if(r.id<=t)break;r.id<n&&(r.ignore=!0)}this.lastDeltas=null},this.getSelection=function(t,n){for(var s=this.selections,e=s.length;e--;){var r=s[e];if(r.rev<t)return n&&(r=s[e+1]),r}},this.getRevision=function(){return this.$rev},this.getDeltas=function(t,n){null==n&&(n=this.$rev+1);for(var s=this.$undoStack,e=null,r=0,i=s.length;i--;){var a=s[i][0];if(a.id<n&&!e&&(e=i+1),a.id<=t){r=i+1;break}}return s.slice(r,e)},this.getChangedRanges=function(t,n){null==n&&(n=this.$rev+1)},this.getChangedLines=function(t,n){null==n&&(n=this.$rev+1)},this.undo=function(t,n){this.lastDeltas=null;var s=this.$undoStack;if(function(t,n){for(var s=n;s--;){var e=t[s];if(e&&!e[0].ignore){for(;s<n-1;){var r=u(t[s],t[s+1]);t[s]=r[0],t[s+1]=r[1],s++}return!0}}}(s,s.length)){t||(t=this.$session),this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0;var e=s.pop(),r=null;return e&&e.length&&(r=t.undoChanges(e,n),this.$redoStack.push(e),this.$syncRev()),this.$fromUndo=!1,r}},this.redo=function(t,n){if(this.lastDeltas=null,t||(t=this.$session),this.$fromUndo=!0,this.$redoStackBaseRev!=this.$rev){var s=this.getDeltas(this.$redoStackBaseRev,this.$rev+1);!function(t,n){for(var s=0;s<n.length;s++)for(var e=n[s],r=0;r<e.length;r++)$(t,e[r])}(this.$redoStack,s),this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(t){t[0].id=++this.$maxRev},this)}var e=this.$redoStack.pop(),r=null;return e&&(r=t.redoChanges(e,n),this.$undoStack.push(e),this.$syncRev()),this.$fromUndo=!1,r},this.$syncRev=function(){var t=this.$undoStack,n=t[t.length-1],s=n&&n[0].id||0;this.$redoStackBaseRev=s,this.$rev=s},this.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},this.canUndo=function(){return this.$undoStack.length>0},this.canRedo=function(){return this.$redoStack.length>0},this.bookmark=function(t){void 0==t&&(t=this.$rev),this.mark=t},this.isAtBookmark=function(){return this.$rev===this.mark},this.toJSON=function(){},this.fromJSON=function(){},this.hasUndo=this.canUndo,this.hasRedo=this.canRedo,this.isClean=this.isAtBookmark,this.markClean=this.bookmark,this.$prettyPrint=function(t){return t?o(t):o(this.$undoStack)+"\n---\n"+o(this.$redoStack)}}).call(e.prototype);var r=t("./range").Range,i=r.comparePoints;r.comparePoints;function a(t){return{row:t.row,column:t.column}}function o(t){if(t=t||this,Array.isArray(t))return t.map(o).join("\n");var n="";return t.action?(n="insert"==t.action?"+":"-",n+="["+t.lines+"]"):t.value&&(n=Array.isArray(t.value)?t.value.map(h).join("\n"):h(t.value)),t.start&&(n+=h(t)),(t.id||t.rev)&&(n+="\t("+(t.id||t.rev)+")"),n}function h(t){return t.start.row+":"+t.start.column+"=>"+t.end.row+":"+t.end.column}function l(t,n){var s="insert"==t.action,e="insert"==n.action;if(s&&e)if(i(n.start,t.end)>=0)f(n,t,-1);else{if(!(i(n.start,t.start)<=0))return null;f(t,n,1)}else if(s&&!e)if(i(n.start,t.end)>=0)f(n,t,-1);else{if(!(i(n.end,t.start)<=0))return null;f(t,n,-1)}else if(!s&&e)if(i(n.start,t.start)>=0)f(n,t,1);else{if(!(i(n.start,t.start)<=0))return null;f(t,n,1)}else if(!s&&!e)if(i(n.start,t.start)>=0)f(n,t,1);else{if(!(i(n.end,t.start)<=0))return null;f(t,n,-1)}return[n,t]}function u(t,n){for(var s=t.length;s--;)for(var e=0;e<n.length;e++)if(!l(t[s],n[e])){for(;s<t.length;){for(;e--;)l(n[e],t[s]);e=n.length,s++}return[t,n]}return t.selectionBefore=n.selectionBefore=t.selectionAfter=n.selectionAfter=null,[n,t]}function c(t,n){var s="insert"==t.action,e="insert"==n.action;if(s&&e)i(t.start,n.start)<0?f(n,t,1):f(t,n,1);else if(s&&!e)i(t.start,n.end)>=0?f(t,n,-1):i(t.start,n.start)<=0?f(n,t,1):(f(t,r.fromPoints(n.start,t.start),-1),f(n,t,1));else if(!s&&e)i(n.start,t.end)>=0?f(n,t,-1):i(n.start,t.start)<=0?f(t,n,1):(f(n,r.fromPoints(t.start,n.start),-1),f(t,n,1));else if(!s&&!e)if(i(n.start,t.end)>=0)f(n,t,-1);else{var a,o;if(!(i(n.end,t.start)<=0))return i(t.start,n.start)<0&&(a=t,t=v(t,n.start)),i(t.end,n.end)>0&&(o=v(t,n.end)),d(n.end,t.start,t.end,-1),o&&!a&&(t.lines=o.lines,t.start=o.start,t.end=o.end,o=t),[n,a,o].filter(Boolean);f(t,n,-1)}return[n,t]}function f(t,n,s){d(t.start,n.start,n.end,s),d(t.end,n.start,n.end,s)}function d(t,n,s,e){t.row==(1==e?n:s).row&&(t.column+=e*(s.column-n.column)),t.row+=e*(s.row-n.row)}function v(t,n){var s=t.lines,e=t.end;t.end=a(n);var r=t.end.row-t.start.row,i=s.splice(r,s.length),o=r?n.column:n.column-t.start.column;return s.push(i[0].substring(0,o)),i[0]=i[0].substr(o),{start:a(n),end:e,lines:i,action:t.action}}function $(t,n){n=function(t){return{start:a(t.start),end:a(t.end),action:t.action,lines:t.lines.slice()}}(n);for(var s=t.length;s--;){for(var e=t[s],r=0;r<e.length;r++){var i=c(e[r],n);n=i[0],2!=i.length&&(i[2]?(e.splice(r+1,1,i[1],i[2]),r++):i[1]||(e.splice(r,1),r--))}e.length||t.splice(s,1)}return t}n.UndoManager=e});
//# sourceMappingURL=sourcemaps/undomanager.js.map
