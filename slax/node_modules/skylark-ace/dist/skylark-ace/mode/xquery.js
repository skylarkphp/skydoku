/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e=require("../worker/worker_client").WorkerClient,t=require("../lib/oop"),n=require("./text").Mode,r=require("./text_highlight_rules").TextHighlightRules,o=require("./xquery/xquery_lexer").XQueryLexer,s=require("../range").Range,i=require("./behaviour/xquery").XQueryBehaviour,a=require("./folding/cstyle").FoldMode,c=require("../anchor").Anchor,h=function(){this.$tokenizer=new o,this.$behaviour=new i,this.foldingRules=new a,this.$highlightRules=new r};t.inherits(h,n),function(){this.completer={getCompletions:function(e,t,n,r,o){if(!t.$worker)return o();t.$worker.emit("complete",{data:{pos:n,prefix:r}}),t.$worker.on("complete",function(e){o(null,e.data)})}},this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t);return t.match(/\s*(?:then|else|return|[{\(]|<\w+>)\s*$/)&&(r+=n),r},this.checkOutdent=function(e,t,n){return!!/^\s+$/.test(t)&&/^\s*[\}\)]/.test(n)},this.autoOutdent=function(e,t,n){var r=t.getLine(n).match(/^(\s*[\}\)])/);if(!r)return 0;var o=r[1].length,i=t.findMatchingBracket({row:n,column:o});if(!i||i.row==n)return 0;var a=this.$getIndent(t.getLine(i.row));t.replace(new s(n,0,n,o-1),a)},this.toggleCommentLines=function(e,t,n,r){var o,i,a=!0,c=/^\s*\(:(.*):\)/;for(o=n;o<=r;o++)if(!c.test(t.getLine(o))){a=!1;break}var h=new s(0,0,0,0);for(o=n;o<=r;o++)i=t.getLine(o),h.start.row=o,h.end.row=o,h.end.column=i.length,t.replace(h,a?i.match(c)[1]:"(:"+i+":)")},this.createWorker=function(t){var n=new e(["ace"],"ace/mode/xquery_worker","XQueryWorker"),r=this;return n.attachToDocument(t.getDocument()),n.on("ok",function(e){t.clearAnnotations()}),n.on("markers",function(e){t.clearAnnotations(),r.addMarkers(e.data,t)}),n.on("highlight",function(e){r.$tokenizer.tokens=e.data.tokens,r.$tokenizer.lines=t.getDocument().getAllLines();for(var n=Object.keys(r.$tokenizer.tokens),o=0;o<n.length;o++){var s=parseInt(n[o]);delete t.bgTokenizer.lines[s],delete t.bgTokenizer.states[s],t.bgTokenizer.fireUpdateEvent(s,s)}}),n},this.removeMarkers=function(e){var t=e.getMarkers(!1);for(var n in t)0===t[n].clazz.indexOf("language_highlight_")&&e.removeMarker(n);for(var r=0;r<e.markerAnchors.length;r++)e.markerAnchors[r].detach();e.markerAnchors=[]},this.addMarkers=function(e,t){t.markerAnchors||(t.markerAnchors=[]),this.removeMarkers(t),t.languageAnnos=[],e.forEach(function(e){var n,r=new c(t.getDocument(),e.pos.sl,e.pos.sc||0);t.markerAnchors.push(r);e.pos.ec,e.pos.sc,e.pos.el,e.pos.sl;var o={guttertext:e.message,type:e.level||"warning",text:e.message};function i(i){if(n&&t.removeMarker(n),o.row=r.row,void 0!==e.pos.sc&&void 0!==e.pos.ec){var a=new s(e.pos.sl,e.pos.sc,e.pos.el,e.pos.ec);n=t.addMarker(a,"language_highlight_"+(e.type?e.type:"default"))}i&&t.setAnnotations(t.languageAnnos)}i(),r.on("change",function(){i(!0)}),e.message&&t.languageAnnos.push(o)}),t.setAnnotations(t.languageAnnos)},this.$id="ace/mode/xquery"}.call(h.prototype),exports.Mode=h});
//# sourceMappingURL=../sourcemaps/mode/xquery.js.map
