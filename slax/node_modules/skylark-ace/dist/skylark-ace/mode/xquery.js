/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,n){"use strict";var r=e("../worker/worker_client").WorkerClient,o=e("../lib/oop"),s=e("./text").Mode,i=e("./text_highlight_rules").TextHighlightRules,a=e("./xquery/xquery_lexer").XQueryLexer,c=e("../range").Range,h=e("./behaviour/xquery").XQueryBehaviour,u=e("./folding/cstyle").FoldMode,l=e("../anchor").Anchor,g=function(){this.$tokenizer=new a,this.$behaviour=new h,this.foldingRules=new u,this.$highlightRules=new i};o.inherits(g,s),function(){this.completer={getCompletions:function(e,t,n,r,o){if(!t.$worker)return o();t.$worker.emit("complete",{data:{pos:n,prefix:r}}),t.$worker.on("complete",function(e){o(null,e.data)})}},this.getNextLineIndent=function(e,t,n){var r=this.$getIndent(t);return t.match(/\s*(?:then|else|return|[{\(]|<\w+>)\s*$/)&&(r+=n),r},this.checkOutdent=function(e,t,n){return!!/^\s+$/.test(t)&&/^\s*[\}\)]/.test(n)},this.autoOutdent=function(e,t,n){var r=t.getLine(n).match(/^(\s*[\}\)])/);if(!r)return 0;var o=r[1].length,s=t.findMatchingBracket({row:n,column:o});if(!s||s.row==n)return 0;var i=this.$getIndent(t.getLine(s.row));t.replace(new c(n,0,n,o-1),i)},this.toggleCommentLines=function(e,t,n,r){var o,s,i=!0,a=/^\s*\(:(.*):\)/;for(o=n;o<=r;o++)if(!a.test(t.getLine(o))){i=!1;break}var h=new c(0,0,0,0);for(o=n;o<=r;o++)s=t.getLine(o),h.start.row=o,h.end.row=o,h.end.column=s.length,t.replace(h,i?s.match(a)[1]:"(:"+s+":)")},this.createWorker=function(e){var t=new r(["ace"],"ace/mode/xquery_worker","XQueryWorker"),n=this;return t.attachToDocument(e.getDocument()),t.on("ok",function(t){e.clearAnnotations()}),t.on("markers",function(t){e.clearAnnotations(),n.addMarkers(t.data,e)}),t.on("highlight",function(t){n.$tokenizer.tokens=t.data.tokens,n.$tokenizer.lines=e.getDocument().getAllLines();for(var r=Object.keys(n.$tokenizer.tokens),o=0;o<r.length;o++){var s=parseInt(r[o]);delete e.bgTokenizer.lines[s],delete e.bgTokenizer.states[s],e.bgTokenizer.fireUpdateEvent(s,s)}}),t},this.removeMarkers=function(e){var t=e.getMarkers(!1);for(var n in t)0===t[n].clazz.indexOf("language_highlight_")&&e.removeMarker(n);for(var r=0;r<e.markerAnchors.length;r++)e.markerAnchors[r].detach();e.markerAnchors=[]},this.addMarkers=function(e,t){t.markerAnchors||(t.markerAnchors=[]),this.removeMarkers(t),t.languageAnnos=[],e.forEach(function(e){var n,r=new l(t.getDocument(),e.pos.sl,e.pos.sc||0);t.markerAnchors.push(r);e.pos.ec,e.pos.sc,e.pos.el,e.pos.sl;var o={guttertext:e.message,type:e.level||"warning",text:e.message};function s(s){if(n&&t.removeMarker(n),o.row=r.row,void 0!==e.pos.sc&&void 0!==e.pos.ec){var i=new c(e.pos.sl,e.pos.sc,e.pos.el,e.pos.ec);n=t.addMarker(i,"language_highlight_"+(e.type?e.type:"default"))}s&&t.setAnnotations(t.languageAnnos)}s(),r.on("change",function(){s(!0)}),e.message&&t.languageAnnos.push(o)}),t.setAnnotations(t.languageAnnos)},this.$id="ace/mode/xquery"}.call(g.prototype),t.Mode=g});
//# sourceMappingURL=../sourcemaps/mode/xquery.js.map
