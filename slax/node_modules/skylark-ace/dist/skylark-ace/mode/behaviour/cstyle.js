/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e,t=require("../../lib/oop"),n=require("../behaviour").Behaviour,r=require("../../token_iterator").TokenIterator,o=require("../../lib/lang"),s=["text","paren.rparen","punctuation.operator"],i=["text","paren.rparen","punctuation.operator","comment"],u={},a={'"':'"',"'":"'"},c=function(t){var n=-1;if(t.multiSelect&&(n=t.selection.index,u.rangeCount!=t.multiSelect.rangeCount&&(u={rangeCount:t.multiSelect.rangeCount})),u[n])return e=u[n];e=u[n]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}},l=function(e,t,n,r){var o=e.end.row-e.start.row;return{text:n+t+r,selection:[0,e.start.column+1,o,e.end.column+(o?0:1)]}},d=function(t){this.add("braces","insertion",function(n,r,s,i,u){var a=s.getCursorPosition(),g=i.doc.getLine(a.row);if("{"==u){c(s);var m=s.getSelectionRange(),f=i.doc.getTextRange(m);if(""!==f&&"{"!==f&&s.getWrapBehavioursEnabled())return l(m,f,"{","}");if(d.isSaneInsertion(s,i))return/[\]\}\)]/.test(g[a.column])||s.inMultiSelectMode||t&&t.braces?(d.recordAutoInsert(s,i,"}"),{text:"{}",selection:[1,1]}):(d.recordMaybeInsert(s,i,"{"),{text:"{",selection:[1,1]})}else if("}"==u){if(c(s),"}"==g.substring(a.column,a.column+1))if(null!==i.$findOpeningBracket("}",{column:a.column+1,row:a.row})&&d.isAutoInsertedClosing(a,g,u))return d.popAutoInsertedClosing(),{text:"",selection:[1,1]}}else{if("\n"==u||"\r\n"==u){c(s);var I="";if(d.isMaybeInsertedClosing(a,g)&&(I=o.stringRepeat("}",e.maybeInsertedBrackets),d.clearMaybeInsertedClosing()),"}"===g.substring(a.column,a.column+1)){var b=i.findMatchingBracket({row:a.row,column:a.column+1},"}");if(!b)return null;var w=this.$getIndent(i.getLine(b.row))}else{if(!I)return void d.clearMaybeInsertedClosing();w=this.$getIndent(g)}var p=w+i.getTabString();return{text:"\n"+p+"\n"+w+I,selection:[1,p.length,1,p.length]}}d.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(t,n,r,o,s){var i=o.doc.getTextRange(s);if(!s.isMultiLine()&&"{"==i){if(c(r),"}"==o.doc.getLine(s.start.row).substring(s.end.column,s.end.column+1))return s.end.column++,s;e.maybeInsertedBrackets--}}),this.add("parens","insertion",function(e,t,n,r,o){if("("==o){c(n);var s=n.getSelectionRange(),i=r.doc.getTextRange(s);if(""!==i&&n.getWrapBehavioursEnabled())return l(s,i,"(",")");if(d.isSaneInsertion(n,r))return d.recordAutoInsert(n,r,")"),{text:"()",selection:[1,1]}}else if(")"==o){c(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row);if(")"==a.substring(u.column,u.column+1))if(null!==r.$findOpeningBracket(")",{column:u.column+1,row:u.row})&&d.isAutoInsertedClosing(u,a,o))return d.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("parens","deletion",function(e,t,n,r,o){var s=r.doc.getTextRange(o);if(!o.isMultiLine()&&"("==s&&(c(n),")"==r.doc.getLine(o.start.row).substring(o.start.column+1,o.start.column+2)))return o.end.column++,o}),this.add("brackets","insertion",function(e,t,n,r,o){if("["==o){c(n);var s=n.getSelectionRange(),i=r.doc.getTextRange(s);if(""!==i&&n.getWrapBehavioursEnabled())return l(s,i,"[","]");if(d.isSaneInsertion(n,r))return d.recordAutoInsert(n,r,"]"),{text:"[]",selection:[1,1]}}else if("]"==o){c(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row);if("]"==a.substring(u.column,u.column+1))if(null!==r.$findOpeningBracket("]",{column:u.column+1,row:u.row})&&d.isAutoInsertedClosing(u,a,o))return d.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("brackets","deletion",function(e,t,n,r,o){var s=r.doc.getTextRange(o);if(!o.isMultiLine()&&"["==s&&(c(n),"]"==r.doc.getLine(o.start.row).substring(o.start.column+1,o.start.column+2)))return o.end.column++,o}),this.add("string_dquotes","insertion",function(e,t,n,r,o){var s=r.$mode.$quotes||a;if(1==o.length&&s[o]){if(this.lineCommentStart&&-1!=this.lineCommentStart.indexOf(o))return;c(n);var i=o,u=n.getSelectionRange(),d=r.doc.getTextRange(u);if(!(""===d||1==d.length&&s[d])&&n.getWrapBehavioursEnabled())return l(u,d,i,i);if(!d){var g=n.getCursorPosition(),m=r.doc.getLine(g.row),f=m.substring(g.column-1,g.column),I=m.substring(g.column,g.column+1),b=r.getTokenAt(g.row,g.column),w=r.getTokenAt(g.row,g.column+1);if("\\"==f&&b&&/escape/.test(b.type))return null;var p,y=b&&/string|escape/.test(b.type),v=!w||/string|escape/.test(w.type);if(I==i)(p=y!==v)&&/string\.end/.test(w.type)&&(p=!1);else{if(y&&!v)return null;if(y&&v)return null;var h=r.$mode.tokenRe;h.lastIndex=0;var C=h.test(f);h.lastIndex=0;var k=h.test(f);if(C||k)return null;if(I&&!/[\s;,.})\]\\]/.test(I))return null;p=!0}return{text:p?i+i:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(e,t,n,r,o){var s=r.$mode.$quotes||a,i=r.doc.getTextRange(o);if(!o.isMultiLine()&&s.hasOwnProperty(i)&&(c(n),r.doc.getLine(o.start.row).substring(o.start.column+1,o.start.column+2)==i))return o.end.column++,o})};d.isSaneInsertion=function(e,t){var n=e.getCursorPosition(),o=new r(t,n.row,n.column);if(!this.$matchTokenType(o.getCurrentToken()||"text",s)){var u=new r(t,n.row,n.column+1);if(!this.$matchTokenType(u.getCurrentToken()||"text",s))return!1}return o.stepForward(),o.getCurrentTokenRow()!==n.row||this.$matchTokenType(o.getCurrentToken()||"text",i)},d.$matchTokenType=function(e,t){return t.indexOf(e.type||e)>-1},d.recordAutoInsert=function(t,n,r){var o=t.getCursorPosition(),s=n.doc.getLine(o.row);this.isAutoInsertedClosing(o,s,e.autoInsertedLineEnd[0])||(e.autoInsertedBrackets=0),e.autoInsertedRow=o.row,e.autoInsertedLineEnd=r+s.substr(o.column),e.autoInsertedBrackets++},d.recordMaybeInsert=function(t,n,r){var o=t.getCursorPosition(),s=n.doc.getLine(o.row);this.isMaybeInsertedClosing(o,s)||(e.maybeInsertedBrackets=0),e.maybeInsertedRow=o.row,e.maybeInsertedLineStart=s.substr(0,o.column)+r,e.maybeInsertedLineEnd=s.substr(o.column),e.maybeInsertedBrackets++},d.isAutoInsertedClosing=function(t,n,r){return e.autoInsertedBrackets>0&&t.row===e.autoInsertedRow&&r===e.autoInsertedLineEnd[0]&&n.substr(t.column)===e.autoInsertedLineEnd},d.isMaybeInsertedClosing=function(t,n){return e.maybeInsertedBrackets>0&&t.row===e.maybeInsertedRow&&n.substr(t.column)===e.maybeInsertedLineEnd&&n.substr(0,t.column)==e.maybeInsertedLineStart},d.popAutoInsertedClosing=function(){e.autoInsertedLineEnd=e.autoInsertedLineEnd.substr(1),e.autoInsertedBrackets--},d.clearMaybeInsertedClosing=function(){e&&(e.maybeInsertedBrackets=0,e.maybeInsertedRow=-1)},t.inherits(d,n),exports.CstyleBehaviour=d});
//# sourceMappingURL=../../sourcemaps/mode/behaviour/cstyle.js.map
