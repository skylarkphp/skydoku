/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,n){"use strict";var r,o=e("../../lib/oop"),s=e("../behaviour").Behaviour,i=e("../../token_iterator").TokenIterator,u=e("../../lib/lang"),a=["text","paren.rparen","punctuation.operator"],c=["text","paren.rparen","punctuation.operator","comment"],l={},d={'"':'"',"'":"'"},g=function(e){var t=-1;if(e.multiSelect&&(t=e.selection.index,l.rangeCount!=e.multiSelect.rangeCount&&(l={rangeCount:e.multiSelect.rangeCount})),l[t])return r=l[t];r=l[t]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}},m=function(e,t,n,r){var o=e.end.row-e.start.row;return{text:n+t+r,selection:[0,e.start.column+1,o,e.end.column+(o?0:1)]}},f=function(e){this.add("braces","insertion",function(t,n,o,s,i){var a=o.getCursorPosition(),c=s.doc.getLine(a.row);if("{"==i){g(o);var l=o.getSelectionRange(),d=s.doc.getTextRange(l);if(""!==d&&"{"!==d&&o.getWrapBehavioursEnabled())return m(l,d,"{","}");if(f.isSaneInsertion(o,s))return/[\]\}\)]/.test(c[a.column])||o.inMultiSelectMode||e&&e.braces?(f.recordAutoInsert(o,s,"}"),{text:"{}",selection:[1,1]}):(f.recordMaybeInsert(o,s,"{"),{text:"{",selection:[1,1]})}else if("}"==i){if(g(o),"}"==c.substring(a.column,a.column+1))if(null!==s.$findOpeningBracket("}",{column:a.column+1,row:a.row})&&f.isAutoInsertedClosing(a,c,i))return f.popAutoInsertedClosing(),{text:"",selection:[1,1]}}else{if("\n"==i||"\r\n"==i){g(o);var I="";if(f.isMaybeInsertedClosing(a,c)&&(I=u.stringRepeat("}",r.maybeInsertedBrackets),f.clearMaybeInsertedClosing()),"}"===c.substring(a.column,a.column+1)){var b=s.findMatchingBracket({row:a.row,column:a.column+1},"}");if(!b)return null;var w=this.$getIndent(s.getLine(b.row))}else{if(!I)return void f.clearMaybeInsertedClosing();w=this.$getIndent(c)}var p=w+s.getTabString();return{text:"\n"+p+"\n"+w+I,selection:[1,p.length,1,p.length]}}f.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(e,t,n,o,s){var i=o.doc.getTextRange(s);if(!s.isMultiLine()&&"{"==i){if(g(n),"}"==o.doc.getLine(s.start.row).substring(s.end.column,s.end.column+1))return s.end.column++,s;r.maybeInsertedBrackets--}}),this.add("parens","insertion",function(e,t,n,r,o){if("("==o){g(n);var s=n.getSelectionRange(),i=r.doc.getTextRange(s);if(""!==i&&n.getWrapBehavioursEnabled())return m(s,i,"(",")");if(f.isSaneInsertion(n,r))return f.recordAutoInsert(n,r,")"),{text:"()",selection:[1,1]}}else if(")"==o){g(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row);if(")"==a.substring(u.column,u.column+1))if(null!==r.$findOpeningBracket(")",{column:u.column+1,row:u.row})&&f.isAutoInsertedClosing(u,a,o))return f.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("parens","deletion",function(e,t,n,r,o){var s=r.doc.getTextRange(o);if(!o.isMultiLine()&&"("==s&&(g(n),")"==r.doc.getLine(o.start.row).substring(o.start.column+1,o.start.column+2)))return o.end.column++,o}),this.add("brackets","insertion",function(e,t,n,r,o){if("["==o){g(n);var s=n.getSelectionRange(),i=r.doc.getTextRange(s);if(""!==i&&n.getWrapBehavioursEnabled())return m(s,i,"[","]");if(f.isSaneInsertion(n,r))return f.recordAutoInsert(n,r,"]"),{text:"[]",selection:[1,1]}}else if("]"==o){g(n);var u=n.getCursorPosition(),a=r.doc.getLine(u.row);if("]"==a.substring(u.column,u.column+1))if(null!==r.$findOpeningBracket("]",{column:u.column+1,row:u.row})&&f.isAutoInsertedClosing(u,a,o))return f.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("brackets","deletion",function(e,t,n,r,o){var s=r.doc.getTextRange(o);if(!o.isMultiLine()&&"["==s&&(g(n),"]"==r.doc.getLine(o.start.row).substring(o.start.column+1,o.start.column+2)))return o.end.column++,o}),this.add("string_dquotes","insertion",function(e,t,n,r,o){var s=r.$mode.$quotes||d;if(1==o.length&&s[o]){if(this.lineCommentStart&&-1!=this.lineCommentStart.indexOf(o))return;g(n);var i=o,u=n.getSelectionRange(),a=r.doc.getTextRange(u);if(!(""===a||1==a.length&&s[a])&&n.getWrapBehavioursEnabled())return m(u,a,i,i);if(!a){var c=n.getCursorPosition(),l=r.doc.getLine(c.row),f=l.substring(c.column-1,c.column),I=l.substring(c.column,c.column+1),b=r.getTokenAt(c.row,c.column),w=r.getTokenAt(c.row,c.column+1);if("\\"==f&&b&&/escape/.test(b.type))return null;var p,y=b&&/string|escape/.test(b.type),v=!w||/string|escape/.test(w.type);if(I==i)(p=y!==v)&&/string\.end/.test(w.type)&&(p=!1);else{if(y&&!v)return null;if(y&&v)return null;var h=r.$mode.tokenRe;h.lastIndex=0;var C=h.test(f);h.lastIndex=0;var k=h.test(f);if(C||k)return null;if(I&&!/[\s;,.})\]\\]/.test(I))return null;p=!0}return{text:p?i+i:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(e,t,n,r,o){var s=r.$mode.$quotes||d,i=r.doc.getTextRange(o);if(!o.isMultiLine()&&s.hasOwnProperty(i)&&(g(n),r.doc.getLine(o.start.row).substring(o.start.column+1,o.start.column+2)==i))return o.end.column++,o})};f.isSaneInsertion=function(e,t){var n=e.getCursorPosition(),r=new i(t,n.row,n.column);if(!this.$matchTokenType(r.getCurrentToken()||"text",a)){var o=new i(t,n.row,n.column+1);if(!this.$matchTokenType(o.getCurrentToken()||"text",a))return!1}return r.stepForward(),r.getCurrentTokenRow()!==n.row||this.$matchTokenType(r.getCurrentToken()||"text",c)},f.$matchTokenType=function(e,t){return t.indexOf(e.type||e)>-1},f.recordAutoInsert=function(e,t,n){var o=e.getCursorPosition(),s=t.doc.getLine(o.row);this.isAutoInsertedClosing(o,s,r.autoInsertedLineEnd[0])||(r.autoInsertedBrackets=0),r.autoInsertedRow=o.row,r.autoInsertedLineEnd=n+s.substr(o.column),r.autoInsertedBrackets++},f.recordMaybeInsert=function(e,t,n){var o=e.getCursorPosition(),s=t.doc.getLine(o.row);this.isMaybeInsertedClosing(o,s)||(r.maybeInsertedBrackets=0),r.maybeInsertedRow=o.row,r.maybeInsertedLineStart=s.substr(0,o.column)+n,r.maybeInsertedLineEnd=s.substr(o.column),r.maybeInsertedBrackets++},f.isAutoInsertedClosing=function(e,t,n){return r.autoInsertedBrackets>0&&e.row===r.autoInsertedRow&&n===r.autoInsertedLineEnd[0]&&t.substr(e.column)===r.autoInsertedLineEnd},f.isMaybeInsertedClosing=function(e,t){return r.maybeInsertedBrackets>0&&e.row===r.maybeInsertedRow&&t.substr(e.column)===r.maybeInsertedLineEnd&&t.substr(0,e.column)==r.maybeInsertedLineStart},f.popAutoInsertedClosing=function(){r.autoInsertedLineEnd=r.autoInsertedLineEnd.substr(1),r.autoInsertedBrackets--},f.clearMaybeInsertedClosing=function(){r&&(r.maybeInsertedBrackets=0,r.maybeInsertedRow=-1)},o.inherits(f,s),t.CstyleBehaviour=f});
//# sourceMappingURL=../../sourcemaps/mode/behaviour/cstyle.js.map
