/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e=require("../../lib/oop"),t=require("../behaviour").Behaviour,n=require("../../token_iterator").TokenIterator;require("../../lib/lang");function r(e,t){return e&&e.type.lastIndexOf(t+".xml")>-1}var i=function(){this.add("string_dquotes","insertion",function(e,t,i,a,o){if('"'==o||"'"==o){var u=o,s=a.doc.getTextRange(i.getSelectionRange());if(""!==s&&"'"!==s&&'"'!=s&&i.getWrapBehavioursEnabled())return{text:u+s+u,selection:!1};var l=i.getCursorPosition(),c=a.doc.getLine(l.row).substring(l.column,l.column+1),g=new n(a,l.row,l.column),d=g.getCurrentToken();if(c==u&&(r(d,"attribute-value")||r(d,"string")))return{text:"",selection:[1,1]};if(d||(d=g.stepBackward()),!d)return;for(;r(d,"tag-whitespace")||r(d,"whitespace");)d=g.stepBackward();var f=!c||c.match(/\s/);if(r(d,"attribute-equals")&&(f||">"==c)||r(d,"decl-attribute-equals")&&(f||"?"==c))return{text:u+u,selection:[1,1]}}}),this.add("string_dquotes","deletion",function(e,t,n,r,i){var a=r.doc.getTextRange(i);if(!i.isMultiLine()&&('"'==a||"'"==a)&&r.doc.getLine(i.start.row).substring(i.start.column+1,i.start.column+2)==a)return i.end.column++,i}),this.add("autoclosing","insertion",function(e,t,i,a,o){if(">"==o){var u=i.getSelectionRange().start,s=new n(a,u.row,u.column),l=s.getCurrentToken()||s.stepBackward();if(!l||!(r(l,"tag-name")||r(l,"tag-whitespace")||r(l,"attribute-name")||r(l,"attribute-equals")||r(l,"attribute-value")))return;if(r(l,"reference.attribute-value"))return;if(r(l,"attribute-value")){var c=s.getCurrentTokenColumn()+l.value.length;if(u.column<c)return;if(u.column==c){var g=s.stepForward();if(g&&r(g,"attribute-value"))return;s.stepBackward()}}if(/^\s*>/.test(a.getLine(u.row).slice(u.column)))return;for(;!r(l,"tag-name");)if("<"==(l=s.stepBackward()).value){l=s.stepForward();break}var d=s.getCurrentTokenRow(),f=s.getCurrentTokenColumn();if(r(s.stepBackward(),"end-tag-open"))return;var v=l.value;if(d==u.row&&(v=v.substring(0,u.column-f)),this.voidElements.hasOwnProperty(v.toLowerCase()))return;return{text:"></"+v+">",selection:[1,1]}}}),this.add("autoindent","insertion",function(e,t,r,i,a){if("\n"==a){var o=r.getCursorPosition(),u=i.getLine(o.row),s=new n(i,o.row,o.column),l=s.getCurrentToken();if(l&&-1!==l.type.indexOf("tag-close")){if("/>"==l.value)return;for(;l&&-1===l.type.indexOf("tag-name");)l=s.stepBackward();if(!l)return;var c=l.value,g=s.getCurrentTokenRow();if(!(l=s.stepBackward())||-1!==l.type.indexOf("end-tag"))return;if(this.voidElements&&!this.voidElements[c]){var d=i.getTokenAt(o.row,o.column+1),f=(u=i.getLine(g),this.$getIndent(u)),v=f+i.getTabString();return d&&"</"===d.value?{text:"\n"+v+"\n"+f,selection:[1,v.length,1,v.length]}:{text:"\n"+v}}}}})};e.inherits(i,t),exports.XmlBehaviour=i});
//# sourceMappingURL=../../sourcemaps/mode/behaviour/xml.js.map
