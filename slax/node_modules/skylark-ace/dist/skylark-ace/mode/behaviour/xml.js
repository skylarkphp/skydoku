/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,n){"use strict";var r=e("../../lib/oop"),i=e("../behaviour").Behaviour,a=e("../../token_iterator").TokenIterator;e("../../lib/lang");function o(e,t){return e&&e.type.lastIndexOf(t+".xml")>-1}var u=function(){this.add("string_dquotes","insertion",function(e,t,n,r,i){if('"'==i||"'"==i){var u=i,s=r.doc.getTextRange(n.getSelectionRange());if(""!==s&&"'"!==s&&'"'!=s&&n.getWrapBehavioursEnabled())return{text:u+s+u,selection:!1};var l=n.getCursorPosition(),c=r.doc.getLine(l.row).substring(l.column,l.column+1),g=new a(r,l.row,l.column),d=g.getCurrentToken();if(c==u&&(o(d,"attribute-value")||o(d,"string")))return{text:"",selection:[1,1]};if(d||(d=g.stepBackward()),!d)return;for(;o(d,"tag-whitespace")||o(d,"whitespace");)d=g.stepBackward();var f=!c||c.match(/\s/);if(o(d,"attribute-equals")&&(f||">"==c)||o(d,"decl-attribute-equals")&&(f||"?"==c))return{text:u+u,selection:[1,1]}}}),this.add("string_dquotes","deletion",function(e,t,n,r,i){var a=r.doc.getTextRange(i);if(!i.isMultiLine()&&('"'==a||"'"==a)&&r.doc.getLine(i.start.row).substring(i.start.column+1,i.start.column+2)==a)return i.end.column++,i}),this.add("autoclosing","insertion",function(e,t,n,r,i){if(">"==i){var u=n.getSelectionRange().start,s=new a(r,u.row,u.column),l=s.getCurrentToken()||s.stepBackward();if(!l||!(o(l,"tag-name")||o(l,"tag-whitespace")||o(l,"attribute-name")||o(l,"attribute-equals")||o(l,"attribute-value")))return;if(o(l,"reference.attribute-value"))return;if(o(l,"attribute-value")){var c=s.getCurrentTokenColumn()+l.value.length;if(u.column<c)return;if(u.column==c){var g=s.stepForward();if(g&&o(g,"attribute-value"))return;s.stepBackward()}}if(/^\s*>/.test(r.getLine(u.row).slice(u.column)))return;for(;!o(l,"tag-name");)if("<"==(l=s.stepBackward()).value){l=s.stepForward();break}var d=s.getCurrentTokenRow(),f=s.getCurrentTokenColumn();if(o(s.stepBackward(),"end-tag-open"))return;var v=l.value;if(d==u.row&&(v=v.substring(0,u.column-f)),this.voidElements.hasOwnProperty(v.toLowerCase()))return;return{text:"></"+v+">",selection:[1,1]}}}),this.add("autoindent","insertion",function(e,t,n,r,i){if("\n"==i){var o=n.getCursorPosition(),u=r.getLine(o.row),s=new a(r,o.row,o.column),l=s.getCurrentToken();if(l&&-1!==l.type.indexOf("tag-close")){if("/>"==l.value)return;for(;l&&-1===l.type.indexOf("tag-name");)l=s.stepBackward();if(!l)return;var c=l.value,g=s.getCurrentTokenRow();if(!(l=s.stepBackward())||-1!==l.type.indexOf("end-tag"))return;if(this.voidElements&&!this.voidElements[c]){var d=r.getTokenAt(o.row,o.column+1),f=(u=r.getLine(g),this.$getIndent(u)),v=f+r.getTabString();return d&&"</"===d.value?{text:"\n"+v+"\n"+f,selection:[1,v.length,1,v.length]}:{text:"\n"+v}}}}})};r.inherits(u,i),t.XmlBehaviour=u});
//# sourceMappingURL=../../sourcemaps/mode/behaviour/xml.js.map
