/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){var e=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,r=new RegExp("[\\-\\.0-9"+e.source.slice(1,-1)+"·̀-ͯ\\ux203F-⁀]"),t=new RegExp("^"+e.source+r.source+"*(?::"+e.source+r.source+"*)?$"),a=0,n=1,i=2,s=3,c=4,u=5,o=6,l=7;function f(){}function d(e,r){return r.lineNumber=e.lineNumber,r.columnNumber=e.columnNumber,r}function m(e,r,t,f,d){for(var m,h=++r,g=a;;){var p=e.charAt(h);switch(p){case"=":if(g===n)m=e.slice(r,h),g=s;else{if(g!==i)throw new Error("attribute equal must after attrName");g=s}break;case"'":case'"':if(g===s){if(r=h+1,!((h=e.indexOf(p,r))>0))throw new Error("attribute value no end '"+p+"' match");w=e.slice(r,h).replace(/&#?\w+;/g,f),t.add(m,w,r-1),g=u}else{if(g!=c)throw new Error('attribute value must after "="');w=e.slice(r,h).replace(/&#?\w+;/g,f),t.add(m,w,r),d.warning('attribute "'+m+'" missed start quot('+p+")!!"),r=h+1,g=u}break;case"/":switch(g){case a:t.setTagName(e.slice(r,h));case u:case o:case l:g=l,t.closed=!0;case c:case n:case i:break;default:throw new Error("attribute invalid close char('/')")}break;case"":d.error("unexpected end of input");case">":switch(g){case a:t.setTagName(e.slice(r,h));case u:case o:case l:break;case c:case n:"/"===(w=e.slice(r,h)).slice(-1)&&(t.closed=!0,w=w.slice(0,-1));case i:g===i&&(w=m),g==c?(d.warning('attribute "'+w+'" missed quot(")!!'),t.add(m,w.replace(/&#?\w+;/g,f),r)):(d.warning('attribute "'+w+'" missed value!! "'+w+'" instead!!'),t.add(w,w,r));break;case s:throw new Error("attribute value missed!!")}return h;case"":p=" ";default:if(p<=" ")switch(g){case a:t.setTagName(e.slice(r,h)),g=o;break;case n:m=e.slice(r,h),g=i;break;case c:var w=e.slice(r,h).replace(/&#?\w+;/g,f);d.warning('attribute "'+w+'" missed quot(")!!'),t.add(m,w,r);case u:g=o}else switch(g){case i:d.warning('attribute "'+m+'" missed value!! "'+m+'" instead!!'),t.add(m,m,r),r=h,g=n;break;case u:d.warning('attribute space is required"'+m+'"!!');case o:g=n,r=h;break;case s:g=c,r=h;break;case l:throw new Error("elements closed character '/' and '>' must be connected to")}}h++}}function h(e,r,t){for(var a=e.tagName,n=null,i=t[t.length-1].currentNSMap,s=e.length;s--;){var c=e[s],u=c.qName,o=c.value;if((m=u.indexOf(":"))>0)var l=c.prefix=u.slice(0,m),f=u.slice(m+1),d="xmlns"===l&&f;else f=u,l=null,d="xmlns"===u&&"";c.localName=f,!1!==d&&(null==n&&(n={},w(i,i={})),i[d]=n[d]=o,c.uri="http://www.w3.org/2000/xmlns/",r.startPrefixMapping(d,o))}for(s=e.length;s--;){(l=(c=e[s]).prefix)&&("xml"===l&&(c.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(c.uri=i[l]))}var m;(m=a.indexOf(":"))>0?(l=e.prefix=a.slice(0,m),f=e.localName=a.slice(m+1)):(l=null,f=e.localName=a);var h=e.uri=i[l||""];if(r.startElement(h,f,a,e),e.closed){if(r.endElement(h,f,a),n)for(l in n)r.endPrefixMapping(l)}else e.currentNSMap=i,e.localNSMap=n,t.push(e)}function g(e,r,t,a,n){if(/^(?:script|textarea)$/i.test(t)){var i=e.indexOf("</"+t+">",r),s=e.substring(r+1,i);if(/[&<]/.test(s))return/^script$/i.test(t)?(n.characters(s,0,s.length),i):(s=s.replace(/&#?\w+;/g,a),n.characters(s,0,s.length),i)}return r+1}function p(e,r,t,a){var n=a[t];return null==n&&(n=a[t]=e.lastIndexOf("</"+t+">")),n<r}function w(e,r){for(var t in e)r[t]=e[t]}function b(e,r,t,a){switch(e.charAt(r+2)){case"-":return"-"===e.charAt(r+3)?(n=e.indexOf("--\x3e",r+4))>r?(t.comment(e,r+4,n-r-4),n+3):(a.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(r+3,6)){var n=e.indexOf("]]>",r+9);return t.startCDATA(),t.characters(e,r+9,n-r-9),t.endCDATA(),n+3}var i=function(e,r){var t,a=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;n.lastIndex=r,n.exec(e);for(;t=n.exec(e);)if(a.push(t),t[1])return a}(e,r),s=i.length;if(s>1&&/!doctype/i.test(i[0][0])){var c=i[1][0],u=s>3&&/^public$/i.test(i[2][0])&&i[3][0],o=s>4&&i[4][0],l=i[s-1];return t.startDTD(c,u&&u.replace(/^(['"])(.*?)\1$/,"$2"),o&&o.replace(/^(['"])(.*?)\1$/,"$2")),t.endDTD(),l.index+l[0].length}}return-1}function v(e,r,t){var a=e.indexOf("?>",r);if(a){var n=e.substring(r,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){n[0].length;return t.processingInstruction(n[1],n[2]),a+2}return-1}return-1}function x(e){}function N(e,r){return e.__proto__=r,e}return f.prototype={parse:function(e,r,t){var a=this.domBuilder;a.startDocument(),w(r,r={}),function(e,r,t,a,n){function i(e){var r=e.slice(1,-1);return r in t?t[r]:"#"===r.charAt(0)?function(e){if(e>65535){var r=55296+((e-=65536)>>10),t=56320+(1023&e);return String.fromCharCode(r,t)}return String.fromCharCode(e)}(parseInt(r.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function s(r){var t=e.substring(F,r).replace(/&#?\w+;/g,i);f&&c(F),a.characters(t,0,r-F),F=r}function c(r,t){for(;r>=o&&(t=l.exec(e));)u=t.index,o=u+t[0].length,f.lineNumber++;f.columnNumber=r-u+1}var u=0,o=0,l=/.+(?:\r\n?|\n)|.*$/g,f=a.locator,w=[{currentNSMap:r}],N={},F=0;for(;;){var D=e.indexOf("<",F);if(D<0){if(!e.substr(F).match(/^\s*$/)){var E=a.document,k=E.createTextNode(e.substr(F));E.appendChild(k),a.currentElement=k}return}switch(D>F&&s(D),e.charAt(D+1)){case"/":var A,C=e.indexOf(">",D+3),O=e.substring(D+2,C);if(!(w.length>1)){n.fatalError("end tag name not found for: "+O);break}var $=(A=w.pop()).localNSMap;if(A.tagName!=O&&n.fatalError("end tag name: "+O+" does not match the current start tagName: "+A.tagName),a.endElement(A.uri,A.localName,O),$)for(var T in $)a.endPrefixMapping(T);C++;break;case"?":f&&c(D),C=v(e,D,a);break;case"!":f&&c(D),C=b(e,D,a,n);break;default:try{f&&c(D);var M=new x,C=m(e,D,M,i,n),S=M.length;if(S&&f){for(var q=d(f,{}),D=0;D<S;D++){var y=M[D];c(y.offset),y.offset=d(f,{})}d(q,f)}!M.closed&&p(e,C,M.tagName,N)&&(M.closed=!0,t.nbsp||n.warning("unclosed xml attribute")),h(M,a,w),"http://www.w3.org/1999/xhtml"!==M.uri||M.closed?C++:C=g(e,C,M.tagName,i,a)}catch(e){n.error("element parse error: "+e),C=-1}}C<0?s(D+1):F=C}}(e,r,t,a,this.errorHandler),a.endDocument()}},x.prototype={setTagName:function(e){if(!t.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,r,a){if(!t.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:r,offset:a}},length:0,getLocalName:function(e){return this[e].localName},getOffset:function(e){return this[e].offset},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},N({},N.prototype)instanceof N||(N=function(e,r){function t(){}for(r in t.prototype=r,t=new t,e)t[r]=e[r];return t}),f});
//# sourceMappingURL=../../sourcemaps/mode/xml/sax.js.map
