/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,r,t){var a=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=new RegExp("[\\-\\.0-9"+a.source.slice(1,-1)+"·̀-ͯ\\ux203F-⁀]"),i=new RegExp("^"+a.source+n.source+"*(?::"+a.source+n.source+"*)?$"),s=0,c=1,u=2,o=3,l=4,f=5,d=6,m=7;function h(){}function g(e,r){return r.lineNumber=e.lineNumber,r.columnNumber=e.columnNumber,r}function p(e,r,t,a,n){for(var i,h=++r,g=s;;){var p=e.charAt(h);switch(p){case"=":if(g===c)i=e.slice(r,h),g=o;else{if(g!==u)throw new Error("attribute equal must after attrName");g=o}break;case"'":case'"':if(g===o){if(r=h+1,!((h=e.indexOf(p,r))>0))throw new Error("attribute value no end '"+p+"' match");w=e.slice(r,h).replace(/&#?\w+;/g,a),t.add(i,w,r-1),g=f}else{if(g!=l)throw new Error('attribute value must after "="');w=e.slice(r,h).replace(/&#?\w+;/g,a),t.add(i,w,r),n.warning('attribute "'+i+'" missed start quot('+p+")!!"),r=h+1,g=f}break;case"/":switch(g){case s:t.setTagName(e.slice(r,h));case f:case d:case m:g=m,t.closed=!0;case l:case c:case u:break;default:throw new Error("attribute invalid close char('/')")}break;case"":n.error("unexpected end of input");case">":switch(g){case s:t.setTagName(e.slice(r,h));case f:case d:case m:break;case l:case c:"/"===(w=e.slice(r,h)).slice(-1)&&(t.closed=!0,w=w.slice(0,-1));case u:g===u&&(w=i),g==l?(n.warning('attribute "'+w+'" missed quot(")!!'),t.add(i,w.replace(/&#?\w+;/g,a),r)):(n.warning('attribute "'+w+'" missed value!! "'+w+'" instead!!'),t.add(w,w,r));break;case o:throw new Error("attribute value missed!!")}return h;case"":p=" ";default:if(p<=" ")switch(g){case s:t.setTagName(e.slice(r,h)),g=d;break;case c:i=e.slice(r,h),g=u;break;case l:var w=e.slice(r,h).replace(/&#?\w+;/g,a);n.warning('attribute "'+w+'" missed quot(")!!'),t.add(i,w,r);case f:g=d}else switch(g){case u:n.warning('attribute "'+i+'" missed value!! "'+i+'" instead!!'),t.add(i,i,r),r=h,g=c;break;case f:n.warning('attribute space is required"'+i+'"!!');case d:g=c,r=h;break;case o:g=l,r=h;break;case m:throw new Error("elements closed character '/' and '>' must be connected to")}}h++}}function w(e,r,t){for(var a=e.tagName,n=null,i=t[t.length-1].currentNSMap,s=e.length;s--;){var c=e[s],u=c.qName,o=c.value;if((m=u.indexOf(":"))>0)var l=c.prefix=u.slice(0,m),f=u.slice(m+1),d="xmlns"===l&&f;else f=u,l=null,d="xmlns"===u&&"";c.localName=f,!1!==d&&(null==n&&(n={},x(i,i={})),i[d]=n[d]=o,c.uri="http://www.w3.org/2000/xmlns/",r.startPrefixMapping(d,o))}for(s=e.length;s--;){(l=(c=e[s]).prefix)&&("xml"===l&&(c.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(c.uri=i[l]))}var m;(m=a.indexOf(":"))>0?(l=e.prefix=a.slice(0,m),f=e.localName=a.slice(m+1)):(l=null,f=e.localName=a);var h=e.uri=i[l||""];if(r.startElement(h,f,a,e),e.closed){if(r.endElement(h,f,a),n)for(l in n)r.endPrefixMapping(l)}else e.currentNSMap=i,e.localNSMap=n,t.push(e)}function b(e,r,t,a,n){if(/^(?:script|textarea)$/i.test(t)){var i=e.indexOf("</"+t+">",r),s=e.substring(r+1,i);if(/[&<]/.test(s))return/^script$/i.test(t)?(n.characters(s,0,s.length),i):(s=s.replace(/&#?\w+;/g,a),n.characters(s,0,s.length),i)}return r+1}function v(e,r,t,a){var n=a[t];return null==n&&(n=a[t]=e.lastIndexOf("</"+t+">")),n<r}function x(e,r){for(var t in e)r[t]=e[t]}function N(e,r,t,a){switch(e.charAt(r+2)){case"-":return"-"===e.charAt(r+3)?(n=e.indexOf("--\x3e",r+4))>r?(t.comment(e,r+4,n-r-4),n+3):(a.error("Unclosed comment"),-1):-1;default:if("CDATA["==e.substr(r+3,6)){var n=e.indexOf("]]>",r+9);return t.startCDATA(),t.characters(e,r+9,n-r-9),t.endCDATA(),n+3}var i=function(e,r){var t,a=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;n.lastIndex=r,n.exec(e);for(;t=n.exec(e);)if(a.push(t),t[1])return a}(e,r),s=i.length;if(s>1&&/!doctype/i.test(i[0][0])){var c=i[1][0],u=s>3&&/^public$/i.test(i[2][0])&&i[3][0],o=s>4&&i[4][0],l=i[s-1];return t.startDTD(c,u&&u.replace(/^(['"])(.*?)\1$/,"$2"),o&&o.replace(/^(['"])(.*?)\1$/,"$2")),t.endDTD(),l.index+l[0].length}}return-1}function F(e,r,t){var a=e.indexOf("?>",r);if(a){var n=e.substring(r,a).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){n[0].length;return t.processingInstruction(n[1],n[2]),a+2}return-1}return-1}function D(e){}function E(e,r){return e.__proto__=r,e}return h.prototype={parse:function(e,r,t){var a=this.domBuilder;a.startDocument(),x(r,r={}),function(e,r,t,a,n){function i(e){var r=e.slice(1,-1);return r in t?t[r]:"#"===r.charAt(0)?function(e){if(e>65535){var r=55296+((e-=65536)>>10),t=56320+(1023&e);return String.fromCharCode(r,t)}return String.fromCharCode(e)}(parseInt(r.substr(1).replace("x","0x"))):(n.error("entity not found:"+e),e)}function s(r){var t=e.substring(h,r).replace(/&#?\w+;/g,i);f&&c(h),a.characters(t,0,r-h),h=r}function c(r,t){for(;r>=o&&(t=l.exec(e));)u=t.index,o=u+t[0].length,f.lineNumber++;f.columnNumber=r-u+1}var u=0,o=0,l=/.+(?:\r\n?|\n)|.*$/g,f=a.locator,d=[{currentNSMap:r}],m={},h=0;for(;;){var x=e.indexOf("<",h);if(x<0){if(!e.substr(h).match(/^\s*$/)){var E=a.document,k=E.createTextNode(e.substr(h));E.appendChild(k),a.currentElement=k}return}switch(x>h&&s(x),e.charAt(x+1)){case"/":var A,C=e.indexOf(">",x+3),O=e.substring(x+2,C);if(!(d.length>1)){n.fatalError("end tag name not found for: "+O);break}var $=(A=d.pop()).localNSMap;if(A.tagName!=O&&n.fatalError("end tag name: "+O+" does not match the current start tagName: "+A.tagName),a.endElement(A.uri,A.localName,O),$)for(var T in $)a.endPrefixMapping(T);C++;break;case"?":f&&c(x),C=F(e,x,a);break;case"!":f&&c(x),C=N(e,x,a,n);break;default:try{f&&c(x);var M=new D,C=p(e,x,M,i,n),S=M.length;if(S&&f){for(var q=g(f,{}),x=0;x<S;x++){var y=M[x];c(y.offset),y.offset=g(f,{})}g(q,f)}!M.closed&&v(e,C,M.tagName,m)&&(M.closed=!0,t.nbsp||n.warning("unclosed xml attribute")),w(M,a,d),"http://www.w3.org/1999/xhtml"!==M.uri||M.closed?C++:C=b(e,C,M.tagName,i,a)}catch(e){n.error("element parse error: "+e),C=-1}}C<0?s(x+1):h=C}}(e,r,t,a,this.errorHandler),a.endDocument()}},D.prototype={setTagName:function(e){if(!i.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,r,t){if(!i.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:r,offset:t}},length:0,getLocalName:function(e){return this[e].localName},getOffset:function(e){return this[e].offset},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},E({},E.prototype)instanceof E||(E=function(e,r){function t(){}for(r in t.prototype=r,t=new t,e)t[r]=e[r];return t}),h});
//# sourceMappingURL=../../sourcemaps/mode/xml/sax.js.map
