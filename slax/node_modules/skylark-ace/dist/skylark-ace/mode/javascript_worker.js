/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var oop=require("../lib/oop"),Mirror=require("../worker/mirror").Mirror,lint=require("./javascript/jshint").JSHINT;function startRegex(e){return RegExp("^("+e.join("|")+")")}var disabledWarningsRe=startRegex(["Bad for in variable '(.+)'.",'Missing "use strict"']),errorsRe=startRegex(["Unexpected","Expected ","Confusing (plus|minus)","\\{a\\} unterminated regular expression","Unclosed ","Unmatched ","Unbegun comment","Bad invocation","Missing space after","Missing operator at"]),infoRe=startRegex(["Expected an assignment","Bad escapement of EOL","Unexpected comma","Unexpected space","Missing radix parameter.","A leading decimal point can","\\['{a}'\\] is better written in dot notation.","'{a}' used out of scope"]),JavaScriptWorker=exports.JavaScriptWorker=function(e){Mirror.call(this,e),this.setTimeout(500),this.setOptions()};oop.inherits(JavaScriptWorker,Mirror),function(){this.setOptions=function(e){this.options=e||{esnext:!0,moz:!0,devel:!0,browser:!0,node:!0,laxcomma:!0,laxbreak:!0,lastsemic:!0,onevar:!1,passfail:!1,maxerr:100,expr:!0,multistr:!0,globalstrict:!0},this.doc.getValue()&&this.deferredUpdate.schedule(100)},this.changeOptions=function(e){oop.mixin(this.options,e),this.doc.getValue()&&this.deferredUpdate.schedule(100)},this.isValidJS=function(str){try{eval("throw 0;"+str)}catch(e){if(0===e)return!0}return!1},this.onUpdate=function(){var e=this.doc.getValue();if(!(e=e.replace(/^#!.*\n/,"\n")))return this.sender.emit("annotate",[]);var t=[],r=this.isValidJS(e)?"warning":"error";lint(e,this.options,this.options.globals);for(var i=lint.errors,n=0;n<i.length;n++){var s=i[n];if(s){var a=s.raw,o="warning";if("Missing semicolon."==a){var c=s.evidence.substr(s.character);c=c.charAt(c.search(/\S/)),"error"==r&&c&&/[\w\d{(['"]/.test(c)?(s.reason='Missing ";" before statement',o="error"):o="info"}else{if(disabledWarningsRe.test(a))continue;infoRe.test(a)?o="info":errorsRe.test(a)?(!0,o=r):"'{a}' is not defined."==a?o="warning":"'{a}' is defined but never used."==a&&(o="info")}t.push({row:s.line-1,column:s.character-1,text:s.reason,type:o,raw:a})}}this.sender.emit("annotate",t)}}.call(JavaScriptWorker.prototype)});
//# sourceMappingURL=../sourcemaps/mode/javascript_worker.js.map
