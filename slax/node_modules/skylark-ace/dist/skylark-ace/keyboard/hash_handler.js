/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(n,i,e){"use strict";var t=n("../lib/keys"),a=n("../lib/useragent"),s=t.KEY_MODS;function o(n,i){this.platform=i||(a.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(n),this.$singleCommand=!0}function d(n,i){o.call(this,n,i),this.$singleCommand=!1}d.prototype=o.prototype,function(){function n(n){return"object"==typeof n&&n.bindKey&&n.bindKey.position||(n.isDefault?-100:0)}this.addCommand=function(n){this.commands[n.name]&&this.removeCommand(n),this.commands[n.name]=n,n.bindKey&&this._buildKeyHash(n)},this.removeCommand=function(n,i){var e=n&&("string"==typeof n?n:n.name);n=this.commands[e],i||delete this.commands[e];var t=this.commandKeyBinding;for(var a in t){var s=t[a];if(s==n)delete t[a];else if(Array.isArray(s)){var o=s.indexOf(n);-1!=o&&(s.splice(o,1),1==s.length&&(t[a]=s[0]))}}},this.bindKey=function(n,i,e){if("object"==typeof n&&n&&(void 0==e&&(e=n.position),n=n[this.platform]),n)return"function"==typeof i?this.addCommand({exec:i,bindKey:n,name:i.name||n}):void n.split("|").forEach(function(n){var t="";if(-1!=n.indexOf(" ")){var a=n.split(/\s+/);n=a.pop(),a.forEach(function(n){var i=this.parseKeys(n),e=s[i.hashId]+i.key;t+=(t?" ":"")+e,this._addCommandToBinding(t,"chainKeys")},this),t+=" "}var o=this.parseKeys(n),d=s[o.hashId]+o.key;this._addCommandToBinding(t+d,i,e)},this)},this._addCommandToBinding=function(i,e,t){var a,s=this.commandKeyBinding;if(e)if(!s[i]||this.$singleCommand)s[i]=e;else{Array.isArray(s[i])?-1!=(a=s[i].indexOf(e))&&s[i].splice(a,1):s[i]=[s[i]],"number"!=typeof t&&(t=n(e));var o=s[i];for(a=0;a<o.length;a++){if(n(o[a])>t)break}o.splice(a,0,e)}else delete s[i]},this.addCommands=function(n){n&&Object.keys(n).forEach(function(i){var e=n[i];if(e){if("string"==typeof e)return this.bindKey(e,i);"function"==typeof e&&(e={exec:e}),"object"==typeof e&&(e.name||(e.name=i),this.addCommand(e))}},this)},this.removeCommands=function(n){Object.keys(n).forEach(function(i){this.removeCommand(n[i])},this)},this.bindKeys=function(n){Object.keys(n).forEach(function(i){this.bindKey(i,n[i])},this)},this._buildKeyHash=function(n){this.bindKey(n.bindKey,n)},this.parseKeys=function(n){var i=n.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(n){return n}),e=i.pop(),a=t[e];if(t.FUNCTION_KEYS[a])e=t.FUNCTION_KEYS[a].toLowerCase();else{if(!i.length)return{key:e,hashId:-1};if(1==i.length&&"shift"==i[0])return{key:e.toUpperCase(),hashId:-1}}for(var s=0,o=i.length;o--;){var d=t.KEY_MODS[i[o]];if(null==d)return"undefined"!=typeof console&&console.error("invalid modifier "+i[o]+" in "+n),!1;s|=d}return{key:e,hashId:s}},this.findKeyCommand=function(n,i){var e=s[n]+i;return this.commandKeyBinding[e]},this.handleKeyboard=function(n,i,e,t){if(!(t<0)){var a=s[i]+e,o=this.commandKeyBinding[a];return n.$keyChain&&(n.$keyChain+=" "+a,o=this.commandKeyBinding[n.$keyChain]||o),!o||"chainKeys"!=o&&"chainKeys"!=o[o.length-1]?(n.$keyChain&&(i&&4!=i||1!=e.length?(-1==i||t>0)&&(n.$keyChain=""):n.$keyChain=n.$keyChain.slice(0,-a.length-1)),{command:o}):(n.$keyChain=n.$keyChain||a,{command:"null"})}},this.getStatusText=function(n,i){return i.$keyChain||""}}.call(o.prototype),i.HashHandler=o,i.MultiHashHandler=d});
//# sourceMappingURL=../sourcemaps/keyboard/hash_handler.js.map
