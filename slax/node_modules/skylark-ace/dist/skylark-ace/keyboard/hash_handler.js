/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var n=require("../lib/keys"),i=require("../lib/useragent"),e=n.KEY_MODS;function t(n,e){this.platform=e||(i.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(n),this.$singleCommand=!0}function a(n,i){t.call(this,n,i),this.$singleCommand=!1}a.prototype=t.prototype,function(){function i(n){return"object"==typeof n&&n.bindKey&&n.bindKey.position||(n.isDefault?-100:0)}this.addCommand=function(n){this.commands[n.name]&&this.removeCommand(n),this.commands[n.name]=n,n.bindKey&&this._buildKeyHash(n)},this.removeCommand=function(n,i){var e=n&&("string"==typeof n?n:n.name);n=this.commands[e],i||delete this.commands[e];var t=this.commandKeyBinding;for(var a in t){var s=t[a];if(s==n)delete t[a];else if(Array.isArray(s)){var o=s.indexOf(n);-1!=o&&(s.splice(o,1),1==s.length&&(t[a]=s[0]))}}},this.bindKey=function(n,i,t){if("object"==typeof n&&n&&(void 0==t&&(t=n.position),n=n[this.platform]),n)return"function"==typeof i?this.addCommand({exec:i,bindKey:n,name:i.name||n}):void n.split("|").forEach(function(n){var a="";if(-1!=n.indexOf(" ")){var s=n.split(/\s+/);n=s.pop(),s.forEach(function(n){var i=this.parseKeys(n),t=e[i.hashId]+i.key;a+=(a?" ":"")+t,this._addCommandToBinding(a,"chainKeys")},this),a+=" "}var o=this.parseKeys(n),d=e[o.hashId]+o.key;this._addCommandToBinding(a+d,i,t)},this)},this._addCommandToBinding=function(n,e,t){var a,s=this.commandKeyBinding;if(e)if(!s[n]||this.$singleCommand)s[n]=e;else{Array.isArray(s[n])?-1!=(a=s[n].indexOf(e))&&s[n].splice(a,1):s[n]=[s[n]],"number"!=typeof t&&(t=i(e));var o=s[n];for(a=0;a<o.length;a++){if(i(o[a])>t)break}o.splice(a,0,e)}else delete s[n]},this.addCommands=function(n){n&&Object.keys(n).forEach(function(i){var e=n[i];if(e){if("string"==typeof e)return this.bindKey(e,i);"function"==typeof e&&(e={exec:e}),"object"==typeof e&&(e.name||(e.name=i),this.addCommand(e))}},this)},this.removeCommands=function(n){Object.keys(n).forEach(function(i){this.removeCommand(n[i])},this)},this.bindKeys=function(n){Object.keys(n).forEach(function(i){this.bindKey(i,n[i])},this)},this._buildKeyHash=function(n){this.bindKey(n.bindKey,n)},this.parseKeys=function(i){var e=i.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(n){return n}),t=e.pop(),a=n[t];if(n.FUNCTION_KEYS[a])t=n.FUNCTION_KEYS[a].toLowerCase();else{if(!e.length)return{key:t,hashId:-1};if(1==e.length&&"shift"==e[0])return{key:t.toUpperCase(),hashId:-1}}for(var s=0,o=e.length;o--;){var d=n.KEY_MODS[e[o]];if(null==d)return"undefined"!=typeof console&&console.error("invalid modifier "+e[o]+" in "+i),!1;s|=d}return{key:t,hashId:s}},this.findKeyCommand=function(n,i){var t=e[n]+i;return this.commandKeyBinding[t]},this.handleKeyboard=function(n,i,t,a){if(!(a<0)){var s=e[i]+t,o=this.commandKeyBinding[s];return n.$keyChain&&(n.$keyChain+=" "+s,o=this.commandKeyBinding[n.$keyChain]||o),!o||"chainKeys"!=o&&"chainKeys"!=o[o.length-1]?(n.$keyChain&&(i&&4!=i||1!=t.length?(-1==i||a>0)&&(n.$keyChain=""):n.$keyChain=n.$keyChain.slice(0,-s.length-1)),{command:o}):(n.$keyChain=n.$keyChain||s,{command:"null"})}},this.getStatusText=function(n,i){return i.$keyChain||""}}.call(t.prototype),exports.HashHandler=t,exports.MultiHashHandler=a});
//# sourceMappingURL=../sourcemaps/keyboard/hash_handler.js.map
