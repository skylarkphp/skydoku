/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,n){"use strict";var r=e("../lib/dom"),i=e("../lib/event"),a=e("../lib/useragent"),o=200,s=200,d=5;function l(e){var t=e.editor,n=r.createElement("img");n.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.isOpera&&(n.style.cssText="width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;");["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"].forEach(function(t){e[t]=this[t]},this),t.addEventListener("mousedown",this.onMouseDown.bind(e));var l,u,g,h,f,v,m,y,D,p,w,E=t.container,A=0;function b(){var e=v;(function(e,n){var r=Date.now(),i=!n||e.row!=n.row,a=!n||e.column!=n.column;!p||i||a?(t.moveCursorToPosition(e),p=r,w={x:u,y:g}):c(w.x,w.y,u,g)>d?p=null:r-p>=s&&(t.renderer.scrollCursorIntoView(),p=null)})(v=t.renderer.screenToTextCoordinates(u,g),e),function(e,n){var r=Date.now(),i=t.renderer.layerConfig.lineHeight,a=t.renderer.layerConfig.characterWidth,s=t.renderer.scroller.getBoundingClientRect(),d={x:{left:u-s.left,right:s.right-u},y:{top:g-s.top,bottom:s.bottom-g}},l=Math.min(d.x.left,d.x.right),c=Math.min(d.y.top,d.y.bottom),h={row:e.row,column:e.column};l/a<=2&&(h.column+=d.x.left<d.x.right?-3:2),c/i<=1&&(h.row+=d.y.top<d.y.bottom?-1:1);var f=e.row!=h.row,v=e.column!=h.column,m=!n||e.row!=n.row;f||v&&!m?D?r-D>=o&&t.renderer.scrollCursorIntoView(h):D=r:D=null}(v,e)}function x(){f=t.selection.toOrientedRange(),l=t.session.addMarker(f,"ace_selection",t.getSelectionStyle()),t.clearSelection(),t.isFocused()&&t.renderer.$cursorLayer.setBlinking(!1),clearInterval(h),b(),h=setInterval(b,20),A=0,i.addListener(document,"mousemove",L)}function S(){clearInterval(h),t.session.removeMarker(l),l=null,t.selection.fromOrientedRange(f),t.isFocused()&&!y&&t.renderer.$cursorLayer.setBlinking(!t.getReadOnly()),f=null,v=null,A=0,D=null,p=null,i.removeListener(document,"mousemove",L)}this.onDragStart=function(e){if(this.cancelDrag||!E.draggable){var r=this;return setTimeout(function(){r.startSelect(),r.captureMouse(e)},0),e.preventDefault()}f=t.getSelectionRange();var i=e.dataTransfer;i.effectAllowed=t.getReadOnly()?"copy":"copyMove",a.isOpera&&(t.container.appendChild(n),n.scrollTop=0),i.setDragImage&&i.setDragImage(n,0,0),a.isOpera&&t.container.removeChild(n),i.clearData(),i.setData("Text",t.session.getTextRange()),y=!0,this.setState("drag")},this.onDragEnd=function(e){if(E.draggable=!1,y=!1,this.setState(null),!t.getReadOnly()){var n=e.dataTransfer.dropEffect;m||"move"!=n||t.session.remove(t.getSelectionRange()),t.renderer.$cursorLayer.setBlinking(!0)}this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(e){if(!t.getReadOnly()&&M(e.dataTransfer))return u=e.clientX,g=e.clientY,l||x(),A++,e.dataTransfer.dropEffect=m=O(e),i.preventDefault(e)},this.onDragOver=function(e){if(!t.getReadOnly()&&M(e.dataTransfer))return u=e.clientX,g=e.clientY,l||(x(),A++),null!==T&&(T=null),e.dataTransfer.dropEffect=m=O(e),i.preventDefault(e)},this.onDragLeave=function(e){if(--A<=0&&l)return S(),m=null,i.preventDefault(e)},this.onDrop=function(e){if(v){var n=e.dataTransfer;if(y)switch(m){case"move":f=f.contains(v.row,v.column)?{start:v,end:v}:t.moveText(f,v);break;case"copy":f=t.moveText(f,v,!0)}else{var r=n.getData("Text");f={start:v,end:t.session.insert(v,r)},t.focus(),m=null}return S(),i.preventDefault(e)}},i.addListener(E,"dragstart",this.onDragStart.bind(e)),i.addListener(E,"dragend",this.onDragEnd.bind(e)),i.addListener(E,"dragenter",this.onDragEnter.bind(e)),i.addListener(E,"dragover",this.onDragOver.bind(e)),i.addListener(E,"dragleave",this.onDragLeave.bind(e)),i.addListener(E,"drop",this.onDrop.bind(e));var T=null;function L(){null==T&&(T=setTimeout(function(){null!=T&&l&&S()},20))}function M(e){var t=e.types;return!t||Array.prototype.some.call(t,function(e){return"text/plain"==e||"Text"==e})}function O(e){var t=["copy","copymove","all","uninitialized"],n=a.isMac?e.altKey:e.ctrlKey,r="uninitialized";try{r=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var i="none";return n&&t.indexOf(r)>=0?i="copy":["move","copymove","linkmove","all","uninitialized"].indexOf(r)>=0?i="move":t.indexOf(r)>=0&&(i="copy"),i}}function c(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}(function(){this.dragWait=function(){Date.now()-this.mousedownEvent.time>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){this.editor.container.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(e){this.editor.renderer.$cursorLayer.setBlinking(!this.editor.getReadOnly()),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var e=this.editor;e.container.draggable=!0,e.renderer.$cursorLayer.setBlinking(!1),e.setStyle("ace_dragging");var t=a.isWin?"default":"move";e.renderer.setCursorStyle(t),this.setState("dragReady")},this.onMouseDrag=function(e){var t=this.editor.container;a.isIE&&"dragReady"==this.state&&(c(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)>3&&t.dragDrop());"dragWait"===this.state&&(c(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)>0&&(t.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition())))},this.onMouseDown=function(e){if(this.$dragEnabled){this.mousedownEvent=e;var t=this.editor,n=e.inSelection(),r=e.getButton();if(1===(e.domEvent.detail||1)&&0===r&&n){if(e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var i=e.domEvent.target||e.domEvent.srcElement;if("unselectable"in i&&(i.unselectable="on"),t.getDragDelay()){if(a.isWebKit)this.cancelDrag=!0,t.container.draggable=!0;this.setState("dragWait")}else this.startDrag();this.captureMouse(e,this.onMouseDrag.bind(this)),e.defaultPrevented=!0}}}}).call(l.prototype),t.DragdropHandler=l});
//# sourceMappingURL=../sourcemaps/mouse/dragdrop_handler.js.map
