/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,i){"use strict";var o=e("../lib/useragent");function s(e){e.$clickSelection=null;var t=e.editor;t.setDefaultHandler("mousedown",this.onMouseDown.bind(e)),t.setDefaultHandler("dblclick",this.onDoubleClick.bind(e)),t.setDefaultHandler("tripleclick",this.onTripleClick.bind(e)),t.setDefaultHandler("quadclick",this.onQuadClick.bind(e)),t.setDefaultHandler("mousewheel",this.onMouseWheel.bind(e)),t.setDefaultHandler("touchmove",this.onTouchMove.bind(e));["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"].forEach(function(t){e[t]=this[t]},this),e.selectByLines=this.extendSelectionBy.bind(e,"getLineRange"),e.selectByWords=this.extendSelectionBy.bind(e,"getWordRange")}function n(e,t){if(e.start.row==e.end.row)var i=2*t.column-e.start.column-e.end.column;else if(e.start.row!=e.end.row-1||e.start.column||e.end.column)i=2*t.row-e.start.row-e.end.row;else var i=t.column-4;return i<0?{cursor:e.start,anchor:e.end}:{cursor:e.end,anchor:e.start}}(function(){this.onMouseDown=function(e){var t=e.inSelection(),i=e.getDocumentPosition();this.mousedownEvent=e;var s=this.editor,n=e.getButton();return 0!==n?((s.getSelectionRange().isEmpty()||1==n)&&s.selection.moveToPosition(i),void(2==n&&(s.textInput.onContextMenu(e.domEvent),o.isMozilla||e.preventDefault()))):(this.mousedownEvent.time=Date.now(),!t||s.isFocused()||(s.focus(),!this.$focusTimeout||this.$clickSelection||s.inMultiSelectMode)?(this.captureMouse(e),this.startSelect(i,e.domEvent._clicks>1),e.preventDefault()):(this.setState("focusWait"),void this.captureMouse(e)))},this.startSelect=function(e,t){e=e||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var i=this.editor;this.mousedownEvent&&(this.mousedownEvent.getShiftKey()?i.selection.selectToPosition(e):t||i.selection.moveToPosition(e),t||this.select(),i.renderer.scroller.setCapture&&i.renderer.scroller.setCapture(),i.setStyle("ace_selecting"),this.setState("select"))},this.select=function(){var e,t=this.editor,i=t.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var o=this.$clickSelection.comparePoint(i);if(-1==o)e=this.$clickSelection.end;else if(1==o)e=this.$clickSelection.start;else{var s=n(this.$clickSelection,i);i=s.cursor,e=s.anchor}t.selection.setSelectionAnchor(e.row,e.column)}t.selection.selectToPosition(i),t.renderer.scrollCursorIntoView()},this.extendSelectionBy=function(e){var t,i=this.editor,o=i.renderer.screenToTextCoordinates(this.x,this.y),s=i.selection[e](o.row,o.column);if(this.$clickSelection){var l=this.$clickSelection.comparePoint(s.start),c=this.$clickSelection.comparePoint(s.end);if(-1==l&&c<=0)t=this.$clickSelection.end,s.end.row==o.row&&s.end.column==o.column||(o=s.start);else if(1==c&&l>=0)t=this.$clickSelection.start,s.start.row==o.row&&s.start.column==o.column||(o=s.end);else if(-1==l&&1==c)o=s.end,t=s.start;else{var r=n(this.$clickSelection,o);o=r.cursor,t=r.anchor}i.selection.setSelectionAnchor(t.row,t.column)}i.selection.selectToPosition(o),i.renderer.scrollCursorIntoView()},this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting"),this.editor.renderer.scroller.releaseCapture&&this.editor.renderer.scroller.releaseCapture()},this.focusWait=function(){var e,t,i,o,s=(e=this.mousedownEvent.x,t=this.mousedownEvent.y,i=this.x,o=this.y,Math.sqrt(Math.pow(i-e,2)+Math.pow(o-t,2))),n=Date.now();(s>0||n-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},this.onDoubleClick=function(e){var t=e.getDocumentPosition(),i=this.editor,o=i.session.getBracketRange(t);o?(o.isEmpty()&&(o.start.column--,o.end.column++),this.setState("select")):(o=i.selection.getWordRange(t.row,t.column),this.setState("selectByWords")),this.$clickSelection=o,this.select()},this.onTripleClick=function(e){var t=e.getDocumentPosition(),i=this.editor;this.setState("selectByLines");var o=i.getSelectionRange();o.isMultiLine()&&o.contains(t.row,t.column)?(this.$clickSelection=i.selection.getLineRange(o.start.row),this.$clickSelection.end=i.selection.getLineRange(o.end.row).end):this.$clickSelection=i.selection.getLineRange(t.row),this.select()},this.onQuadClick=function(e){var t=this.editor;t.selectAll(),this.$clickSelection=t.getSelectionRange(),this.setState("selectAll")},this.onMouseWheel=function(e){if(!e.getAccelKey()){e.getShiftKey()&&e.wheelY&&!e.wheelX&&(e.wheelX=e.wheelY,e.wheelY=0);var t=this.editor;this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0});var i=this.$lastScroll,o=e.domEvent.timeStamp,s=o-i.t,n=s?e.wheelX/s:i.vx,l=s?e.wheelY/s:i.vy;s<550&&(n=(n+i.vx)/2,l=(l+i.vy)/2);var c=Math.abs(n/l),r=!1;if(c>=1&&t.renderer.isScrollableBy(e.wheelX*e.speed,0)&&(r=!0),c<=1&&t.renderer.isScrollableBy(0,e.wheelY*e.speed)&&(r=!0),r)i.allowed=o;else if(o-i.allowed<550){Math.abs(n)<=1.5*Math.abs(i.vx)&&Math.abs(l)<=1.5*Math.abs(i.vy)?(r=!0,i.allowed=o):i.allowed=0}return i.t=o,i.vx=n,i.vy=l,r?(t.renderer.scrollBy(e.wheelX*e.speed,e.wheelY*e.speed),e.stop()):void 0}},this.onTouchMove=function(e){this.editor._emit("mousewheel",e)}}).call(s.prototype),t.DefaultHandlers=s});
//# sourceMappingURL=../sourcemaps/mouse/default_handlers.js.map
