/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(e,t,n){"use strict";var o=e("../lib/event"),s=e("../lib/useragent"),i=e("./default_handlers").DefaultHandlers,r=e("./default_gutter_handler").GutterHandler,u=e("./mouse_event").MouseEvent,d=e("./dragdrop_handler").DragdropHandler,a=e("../config"),l=function(e){var t=this;this.editor=e,new i(this),new r(this),new d(this);var n=function(t){(!document.hasFocus||!document.hasFocus()||!e.isFocused()&&document.activeElement==(e.textInput&&e.textInput.getElement()))&&window.focus(),e.focus()},u=e.renderer.getMouseEventTarget();o.addListener(u,"click",this.onMouseEvent.bind(this,"click")),o.addListener(u,"mousemove",this.onMouseMove.bind(this,"mousemove")),o.addMultiMouseDownListener([u,e.renderer.scrollBarV&&e.renderer.scrollBarV.inner,e.renderer.scrollBarH&&e.renderer.scrollBarH.inner,e.textInput&&e.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent"),o.addMouseWheelListener(e.container,this.onMouseWheel.bind(this,"mousewheel")),o.addTouchMoveListener(e.container,this.onTouchMove.bind(this,"touchmove"));var a=e.renderer.$gutter;o.addListener(a,"mousedown",this.onMouseEvent.bind(this,"guttermousedown")),o.addListener(a,"click",this.onMouseEvent.bind(this,"gutterclick")),o.addListener(a,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick")),o.addListener(a,"mousemove",this.onMouseEvent.bind(this,"guttermousemove")),o.addListener(u,"mousedown",n),o.addListener(a,"mousedown",n),s.isIE&&e.renderer.scrollBarV&&(o.addListener(e.renderer.scrollBarV.element,"mousedown",n),o.addListener(e.renderer.scrollBarH.element,"mousedown",n)),e.on("mousemove",function(n){if(!t.state&&!t.$dragDelay&&t.$dragEnabled){var o=e.renderer.screenToTextCoordinates(n.x,n.y),s=e.session.selection.getRange(),i=e.renderer;!s.isEmpty()&&s.insideStart(o.row,o.column)?i.setCursorStyle("default"):i.setCursorStyle("")}})};(function(){this.onMouseEvent=function(e,t){this.editor._emit(e,new u(t,this.editor))},this.onMouseMove=function(e,t){var n=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;n&&n.length&&this.editor._emit(e,new u(t,this.editor))},this.onMouseWheel=function(e,t){var n=new u(t,this.editor);n.speed=2*this.$scrollSpeed,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.onTouchMove=function(e,t){var n=new u(t,this.editor);n.speed=1,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.setState=function(e){this.state=e},this.captureMouse=function(e,t){this.x=e.x,this.y=e.y,this.isMousePressed=!0;var n=this.editor,i=this.editor.renderer;i.$keepTextAreaAtCursor&&(i.$keepTextAreaAtCursor=null);var r=this,d=function(e){if(e){if(s.isWebKit&&!e.which&&r.releaseMouse)return r.releaseMouse();r.x=e.clientX,r.y=e.clientY,t&&t(e),r.mouseEvent=new u(e,r.editor),r.$mouseMoved=!0}},a=function(e){n.off("beforeEndOperation",c),clearInterval(h),l(),r[r.state+"End"]&&r[r.state+"End"](e),r.state="",null==i.$keepTextAreaAtCursor&&(i.$keepTextAreaAtCursor=!0,i.$moveTextAreaToCursor()),r.isMousePressed=!1,r.$onCaptureMouseMove=r.releaseMouse=null,e&&r.onMouseEvent("mouseup",e),n.endOperation()},l=function(){r[r.state]&&r[r.state](),r.$mouseMoved=!1};if(s.isOldIE&&"dblclick"==e.domEvent.type)return setTimeout(function(){a(e)});var c=function(e){r.releaseMouse&&n.curOp.command.name&&n.curOp.selectionChanged&&(r[r.state+"End"]&&r[r.state+"End"](),r.state="",r.releaseMouse())};n.on("beforeEndOperation",c),n.startOperation({command:{name:"mouse"}}),r.$onCaptureMouseMove=d,r.releaseMouse=o.capture(this.editor.container,d,a);var h=setInterval(l,20)},this.releaseMouse=null,this.cancelContextMenu=function(){var e=function(t){t&&t.domEvent&&"contextmenu"!=t.domEvent.type||(this.editor.off("nativecontextmenu",e),t&&t.domEvent&&o.stopEvent(t.domEvent))}.bind(this);setTimeout(e,10),this.editor.on("nativecontextmenu",e)}}).call(l.prototype),a.defineOptions(l.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:s.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),t.MouseHandler=l});
//# sourceMappingURL=../sourcemaps/mouse/mouse_handler.js.map
