/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var e=require("../lib/event"),t=require("../lib/useragent"),n=require("./default_handlers").DefaultHandlers,o=require("./default_gutter_handler").GutterHandler,s=require("./mouse_event").MouseEvent,i=require("./dragdrop_handler").DragdropHandler,r=require("../config"),u=function(s){var r=this;this.editor=s,new n(this),new o(this),new i(this);var u=function(e){(!document.hasFocus||!document.hasFocus()||!s.isFocused()&&document.activeElement==(s.textInput&&s.textInput.getElement()))&&window.focus(),s.focus()},d=s.renderer.getMouseEventTarget();e.addListener(d,"click",this.onMouseEvent.bind(this,"click")),e.addListener(d,"mousemove",this.onMouseMove.bind(this,"mousemove")),e.addMultiMouseDownListener([d,s.renderer.scrollBarV&&s.renderer.scrollBarV.inner,s.renderer.scrollBarH&&s.renderer.scrollBarH.inner,s.textInput&&s.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent"),e.addMouseWheelListener(s.container,this.onMouseWheel.bind(this,"mousewheel")),e.addTouchMoveListener(s.container,this.onTouchMove.bind(this,"touchmove"));var a=s.renderer.$gutter;e.addListener(a,"mousedown",this.onMouseEvent.bind(this,"guttermousedown")),e.addListener(a,"click",this.onMouseEvent.bind(this,"gutterclick")),e.addListener(a,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick")),e.addListener(a,"mousemove",this.onMouseEvent.bind(this,"guttermousemove")),e.addListener(d,"mousedown",u),e.addListener(a,"mousedown",u),t.isIE&&s.renderer.scrollBarV&&(e.addListener(s.renderer.scrollBarV.element,"mousedown",u),e.addListener(s.renderer.scrollBarH.element,"mousedown",u)),s.on("mousemove",function(e){if(!r.state&&!r.$dragDelay&&r.$dragEnabled){var t=s.renderer.screenToTextCoordinates(e.x,e.y),n=s.session.selection.getRange(),o=s.renderer;!n.isEmpty()&&n.insideStart(t.row,t.column)?o.setCursorStyle("default"):o.setCursorStyle("")}})};(function(){this.onMouseEvent=function(e,t){this.editor._emit(e,new s(t,this.editor))},this.onMouseMove=function(e,t){var n=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;n&&n.length&&this.editor._emit(e,new s(t,this.editor))},this.onMouseWheel=function(e,t){var n=new s(t,this.editor);n.speed=2*this.$scrollSpeed,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.onTouchMove=function(e,t){var n=new s(t,this.editor);n.speed=1,n.wheelX=t.wheelX,n.wheelY=t.wheelY,this.editor._emit(e,n)},this.setState=function(e){this.state=e},this.captureMouse=function(n,o){this.x=n.x,this.y=n.y,this.isMousePressed=!0;var i=this.editor,r=this.editor.renderer;r.$keepTextAreaAtCursor&&(r.$keepTextAreaAtCursor=null);var u=this,d=function(e){if(e){if(t.isWebKit&&!e.which&&u.releaseMouse)return u.releaseMouse();u.x=e.clientX,u.y=e.clientY,o&&o(e),u.mouseEvent=new s(e,u.editor),u.$mouseMoved=!0}},a=function(e){i.off("beforeEndOperation",c),clearInterval(h),l(),u[u.state+"End"]&&u[u.state+"End"](e),u.state="",null==r.$keepTextAreaAtCursor&&(r.$keepTextAreaAtCursor=!0,r.$moveTextAreaToCursor()),u.isMousePressed=!1,u.$onCaptureMouseMove=u.releaseMouse=null,e&&u.onMouseEvent("mouseup",e),i.endOperation()},l=function(){u[u.state]&&u[u.state](),u.$mouseMoved=!1};if(t.isOldIE&&"dblclick"==n.domEvent.type)return setTimeout(function(){a(n)});var c=function(e){u.releaseMouse&&i.curOp.command.name&&i.curOp.selectionChanged&&(u[u.state+"End"]&&u[u.state+"End"](),u.state="",u.releaseMouse())};i.on("beforeEndOperation",c),i.startOperation({command:{name:"mouse"}}),u.$onCaptureMouseMove=d,u.releaseMouse=e.capture(this.editor.container,d,a);var h=setInterval(l,20)},this.releaseMouse=null,this.cancelContextMenu=function(){var t=function(n){n&&n.domEvent&&"contextmenu"!=n.domEvent.type||(this.editor.off("nativecontextmenu",t),n&&n.domEvent&&e.stopEvent(n.domEvent))}.bind(this);setTimeout(t,10),this.editor.on("nativecontextmenu",t)}}).call(u.prototype),r.defineOptions(u.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:t.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),exports.MouseHandler=u});
//# sourceMappingURL=../sourcemaps/mouse/mouse_handler.js.map
