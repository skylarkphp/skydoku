/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(t,i,s){"use strict";var e=t("./lib/oop"),h=t("./lib/dom"),r=t("./config"),o=t("./layer/gutter").Gutter,n=t("./layer/marker").Marker,l=t("./layer/text").Text,a=t("./layer/cursor").Cursor,c=t("./scrollbar").HScrollBar,u=t("./scrollbar").VScrollBar,d=t("./renderloop").RenderLoop,g=t("./layer/font_metrics").FontMetrics,$=t("./lib/event_emitter").EventEmitter,f=t("./css/editor.css"),p=t("./lib/useragent"),C=p.isIE;h.importCssString(f,"ace_editor.css");var L=function(t,i){var s=this;this.container=t||h.createElement("div"),h.addCssClass(this.container,"ace_editor"),h.HI_DPI&&h.addCssClass(this.container,"ace_hidpi"),this.setTheme(i),this.$gutter=h.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.$gutter.setAttribute("aria-hidden",!0),this.scroller=h.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=h.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new o(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new n(this.content);var e=this.$textLayer=new l(this.content);this.canvas=e.element,this.$markerFront=new n(this.content),this.$cursorLayer=new a(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new u(this.container,this),this.scrollBarH=new c(this.container,this),this.scrollBarV.addEventListener("scroll",function(t){s.$scrollAnimation||s.session.setScrollTop(t.data-s.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(t){s.$scrollAnimation||s.session.setScrollLeft(t.data-s.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new g(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.addEventListener("changeCharacterSize",function(t){s.updateCharacterSize(),s.onResize(!0,s.gutterWidth,s.$size.width,s.$size.height),s._signal("changeCharacterSize",t)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!p.isIOS,this.$loop=new d(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),r.resetOptions(this),r._emit("renderer",this)};(function(){this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,this.CHANGE_H_SCROLL=1024,e.implement(this,$),this.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin()},this.setSession=function(t){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),this.session=t,t&&this.scrollMargin.top&&t.getScrollTop()<=0&&t.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(t),this.$markerBack.setSession(t),this.$markerFront.setSession(t),this.$gutterLayer.setSession(t),this.$textLayer.setSession(t),t&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))},this.updateLines=function(t,i,s){if(void 0===i&&(i=1/0),this.$changedLines?(this.$changedLines.firstRow>t&&(this.$changedLines.firstRow=t),this.$changedLines.lastRow<i&&(this.$changedLines.lastRow=i)):this.$changedLines={firstRow:t,lastRow:i},this.$changedLines.lastRow<this.layerConfig.firstRow){if(!s)return;this.$changedLines.lastRow=this.layerConfig.lastRow}this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)},this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(t){t?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.$changes=0,this.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},this.onResize=function(t,i,s,e){if(!(this.resizing>2)){this.resizing>0?this.resizing++:this.resizing=t?1:0;var h=this.container;e||(e=h.clientHeight||h.scrollHeight),s||(s=h.clientWidth||h.scrollWidth);var r=this.$updateCachedSize(t,i,s,e);if(!this.$size.scrollerHeight||!s&&!e)return this.resizing=0;t&&(this.$gutterLayer.$padding=null),t?this.$renderChanges(r|this.$changes,!0):this.$loop.schedule(r|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarV.scrollLeft=this.scrollBarV.scrollTop=null}},this.$updateCachedSize=function(t,i,s,e){e-=this.$extraHeight||0;var r=0,o=this.$size,n={width:o.width,height:o.height,scrollerHeight:o.scrollerHeight,scrollerWidth:o.scrollerWidth};if(e&&(t||o.height!=e)&&(o.height=e,r|=this.CHANGE_SIZE,o.scrollerHeight=o.height,this.$horizScroll&&(o.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",r|=this.CHANGE_SCROLL),s&&(t||o.width!=s)){r|=this.CHANGE_SIZE,o.width=s,null==i&&(i=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=i,h.setStyle(this.scrollBarH.element.style,"left",i+"px"),h.setStyle(this.scroller.style,"left",i+this.margin.left+"px"),o.scrollerWidth=Math.max(0,s-i-this.scrollBarV.getWidth()-this.margin.h),h.setStyle(this.$gutter.style,"left",this.margin.left+"px");var l=this.scrollBarV.getWidth()+"px";h.setStyle(this.scrollBarH.element.style,"right",l),h.setStyle(this.scroller.style,"right",l),h.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight()),(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||t)&&(r|=this.CHANGE_FULL)}return o.$dirty=!s||!e,r&&this._signal("resize",n),r},this.onGutterResize=function(t){var i=this.$showGutter?t:0;i!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,i,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()?this.$loop.schedule(this.CHANGE_FULL):this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},this.adjustWrapLimit=function(){var t=this.$size.scrollerWidth-2*this.$padding,i=Math.floor(t/this.characterWidth);return this.session.adjustWrapLimit(i,this.$showPrintMargin&&this.$printMarginColumn)},this.setAnimatedScroll=function(t){this.setOption("animatedScroll",t)},this.getAnimatedScroll=function(){return this.$animatedScroll},this.setShowInvisibles=function(t){this.setOption("showInvisibles",t),this.session.$bidiHandler.setShowInvisibles(t)},this.getShowInvisibles=function(){return this.getOption("showInvisibles")},this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},this.setDisplayIndentGuides=function(t){this.setOption("displayIndentGuides",t)},this.setShowPrintMargin=function(t){this.setOption("showPrintMargin",t)},this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},this.setPrintMarginColumn=function(t){this.setOption("printMarginColumn",t)},this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},this.getShowGutter=function(){return this.getOption("showGutter")},this.setShowGutter=function(t){return this.setOption("showGutter",t)},this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},this.setFadeFoldWidgets=function(t){this.setOption("fadeFoldWidgets",t)},this.setHighlightGutterLine=function(t){this.setOption("highlightGutterLine",t)},this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},this.$updatePrintMargin=function(){if(this.$showPrintMargin||this.$printMarginEl){if(!this.$printMarginEl){var t=h.createElement("div");t.className="ace_layer ace_print-margin-layer",this.$printMarginEl=h.createElement("div"),this.$printMarginEl.className="ace_print-margin",t.appendChild(this.$printMarginEl),this.content.insertBefore(t,this.content.firstChild)}var i=this.$printMarginEl.style;i.left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px",i.visibility=this.$showPrintMargin?"visible":"hidden",this.session&&-1==this.session.$wrap&&this.adjustWrapLimit()}},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.scroller},this.getTextAreaContainer=function(){return this.container},this.$moveTextAreaToCursor=function(){var t=this.textarea.style;if(this.$keepTextAreaAtCursor){var i=this.$cursorLayer.$pixelPos;if(i){var s=this.$composition;s&&s.markerRange&&(i=this.$cursorLayer.getPixelPosition(s.markerRange.start,!0));var e=this.layerConfig,r=i.top,o=i.left;r-=e.offset;var n=s&&s.useTextareaForIME?this.lineHeight:C?0:1;if(r<0||r>e.height-n)h.translate(this.textarea,0,0);else{var l=1;if(s)if(s.useTextareaForIME){var a=this.textarea.value;l=this.characterWidth*this.session.$getStringScreenWidth(a)[0],n+=2}else r+=this.lineHeight+2;else r+=this.lineHeight;(o-=this.scrollLeft)>this.$size.scrollerWidth-l&&(o=this.$size.scrollerWidth-l),o+=this.gutterWidth+this.margin.left,h.setStyle(t,"height",n+"px"),h.setStyle(t,"width",l+"px"),h.translate(this.textarea,Math.min(o,this.$size.scrollerWidth-l),Math.min(r,this.$size.height-n))}}}else h.translate(this.textarea,-100,0)},this.getFirstVisibleRow=function(){return this.layerConfig.firstRow},this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(0===this.layerConfig.offset?0:1)},this.getLastFullyVisibleRow=function(){var t=this.layerConfig,i=t.lastRow;return this.session.documentToScreenRow(i,0)*t.lineHeight-this.session.getScrollTop()>t.height-t.lineHeight?i-1:i},this.getLastVisibleRow=function(){return this.layerConfig.lastRow},this.$padding=null,this.setPadding=function(t){this.$padding=t,this.$textLayer.setPadding(t),this.$cursorLayer.setPadding(t),this.$markerFront.setPadding(t),this.$markerBack.setPadding(t),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.setScrollMargin=function(t,i,s,e){var h=this.scrollMargin;h.top=0|t,h.bottom=0|i,h.right=0|e,h.left=0|s,h.v=h.top+h.bottom,h.h=h.left+h.right,h.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-h.top),this.updateFull()},this.setMargin=function(t,i,s,e){var h=this.margin;h.top=0|t,h.bottom=0|i,h.right=0|e,h.left=0|s,h.v=h.top+h.bottom,h.h=h.left+h.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},this.setHScrollBarAlwaysVisible=function(t){this.setOption("hScrollBarAlwaysVisible",t)},this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},this.setVScrollBarAlwaysVisible=function(t){this.setOption("vScrollBarAlwaysVisible",t)},this.$updateScrollBarV=function(){var t=this.layerConfig.maxHeight,i=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(t-=(i-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>t-i&&(t=this.scrollTop+i,this.scrollBarV.scrollTop=null)),this.scrollBarV.setScrollHeight(t+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},this.$frozen=!1,this.freeze=function(){this.$frozen=!0},this.unfreeze=function(){this.$frozen=!1},this.$renderChanges=function(t,i){if(this.$changes&&(t|=this.$changes,this.$changes=0),this.session&&this.container.offsetWidth&&!this.$frozen&&(t||i)){if(this.$size.$dirty)return this.$changes|=t,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender"),this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var s=this.layerConfig;if(t&this.CHANGE_FULL||t&this.CHANGE_SIZE||t&this.CHANGE_TEXT||t&this.CHANGE_LINES||t&this.CHANGE_SCROLL||t&this.CHANGE_H_SCROLL){if(t|=this.$computeLayerConfig()|this.$loop.clear(),s.firstRow!=this.layerConfig.firstRow&&s.firstRowScreen==this.layerConfig.firstRowScreen){var e=this.scrollTop+(s.firstRow-this.layerConfig.firstRow)*this.lineHeight;e>0&&(this.scrollTop=e,t|=this.CHANGE_SCROLL,t|=this.$computeLayerConfig()|this.$loop.clear())}s=this.layerConfig,this.$updateScrollBarV(),t&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),h.translate(this.content,-this.scrollLeft,-s.offset);var r=s.width+2*this.$padding+"px",o=s.minHeight+"px";h.setStyle(this.content.style,"width",r),h.setStyle(this.content.style,"height",o)}if(t&this.CHANGE_H_SCROLL&&(h.translate(this.content,-this.scrollLeft,-s.offset),this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left"),t&this.CHANGE_FULL)return this.$textLayer.update(s),this.$showGutter&&this.$gutterLayer.update(s),this.$markerBack.update(s),this.$markerFront.update(s),this.$cursorLayer.update(s),this.$moveTextAreaToCursor(),void this._signal("afterRender");if(t&this.CHANGE_SCROLL)return t&this.CHANGE_TEXT||t&this.CHANGE_LINES?this.$textLayer.update(s):this.$textLayer.scrollLines(s),this.$showGutter&&(t&this.CHANGE_GUTTER||t&this.CHANGE_LINES?this.$gutterLayer.update(s):this.$gutterLayer.scrollLines(s)),this.$markerBack.update(s),this.$markerFront.update(s),this.$cursorLayer.update(s),this.$moveTextAreaToCursor(),void this._signal("afterRender");t&this.CHANGE_TEXT?(this.$textLayer.update(s),this.$showGutter&&this.$gutterLayer.update(s)):t&this.CHANGE_LINES?(this.$updateLines()||t&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(s):t&this.CHANGE_TEXT||t&this.CHANGE_GUTTER?this.$showGutter&&this.$gutterLayer.update(s):t&this.CHANGE_CURSOR&&this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(s),t&this.CHANGE_CURSOR&&(this.$cursorLayer.update(s),this.$moveTextAreaToCursor()),t&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(s),t&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(s),this._signal("afterRender")}else this.$changes|=t},this.$autosize=function(){var t=this.session.getScreenLength()*this.lineHeight,i=this.$maxLines*this.lineHeight,s=Math.min(i,Math.max((this.$minLines||1)*this.lineHeight,t))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(s+=this.scrollBarH.getHeight()),this.$maxPixelHeight&&s>this.$maxPixelHeight&&(s=this.$maxPixelHeight);var e=!(s<=2*this.lineHeight)&&t>i;if(s!=this.desiredHeight||this.$size.height!=this.desiredHeight||e!=this.$vScroll){e!=this.$vScroll&&(this.$vScroll=e,this.scrollBarV.setVisible(e));var h=this.container.clientWidth;this.container.style.height=s+"px",this.$updateCachedSize(!0,this.$gutterWidth,h,s),this.desiredHeight=s,this._signal("autosize")}},this.$computeLayerConfig=function(){var t=this.session,i=this.$size,s=i.height<=2*this.lineHeight,e=this.session.getScreenLength()*this.lineHeight,h=this.$getLongestLine(),r=!s&&(this.$hScrollBarAlwaysVisible||i.scrollerWidth-h-2*this.$padding<0),o=this.$horizScroll!==r;o&&(this.$horizScroll=r,this.scrollBarH.setVisible(r));var n=this.$vScroll;this.$maxLines&&this.lineHeight>1&&this.$autosize();var l=i.scrollerHeight+this.lineHeight,a=!this.$maxLines&&this.$scrollPastEnd?(i.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;e+=a;var c=this.scrollMargin;this.session.setScrollTop(Math.max(-c.top,Math.min(this.scrollTop,e-i.scrollerHeight+c.bottom))),this.session.setScrollLeft(Math.max(-c.left,Math.min(this.scrollLeft,h+2*this.$padding-i.scrollerWidth+c.right)));var u=!s&&(this.$vScrollBarAlwaysVisible||i.scrollerHeight-e+a<0||this.scrollTop>c.top),d=n!==u;d&&(this.$vScroll=u,this.scrollBarV.setVisible(u));var g,$,f=this.scrollTop%this.lineHeight,p=Math.ceil(l/this.lineHeight)-1,C=Math.max(0,Math.round((this.scrollTop-f)/this.lineHeight)),L=C+p,m=this.lineHeight;C=t.screenToDocumentRow(C,0);var S=t.getFoldLine(C);S&&(C=S.start.row),g=t.documentToScreenRow(C,0),$=t.getRowLength(C)*m,L=Math.min(t.screenToDocumentRow(L,0),t.getLength()-1),l=i.scrollerHeight+t.getRowLength(L)*m+$,f=this.scrollTop-g*m;var H=0;return(this.layerConfig.width!=h||o)&&(H=this.CHANGE_H_SCROLL),(o||d)&&(H=this.$updateCachedSize(!0,this.gutterWidth,i.width,i.height),this._signal("scrollbarVisibilityChanged"),d&&(h=this.$getLongestLine())),this.layerConfig={width:h,padding:this.$padding,firstRow:C,firstRowScreen:g,lastRow:L,lineHeight:m,characterWidth:this.characterWidth,minHeight:l,maxHeight:e,offset:f,gutterOffset:m?Math.max(0,Math.ceil((f+i.height-i.scrollerHeight)/m)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(h-this.$padding),H},this.$updateLines=function(){if(this.$changedLines){var t=this.$changedLines.firstRow,i=this.$changedLines.lastRow;this.$changedLines=null;var s=this.layerConfig;if(!(t>s.lastRow+1||i<s.firstRow))return i===1/0?(this.$showGutter&&this.$gutterLayer.update(s),void this.$textLayer.update(s)):(this.$textLayer.updateLines(s,t,i),!0)}},this.$getLongestLine=function(){var t=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(t+=1),this.$textLayer&&t>this.$textLayer.MAX_LINE_LENGTH&&(t=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(t*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(t,i){this.$gutterLayer.addGutterDecoration(t,i)},this.removeGutterDecoration=function(t,i){this.$gutterLayer.removeGutterDecoration(t,i)},this.updateBreakpoints=function(t){this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(t){this.$gutterLayer.setAnnotations(t),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollSelectionIntoView=function(t,i,s){this.scrollCursorIntoView(t,s),this.scrollCursorIntoView(i,s)},this.scrollCursorIntoView=function(t,i,s){if(0!==this.$size.scrollerHeight){var e=this.$cursorLayer.getPixelPosition(t),h=e.left,r=e.top,o=s&&s.top||0,n=s&&s.bottom||0,l=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;l+o>r?(i&&l+o>r+this.lineHeight&&(r-=i*this.$size.scrollerHeight),0===r&&(r=-this.scrollMargin.top),this.session.setScrollTop(r)):l+this.$size.scrollerHeight-n<r+this.lineHeight&&(i&&l+this.$size.scrollerHeight-n<r-this.lineHeight&&(r+=i*this.$size.scrollerHeight),this.session.setScrollTop(r+this.lineHeight+n-this.$size.scrollerHeight));var a=this.scrollLeft;a>h?(h<this.$padding+2*this.layerConfig.characterWidth&&(h=-this.scrollMargin.left),this.session.setScrollLeft(h)):a+this.$size.scrollerWidth<h+this.characterWidth?this.session.setScrollLeft(Math.round(h+this.characterWidth-this.$size.scrollerWidth)):a<=this.$padding&&h-a<this.characterWidth&&this.session.setScrollLeft(0)}},this.getScrollTop=function(){return this.session.getScrollTop()},this.getScrollLeft=function(){return this.session.getScrollLeft()},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(t){this.session.setScrollTop(t*this.lineHeight)},this.alignCursor=function(t,i){"number"==typeof t&&(t={row:t,column:0});var s=this.$cursorLayer.getPixelPosition(t),e=this.$size.scrollerHeight-this.lineHeight,h=s.top-e*(i||0);return this.session.setScrollTop(h),h},this.STEPS=8,this.$calcSteps=function(t,i){var s,e,h=0,r=this.STEPS,o=[];for(h=0;h<r;++h)o.push((s=h/this.STEPS,e=t,(i-t)*(Math.pow(s-1,3)+1)+e));return o},this.scrollToLine=function(t,i,s,e){var h=this.$cursorLayer.getPixelPosition({row:t,column:0}).top;i&&(h-=this.$size.scrollerHeight/2);var r=this.scrollTop;this.session.setScrollTop(h),!1!==s&&this.animateScrolling(r,e)},this.animateScrolling=function(t,i){var s=this.scrollTop;if(this.$animatedScroll){var e=this;if(t!=s){if(this.$scrollAnimation){var h=this.$scrollAnimation.steps;if(h.length&&(t=h[0])==s)return}var r=e.$calcSteps(t,s);this.$scrollAnimation={from:t,to:s,steps:r},clearInterval(this.$timer),e.session.setScrollTop(r.shift()),e.session.$scrollTop=s,this.$timer=setInterval(function(){r.length?(e.session.setScrollTop(r.shift()),e.session.$scrollTop=s):null!=s?(e.session.$scrollTop=-1,e.session.setScrollTop(s),s=null):(e.$timer=clearInterval(e.$timer),e.$scrollAnimation=null,i&&i())},10)}}},this.scrollToY=function(t){this.scrollTop!==t&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=t)},this.scrollToX=function(t){this.scrollLeft!==t&&(this.scrollLeft=t),this.$loop.schedule(this.CHANGE_H_SCROLL)},this.scrollTo=function(t,i){this.session.setScrollTop(i),this.session.setScrollLeft(i)},this.scrollBy=function(t,i){i&&this.session.setScrollTop(this.session.getScrollTop()+i),t&&this.session.setScrollLeft(this.session.getScrollLeft()+t)},this.isScrollableBy=function(t,i){return i<0&&this.session.getScrollTop()>=1-this.scrollMargin.top||(i>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom||(t<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left||(t>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right||void 0)))},this.pixelToScreenCoordinates=function(t,i){var s;if(this.$hasCssTransforms){s={top:0,left:0};var e=this.$fontMetrics.transformCoordinates([t,i]);t=e[1]-this.gutterWidth-this.margin.left,i=e[0]}else s=this.scroller.getBoundingClientRect();var h=t+this.scrollLeft-s.left-this.$padding,r=h/this.characterWidth,o=Math.floor((i+this.scrollTop-s.top)/this.lineHeight),n=this.$blockCursor?Math.floor(r):Math.round(r);return{row:o,column:n,side:r-n>0?1:-1,offsetX:h}},this.screenToTextCoordinates=function(t,i){var s;if(this.$hasCssTransforms){s={top:0,left:0};var e=this.$fontMetrics.transformCoordinates([t,i]);t=e[1]-this.gutterWidth-this.margin.left,i=e[0]}else s=this.scroller.getBoundingClientRect();var h=t+this.scrollLeft-s.left-this.$padding,r=h/this.characterWidth,o=this.$blockCursor?Math.floor(r):Math.round(r),n=Math.floor((i+this.scrollTop-s.top)/this.lineHeight);return this.session.screenToDocumentPosition(n,Math.max(o,0),h)},this.textToScreenCoordinates=function(t,i){var s=this.scroller.getBoundingClientRect(),e=this.session.documentToScreenPosition(t,i),h=this.$padding+(this.session.$bidiHandler.isBidiRow(e.row,t)?this.session.$bidiHandler.getPosLeft(e.column):Math.round(e.column*this.characterWidth)),r=e.row*this.lineHeight;return{pageX:s.left+h-this.scrollLeft,pageY:s.top+r-this.scrollTop}},this.visualizeFocus=function(){h.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){h.removeCssClass(this.container,"ace_focus")},this.showComposition=function(t){this.$composition=t,t.cssText||(t.cssText=this.textarea.style.cssText,t.keepTextAreaAtCursor=this.$keepTextAreaAtCursor),t.useTextareaForIME=this.$useTextareaForIME,this.$useTextareaForIME?(this.$keepTextAreaAtCursor=!0,h.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):t.markerId=this.session.addMarker(t.markerRange,"ace_composition_marker","text")},this.setCompositionText=function(t){var i=this.session.selection.cursor;this.addToken(t,"composition_placeholder",i.row,i.column),this.$moveTextAreaToCursor()},this.hideComposition=function(){this.$composition&&(this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId),h.removeCssClass(this.textarea,"ace_composition"),this.$keepTextAreaAtCursor=this.$composition.keepTextAreaAtCursor,this.textarea.style.cssText=this.$composition.cssText,this.$composition=null,this.$cursorLayer.element.style.display="")},this.addToken=function(t,i,s,e){var h=this.session;h.bgTokenizer.lines[s]=null;var r={type:i,value:t},o=h.getTokens(s);if(null==e)o.push(r);else for(var n=0,l=0;l<o.length;l++){var a=o[l];if(e<=(n+=a.value.length)){var c=a.value.length-(n-e),u=a.value.slice(0,c),d=a.value.slice(c);o.splice(l,1,{type:a.type,value:u},r,{type:a.type,value:d});break}}this.updateLines(s,s)},this.setTheme=function(t,i){var s=this;if(this.$themeId=t,s._dispatchEvent("themeChange",{theme:t}),t&&"string"!=typeof t)o(t);else{var e=t||this.$options.theme.initialValue;r.loadModule(["theme",e],o)}function o(e){if(s.$themeId!=t)return i&&i();if(!e||!e.cssClass)throw new Error("couldn't load module "+t+" or it didn't call define");e.$id&&(s.$themeId=e.$id),h.importCssString(e.cssText,e.cssClass,s.container),s.theme&&h.removeCssClass(s.container,s.theme.cssClass);var r="padding"in e?e.padding:"padding"in(s.theme||{})?4:s.$padding;s.$padding&&r!=s.$padding&&s.setPadding(r),s.$theme=e.cssClass,s.theme=e,h.addCssClass(s.container,e.cssClass),h.setCssClass(s.container,"ace_dark",e.isDark),s.$size&&(s.$size.width=0,s.$updateSizeAsync()),s._dispatchEvent("themeLoaded",{theme:e}),i&&i()}},this.getTheme=function(){return this.$themeId},this.setStyle=function(t,i){h.setCssClass(this.container,t,!1!==i)},this.unsetStyle=function(t){h.removeCssClass(this.container,t)},this.setCursorStyle=function(t){h.setStyle(this.scroller.style,"cursor",t)},this.setMouseCursor=function(t){h.setStyle(this.scroller.style,"cursor",t)},this.attachToShadowRoot=function(){h.importCssString(f,"ace_editor.css",this.container)},this.destroy=function(){this.$fontMetrics.destroy(),this.$cursorLayer.destroy()}}).call(L.prototype),r.defineOptions(L.prototype,"renderer",{animatedScroll:{initialValue:!1},showInvisibles:{set:function(t){this.$textLayer.setShowInvisibles(t)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(t){"number"==typeof t&&(this.$printMarginColumn=t),this.$showPrintMargin=!!t,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(t){this.$gutter.style.display=t?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},fadeFoldWidgets:{set:function(t){h.setCssClass(this.$gutter,"ace_fade-fold-widgets",t)},initialValue:!1},showFoldWidgets:{set:function(t){this.$gutterLayer.setShowFoldWidgets(t),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(t){this.$textLayer.setDisplayIndentGuides(t)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightGutterLine:{set:function(t){this.$gutterLayer.setHighlightGutterLine(t),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(t){this.$hScrollBarAlwaysVisible&&this.$horizScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(t){this.$vScrollBarAlwaysVisible&&this.$vScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(t){"number"==typeof t&&(t+="px"),this.container.style.fontSize=t,this.updateFontSize()},initialValue:12},fontFamily:{set:function(t){this.container.style.fontFamily=t,this.updateFontSize()}},maxLines:{set:function(t){this.updateFull()}},minLines:{set:function(t){this.$minLines<562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(t){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(t){t=+t||0,this.$scrollPastEnd!=t&&(this.$scrollPastEnd=t,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(t){this.$gutterLayer.$fixedWidth=!!t,this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(t){this.setTheme(t)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!p.isMobile&&!p.isIE}}),i.VirtualRenderer=L});
//# sourceMappingURL=sourcemaps/virtual_renderer.js.map
