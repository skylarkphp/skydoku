/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(s,t,i){"use strict";var e=s("../lib/dom"),n=function(s){this.element=e.createElement("div"),this.element.className="ace_layer ace_cursor-layer",s.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),e.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)};(function(){this.$updateOpacity=function(s){for(var t=this.cursors,i=t.length;i--;)e.setStyle(t[i].style,"opacity",s?"":"0")},this.$startCssAnimation=function(){for(var s=this.cursors,t=s.length;t--;)s[t].style.animationDuration=this.blinkInterval+"ms";setTimeout(function(){e.addCssClass(this.element,"ace_animate-blinking")}.bind(this))},this.$stopCssAnimation=function(){e.removeCssClass(this.element,"ace_animate-blinking")},this.$padding=0,this.setPadding=function(s){this.$padding=s},this.setSession=function(s){this.session=s},this.setBlinking=function(s){s!=this.isBlinking&&(this.isBlinking=s,this.restartTimer())},this.setBlinkInterval=function(s){s!=this.blinkInterval&&(this.blinkInterval=s,this.restartTimer())},this.setSmoothBlinking=function(s){s!=this.smoothBlinking&&(this.smoothBlinking=s,e.setCssClass(this.element,"ace_smooth-blinking",s),this.$updateCursors(!0),this.restartTimer())},this.addCursor=function(){var s=e.createElement("div");return s.className="ace_cursor",this.element.appendChild(s),this.cursors.push(s),s},this.removeCursor=function(){if(this.cursors.length>1){var s=this.cursors.pop();return s.parentNode.removeChild(s),s}},this.hideCursor=function(){this.isVisible=!1,e.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,e.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var s=this.$updateCursors;if(clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&e.removeCssClass(this.element,"ace_smooth-blinking"),s(!0),this.isBlinking&&this.blinkInterval&&this.isVisible)if(this.smoothBlinking&&setTimeout(function(){e.addCssClass(this.element,"ace_smooth-blinking")}.bind(this)),e.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var t=function(){this.timeoutId=setTimeout(function(){s(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){s(!0),t()},this.blinkInterval),t()}else this.$stopCssAnimation()},this.getPixelPosition=function(s,t){if(!this.config||!this.session)return{left:0,top:0};s||(s=this.session.selection.getCursor());var i=this.session.documentToScreenPosition(s);return{left:this.$padding+(this.session.$bidiHandler.isBidiRow(i.row,s.row)?this.session.$bidiHandler.getPosLeft(i.column):i.column*this.config.characterWidth),top:(i.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight}},this.isCursorInView=function(s,t){return s.top>=0&&s.top<t.maxHeight},this.update=function(s){this.config=s;var t=this.session.$selectionMarkers,i=0,n=0;void 0!==t&&0!==t.length||(t=[{cursor:null}]);i=0;for(var r=t.length;i<r;i++){var o=this.getPixelPosition(t[i].cursor,!0);if(!((o.top>s.height+s.offset||o.top<0)&&i>1)){var h=this.cursors[n++]||this.addCursor(),a=h.style;this.drawCursor?this.drawCursor(h,o,s,t[i],this.session):this.isCursorInView(o,s)?(e.setStyle(a,"display","block"),e.translate(h,o.left,o.top),e.setStyle(a,"width",Math.round(s.characterWidth)+"px"),e.setStyle(a,"height",s.lineHeight+"px")):e.setStyle(a,"display","none")}}for(;this.cursors.length>n;)this.removeCursor();var l=this.session.getOverwrite();this.$setOverwrite(l),this.$pixelPos=o,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(s){s!=this.overwrite&&(this.overwrite=s,s?e.addCssClass(this.element,"ace_overwrite-cursors"):e.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(n.prototype),t.Cursor=n});
//# sourceMappingURL=../sourcemaps/layer/cursor.js.map
