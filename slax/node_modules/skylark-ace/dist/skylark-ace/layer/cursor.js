/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(require,exports,module){"use strict";var s=require("../lib/dom"),t=function(t){this.element=s.createElement("div"),this.element.className="ace_layer ace_cursor-layer",t.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),s.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)};(function(){this.$updateOpacity=function(t){for(var i=this.cursors,e=i.length;e--;)s.setStyle(i[e].style,"opacity",t?"":"0")},this.$startCssAnimation=function(){for(var t=this.cursors,i=t.length;i--;)t[i].style.animationDuration=this.blinkInterval+"ms";setTimeout(function(){s.addCssClass(this.element,"ace_animate-blinking")}.bind(this))},this.$stopCssAnimation=function(){s.removeCssClass(this.element,"ace_animate-blinking")},this.$padding=0,this.setPadding=function(s){this.$padding=s},this.setSession=function(s){this.session=s},this.setBlinking=function(s){s!=this.isBlinking&&(this.isBlinking=s,this.restartTimer())},this.setBlinkInterval=function(s){s!=this.blinkInterval&&(this.blinkInterval=s,this.restartTimer())},this.setSmoothBlinking=function(t){t!=this.smoothBlinking&&(this.smoothBlinking=t,s.setCssClass(this.element,"ace_smooth-blinking",t),this.$updateCursors(!0),this.restartTimer())},this.addCursor=function(){var t=s.createElement("div");return t.className="ace_cursor",this.element.appendChild(t),this.cursors.push(t),t},this.removeCursor=function(){if(this.cursors.length>1){var s=this.cursors.pop();return s.parentNode.removeChild(s),s}},this.hideCursor=function(){this.isVisible=!1,s.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.showCursor=function(){this.isVisible=!0,s.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},this.restartTimer=function(){var t=this.$updateCursors;if(clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&s.removeCssClass(this.element,"ace_smooth-blinking"),t(!0),this.isBlinking&&this.blinkInterval&&this.isVisible)if(this.smoothBlinking&&setTimeout(function(){s.addCssClass(this.element,"ace_smooth-blinking")}.bind(this)),s.HAS_CSS_ANIMATION)this.$startCssAnimation();else{var i=function(){this.timeoutId=setTimeout(function(){t(!1)},.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){t(!0),i()},this.blinkInterval),i()}else this.$stopCssAnimation()},this.getPixelPosition=function(s,t){if(!this.config||!this.session)return{left:0,top:0};s||(s=this.session.selection.getCursor());var i=this.session.documentToScreenPosition(s);return{left:this.$padding+(this.session.$bidiHandler.isBidiRow(i.row,s.row)?this.session.$bidiHandler.getPosLeft(i.column):i.column*this.config.characterWidth),top:(i.row-(t?this.config.firstRowScreen:0))*this.config.lineHeight}},this.isCursorInView=function(s,t){return s.top>=0&&s.top<t.maxHeight},this.update=function(t){this.config=t;var i=this.session.$selectionMarkers,e=0,n=0;void 0!==i&&0!==i.length||(i=[{cursor:null}]);e=0;for(var r=i.length;e<r;e++){var o=this.getPixelPosition(i[e].cursor,!0);if(!((o.top>t.height+t.offset||o.top<0)&&e>1)){var h=this.cursors[n++]||this.addCursor(),a=h.style;this.drawCursor?this.drawCursor(h,o,t,i[e],this.session):this.isCursorInView(o,t)?(s.setStyle(a,"display","block"),s.translate(h,o.left,o.top),s.setStyle(a,"width",Math.round(t.characterWidth)+"px"),s.setStyle(a,"height",t.lineHeight+"px")):s.setStyle(a,"display","none")}}for(;this.cursors.length>n;)this.removeCursor();var l=this.session.getOverwrite();this.$setOverwrite(l),this.$pixelPos=o,this.restartTimer()},this.drawCursor=null,this.$setOverwrite=function(t){t!=this.overwrite&&(this.overwrite=t,t?s.addCssClass(this.element,"ace_overwrite-cursors"):s.removeCssClass(this.element,"ace_overwrite-cursors"))},this.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)}}).call(t.prototype),exports.Cursor=t});
//# sourceMappingURL=../sourcemaps/layer/cursor.js.map
