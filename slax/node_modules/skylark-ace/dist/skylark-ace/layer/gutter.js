/**
 * skylark-ace - A version of ace v1.4.3 that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(function(t,e,s){"use strict";var i=t("../lib/dom"),n=t("../lib/oop"),r=t("../lib/lang"),o=t("../lib/event_emitter").EventEmitter,h=t("./lines").Lines,a=function(t){this.element=i.createElement("div"),this.element.className="ace_layer ace_gutter-layer",t.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new h(this.element),this.$lines.$offsetCoefficient=1};function l(t){var e=document.createTextNode("");t.appendChild(e);var s=i.createElement("span");return t.appendChild(s),t}(function(){n.implement(this,o),this.setSession=function(t){this.session&&this.session.removeEventListener("change",this.$updateAnnotations),this.session=t,t&&t.on("change",this.$updateAnnotations)},this.addGutterDecoration=function(t,e){window.console&&console.warn&&console.warn("deprecated use session.addGutterDecoration"),this.session.addGutterDecoration(t,e)},this.removeGutterDecoration=function(t,e){window.console&&console.warn&&console.warn("deprecated use session.removeGutterDecoration"),this.session.removeGutterDecoration(t,e)},this.setAnnotations=function(t){this.$annotations=[];for(var e=0;e<t.length;e++){var s=t[e],i=s.row,n=this.$annotations[i];n||(n=this.$annotations[i]={text:[]});var o=s.text;o=o?r.escapeHTML(o):s.html||"",-1===n.text.indexOf(o)&&n.text.push(o);var h=s.type;"error"==h?n.className=" ace_error":"warning"==h&&" ace_error"!=n.className?n.className=" ace_warning":"info"!=h||n.className||(n.className=" ace_info")}},this.$updateAnnotations=function(t){if(this.$annotations.length){var e=t.start.row,s=t.end.row-e;if(0===s);else if("remove"==t.action)this.$annotations.splice(e,s+1,null);else{var i=new Array(s+1);i.unshift(e,1),this.$annotations.splice.apply(this.$annotations,i)}}},this.update=function(t){this.config=t;var e=this.session,s=t.firstRow,i=Math.min(t.lastRow+t.gutterOffset,e.getLength()-1);this.oldLastRow=i,this.config=t,this.$lines.moveContainer(t),this.$updateCursorRow();for(var n=e.getNextFoldLine(s),r=n?n.start.row:1/0,o=null,h=-1,a=s;;){if(a>r&&(a=n.end.row+1,r=(n=e.getNextFoldLine(a,n))?n.start.row:1/0),a>i){for(;this.$lines.getLength()>h+1;)this.$lines.pop();break}(o=this.$lines.get(++h))?o.row=a:(o=this.$lines.createCell(a,t,this.session,l),this.$lines.push(o)),this.$renderCell(o,t,n,a),a++}this._signal("afterRender"),this.$updateGutterWidth(t)},this.$updateGutterWidth=function(t){var e=this.session,s=e.gutterRenderer||this.$renderer,i=e.$firstLineNumber,n=this.$lines.last()?this.$lines.last().text:"";(this.$fixedWidth||e.$useWrapMode)&&(n=e.getLength()+i-1);var r=s?s.getWidth(e,n,t):n.toString().length*t.characterWidth,o=this.$padding||this.$computePadding();(r+=o.left+o.right)===this.gutterWidth||isNaN(r)||(this.gutterWidth=r,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",r))},this.$updateCursorRow=function(){if(this.$highlightGutterLine){var t=this.session.selection.getCursor();this.$cursorRow!==t.row&&(this.$cursorRow=t.row)}},this.updateLineHighlight=function(){if(this.$highlightGutterLine){var t=this.session.selection.cursor.row;if(this.$cursorRow=t,!this.$cursorCell||this.$cursorCell.row!=t){this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));var e=this.$lines.cells;this.$cursorCell=null;for(var s=0;s<e.length;s++){var i=e[s];if(i.row>=this.$cursorRow){if(i.row>this.$cursorRow){var n=this.session.getFoldLine(this.$cursorRow);if(!(s>0&&n&&n.start.row==e[s-1].row))break;i=e[s-1]}i.element.className="ace_gutter-active-line "+i.element.className,this.$cursorCell=i;break}}}}},this.scrollLines=function(t){var e=this.config;if(this.config=t,this.$updateCursorRow(),this.$lines.pageChanged(e,t))return this.update(t);this.$lines.moveContainer(t);var s=Math.min(t.lastRow+t.gutterOffset,this.session.getLength()-1),i=this.oldLastRow;if(this.oldLastRow=s,!e||i<t.firstRow)return this.update(t);if(s<e.firstRow)return this.update(t);if(e.firstRow<t.firstRow)for(var n=this.session.getFoldedRowCount(e.firstRow,t.firstRow-1);n>0;n--)this.$lines.shift();if(i>s)for(n=this.session.getFoldedRowCount(s+1,i);n>0;n--)this.$lines.pop();t.firstRow<e.firstRow&&this.$lines.unshift(this.$renderLines(t,t.firstRow,e.firstRow-1)),s>i&&this.$lines.push(this.$renderLines(t,i+1,s)),this.updateLineHighlight(),this._signal("afterRender"),this.$updateGutterWidth(t)},this.$renderLines=function(t,e,s){for(var i=[],n=e,r=this.session.getNextFoldLine(n),o=r?r.start.row:1/0;n>o&&(n=r.end.row+1,o=(r=this.session.getNextFoldLine(n,r))?r.start.row:1/0),!(n>s);){var h=this.$lines.createCell(n,t,this.session,l);this.$renderCell(h,t,r,n),i.push(h),n++}return i},this.$renderCell=function(t,e,s,n){var r=t.element,o=this.session,h=r.childNodes[0],a=r.childNodes[1],l=o.$firstLineNumber,d=o.$breakpoints,u=o.$decorations,c=o.gutterRenderer||this.$renderer,g=this.$showFoldWidgets&&o.foldWidgets,$=s?s.start.row:Number.MAX_VALUE,f="ace_gutter-cell ";if(this.$highlightGutterLine&&(n==this.$cursorRow||s&&n<this.$cursorRow&&n>=$&&this.$cursorRow<=s.end.row)&&(f+="ace_gutter-active-line ",this.$cursorCell!=t&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=t)),d[n]&&(f+=d[n]),u[n]&&(f+=u[n]),this.$annotations[n]&&(f+=this.$annotations[n].className),r.className!=f&&(r.className=f),g){var w=g[n];null==w&&(w=g[n]=o.getFoldWidget(n))}if(w){f="ace_fold-widget ace_"+w;"start"==w&&n==$&&n<s.end.row?f+=" ace_closed":f+=" ace_open",a.className!=f&&(a.className=f);var p=e.lineHeight+"px";i.setStyle(a.style,"height",p),i.setStyle(a.style,"display","inline-block")}else a&&i.setStyle(a.style,"display","none");var m=(c?c.getText(o,n):n+l).toString();return m!==h.data&&(h.data=m),i.setStyle(t.element.style,"height",this.$lines.computeLineHeight(n,e,o)+"px"),i.setStyle(t.element.style,"top",this.$lines.computeLineTop(n,e,o)+"px"),t.text=m,t},this.$fixedWidth=!1,this.$highlightGutterLine=!0,this.$renderer="",this.setHighlightGutterLine=function(t){this.$highlightGutterLine=t},this.$showLineNumbers=!0,this.$renderer="",this.setShowLineNumbers=function(t){this.$renderer=!t&&{getWidth:function(){return 0},getText:function(){return""}}},this.getShowLineNumbers=function(){return this.$showLineNumbers},this.$showFoldWidgets=!0,this.setShowFoldWidgets=function(t){t?i.addCssClass(this.element,"ace_folding-enabled"):i.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=t,this.$padding=null},this.getShowFoldWidgets=function(){return this.$showFoldWidgets},this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var t=i.computedStyle(this.element.firstChild);return this.$padding={},this.$padding.left=(parseInt(t.borderLeftWidth)||0)+(parseInt(t.paddingLeft)||0)+1,this.$padding.right=(parseInt(t.borderRightWidth)||0)+(parseInt(t.paddingRight)||0),this.$padding},this.getRegion=function(t){var e=this.$padding||this.$computePadding(),s=this.element.getBoundingClientRect();return t.x<e.left+s.left?"markers":this.$showFoldWidgets&&t.x>s.right-e.right?"foldWidgets":void 0}}).call(a.prototype),e.Gutter=a});
//# sourceMappingURL=../sourcemaps/layer/gutter.js.map
