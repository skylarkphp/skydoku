/**
 * skylark-domx-colorpicker - The skylark dom plugin for picking color 
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-colorpicker/
 * @license MIT
 */
!function(e,t){var o=t.define,require=t.require,a="function"==typeof o&&o.amd,r=!a&&"undefined"!=typeof exports;if(!a&&!o){var s={};o=t.define=function(e,t,o){"function"==typeof o?(s[e]={factory:o,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var o=t.split("/"),a=e.split("/");o.pop();for(var r=0;r<a.length;r++)"."!=a[r]&&(".."==a[r]?o.pop():o.push(a[r]));return o.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):s[e]={factory:null,resolved:!0,exports:o}},require=t.require=function(e){if(!s.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=s[e];if(!module.resolved){var o=[];module.deps.forEach(function(e){o.push(require(e))}),module.exports=module.factory.apply(t,o)||null,module.resolved=!0}return module.exports}}if(!o)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-domx-colorpicker/draggable",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-eventer","skylark-domx-finder","skylark-domx-query"],function(e,t,o,a,r,s,l){return function(e,t,a,r){t=t||function(){},a=a||function(){},r=r||function(){};var s=document,i=!1,n={},c=0,d=0,p="ontouchstart"in window,f={};function h(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function u(a){if(i){if(o.isIE&&s.documentMode<9&&!a.button)return g();var r=a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches[0],l=r&&r.pageX||a.pageX,f=r&&r.pageY||a.pageY,u=Math.max(0,Math.min(l-n.left,d)),v=Math.max(0,Math.min(f-n.top,c));p&&h(a),t.apply(e,[u,v,a])}}function g(){i&&(l(s).off(f),l(s.body).removeClass("sp-dragging"),setTimeout(function(){r.apply(e,arguments)},0)),i=!1}f.selectstart=h,f.dragstart=h,f["touchmove mousemove"]=u,f["touchend mouseup"]=g,l(e).on("touchstart mousedown",function(t){(t.which?3==t.which:2==t.button)||i||!1!==a.apply(e,arguments)&&(i=!0,c=l(e).height(),d=l(e).width(),n=l(e).offset(),l(s).on(f),l(s.body).addClass("sp-dragging"),u(t),h(t))})}}),e("skylark-domx-colorpicker/ColorPicker",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-fx","skylark-data-color/colors","skylark-data-color/Color","./draggable"],function(e,t,o,a,r,s,l,i,n,c,d,p){"use strict";var f=t.noop,h={beforeShow:f,move:f,change:f,show:f,hide:f,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},u=[],g=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),v=function(){var e="";if(o.isIE)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function k(e,t,o,a){for(var r=[],l=0;l<e.length;l++){var i=e[l];if(i){var n=c.Color(i),p=n.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";p+=d.equals(t,i)?" sp-thumb-active":"";var f=n.toString(a.preferredFormat||"rgb"),h="background-color:"+n.toRgbString();r.push('<span title="'+f+'" data-color="'+n.toRgbString()+'" class="'+p+'"><span class="sp-thumb-inner" style="'+h+';" /></span>')}else{r.push(s("<div />").append(s('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",a.noColorSelectedText)).html())}}return"<div class='sp-cf "+o+"'>"+r.join("")+"</div>"}var m=t.Evented.inherit({klassName:"ColorPicker",init:function(e,a){var r=function(e,o){var a=t.mixin({},h,e);return a.callbacks={move:w(a.move,o),change:w(a.change,o),show:w(a.show,o),hide:w(a.hide,o),beforeShow:w(a.beforeShow,o)},a}(a,e),i=r.flat,n=r.showSelectionPalette,f=r.localStorageKey,m=r.theme,x=r.callbacks,b=t.debounce(Le,10),C=!1,P=!1,S=0,T=0,M=0,E=0,z=0,F=0,I=0,O=0,j=0,A=0,D=1,R=[],N=[],q={},H=r.selectionPalette.slice(0),L=r.maxSelectionSize,_="sp-dragging",K=null,B=e.ownerDocument,V=(B.body,s(e)),W=!1,X=s(v,B).addClass(m),Y=X.find(".sp-picker-container"),G=X.find(".sp-color"),J=X.find(".sp-dragger"),Q=X.find(".sp-hue"),U=X.find(".sp-slider"),Z=X.find(".sp-alpha-inner"),$=X.find(".sp-alpha"),ee=X.find(".sp-alpha-handle"),te=X.find(".sp-input"),oe=X.find(".sp-palette"),ae=X.find(".sp-initial"),re=X.find(".sp-cancel"),se=X.find(".sp-clear"),le=X.find(".sp-choose"),ie=X.find(".sp-palette-toggle"),ne=V.is("input"),ce=ne&&"color"===V.attr("type")&&inputTypeColorSupport(),de=ne&&!i,pe=de?s(g).addClass(m).addClass(r.className).addClass(r.replacerClassName):s([]),fe=de?pe:V,he=pe.find(".sp-preview-inner"),ue=r.color||ne&&V.val(),ge=!1,ve=r.preferredFormat,ke=!r.showButtons||r.clickoutFiresChange,me=!ue,ye=r.allowEmpty&&!ce;function we(){if(r.showPaletteOnly&&(r.showPalette=!0),ie.text(r.showPaletteOnly?r.togglePaletteMoreText:r.togglePaletteLessText),r.palette){R=r.palette.slice(0),N=t.isArray(R[0])?R:[R],q={};for(var e=0;e<N.length;e++)for(var o=0;o<N[e].length;o++){var a=d(N[e][o]).toRgbString();q[a]=!0}}X.toggleClass("sp-flat",i),X.toggleClass("sp-input-disabled",!r.showInput),X.toggleClass("sp-alpha-enabled",r.showAlpha),X.toggleClass("sp-clear-enabled",ye),X.toggleClass("sp-buttons-disabled",!r.showButtons),X.toggleClass("sp-palette-buttons-disabled",!r.togglePaletteOnly),X.toggleClass("sp-palette-disabled",!r.showPalette),X.toggleClass("sp-palette-only",r.showPaletteOnly),X.toggleClass("sp-initial-disabled",!r.showInitial),X.addClass(r.className).addClass(r.containerClassName),Le()}function xe(){if(f&&window.localStorage){try{var e=window.localStorage[f].split(",#");e.length>1&&(delete window.localStorage[f],t.each(e,function(e,t){be(t)}))}catch(e){}try{H=window.localStorage[f].split(";")}catch(e){}}}function be(e){if(n){var o=d(e).toRgbString();if(!q[o]&&-1===t.inArray(o,H))for(H.push(o);H.length>L;)H.shift();if(f&&window.localStorage)try{window.localStorage[f]=H.join(";")}catch(e){}}}function Ce(){var e=De(),o=t.map(N,function(t,o){return k(t,e,"sp-palette-row sp-palette-row-"+o,r)});xe(),H&&o.push(k(function(){var e=[];if(r.showPalette)for(var t=0;t<H.length;t++){var o=d(H[t]).toRgbString();q[o]||e.push(H[t])}return e.reverse().slice(0,r.maxSelectionSize)}(),e,"sp-palette-row sp-palette-row-selection",r)),oe.html(o.join(""))}function Pe(){if(r.showInitial){var e=ge,t=De();ae.html(k([e,t],t,"sp-palette-row-initial",r))}}function Se(){(T<=0||S<=0||E<=0)&&Le(),P=!0,X.addClass(_),K=null,V.trigger("dragstart.ColorPicker",[De()])}function Te(){P=!1,X.removeClass(_),V.trigger("dragstop.ColorPicker",[De()])}function Me(){var e=te.val();if(null!==e&&""!==e||!ye){var t=d(e);t.isValid()?(Ae(t),Re(),He()):te.addClass("sp-validation-error")}else Ae(null),Re(),He()}function Ee(){C?Oe():ze()}function ze(){var e=l.create("beforeShow.ColorPicker");C?Le():(V.trigger(e,[De()]),!1===x.beforeShow(De())||e.isDefaultPrevented()||(!function(){for(var e=0;e<u.length;e++)u[e]&&u[e].hide()}(),C=!0,s(B).on("keydown.ColorPicker",Fe),s(B).on("click.ColorPicker",Ie),s(window).on("resize.ColorPicker",b),pe.addClass("sp-active"),X.removeClass("sp-hidden"),Le(),Ne(),ge=De(),Pe(),x.show(ge),V.trigger("show.ColorPicker",[ge])))}function Fe(e){27===e.keyCode&&Oe()}function Ie(e){2!=e.button&&(P||(ke?He(!0):je(),Oe()))}function Oe(){C&&!i&&(C=!1,s(B).off("keydown.ColorPicker",Fe),s(B).off("click.ColorPicker",Ie),s(window).off("resize.ColorPicker",b),pe.removeClass("sp-active"),X.addClass("sp-hidden"),x.hide(De()),V.trigger("hide.ColorPicker",[De()]))}function je(){Ae(ge,!0),He(!0)}function Ae(e,t){var o,a;d.equals(e,De())?Ne():(!e&&ye?me=!0:(me=!1,o=c.Color(e),a=o.toHsv(),O=a.h%360/360,j=a.s,A=a.v,D=a.a),Ne(),o&&o.isValid()&&!t&&(ve=r.preferredFormat||o.getFormat()))}function De(e){return e=e||{},ye&&me?null:d.fromRatio({h:O,s:j,v:A,a:Math.round(1e3*D)/1e3},{format:e.format||ve})}function Re(){Ne(),x.move(De()),V.trigger("move.ColorPicker",[De()])}function Ne(){te.removeClass("sp-validation-error"),qe();var e=d.fromRatio({h:O,s:1,v:1});G.css("background-color",e.toHexString());var t=ve;D<1&&(0!==D||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var a=De({format:t}),s="";if(he.removeClass("sp-clear-display"),he.css("background-color","transparent"),!a&&ye)he.addClass("sp-clear-display");else{var l=a.toHexString(),i=a.toRgbString();if(he.css("background-color",i),r.showAlpha){var n=a.toRgb();n.a=0;var c=d(n).toRgbString(),p="linear-gradient(left, "+c+", "+l+")";o.isIE?Z.css("filter",d(c).toFilter({gradientType:1},l)):(Z.css("background","-webkit-"+p),Z.css("background","-moz-"+p),Z.css("background","-ms-"+p),Z.css("background","linear-gradient(to right, "+c+", "+l+")"))}s=a.toString(t)}r.showInput&&te.val(s),r.showPalette&&Ce(),Pe()}function qe(){var e=j,t=A;if(ye&&me)ee.hide(),U.hide(),J.hide();else{ee.show(),U.show(),J.show();var o=e*S,a=T-t*T;o=Math.max(-M,Math.min(S-M,o-M)),a=Math.max(-M,Math.min(T-M,a-M)),J.css({top:a+"px",left:o+"px"});var r=D*z;ee.css({left:r-F/2+"px"});var s=O*E;U.css({top:s-I+"px"})}}function He(e){var t=De(),o="",a=!d.equals(t,ge);t&&(o=t.toString(ve),be(t)),ne&&V.val(o),e&&a&&(x.change(t),V.trigger("change",[t]))}function Le(){var e,t,o,a,l,n,c,d,p,f,h,u;C&&(S=G.width(),T=G.height(),M=J.height(),Q.width(),E=Q.height(),I=U.height(),z=$.width(),F=ee.width(),i||(X.css("position","absolute"),r.offset?X.offset(r.offset):X.offset((t=fe,o=(e=X).outerWidth(),a=e.outerHeight(),l=t.outerHeight(),n=e[0].ownerDocument,c=n.documentElement,d=c.clientWidth+s(n).scrollLeft(),p=c.clientHeight+s(n).scrollTop(),f=t.offset(),h=f.left,u=f.top,u+=l,h-=Math.min(h,h+o>d&&d>o?Math.abs(h+o-d):0),{top:u-=Math.min(u,u+a>p&&p>a?Math.abs(a+l-0):0),bottom:f.bottom,left:h,right:f.right,width:f.width,height:f.height}))),qe(),r.showPalette&&Ce(),V.trigger("reflow.ColorPicker"))}function _e(){Oe(),W=!0,V.attr("disabled",!0),fe.addClass("sp-disabled")}!function(){o.isIE&&X.find("*:not(input)").attr("unselectable","on");we(),de&&V.after(pe).hide();ye||se.hide();if(i)V.after(X).hide();else{var e="parent"===r.appendTo?V.parent():s(r.appendTo);1!==e.length&&(e=s("body")),e.append(X)}xe(),fe.on("click.ColorPicker touchstart.ColorPicker",function(e){W||Ee(),e.stopPropagation(),s(e.target).is("input")||e.preventDefault()}),(V.is(":disabled")||!0===r.disabled)&&_e();X.click(y),te.change(Me),te.on("paste",function(){setTimeout(Me,1)}),te.keydown(function(e){13==e.keyCode&&Me()}),re.text(r.cancelText),re.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),je(),Oe()}),se.attr("title",r.clearText),se.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),me=!0,Re(),i&&He(!0)}),le.text(r.chooseText),le.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),o.isIE&&te.is(":focus")&&te.trigger("change"),te.hasClass("sp-validation-error")||(He(!0),Oe())}),ie.text(r.showPaletteOnly?r.togglePaletteMoreText:r.togglePaletteLessText),ie.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),r.showPaletteOnly=!r.showPaletteOnly,r.showPaletteOnly||i||X.css("left","-="+(Y.outerWidth(!0)+5)),we()}),p($,function(e,t,o){D=e/z,me=!1,o.shiftKey&&(D=Math.round(10*D)/10),Re()},Se,Te),p(Q,function(e,t){O=parseFloat(t/E),me=!1,r.showAlpha||(D=1),Re()},Se,Te),p(G,function(e,t,o){if(o.shiftKey){if(!K){var a=j*S,s=T-A*T,l=Math.abs(e-a)>Math.abs(t-s);K=l?"x":"y"}}else K=null;var i=!K||"y"===K;(!K||"x"===K)&&(j=parseFloat(e/S)),i&&(A=parseFloat((T-t)/T)),me=!1,r.showAlpha||(D=1),Re()},Se,Te),ue?(Ae(ue),Ne(),ve=r.preferredFormat||d(ue).format,be(ue)):Ne();i&&ze();function t(e){return e.data&&e.data.ignore?(Ae(s(e.target).closest(".sp-thumb-el").data("color")),Re()):(Ae(s(e.target).closest(".sp-thumb-el").data("color")),Re(),r.hideAfterPaletteSelect?(He(!0),Oe()):He()),!1}var a=o.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";oe.on(a,".sp-thumb-el",t),ae.on(a,".sp-thumb-el:nth-child(1)",{ignore:!0},t)}();var Ke={show:ze,hide:Oe,toggle:Ee,reflow:Le,option:function(e,o){if(void 0===e)return t.mixin({},r);if(void 0===o)return r[e];r[e]=o,"preferredFormat"===e&&(ve=r.preferredFormat);we()},enable:function(){W=!1,V.attr("disabled",!1),fe.removeClass("sp-disabled")},disable:_e,offset:function(e){r.offset=e,Le()},set:function(e){Ae(e),He()},get:De,destroy:function(){V.show(),fe.off("click.ColorPicker touchstart.ColorPicker"),X.remove(),pe.remove(),u[Ke.id]=null},container:X};return Ke.id=u.push(Ke)-1,Ke}});function y(e){e.stopPropagation()}function w(e,t){var o=Array.prototype.slice,a=o.call(arguments,2);return function(){return e.apply(t,a.concat(o.call(arguments)))}}var x="ColorPicker.id";return m.load=!0,m.loadOpts={},m.draggable=p,m.defaults=h,m.localization={},m.palettes={},s.fn.colorPicker=function(e,o){if("string"==typeof e){var a=this,r=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=u[s(this).data(x)];if(t){var o=t[e];if(!o)throw new Error("skylark-ui-colorpicker: no such method: '"+e+"'");"get"==e?a=t.get():"container"==e?a=t.container:"option"==e?a=t.option.apply(t,r):"destroy"==e?(t.destroy(),s(this).removeData(x)):o.apply(t,r)}}),a}return this.colorPicker("destroy").each(function(){var o=t.mixin({},s(this).data(),e),a=m(this,o);s(this).data(x,a.id)})},e.attach("domx.ColorPicker",m)}),e("skylark-domx-colorpicker/i18n/texts_ja",["../ColorPicker"],function(e){var t=e.localization.ja={cancelText:"中止",chooseText:"選択"};return t}),e("skylark-domx-colorpicker/i18n/texts_zh-cn",["../ColorPicker"],function(e){var t=e.localization["zh-cn"]={cancelText:"取消",chooseText:"选择",clearText:"清除",togglePaletteMoreText:"更多选项",togglePaletteLessText:"隐藏",noColorSelectedText:"尚未选择任何颜色"};return t}),e("skylark-domx-colorpicker/i18n/texts_zh-tw",["../ColorPicker"],function(e){var t=e.localization["zh-tw"]={cancelText:"取消",chooseText:"選擇",clearText:"清除",togglePaletteMoreText:"更多選項",togglePaletteLessText:"隱藏",noColorSelectedText:"尚未選擇任何顏色"};return t}),e("skylark-domx-colorpicker/main",["./ColorPicker","./i18n/texts_ja","./i18n/texts_zh-cn","./i18n/texts_zh-tw"],function(e){return e}),e("skylark-domx-colorpicker",["skylark-domx-colorpicker/main"],function(e){return e})}(o),!a){var l=require("skylark-langx-ns");r?module.exports=l:t.skylarkjs=l}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-domx-colorpicker.js.map
