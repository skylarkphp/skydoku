/**
 * skylark-domx-colorpicker - The skylark dom plugin for picking color 
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-colorpicker/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-fx","skylark-data-color/colors","skylark-data-color/Color","./draggable"],function(e,t,o,a,s,l,i,r,n,c,d,p){"use strict";var h=t.noop,f={beforeShow:h,move:h,change:h,show:h,hide:h,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},u=[],g=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),v=function(){var e="";if(o.isIE)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function m(e,t,o,a){for(var s=[],i=0;i<e.length;i++){var r=e[i];if(r){var n=c.Color(r),p=n.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";p+=d.equals(t,r)?" sp-thumb-active":"";var h=n.toString(a.preferredFormat||"rgb"),f="background-color:"+n.toRgbString();s.push('<span title="'+h+'" data-color="'+n.toRgbString()+'" class="'+p+'"><span class="sp-thumb-inner" style="'+f+';" /></span>')}else{s.push(l("<div />").append(l('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",a.noColorSelectedText)).html())}}return"<div class='sp-cf "+o+"'>"+s.join("")+"</div>"}var k=t.Evented.inherit({klassName:"ColorPicker",init:function(e,a){var s=function(e,o){var a=t.mixin({},f,e);return a.callbacks={move:b(a.move,o),change:b(a.change,o),show:b(a.show,o),hide:b(a.hide,o),beforeShow:b(a.beforeShow,o)},a}(a,e),r=s.flat,n=s.showSelectionPalette,h=s.localStorageKey,k=s.theme,y=s.callbacks,C=t.debounce(Ke,10),P=!1,x=!1,S=0,T=0,M=0,F=0,A=0,I=0,O=0,E=0,R=0,D=0,N=1,z=[],H=[],j={},q=s.selectionPalette.slice(0),K=s.maxSelectionSize,L="sp-dragging",B=null,W=e.ownerDocument,V=(W.body,l(e)),G=!1,J=l(v,W).addClass(k),Q=J.find(".sp-picker-container"),U=J.find(".sp-color"),X=J.find(".sp-dragger"),Y=J.find(".sp-hue"),Z=J.find(".sp-slider"),$=J.find(".sp-alpha-inner"),_=J.find(".sp-alpha"),ee=J.find(".sp-alpha-handle"),te=J.find(".sp-input"),oe=J.find(".sp-palette"),ae=J.find(".sp-initial"),se=J.find(".sp-cancel"),le=J.find(".sp-clear"),ie=J.find(".sp-choose"),re=J.find(".sp-palette-toggle"),ne=V.is("input"),ce=ne&&"color"===V.attr("type")&&inputTypeColorSupport(),de=ne&&!r,pe=de?l(g).addClass(k).addClass(s.className).addClass(s.replacerClassName):l([]),he=de?pe:V,fe=pe.find(".sp-preview-inner"),ue=s.color||ne&&V.val(),ge=!1,ve=s.preferredFormat,me=!s.showButtons||s.clickoutFiresChange,ke=!ue,we=s.allowEmpty&&!ce;function be(){if(s.showPaletteOnly&&(s.showPalette=!0),re.text(s.showPaletteOnly?s.togglePaletteMoreText:s.togglePaletteLessText),s.palette){z=s.palette.slice(0),H=t.isArray(z[0])?z:[z],j={};for(var e=0;e<H.length;e++)for(var o=0;o<H[e].length;o++){var a=d(H[e][o]).toRgbString();j[a]=!0}}J.toggleClass("sp-flat",r),J.toggleClass("sp-input-disabled",!s.showInput),J.toggleClass("sp-alpha-enabled",s.showAlpha),J.toggleClass("sp-clear-enabled",we),J.toggleClass("sp-buttons-disabled",!s.showButtons),J.toggleClass("sp-palette-buttons-disabled",!s.togglePaletteOnly),J.toggleClass("sp-palette-disabled",!s.showPalette),J.toggleClass("sp-palette-only",s.showPaletteOnly),J.toggleClass("sp-initial-disabled",!s.showInitial),J.addClass(s.className).addClass(s.containerClassName),Ke()}function ye(){if(h&&window.localStorage){try{var e=window.localStorage[h].split(",#");e.length>1&&(delete window.localStorage[h],t.each(e,function(e,t){Ce(t)}))}catch(e){}try{q=window.localStorage[h].split(";")}catch(e){}}}function Ce(e){if(n){var o=d(e).toRgbString();if(!j[o]&&-1===t.inArray(o,q))for(q.push(o);q.length>K;)q.shift();if(h&&window.localStorage)try{window.localStorage[h]=q.join(";")}catch(e){}}}function Pe(){var e=Ne(),o=t.map(H,function(t,o){return m(t,e,"sp-palette-row sp-palette-row-"+o,s)});ye(),q&&o.push(m(function(){var e=[];if(s.showPalette)for(var t=0;t<q.length;t++){var o=d(q[t]).toRgbString();j[o]||e.push(q[t])}return e.reverse().slice(0,s.maxSelectionSize)}(),e,"sp-palette-row sp-palette-row-selection",s)),oe.html(o.join(""))}function xe(){if(s.showInitial){var e=ge,t=Ne();ae.html(m([e,t],t,"sp-palette-row-initial",s))}}function Se(){(T<=0||S<=0||F<=0)&&Ke(),x=!0,J.addClass(L),B=null,V.trigger("dragstart.ColorPicker",[Ne()])}function Te(){x=!1,J.removeClass(L),V.trigger("dragstop.ColorPicker",[Ne()])}function Me(){var e=te.val();if(null!==e&&""!==e||!we){var t=d(e);t.isValid()?(De(t),ze(),qe()):te.addClass("sp-validation-error")}else De(null),ze(),qe()}function Fe(){P?Ee():Ae()}function Ae(){var e=i.create("beforeShow.ColorPicker");P?Ke():(V.trigger(e,[Ne()]),!1===y.beforeShow(Ne())||e.isDefaultPrevented()||(!function(){for(var e=0;e<u.length;e++)u[e]&&u[e].hide()}(),P=!0,l(W).on("keydown.ColorPicker",Ie),l(W).on("click.ColorPicker",Oe),l(window).on("resize.ColorPicker",C),pe.addClass("sp-active"),J.removeClass("sp-hidden"),Ke(),He(),ge=Ne(),xe(),y.show(ge),V.trigger("show.ColorPicker",[ge])))}function Ie(e){27===e.keyCode&&Ee()}function Oe(e){2!=e.button&&(x||(me?qe(!0):Re(),Ee()))}function Ee(){P&&!r&&(P=!1,l(W).off("keydown.ColorPicker",Ie),l(W).off("click.ColorPicker",Oe),l(window).off("resize.ColorPicker",C),pe.removeClass("sp-active"),J.addClass("sp-hidden"),y.hide(Ne()),V.trigger("hide.ColorPicker",[Ne()]))}function Re(){De(ge,!0),qe(!0)}function De(e,t){var o,a;d.equals(e,Ne())?He():(!e&&we?ke=!0:(ke=!1,a=(o=c.Color(e)).toHsv(),E=a.h%360/360,R=a.s,D=a.v,N=a.a),He(),o&&o.isValid()&&!t&&(ve=s.preferredFormat||o.getFormat()))}function Ne(e){return e=e||{},we&&ke?null:d.fromRatio({h:E,s:R,v:D,a:Math.round(1e3*N)/1e3},{format:e.format||ve})}function ze(){He(),y.move(Ne()),V.trigger("move.ColorPicker",[Ne()])}function He(){te.removeClass("sp-validation-error"),je();var e=d.fromRatio({h:E,s:1,v:1});U.css("background-color",e.toHexString());var t=ve;N<1&&(0!==N||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var a=Ne({format:t}),l="";if(fe.removeClass("sp-clear-display"),fe.css("background-color","transparent"),!a&&we)fe.addClass("sp-clear-display");else{var i=a.toHexString(),r=a.toRgbString();if(fe.css("background-color",r),s.showAlpha){var n=a.toRgb();n.a=0;var c=d(n).toRgbString(),p="linear-gradient(left, "+c+", "+i+")";o.isIE?$.css("filter",d(c).toFilter({gradientType:1},i)):($.css("background","-webkit-"+p),$.css("background","-moz-"+p),$.css("background","-ms-"+p),$.css("background","linear-gradient(to right, "+c+", "+i+")"))}l=a.toString(t)}s.showInput&&te.val(l),s.showPalette&&Pe(),xe()}function je(){var e=R,t=D;if(we&&ke)ee.hide(),Z.hide(),X.hide();else{ee.show(),Z.show(),X.show();var o=e*S,a=T-t*T;o=Math.max(-M,Math.min(S-M,o-M)),a=Math.max(-M,Math.min(T-M,a-M)),X.css({top:a+"px",left:o+"px"});var s=N*A;ee.css({left:s-I/2+"px"});var l=E*F;Z.css({top:l-O+"px"})}}function qe(e){var t=Ne(),o="",a=!d.equals(t,ge);t&&(o=t.toString(ve),Ce(t)),ne&&V.val(o),e&&a&&(y.change(t),V.trigger("change",[t]))}function Ke(){var e,t,o,a,i,n,c,d,p,h,f,u;P&&(S=U.width(),T=U.height(),M=X.height(),Y.width(),F=Y.height(),O=Z.height(),A=_.width(),I=ee.width(),r||(J.css("position","absolute"),s.offset?J.offset(s.offset):J.offset((t=he,o=(e=J).outerWidth(),a=e.outerHeight(),i=t.outerHeight(),n=e[0].ownerDocument,c=n.documentElement,d=c.clientWidth+l(n).scrollLeft(),p=c.clientHeight+l(n).scrollTop(),h=t.offset(),f=h.left,u=h.top,u+=i,f-=Math.min(f,f+o>d&&d>o?Math.abs(f+o-d):0),{top:u-=Math.min(u,u+a>p&&p>a?Math.abs(a+i-0):0),bottom:h.bottom,left:f,right:h.right,width:h.width,height:h.height}))),je(),s.showPalette&&Pe(),V.trigger("reflow.ColorPicker"))}function Le(){Ee(),G=!0,V.attr("disabled",!0),he.addClass("sp-disabled")}!function(){if(o.isIE&&J.find("*:not(input)").attr("unselectable","on"),be(),de&&V.after(pe).hide(),we||le.hide(),r)V.after(J).hide();else{var e="parent"===s.appendTo?V.parent():l(s.appendTo);1!==e.length&&(e=l("body")),e.append(J)}function t(e){return e.data&&e.data.ignore?(De(l(e.target).closest(".sp-thumb-el").data("color")),ze()):(De(l(e.target).closest(".sp-thumb-el").data("color")),ze(),s.hideAfterPaletteSelect?(qe(!0),Ee()):qe()),!1}ye(),he.on("click.ColorPicker touchstart.ColorPicker",function(e){G||Fe(),e.stopPropagation(),l(e.target).is("input")||e.preventDefault()}),(V.is(":disabled")||!0===s.disabled)&&Le(),J.click(w),te.change(Me),te.on("paste",function(){setTimeout(Me,1)}),te.keydown(function(e){13==e.keyCode&&Me()}),se.text(s.cancelText),se.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),Re(),Ee()}),le.attr("title",s.clearText),le.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),ke=!0,ze(),r&&qe(!0)}),ie.text(s.chooseText),ie.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),o.isIE&&te.is(":focus")&&te.trigger("change"),te.hasClass("sp-validation-error")||(qe(!0),Ee())}),re.text(s.showPaletteOnly?s.togglePaletteMoreText:s.togglePaletteLessText),re.on("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),s.showPaletteOnly=!s.showPaletteOnly,s.showPaletteOnly||r||J.css("left","-="+(Q.outerWidth(!0)+5)),be()}),p(_,function(e,t,o){N=e/A,ke=!1,o.shiftKey&&(N=Math.round(10*N)/10),ze()},Se,Te),p(Y,function(e,t){E=parseFloat(t/F),ke=!1,s.showAlpha||(N=1),ze()},Se,Te),p(U,function(e,t,o){if(o.shiftKey){if(!B){var a=R*S,l=T-D*T,i=Math.abs(e-a)>Math.abs(t-l);B=i?"x":"y"}}else B=null;var r=!B||"y"===B;(!B||"x"===B)&&(R=parseFloat(e/S)),r&&(D=parseFloat((T-t)/T)),ke=!1,s.showAlpha||(N=1),ze()},Se,Te),ue?(De(ue),He(),ve=s.preferredFormat||d(ue).format,Ce(ue)):He(),r&&Ae();var a=o.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";oe.on(a,".sp-thumb-el",t),ae.on(a,".sp-thumb-el:nth-child(1)",{ignore:!0},t)}();var Be={show:Ae,hide:Ee,toggle:Fe,reflow:Ke,option:function(e,o){return void 0===e?t.mixin({},s):void 0===o?s[e]:(s[e]=o,"preferredFormat"===e&&(ve=s.preferredFormat),void be())},enable:function(){G=!1,V.attr("disabled",!1),he.removeClass("sp-disabled")},disable:Le,offset:function(e){s.offset=e,Ke()},set:function(e){De(e),qe()},get:Ne,destroy:function(){V.show(),he.off("click.ColorPicker touchstart.ColorPicker"),J.remove(),pe.remove(),u[Be.id]=null},container:J};return Be.id=u.push(Be)-1,Be}});function w(e){e.stopPropagation()}function b(e,t){var o=Array.prototype.slice,a=o.call(arguments,2);return function(){return e.apply(t,a.concat(o.call(arguments)))}}var y="ColorPicker.id";return k.load=!0,k.loadOpts={},k.draggable=p,k.defaults=f,k.localization={},k.palettes={},l.fn.colorPicker=function(e,o){if("string"==typeof e){var a=this,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var t=u[l(this).data(y)];if(t){var o=t[e];if(!o)throw new Error("skylark-ui-colorpicker: no such method: '"+e+"'");"get"==e?a=t.get():"container"==e?a=t.container:"option"==e?a=t.option.apply(t,s):"destroy"==e?(t.destroy(),l(this).removeData(y)):o.apply(t,s)}}),a}return this.colorPicker("destroy").each(function(){var o=t.mixin({},l(this).data(),e),a=k(this,o);l(this).data(y,a.id)})},e.attach("domx.ColorPicker",k)});
//# sourceMappingURL=sourcemaps/ColorPicker.js.map
