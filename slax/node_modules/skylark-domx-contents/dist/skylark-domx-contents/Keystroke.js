/**
 * skylark-domx-contents - A dom plugin for  editing  the content of html element.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,i){var n=e.Evented.inherit({init:function(t,i){this.editable=t,this.opts=e.extend({},this.opts,i),this._keystrokeHandlers={},this._initKeystrokeHandlers()}});return n.pluginName="Keystroke",n.prototype.add=function(e,t,i){return e=e.toLowerCase(),e=this.editable.hotkeys.constructor.aliases[e]||e,this._keystrokeHandlers[e]||(this._keystrokeHandlers[e]={}),this._keystrokeHandlers[e][t]=i},n.prototype.respondTo=function(e){var i,n,r,l,a;if(n=null!=(r=this.editable.hotkeys.constructor.keyNameMap[e.which])?r.toLowerCase():void 0)return!!(n in this._keystrokeHandlers&&((l="function"==typeof(i=this._keystrokeHandlers[n])["*"]?i["*"](e):void 0)||this.editable.selection.startNodes().each((a=this,function(i,r){var s,o;if(r.nodeType===Node.ELEMENT_NODE)return s=null!=(o=a._keystrokeHandlers[n])?o[r.tagName.toLowerCase()]:void 0,!0!==(l="function"==typeof s?s(e,t(r)):void 0)&&!1!==l&&void 0})),l))||void 0},n.prototype._initKeystrokeHandlers=function(){var e,i;return this.editable.util.browser.safari&&this.add("enter","*",(i=this,function(e){var n,r;if(e.shiftKey&&!(n=i.editable.selection.blockNodes().last()).is("pre"))return r=t("<br/>"),i.editable.selection.rangeAtEndOf(n)?(i.editable.selection.insertNode(r),i.editable.selection.insertNode(t("<br/>")),i.editable.selection.setRangeBefore(r)):i.editable.selection.insertNode(r),!0})),(this.editable.util.browser.webkit||this.editable.util.browser.msie)&&(e=function(e){return function(i,n){var r;if(e.editable.selection.rangeAtEndOf(n))return r=t("<p/>").append(e.editable.util.phBr).insertAfter(n),e.editable.selection.setRangeAtStartOf(r),!0}}(this),this.add("enter","h1",e),this.add("enter","h2",e),this.add("enter","h3",e),this.add("enter","h4",e),this.add("enter","h5",e),this.add("enter","h6",e)),this.add("backspace","*",function(e){return function(t){var i,n,r;return(n=(r=e.editable.selection.rootNodes().first()).prev()).is("hr")&&e.editable.selection.rangeAtStartOf(r)?(e.editable.selection.save(),n.remove(),e.editable.selection.restore(),!0):((i=e.editable.selection.blockNodes().last()).is("."+this.opts.classPrefix+"resize-handle")&&r.is("."+this.opts.classPrefix+"table")&&(t.preventDefault(),r.remove(),e.editable.selection.setRangeAtEndOf(n)),n.is("."+this.opts.classPrefix+"table")&&!i.is("table")&&e.editable.util.isEmptyNode(i)&&(t.preventDefault(),i.remove(),e.editable.selection.setRangeAtEndOf(n)),e.editable.util.browser.webkit&&e.editable.selection.rangeAtStartOf(i)?(e.editable.selection.save(),e.editable.formatter.cleanNode(i,!0),e.editable.selection.restore(),null):void 0)}}(this)),this.add("enter","div",function(e){return function(i,n){var r;if(n.is("."+this.opts.classPrefix+"table")&&e.editable.selection.blockNodes().last().is("."+this.opts.classPrefix+"resize-handle"))return i.preventDefault(),r=t("<p/>").append(e.editable.util.phBr).insertAfter(n),e.editable.selection.setRangeAtStartOf(r)}}(this)),this.add("enter","li",function(e){return function(i,n){var r,l,a,s;if((r=n.clone()).find("ul, ol").remove(),e.editable.util.isEmptyNode(r)&&n.is(e.editable.selection.blockNodes().last())){if(l=n.parent(),n.next("li").length>0){if(!e.editable.util.isEmptyNode(n))return;l.parent("li").length>0?(a=t("<li/>").append(e.editable.util.phBr).insertAfter(l.parent("li")),s=t("<"+l[0].tagName+"/>").append(n.nextAll("li")),a.append(s)):(a=t("<p/>").append(e.editable.util.phBr).insertAfter(l),s=t("<"+l[0].tagName+"/>").append(n.nextAll("li")),a.after(s))}else l.parent("li").length>0?(a=t("<li/>").insertAfter(l.parent("li")),n.contents().length>0?a.append(n.contents()):a.append(e.editable.util.phBr)):(a=t("<p/>").append(e.editable.util.phBr).insertAfter(l),n.children("ul, ol").length>0&&a.after(n.children("ul, ol")));return n.prev("li").length?n.remove():n.prev("ul").length||n.prev("ol").length?n.remove():l.remove(),e.editable.selection.setRangeAtStartOf(a),!0}}}(this)),this.add("enter","pre",function(e){return function(i,n){var r,l,a;return i.preventDefault(),i.shiftKey?(r=t("<p/>").append(e.editable.util.phBr).insertAfter(n),e.editable.selection.setRangeAtStartOf(r),!0):(l=null,(a=e.editable.selection.range()).deleteContents(),l=!e.editable.util.browser.msie&&e.editable.selection.rangeAtEndOf(n)?document.createTextNode("\n\n"):document.createTextNode("\n"),a.insertNode(l),a.setEnd(l,1),a.collapse(!1),e.editable.selection.range(a),!0)}}(this)),this.add("enter","blockquote",function(e){return function(t,i){var n,r;if((n=e.editable.selection.blockNodes().last()).is("p")&&!n.next().length&&e.editable.util.isEmptyNode(n))return i.after(n),r=document.createRange(),e.editable.selection.setRangeAtStartOf(n,r),!0}}(this)),this.add("backspace","li",function(e){return function(i,n){var r,l,a,s,o,d,c,u,p;return l=n.children("ul, ol"),o=n.prev("li"),l.length>0&&o.length>0&&(p="",d=null,n.contents().each(function(e,i){return(1!==i.nodeType||!/UL|OL/.test(i.nodeName))&&(1===i.nodeType&&/BR/.test(i.nodeName)?void 0:(3===i.nodeType&&i.nodeValue?p+=i.nodeValue:1===i.nodeType&&(p+=t(i).text()),d=t(i)))}),c=e.editable.util.browser.firefox&&!d.next("br").length,d&&1===p.length&&c?(r=t(e.editable.util.phBr).insertAfter(d),d.remove(),e.editable.selection.setRangeBefore(r),!0):!(p.length>0)&&(u=document.createRange(),(s=o.children("ul, ol")).length>0?(a=t("<li/>").append(e.editable.util.phBr).appendTo(s),s.append(l.children("li")),n.remove(),e.editable.selection.setRangeAtEndOf(a,u)):(e.editable.selection.setRangeAtEndOf(o,u),o.append(l),n.remove(),e.editable.selection.range(u)),!0))}}(this)),this.add("backspace","pre",function(e){return function(i,n){var r,l,a;if(e.editable.selection.rangeAtStartOf(n))return l=n.html().replace("\n","<br/>")||e.editable.util.phBr,r=t("<p/>").append(l).insertAfter(n),n.remove(),a=document.createRange(),e.editable.selection.setRangeAtStartOf(r,a),!0}}(this)),this.add("backspace","blockquote",function(e){return function(t,i){var n,r;if(e.editable.selection.rangeAtStartOf(i))return n=i.children().first().unwrap(),r=document.createRange(),e.editable.selection.setRangeAtStartOf(n,r),!0}}(this))},i.Keystroke=n});
//# sourceMappingURL=sourcemaps/Keystroke.js.map
