/**
 * skylark-domx-contents - A dom plugin for  editing  the content of html element.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,n){var r=n.define,require=n.require,o="function"==typeof r&&r.amd,a=!o&&"undefined"!=typeof exports;if(!o&&!r){var s={};r=n.define=function(e,t,n){"function"==typeof n?(s[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),r=e.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):s[e]={factory:null,resolved:!0,exports:n}},require=n.require=function(e){if(!s.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=s[e];if(!module.resolved){var t=[];module.deps.forEach(function(e){t.push(require(e))}),module.exports=module.factory.apply(n,t)||null,module.resolved=!0}return module.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-langx-ns/_attach",[],function(){return function(e,t,n){"string"==typeof t&&(t=t.split("."));for(var r=t.length,i=e,o=0,a=t[o++];o<r;)i=i[a]=i[a]||{},a=t[o++];return i[a]=n}}),t("skylark-langx-ns/ns",["./_attach"],function(e){var t={attach:function(n,r){return e(t,n,r)}};return t}),t("skylark-langx-ns/main",["./ns"],function(e){return e}),t("skylark-langx-ns",["skylark-langx-ns/main"],function(e){return e}),t("skylark-langx/skylark",["skylark-langx-ns"],function(e){return e}),t("skylark-langx-types/types",["skylark-langx-ns"],function(e){var t,n={}.toString,r=(t={},"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e){t["[object "+e+"]"]=e.toLowerCase()}),function(e){return null==e?String(e):t[n.call(e)]||"object"});function i(e){var t;for(t in e)if(null!==e[t])return!1;return!0}function o(e){return"function"==r(e)}function a(e){return e&&e.nodeType}function s(e){return"number"==typeof e}function l(e){return"object"==r(e)}function u(e){return"string"==typeof e}function c(e){return e&&e==e.window}return e.attach("langx.types",{isArray:function(e){return e&&e.constructor===Array},isArrayLike:function(e){return!u(e)&&!a(e)&&"number"==typeof e.length&&!o(e)},isBoolean:function(e){return"boolean"==typeof e},isDefined:function(e){return void 0!==e},isDocument:function(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE},isEmpty:i,isEmptyObject:i,isFunction:o,isHtmlNode:a,isNull:function(e){return"null"===r(e)},isNumber:s,isNumeric:s,isObject:l,isPlainObject:function(e){return l(e)&&!c(e)&&Object.getPrototypeOf(e)==Object.prototype},isString:u,isSameOrigin:function(e){if(e){var t=location.protocol+"//"+location.hostname;return location.port&&(t+=":"+location.port),e.startsWith(t)}},isSymbol:function(e){return"symbol"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag},isUndefined:function(e){return void 0===e},isWindow:c,type:r})}),t("skylark-langx-types/main",["./types"],function(e){return e}),t("skylark-langx-types",["skylark-langx-types/main"],function(e){return e}),t("skylark-langx-numbers/numbers",["skylark-langx-ns","skylark-langx-types"],function(e,t){var n=t.isObject,r=t.isSymbol,i=1/0,o=1.7976931348623157e308,a=NaN,s=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,d=parseInt;function f(e){if(!e)return 0===e?e:0;if((e=h(e))===i||e===-i){var t=e<0?-1:1;return t*o}return e==e?e:0}function h(e){if("number"==typeof e)return e;if(r(e))return a;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var i=u.test(e);return i||c.test(e)?d(e.slice(2),i?2:8):l.test(e)?a:+e}return e.attach("langx.numbers",{toFinite:f,toNumber:h,toInteger:function(e){var t=f(e),n=t%1;return t==t?n?t-n:t:0}})}),t("skylark-langx-numbers/main",["./numbers"],function(e){return e}),t("skylark-langx-numbers",["skylark-langx-numbers/main"],function(e){return e}),t("skylark-langx-objects/objects",["skylark-langx-ns/ns","skylark-langx-ns/_attach","skylark-langx-types","skylark-langx-numbers"],function(e,t,n,r){var i,o,a=Object.prototype.hasOwnProperty,s=Array.prototype.slice,l=n.isBoolean,u=n.isFunction,c=n.isObject,d=n.isPlainObject,f=n.isArray,h=n.isArrayLike,p=n.isString,g=r.toInteger;var y,m,b="undefined"!=typeof Symbol?Symbol.prototype:null;function v(e){if(!c(e))return[];var t=[];for(var n in e)t.push(n);return t}function k(e,t){if(!f(t))return null!=e&&a.call(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!a.call(e,i))return!1;e=e[i]}return!!n}function x(e,t,n,r){for(var i in t)r&&void 0!==e[i]||(n&&(d(t[i])||f(t[i]))?(d(t[i])&&!d(e[i])&&(e[i]={}),f(t[i])&&!f(e[i])&&(e[i]=[]),x(e[i],t[i],n,r)):void 0!==t[i]&&(e[i]=t[i]));return e}function _(e){var t=s.call(arguments,0),n=t.shift(),r=!1;return l(t[t.length-1])&&(r=t.pop()),{target:n,sources:t,deep:r}}function w(){var e=_.apply(this,arguments);return e.sources.forEach(function(t){x(e.target,t,e.deep,!1)}),e.target}function N(e){for(var t=v(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}return i=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&o(e,t,n,r)},o=function(e,t,n,r){var o=toString.call(e);if(o!==toString.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return b.valueOf.call(e)===b.valueOf.call(t)}var a="[object Array]"===o;if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,l=t.constructor;if(s!==l&&!(u(s)&&s instanceof s&&u(l)&&l instanceof l)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var c=n.length;c--;)if(n[c]===e)return r[c]===t;if(n.push(e),r.push(t),a){if((c=e.length)!==t.length)return!1;for(;c--;)if(!i(e[c],t[c],n,r))return!1}else{var d,f=Object.keys(e);if(c=f.length,Object.keys(t).length!==c)return!1;for(;c--;)if(d=f[c],void 0===t[d]||!i(e[d],t[d],n,r))return!1}return n.pop(),r.pop(),!0},e.attach("langx.objects",{allKeys:v,attach:t,clone:function e(t,n){var r;if(void 0===t||null===t)r=t;else if(n&&t.clone)r=t.clone();else if(f(t)){r=[];for(var i=0;i<t.length;i++)r.push(e(t[i]))}else if(d(t))for(var o in r={},t)r[o]=e(t[o]);else r=t;return r},defaults:(y=v,m=!0,function(e){var t=arguments.length;if(m&&(e=Object(e)),t<2||null==e)return e;for(var n=1;n<t;n++)for(var r=arguments[n],i=y(r),o=i.length,a=0;a<o;a++){var s=i[a];m&&void 0!==e[s]||(e[s]=r[s])}return e}),each:function(e,t){var n,r,i,o;if(e)if(void 0===(n=e.length)){for(r in e)if(e.hasOwnProperty(r)&&(o=e[r],!1===t.call(o,r,o)))break}else for(i=0;i<n&&(o=e[i],!1!==t.call(o,i,o));i++);return this},extend:function(e){var t,n=s.call(arguments,1);"boolean"==typeof e&&(t=e,e=n.shift());0==n.length&&(n=[e],e=this);return n.forEach(function(n){w(e,n,t)}),e},has:k,isEqual:function(e,t){return i(e,t)},includes:function(e,t,n,r){e=h(e)?e:N(e),n=n&&!r?g(n):0;var i=e.length;n<0&&(n=nativeMax(i+n,0));return p(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&baseIndexOf(e,t,n)>-1},isMatch:function(e,t){var n=n(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var a=n[o];if(t[a]!==i[a]||!(a in i))return!1}return!0},keys:function(e){if(c(e))return[];var t=[];for(var n in e)k(e,n)&&t.push(n);return t},mixin:w,omit:function(e,t,n){if(!e)return null;for(var r=w({},e),i=1;i<arguments.length;i++){var o=arguments[i];o in e&&delete r[o]}return r},pick:function(e,t,n){if(!e)return null;for(var r={},i=1;i<arguments.length;i++){var o=arguments[i];o in e&&(r[o]=e[o])}return r},removeItem:function(e,t){if(f(e)){var n=e.indexOf(t);-1!=n&&e.splice(n,1)}else if(d(e))for(var r in e)if(e[r]==t){delete e[r];break}return this},result:function(e,t,n){f(t)||(t=t.split("."));var r=t.length;if(!r)return u(n)?n.call(e):n;for(var i=0;i<r;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=n,i=r),e=u(o)?o.call(e):o}return e},safeMixin:function(){var e=_.apply(this,arguments);return e.sources.forEach(function(t){x(e.target,t,e.deep,!0)}),e.target},values:N})}),t("skylark-langx-objects/main",["./objects"],function(e){return e}),t("skylark-langx-objects",["skylark-langx-objects/main"],function(e){return e}),t("skylark-langx-arrays/arrays",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects"],function(e,t,n){var r=Array.prototype.filter,i=t.isArrayLike;function o(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function a(e){return e!=e}function s(e){if(i(e)){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(i(r))for(var o=0;o<r.length;o++)t.push(r[o]);else t.push(r)}return t}return e}return e.attach("langx.arrays",{baseFindIndex:o,baseIndexOf:function(e,t,n){if(t!=t)return o(e,a,n);var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1},compact:function(e){return r.call(e,function(e){return null!=e})},first:function(e,t){return t?e.slice(0,t):e[0]},filter:function(e,t){return r.call(e,t)},flatten:s,grep:function(e,t){var r=[];return n.each(e,function(e,n){t(n,e)&&r.push(n)}),r},inArray:function(e,t){if(!t)return-1;var n;if(t.indexOf)return t.indexOf(e);n=t.length;for(;n--;)if(t[n]===e)return n;return-1},makeArray:function(e,t,n){if(i(e))return(n||[]).concat(Array.prototype.slice.call(e,t||0));return[e]},merge:function(e,t){var n=t.length,r=e.length,i=0;if("number"==typeof n)for(;i<n;i++)e[r++]=t[i];else for(;void 0!==t[i];)e[r++]=t[i++];return e.length=r,e},forEach:function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n)},map:function(e,t){var n,r,o,a=[];if(i(e))for(r=0;r<e.length;r++)null!=(n=t.call(e[r],e[r],r))&&a.push(n);else for(o in e)null!=(n=t.call(e[o],e[o],o))&&a.push(n);return s(a)},reduce:function(e,t,n){return Array.prototype.reduce.call(e,t,n)},uniq:function(e){return r.call(e,function(t,n){return e.indexOf(t)==n})}})}),t("skylark-langx-arrays/main",["./arrays"],function(e){return e}),t("skylark-langx-arrays",["skylark-langx-arrays/main"],function(e){return e}),t("skylark-langx/arrays",["skylark-langx-arrays"],function(e){return e}),t("skylark-langx-klass/klass",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects","skylark-langx-arrays"],function(e,t,n,r){var i=r.uniq,o=n.has,a=n.mixin,s=t.isArray,l=t.isDefined;var u=function(){function e(){return this._construct?this._construct.apply(this,arguments):this.init?this.init.apply(this,arguments):void 0}return function n(r,u,c,d){s(u)&&(d=c,c=u,u=null),u=u||Object,l(c)&&!s(c)&&(d=c,c=!1);var f=u;c&&(c=function(e,t){var n=[];return t.forEach(function(e){if(o(e,"__mixins__"))throw new Error("nested mixins");for(var t=[];e;)t.unshift(e),e=e.superclass;n=n.concat(t)}),(n=(n=i(n)).filter(function(t){for(var n=e;n;){if(t===n)return!1;if(o(n,"__mixins__"))for(var r=n.__mixins__,i=0;i<r.length;i++)if(r[i]===t)return!1;n=n.superclass}return!0})).length>0&&n}(f,c)),c&&(f=function(e,t){for(var n=e,r=0;r<t.length;r++){var i=new Function;i.prototype=Object.create(n.prototype),i.__proto__=n,i.superclass=null,a(i.prototype,t[r].prototype),i.prototype.__mixin__=t[r],n=i}return n}(f,c));var h=r.klassName||"",p=new Function("return function "+h+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return p.prototype=Object.create(f.prototype),p.prototype.constructor=p,p.superclass=u,p.__proto__=f,p._constructor||(p._constructor=e),c&&(p.__mixins__=c),p.partial||(p.partial=function(e,n){return function(e,n,r){var i=e.prototype,o=e.superclass.prototype,a=r&&r.noOverrided;r&&r.overrides;for(var s in n)if("constructor"!==s){var l=n[s];"function"==typeof n[s]?i[s]=l._constructor||a||"function"!=typeof o[s]?l:function(e,t,n){return function(){var e=this.overrided;this.overrided=n;var r=t.apply(this,arguments);return this.overrided=e,r}}(0,l,o[s]):t.isPlainObject(l)&&null!==l&&l.get?Object.defineProperty(i,s,l):i[s]=l}return e}(this,e,n)}),p.inherit||(p.inherit=function(e,t,r){return n(e,this,t,r)}),p.partial(r,d),p}}();return e.attach("langx.klass",u)}),t("skylark-langx-klass/main",["./klass"],function(e){return e}),t("skylark-langx-klass",["skylark-langx-klass/main"],function(e){return e}),t("skylark-langx/klass",["skylark-langx-klass"],function(e){return e}),t("skylark-langx/ArrayStore",["./klass"],function(e){var t=function(e){if(!e)return e;var n=!!e.then;function r(r){e[r]=function(){var i=arguments,o=Deferred.when(e,function(e){return t(Array.prototype[r].apply(e,i))});if("forEach"!==r||n)return o}}return n&&(e=Object.delegate(e)),r("forEach"),r("filter"),r("map"),null==e.total&&(e.total=Deferred.when(e,function(e){return e.length})),e},n=e({klassName:"ArrayStore",queryEngine:function(e,t){switch(typeof e){default:throw new Error("Can not query with a "+typeof e);case"object":case"undefined":var n=e;e=function(e){for(var t in n){var r=n[t];if(r&&r.test){if(!r.test(e[t],e))return!1}else if(r!=e[t])return!1}return!0};break;case"string":if(!this[e])throw new Error("No filter function "+e+" was found in store");e=this[e];case"function":}function r(n){var r=function(e,t,n){var r,i=0,o=e&&e.length||0,a=[];o&&"string"==typeof e&&(e=e.split(""));"string"==typeof t&&(t=cache[t]||buildFn(t));if(n)for(;i<o;++i)r=e[i],t.call(n,r,i,e)&&a.push(r);else for(;i<o;++i)r=e[i],t(r,i,e)&&a.push(r);return a}(n,e),i=t&&t.sort;if(i&&r.sort("function"==typeof i?i:function(e,t){for(var n,r=0;n=i[r];r++){var o=e[n.attribute],a=t[n.attribute];if(o=null!=o?o.valueOf():o,a=null!=a?a.valueOf():a,o!=a)return!!n.descending==(null==o||o>a)?-1:1}return 0}),t&&(t.start||t.count)){var o=r.length;(r=r.slice(t.start||0,(t.start||0)+(t.count||1/0))).total=o}return r}return r.matches=e,r},idProperty:"id",get:function(e){return this.data[this.index[e]]},getIdentity:function(e){return e[this.idProperty]},put:function(e,t){var n=this.data,r=this.index,i=this.idProperty,o=e[i]=t&&"id"in t?t.id:i in e?e[i]:Math.random();if(o in r){if(t&&!1===t.overwrite)throw new Error("Object already exists");n[r[o]]=e}else r[o]=n.push(e)-1;return o},add:function(e,t){return(t=t||{}).overwrite=!1,this.put(e,t)},remove:function(e){var t=this.index,n=this.data;if(e in t)return n.splice(t[e],1),this.setData(n),!0},query:function(e,n){return t(this.queryEngine(e,n)(this.data))},setData:function(e){e.items?(this.idProperty=e.identifier||this.idProperty,e=this.data=e.items):this.data=e,this.index={};for(var t=0,n=e.length;t<n;t++)this.index[e[t][this.idProperty]]=t},init:function(e){for(var t in e)this[t]=e[t];this.setData(this.data||[])}});return n}),t("skylark-langx-aspect/aspect",["skylark-langx-ns"],function(e){var t,n=0;function r(e){return function(r,i,o,a){var s,l=r[i];l&&l.target==r||(r[i]=s=function(){for(var e=n,r=arguments,i=s.before;i;)r=i.advice.apply(this,r)||r,i=i.next;if(s.around)var o=s.around.advice(this,r);for(var a=s.after;a&&a.id<e;){if(a.receiveArguments){var l=a.advice.apply(this,r);o=l===t?o:l}else o=a.advice.call(this,o,r);a=a.next}return o},l&&(s.around={advice:function(e,t){return l.apply(e,t)}}),s.target=r);var u=function(e,t,r,i){var o,a=e[t],s="around"==t;if(s){var l=r(function(){return a.advice(this,arguments)});o={remove:function(){l&&(l=e=r=null)},advice:function(e,t){return l?l.apply(e,t):a.advice(e,t)}}}else o={remove:function(){if(o.advice){var n=o.previous,i=o.next;i||n?(n?n.next=i:e[t]=i,i&&(i.previous=n)):delete e[t],e=r=o.advice=null}},id:n++,advice:r,receiveArguments:i};if(a&&!s)if("after"==t){for(;a.next&&(a=a.next););a.next=o,o.previous=a}else"before"==t&&(e[t]=o,o.next=a,a.previous=o);else e[t]=o;return o}(s||l,e,o,a);return o=null,u}}return e.attach("langx.aspect",{after:r("after"),around:r("around"),before:r("before")})}),t("skylark-langx-aspect/main",["./aspect"],function(e){return e}),t("skylark-langx-aspect",["skylark-langx-aspect/main"],function(e){return e}),t("skylark-langx/aspect",["skylark-langx-aspect"],function(e){return e}),t("skylark-langx-funcs/funcs",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects"],function(e,t,n){var r=n.mixin,i=Array.prototype.slice,o=t.isFunction,a=t.isString;var s=function(){function e(){}return function(t,n){e.prototype=t;var i=new e;return e.prototype=null,n&&r(i,n),i}}(),l={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};return e.attach("langx.funcs",{debounce:function(e,t){var n;return function(){var r=this,i=arguments;n&&clearTimeout(n),n=setTimeout(function(){n=null,e.apply(r,i)},t)}},delegate:s,defer:function(e){requestAnimationFrame?requestAnimationFrame(e):setTimeoutout(e);return this},noop:function(){},proxy:function e(t,n){var r=2 in arguments&&i.call(arguments,2);if(o(t)){return function(){return t.apply(n,r?r.concat(i.call(arguments)):arguments)}}if(a(n))return r?(r.unshift(t[n],t),e.apply(null,r)):e(t[n],t);throw new TypeError("expected function")},returnTrue:function(){return!0},returnFalse:function(){return!1},templateSettings:l,template:function(e,t,r){!t&&r&&(t=r);t=n.defaults({},t,l);var i,o=RegExp([(t.escape||noMatch).source,(t.interpolate||noMatch).source,(t.evaluate||noMatch).source].join("|")+"|$","g"),a=0,s="__p+='";e.replace(o,function(t,n,r,i,o){return s+=e.slice(a,o).replace(escapeRegExp,escapeChar),a=o+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(s+="';\n"+i+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n");s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(t.variable||"obj","_",s)}catch(e){throw e.source=s,e}var u=function(e){return i.call(this,e,_)},c=t.variable||"obj";return u.source="function("+c+"){\n"+s+"}",u}})}),t("skylark-langx-funcs/main",["./funcs"],function(e){return e}),t("skylark-langx-funcs",["skylark-langx-funcs/main"],function(e){return e}),t("skylark-langx-async/Deferred",["skylark-langx-arrays","skylark-langx-funcs","skylark-langx-objects"],function(e,t,n){"use strict";var r=Symbol?Symbol():"__pglisteners",i=Symbol?Symbol():"__pgnotifies",o=Array.prototype.slice,a=t.proxy,s=e.makeArray,l=n.result,u=n.mixin;u(Promise.prototype,{always:function(e){return this.then(e,e),this},done:function(){for(var e=0;e<arguments.length;e++)this.then(arguments[e]);return this},fail:function(e){return this.catch(e),this}});var c=function(){var e=this,t=this.promise=new Promise(function(t,n){e._resolve=t,e._reject=n});d(t,e),this[r]=[],this[i]=[]};function d(e,t){var n={state:function(){return t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},then:function(e,t,n){return n&&this.progress(n),d(Promise.prototype.then.call(this,e&&function(t){return t&&void 0!==t.__ctx__?e.apply(t.__ctx__,t):e(t)},t&&function(e){return e&&void 0!==e.__ctx__?t.apply(e.__ctx__,e):t(e)}))},progress:function(e){return t[i].forEach(function(t){e(t)}),t[r].push(e),this}};return n.pipe=n.then,u(e,n)}return c.prototype.resolve=function(e){var t=o.call(arguments);return this.resolveWith(null,t)},c.prototype.resolveWith=function(e,t){return(t=t?s(t):[]).__ctx__=e,this._resolve(t),this._resolved=!0,this},c.prototype.notify=function(e){try{return this[i].push(e),this[r].forEach(function(t){return t(e)})}catch(e){this.reject(e)}return this},c.prototype.reject=function(e){var t=o.call(arguments);return this.rejectWith(null,t)},c.prototype.rejectWith=function(e,t){return(t=t?s(t):[]).__ctx__=e,this._reject(t),this._rejected=!0,this},c.prototype.isResolved=function(){return!!this._resolved},c.prototype.isRejected=function(){return!!this._rejected},c.prototype.then=function(e,t,n){var r=l(this,"promise");return r.then(e,t,n)},c.prototype.progress=function(e){var t=l(this,"promise");return t.progress(e)},c.prototype.catch=function(e){var t=l(this,"promise");return t.catch(e)},c.prototype.done=function(){var e=l(this,"promise");return e.done.apply(e,arguments)},c.prototype.fail=function(e){var t=l(this,"promise");return t.fail(e)},c.all=function(e){var t=new c;return Promise.all(e).then(t.resolve.bind(t),t.reject.bind(t)),l(t,"promise")},c.first=function(e){return d(Promise.race(e))},c.when=function(e,t,n,r){var i=e&&"function"==typeof e.then,o=i&&e instanceof Promise;if(!i)return arguments.length>1?t?t(e):e:(new c).resolve(e);if(!o){var s=new c(e.cancel);e.then(a(s.resolve,s),a(s.reject,s),s.notify),e=s.promise}return t||n||r?e.then(t,n,r):e},c.reject=function(e){var t=new c;return t.reject(e),t.promise},c.immediate=c.resolve=function(e){var t=new c;return t.resolve.apply(t,arguments),t.promise},c}),t("skylark-langx-async/async",["skylark-langx-ns","skylark-langx-objects","./Deferred"],function(e,t,n){var r=t.each,i={Deferred:n,parallel:function(e,t,i){var o=[];return i=i||null,t=t||[],r(e,function(e,n){o.push(n.apply(i,t))}),n.all(o)},series:function(e,t,i){var o=[],a=new n,s=a.promise;return i=i||null,t=t||[],a.resolve(),r(e,function(e,n){s=s.then(function(){return n.apply(i,t)}),o.push(s)}),n.all(o)},waterful:function(e,t,i){var o=new n,a=o.promise;return i=i||null,t=t||[],o.resolveWith(i,t),r(e,function(e,t){a=a.then(t)}),a}};return e.attach("langx.async",i)}),t("skylark-langx-async/main",["./async"],function(e){return e}),t("skylark-langx-async",["skylark-langx-async/main"],function(e){return e}),t("skylark-langx/async",["skylark-langx-async"],function(e){return e}),t("skylark-langx-datetimes/datetimes",["skylark-langx-ns"],function(e){return e.attach("langx.datetimes",{parseMilliSeconds:function(e){var t=e.split(" "),n=parseInt(t[0]);if(isNaN(n))return 0;switch(t[1].trim().replace(/\./g,"")){case"minutes":case"minute":case"min":case"mm":case"m":return 6e4*n;case"hours":case"hour":case"HH":case"hh":case"h":case"H":return 36e5*n;case"seconds":case"second":case"sec":case"ss":case"s":return 1e3*n;case"days":case"day":case"DD":case"dd":case"d":return 864e5*n;case"months":case"month":case"MM":case"M":return 24192e5*n;case"weeks":case"week":case"W":case"w":return 6048e5*n;case"years":case"year":case"yyyy":case"yy":case"y":return 31536e6*n;default:return 0}}})}),t("skylark-langx-datetimes/main",["./datetimes"],function(e){return e}),t("skylark-langx-datetimes",["skylark-langx-datetimes/main"],function(e){return e}),t("skylark-langx/datetimes",["skylark-langx-datetimes"],function(e){return e}),t("skylark-langx/Deferred",["skylark-langx-async/Deferred"],function(e){return e}),t("skylark-langx-emitter/Emitter",["skylark-langx-ns/ns","skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-klass"],function(e,t,n,r,i){var o=Array.prototype.slice,a=r.compact,s=t.isDefined,l=t.isPlainObject,u=t.isFunction,c=t.isString,d=t.isEmptyObject,f=n.mixin,h=n.safeMixin;function p(e){var t=(""+e).split(".");return{name:t[0],ns:t.slice(1).join(" ")}}var g=i({on:function(e,t,n,r,i,o){var a=this,s=this._hub||(this._hub={});return l(e)?(i=r,each(e,function(e,r){a.on(e,t,n,r,i,o)}),this):(c(t)||u(r)||(i=r,r=n,n=t,t=void 0),u(n)&&(i=r,r=n,n=null),c(e)&&(e=e.split(/\s/)),e.forEach(function(e){var a=p(e),l=a.name,u=a.ns;(s[l]||(s[l]=[])).push({fn:r,selector:t,data:n,ctx:i,ns:u,one:o})}),this)},one:function(e,t,n,r,i){return this.on(e,t,n,r,i,1)},emit:function(e){if(!this._hub)return this;var t=this;c(e)&&(e=new CustomEvent(e)),Object.defineProperty(e,"target",{value:this});var n=o.call(arguments,1);return n=s(n)?[e].concat(n):[e],[e.type||e.name,"all"].forEach(function(r){var i=p(r),o=i.name,s=i.ns,l=t._hub[o];if(l){for(var u=l.length,c=!1,d=0;d<u;d++){var h=l[d];(!s||h.ns&&h.ns.startsWith(s))&&(e.data?h.data&&(e.data=f({},h.data,e.data)):e.data=h.data||null,h.fn.apply(h.ctx,n),h.one&&(l[d]=null,c=!0))}c&&(t._hub[r]=a(l))}}),this},listened:function(e){var t=(this._hub||(this._events={}))[e]||[];return t.length>0},listenTo:function(e,t,n,r){if(!e)return this;c(n)&&(n=this[n]),r?e.one(t,n,this):e.on(t,n,this);for(var i,o=this._listeningTo||(this._listeningTo=[]),a=0;a<o.length;a++)if(o[a].obj==e){i=o[a];break}i||o.push(i={obj:e,events:{}});var s=i.events,l=s[t]=s[t]||[];return-1==l.indexOf(n)&&l.push(n),this},listenToOnce:function(e,t,n){return this.listenTo(e,t,n,1)},off:function(e,t){var n=this._hub||(this._hub={});return c(e)&&(e=e.split(/\s/)),e.forEach(function(e){var r=p(e),i=r.name,o=r.ns,a=n[i];if(a){var s=[];if(t||o)for(var l=0,u=a.length;l<u;l++)t&&a[l].fn!==t&&a[l].fn._!==t?s.push(a[l]):!o||a[l].ns&&0==a[l].ns.indexOf(o)||s.push(a[l]);s.length?n[i]=s:delete n[i]}}),this},unlistenTo:function(e,t,n){var r=this._listeningTo;if(!r)return this;for(var i=0;i<r.length;i++){var o=r[i];if(!e||e==o.obj){var s=o.events;for(var l in s)if(!t||t==l){for(var u=s[l],c=0;c<u.length;c++)n&&n!=u[i]||(o.obj.off(l,u[i],this),u[i]=null);u=s[l]=a(u),d(u)&&(s[l]=null)}d(s)&&(r[i]=null)}}return r=this._listeningTo=a(r),d(r)&&(this._listeningTo=null),this},trigger:function(){return this.emit.apply(this,arguments)}});return g.createEvent=function(e,t){var n=new CustomEvent(e,t);return h(n,t)},e.attach("langx.Emitter",g)}),t("skylark-langx-emitter/Evented",["skylark-langx-ns/ns","./Emitter"],function(e,t){return e.attach("langx.Evented",t)}),t("skylark-langx-emitter/main",["./Emitter","./Evented"],function(e){return e}),t("skylark-langx-emitter",["skylark-langx-emitter/main"],function(e){return e}),t("skylark-langx/Emitter",["skylark-langx-emitter"],function(e){return e}),t("skylark-langx/Evented",["skylark-langx-emitter"],function(e){return e}),t("skylark-langx/funcs",["skylark-langx-funcs"],function(e){return e}),t("skylark-langx-hoster/hoster",["skylark-langx-ns"],function(e){var t={isBrowser:!0,isNode:null,global:this,browser:null,node:null};"object"==typeof process&&process.versions&&process.versions.node&&process.versions.v8&&(t.isNode=!0,t.isBrowser=!1),t.global=function(){return"undefined"!=typeof global&&"function"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this}();var n=null;if(Object.defineProperty(t,"document",function(){if(!n){var e="undefined"==typeof window?require("html-element"):window;n=e.document}return n}),t.isBrowser){var r=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}}(navigator.userAgent),i=t.browser={};r.browser&&(i[r.browser]=!0,i.version=r.version),i.chrome?i.webkit=!0:i.webkit&&(i.safari=!0)}return e.attach("langx.hoster",t)}),t("skylark-langx-hoster/main",["./hoster"],function(e){return e}),t("skylark-langx-hoster",["skylark-langx-hoster/main"],function(e){return e}),t("skylark-langx/hoster",["skylark-langx-hoster"],function(e){return e}),t("skylark-langx/numbers",["skylark-langx-numbers"],function(e){return e}),t("skylark-langx/objects",["skylark-langx-objects"],function(e){return e}),t("skylark-langx-strings/strings",["skylark-langx-ns"],function(e){var t=Object.freeze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"});function n(e){return t[e]}var r=/[&<>"'`=]/g;var i=0;function o(e,t){var n,r,i,o,a,s,l,u=arguments.callee;return u.cache[e]||(u.cache[e]=(n=e,r=/^[\w\-]+$/.test(e)?u.get(e):(n="template(string)",e),i=1,o=("try { "+(u.variable?"var "+u.variable+" = this.stash;":"with (this.stash) { ")+"this.ret += '"+r.replace(/<%/g,"").replace(/%>/g,"").replace(/'(?![^\x11\x13]+?\x13)/g,"\\x27").replace(/^\s*|\s*$/g,"").replace(/\n|\r\n/g,function(){return"';\nthis.line = "+ ++i+"; this.ret += '\\n"}).replace(/\x11=raw(.+?)\x13/g,"' + ($1) + '").replace(/\x11=(.+?)\x13/g,"' + this.escapeHTML($1) + '").replace(/\x11(.+?)\x13/g,"'; $1; this.ret += '")+"'; "+(u.variable?"":"}")+"return this.ret;} catch (e) { throw 'TemplateError: ' + e + ' (on "+n+"' + ' line ' + this.line + ')'; } //@ sourceURL="+n+"\n").replace(/this\.ret \+= '';/g,""),a=new Function(o),s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#x22;","'":"&#x27;"},l=function(e){return(""+e).replace(/[&<>\'\"]/g,function(e){return s[e]})},function(e){return a.call(u.context={escapeHTML:l,line:1,ret:"",stash:e})})),t?u.cache[e](t):u.cache[e]}return o.cache={},o.get=function(e){return document.getElementById(e).innerHTML},e.attach("langx.strings",{camelCase:function(e){return e.replace(/-([\da-z])/g,function(e){return e.toUpperCase().replace("-","")})},dasherize:function(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()},deserializeValue:function(e){try{return e?"true"==e||"false"!=e&&("null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?JSON.parse(e):e):e}catch(t){return e}},escapeHTML:function(e){if(null==e)return"";if(!e)return String(e);return e.toString().replace(r,n)},generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})},lowerFirst:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},rtrim:function(e){return e.replace(/\s+$/g,"")},serializeValue:function(e){return JSON.stringify(e)},substitute:function(e,t,n,r){function i(e,t){if(e.match(/\./)){var n,r=function(e,t){var i=e.pop();return i?t[i]?r(e,n=t[i]):null:n};return r(e.split(".").reverse(),t)}return t[e]}return r=r||window,n=n?proxy(r,n):function(e){return e},e.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(e,o,a){var s=i(o,t);return a&&(s=i(a,r).call(r,s,o)),n(s,o).toString()})},slugify:function(e){e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var t="ÁÄÂÀÃÅČÇĆĎÉĚËÈÊẼĔȆÍÌÎÏŇÑÓÖÒÔÕØŘŔŠŤÚŮÜÙÛÝŸŽáäâàãåčçćďéěëèêẽĕȇíìîïňñóöòôõøðřŕšťúůüùûýÿžþÞĐđßÆa·/_,:;",n=0,r=t.length;n<r;n++)e=e.replace(new RegExp(t.charAt(n),"g"),"AAAAAACCCDEEEEEEEEIIIINNOOOOOORRSTUUUUUYYZaaaaaacccdeeeeeeeeiiiinnooooooorrstuuuuuyyzbBDdBAa------".charAt(n));return e=e.replace(/\s+/g,"-").replace(/-+/g,"-")},template:o,trim:function(e){return null==e?"":String.prototype.trim.call(e)},uniqueId:function(e){var t=++i+"";return e?e+t:t},upperFirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}})}),t("skylark-langx-strings/main",["./strings"],function(e){return e}),t("skylark-langx-strings",["skylark-langx-strings/main"],function(e){return e}),t("skylark-langx/strings",["skylark-langx-strings"],function(e){return e}),t("skylark-langx/Stateful",["./Evented","./strings","./objects"],function(e,t,n){var r=n.isEqual,i=n.mixin,o=n.result,a=n.isEmptyObject,s=n.clone,l=t.uniqueId,u=e.inherit({_construct:function(e,t){var n=e||{};t||(t={}),this.cid=l(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var r=o(this,"defaults");n=i({},r,n),this.set(n,t),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(e){return s(this.attributes)},get:function(e){return this.attributes[e]},has:function(e){return null!=this.get(e)},set:function(e,t,n){if(null==e)return this;var i;if("object"==typeof e?(i=e,n=t):(i={})[e]=t,n||(n={}),!this._validate(i,n))return!1;var o=n.unset,a=n.silent,l=[],u=this._changing;this._changing=!0,u||(this._previousAttributes=s(this.attributes),this.changed={});var c=this.attributes,d=this.changed,f=this._previousAttributes;for(var h in i)t=i[h],r(c[h],t)||l.push(h),r(f[h],t)?delete d[h]:d[h]=t,o?delete c[h]:c[h]=t;if(this.idAttribute in i&&(this.id=this.get(this.idAttribute)),!a){l.length&&(this._pending=n);for(var p=0;p<l.length;p++)this.trigger("change:"+l[p],this,c[l[p]],n)}if(u)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i({},e,{unset:!0}))},hasChanged:function(e){return null==e?!a(this.changed):void 0!==this.changed[e]},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&s(this.changed);var t=this._changing?this._previousAttributes:this.attributes,n={};for(var i in e){var o=e[i];r(t[i],o)||(n[i]=o)}return!a(n)&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return s(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i(t,{validationError:n})),!1)}});return u}),t("skylark-langx-topic/topic",["skylark-langx-ns","skylark-langx-emitter/Evented"],function(e,t){var n=new t;return e.attach("langx.topic",{publish:function(e,t,r){var i=[].slice.call(arguments,1);return n.trigger({type:e,data:i})},subscribe:function(e,t,r){var i=function(e){t.apply(r,e.data)};return n.on(e,i),{remove:function(){n.off(e,i)}}}})}),t("skylark-langx-topic/main",["./topic"],function(e){return e}),t("skylark-langx-topic",["skylark-langx-topic/main"],function(e){return e}),t("skylark-langx/topic",["skylark-langx-topic"],function(e){return e}),t("skylark-langx/types",["skylark-langx-types"],function(e){return e}),t("skylark-langx/langx",["./skylark","./arrays","./ArrayStore","./aspect","./async","./datetimes","./Deferred","./Emitter","./Evented","./funcs","./hoster","./klass","./numbers","./objects","./Stateful","./strings","./topic","./types"],function(e,t,n,r,i,o,a,s,l,u,c,d,f,h,p,g,y,m){"use strict";Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter;var b=h.mixin,v=(h.safeMixin,m.isFunction);var k=1;function x(){return x}return b(x,{createEvent:s.createEvent,funcArg:function(e,t,n,r){return v(t)?t.call(e,n,r):t},getQueryParams:function(e){var t=(e=e||window.location.href).split("?"),n={};t.length>1&&t[1].split("&").forEach(function(e){var t=e.split("=");n[t[0]]=t[1]});return n},toPixel:function(e){return parseFloat(e)||0},uid:function(e){return e._uid||(e._uid=k++)},URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),b(x,t,r,o,u,f,h,g,m,{ArrayStore:n,async:i,Deferred:a,Emitter:s,Evented:l,hoster:c,klass:d,Stateful:p,topic:y}),e.langx=x}),t("skylark-domx-browser/browser",["skylark-langx/skylark","skylark-langx/langx"],function(e,t){"use strict";var n,r,i=t.hoster.browser,o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},a=null,s="",l="",u={},c={},d=/^(Webkit|webkit|O|Moz|moz|ms)(.*)$/,f=window.document,h=f.createElement("div"),p=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.matchesSelector,g=h.requestFullscreen||h.webkitRequestFullscreen||h.mozRequestFullScreen||h.msRequestFullscreen,y=(f.exitFullscreen||f.webkitCancelFullScreen||f.mozCancelFullScreen||f.msExitFullscreen,h.style);for(var m in y){var b=m.match(r||d);if(b){r||(n=b[1],r=new RegExp("^("+n+")(.*)$"),n,s="-"+n.toLowerCase()+"-",l=n.toLowerCase()),u[t.lowerFirst(b[2])]=m;var v=t.dasherize(b[2]);c[v]=s+v,o[m]&&(a=o[m])}}return a||void 0!==y.transition&&(a=o.transition),t.mixin(i,{css3PropPrefix:s,isIE:!!/msie/i.exec(window.navigator.userAgent),normalizeStyleProperty:function(e){return u[e]||e},normalizeCssProperty:function(e){return c[e]||e},normalizeCssEvent:function(e){return l?l+e:e.toLowerCase()},matchesSelector:p,requestFullScreen:g,exitFullscreen:g,location:function(){return window.location},support:{}}),a&&(i.support.transition={end:a}),h=null,e.attach("domx.browser",i)}),t("skylark-domx-browser/main",["./browser"],function(e){return e}),t("skylark-domx-browser",["skylark-domx-browser/main"],function(e){return e}),t("skylark-domx-noder/noder",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser"],function(e,t,n){var r=!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g),i=/^\s*<(\w+|!)[^>]*>/,o=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,a=document.createElement("div"),s=document.createElement("table"),l=document.createElement("tbody"),u=document.createElement("tr"),c={tr:l,tbody:s,thead:s,tfoot:s,td:u,th:u,"*":a},d=/^(?:body|html)$/i,f=Array.prototype.map,h=Array.prototype.slice;function p(e,n){return t.isArrayLike(e)||(e=[e]),n&&(e=f.call(e,function(e){return e.cloneNode(!0)})),t.flatten(e)}function g(e,t){var n=e.nodeName&&e.nodeName.toLowerCase();return void 0!==t?n===t.toLowerCase():n}function y(e,n){if(t.isFunction(e))return e.apply(n,[]);if(t.isArrayLike(e)){for(var r,i=0;i<e.length;i++)t.isFunction(e[i])&&(e[i]=e[i].apply(n,[]),t.isArrayLike(e[i])&&(r=!0));r&&(e=t.flatten(e))}return e}function m(e,t,n){t=y(t,e);for(var r=e,i=p(t,n),o=0;o<i.length;o++)r.appendChild(i[o]);return this}function b(e,t,n){var r=document.createElement(e);if(t)for(var i in t)r.setAttribute(i,t[i]);return n&&m(n,r),r}var v=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi;function k(e,t,n){if(n)return e.parentNode===t;if(document.documentElement.contains)return t.contains(e);for(;e;){if(t===e)return!0;e=e.parentNode}return!1}function x(e){return e?9==e.nodeType?e:e.ownerDocument:document}function _(){return _}return t.mixin(_,{active:function(e){var t;e=e||document;try{t=e.activeElement}catch(n){t=e.body}t||(t=e.body);t.nodeName||(t=e.body);return t},blur:function(e){e.blur()},body:function(){return document.body},clone:function(e,t){var n,i=this;if(!r||1!==e.nodeType||t)return e.cloneNode(t);if(!t)return n=document.createElement(e.nodeName),each(i.getAttribs(e),function(t){i.setAttrib(n,t.nodeName,i.getAttrib(e,t.nodeName))}),n},contents:function(e){if(g(e,"iframe"))return e.contentDocument;return e.childNodes},createElement:b,createFragment:function(e){if(e=t.trim(e),o.test(e))return[b(RegExp.$1)];var n=i.test(e)&&RegExp.$1;n in c||(n="*");var r=c[n];return r.innerHTML=""+e,dom=h.call(r.childNodes),dom.forEach(function(e){r.removeChild(e)}),dom},contains:function(e,t){return k(t,e)},createTextNode:function(e){return document.createTextNode(e)},doc:function(){return document},empty:function(e){for(;e.hasChildNodes();){var t=e.firstChild;e.removeChild(t)}return this},fullScreen:function(e){if(!1===e)n.exitFullScreen.apply(document);else{if(!e)return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;n.requestFullScreen.apply(e),e}},focusable:function(e,t){var n,r,i,o,a,s=e.nodeName.toLowerCase();if("area"===s)return n=e.parentNode,r=n.name,!(!e.href||!r||"map"!==n.nodeName.toLowerCase())&&((i=$("img[usemap='#"+r+"']")).length>0&&i.is(":visible"));/^(input|select|textarea|button|object)$/.test(s)?(o=!e.disabled)&&(a=$(e).closest("fieldset")[0])&&(o=!a.disabled):o="a"===s&&e.href||t;return o&&$(e).is(":visible")&&visible($(e))},html:function(e,n){if(void 0===n)return e.innerHTML;if(this.empty(e),n=n||"",t.isString(n)&&(n=n.replace(v,"<$1></$2>")),t.isString(n)||t.isNumber(n))e.innerHTML=n;else if(t.isArrayLike(n))for(var r=0;r<n.length;r++)e.appendChild(n[r]);else e.appendChild(n);return this},isChildOf:k,isDocument:function(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE},isInDocument:function(e){return e===document.body||document.body.contains(e)},isWindow:t.isWindow,nodeName:g,offsetParent:function(e){var t=e.offsetParent||document.body;for(;t&&!d.test(t.nodeName)&&"static"==document.defaultView.getComputedStyle(t).position;)t=t.offsetParent;return t},ownerDoc:x,ownerWindow:function(e){var t=x(e);return t.defaultView||t.parentWindow},after:function(e,t,n){t=y(t,e);var r=(o=e).parentNode;if(r)for(var i=p(t,n),o=o.nextSibling,a=0;a<i.length;a++)o?r.insertBefore(i[a],o):r.appendChild(i[a]);return this},before:function(e,t,n){t=y(t,e);var r=e,i=r.parentNode;if(i)for(var o=p(t,n),a=0;a<o.length;a++)i.insertBefore(o[a],r);return this},prepend:function(e,t,n){for(var r=e,i=r.firstChild,o=p(t,n),a=0;a<o.length;a++)i?r.insertBefore(o[a],i):r.appendChild(o[a]);return this},append:m,reflow:function(e){null==el&&(e=document);return e.offsetHeight,this},remove:function(e){if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch(e){console.warn("The node is already removed",e)}return this},removeChild:function(e,n){t.isArrayLike(n)||(n=[n]);for(var r=0;r<n.length;r++)e.removeChild(n[r]);return this},replace:function(e,t){return t.parentNode.replaceChild(e,t),this},traverse:function e(t,n){n(t);for(var r=0,i=t.childNodes.length;r<i;r++)e(t.childNodes[r],n);return this},reverse:function(e){for(var t=e.firstChild,n=e.children.length-1;n>0;n--)if(n>0){var r=e.children[n];e.insertBefore(r,t)}},wrapper:function(e,n){t.isString(n)&&(n=this.createFragment(n).firstChild);e.parentNode.insertBefore(n,e),n.appendChild(e)},wrapperInner:function(e,t){var n=h.call(e.childNodes);e.appendChild(t);for(var r=0;r<n.length;r++)t.appendChild(n[r]);return this},unwrap:function(e){var t=e.parentNode;if(t){if(this.isDoc(t.parentNode))return;t.parentNode.insertBefore(e,t)}}}),e.attach("domx.noder",_)}),t("skylark-domx-noder/main",["./noder"],function(e){return e}),t("skylark-domx-noder",["skylark-domx-noder/main"],function(e){return e}),t("skylark-domx-finder/finder",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder"],function(e,t,n,r){var o={},a=Array.prototype.filter,s=Array.prototype.slice,l=n.matchesSelector;(function(){var e,t,n,r,i,o={},a={},s=/\\/g,l=function(n,i){if(null==n)return null;if(!0===n.Slick)return n;n=(""+n).replace(/^\s+|\s+$/g,"");var s=(r=!!i)?a:o;if(s[n])return s[n];for(e={Slick:!0,expressions:[],raw:n,reverse:function(){return l(this.raw,!0)}},t=-1;n!=(n=n.replace(f,h)););return e.length=e.expressions.length,s[e.raw]=r?c(e):e},u=function(e){return"!"===e?" ":" "===e?"!":/^!/.test(e)?e.replace(/^!/,""):"!"+e},c=function(e){for(var t=e.expressions,n=0;n<t.length;n++){for(var r=t[n],i={parts:[],tag:"*",combinator:u(r[0].combinator)},o=0;o<r.length;o++){var a=r[o];a.reverseCombinator||(a.reverseCombinator=" "),a.combinator=a.reverseCombinator,delete a.reverseCombinator}r.reverse().push(i)}return e},d=(i=/(?=[\-\[\]{}()*+?.\\\^$|,#\s])/g,function(e){return e.replace(i,"\\")}),f=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+d(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function h(i,o,a,l,c,f,h,p,g,y,m,b,v,k,x,_){if((o||-1===t)&&(e.expressions[++t]=[],n=-1,o))return"";if(a||l||-1===n){a=a||" ";var w=e.expressions[t];r&&w[n]&&(w[n].reverseCombinator=u(a)),w[++n]={combinator:a,tag:"*"}}var N=e.expressions[t][n];if(c)N.tag=c.replace(s,"");else if(f)N.id=f.replace(s,"");else if(h)h=h.replace(s,""),N.classList||(N.classList=[]),N.classes||(N.classes=[]),N.classList.push(h),N.classes.push({value:h,regexp:new RegExp("(^|\\s)"+d(h)+"(\\s|$)")});else if(v)_=(_=_||x)?_.replace(s,""):null,N.pseudos||(N.pseudos=[]),N.pseudos.push({key:v.replace(s,""),value:_,type:1==b.length?"class":"element"});else if(p){var A,E;switch(p=p.replace(s,""),m=(m||"").replace(s,""),g){case"^=":E=new RegExp("^"+d(m));break;case"$=":E=new RegExp(d(m)+"$");break;case"~=":E=new RegExp("(^|\\s)"+d(m)+"(\\s|$)");break;case"|=":E=new RegExp("^"+d(m)+"(-|$)");break;case"=":A=function(e){return m==e};break;case"*=":A=function(e){return e&&e.indexOf(m)>-1};break;case"!=":A=function(e){return m!=e};break;default:A=function(e){return!!e}}""==m&&/^[*$^]=$/.test(g)&&(A=function(){return!1}),A||(A=function(e){return e&&E.test(e)}),N.attributes||(N.attributes=[]),N.attributes.push({key:p,operator:g,value:m,test:A})}return""}var p=this.Slick||{};p.parse=function(e){return l(e)},p.escapeRegExp=d,this.Slick||(this.Slick=p)}).apply(o);var u=/^(?:input|select|textarea|button)$/i,c=/^h\d$/i,s=Array.prototype.slice;o.parseSelector=o.Slick.parse;var d=o.pseudos={button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},checked:function(e){return!!e.checked},contains:function(e,t,n,r){if($(this).text().indexOf(r)>-1)return this},disabled:function(e){return!!e.disabled},enabled:function(e){return!e.disabled},eq:function(e,t,n,r){return t==r},even:function(e,t,n,r){return t%2==0},focus:function(e){return document.activeElement===e&&(e.href||e.type||e.tabindex)},focusable:function(e){return r.focusable(e,null!=e.tabindex)},first:function(e,t){return 0===t},gt:function(e,t,n,r){return t>r},has:function(e,t,n,r){return b(e,r)},header:function(e){return c.test(e.nodeName)},hidden:function(e){return!o.pseudos.visible(e)},input:function(e){return u.test(e.nodeName)},last:function(e,t,n){return t===n.length-1},lt:function(e,t,n,r){return t<r},not:function(e,t,n,r){return!x(e,r)},odd:function(e,t,n,r){return t%2==1},parent:function(e){return!!e.parentNode},selected:function(e){return!!e.selected},tabbable:function(e){var t=e.tabindex,n=null!=t;return(!n||t>=0)&&r.focusable(element,n)},text:function(e){return"text"===e.type},visible:function(e){return e.offsetWidth&&e.offsetWidth},empty:function(e){return!e.hasChildNodes()}};function f(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function h(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}for(i in["first","eq","last"].forEach(function(e){d[e].isArrayFilter=!0}),d.nth=d.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d[i]=f(i);for(i in{submit:!0,reset:!0})d[i]=h(i);function p(e,n,r){for(var i=[],a=r&&t.isString(r);(e=e.parentNode)&&9!==e.nodeType;){if(r)if(a){if(x(e,r))break}else if(t.isArrayLike(r)){if(t.inArray(e,r)>-1)break}else if(e==r)break;i.push(e)}return n&&(i=o.filter(i,n)),i}function g(e,t){for(var n=e.childNodes,r=[],i=0;i<n.length;i++){var e=n[i];1==e.nodeType&&r.push(e)}return t&&(r=o.filter(r,t)),r}function y(e,t){try{return s.call(e.querySelectorAll(t))}catch(e){}return o.query(e,t)}function m(e,t){try{return e.querySelector(t)}catch(e){}var n=o.query(e,t);return n.length>0?n[0]:null}function b(e,t){return t||(t=e,e=document.body),x(e,t)?e:m(e,t)}function v(e,t,n){for(var r=e.childNodes,i=r[0];i;){if(1==i.nodeType){if(!t||x(i,t))return i;if(n)break}i=i.nextSibling}return null}function k(e,t,n){for(var r=e.childNodes,i=r[r.length-1];i;){if(1==i.nodeType){if(!t||x(i,t))return i;if(n)break}i=i.previousSibling}return null}function x(e,n){if(!n||!e||1!==e.nodeType)return!1;if(t.isString(n)){try{return l.call(e,n.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(e){}return o.match(e,n)}return t.isArrayLike(n)?t.inArray(e,n)>-1:t.isPlainObject(n)?o.check(e,n):e===n}function _(e,t,n){for(var r=e.nextSibling;r;){if(1==r.nodeType){if(!t||x(r,t))return r;if(n)break}r=r.nextSibling}return null}function w(e,t){for(var n=e.nextSibling,r=[];n;)1==n.nodeType&&(t&&!x(n,t)||r.push(n)),n=n.nextSibling;return r}function N(e,t){var n=e.parentNode;return!n||t&&!x(n,t)?null:n}function A(e,t,n){for(var r=e.previousSibling;r;){if(1==r.nodeType){if(!t||x(r,t))return r;if(n)break}r=r.previousSibling}return null}function E(e,t){for(var n=e.previousSibling,r=[];n;)1==n.nodeType&&(t&&!x(n,t)||r.push(n)),n=n.previousSibling;return r}function S(e,t){for(var n=e.parentNode.firstChild,r=[];n;)1==n.nodeType&&n!==e&&(t&&!x(n,t)||r.push(n)),n=n.nextSibling;return r}o.divide=function(e){var t,n,r,i,o,a="",s=[];if((n=e.id)&&(a+="#"+n),r=e.classes)for(var l=r.length;l--;)a+="."+r[l].value;if(i=e.attributes)for(var l=0;l<i.length;l++)i[l].operator?a+="["+i[l].key+i[l].operator+JSON.stringify(i[l].value)+"]":a+="["+i[l].key+"]";if(o=e.pseudos)for(l=o.length;l--;)part=o[l],this.pseudos[part.key]?s.push(part):void 0!==part.value&&(a+=":"+part.key+"("+JSON.stringify(part));return(t=e.tag)&&"*"!==t&&(a=t.toUpperCase()+a),a||(a="*"),{nativeSelector:a,customPseudos:s}},o.check=function(e,t,n,r,i){var o,a,s,u,c,d,f,h,p;if(!i){if(o=t.tag){var g=e.nodeName.toUpperCase();if("*"==o){if(g<"@")return!1}else if(g!=(o||"").toUpperCase())return!1}if((a=t.id)&&e.getAttribute("id")!=a)return!1;if(s=t.classes)for(d=s.length;d--;)if(!(h=e.getAttribute("class"))||!s[d].regexp.test(h))return!1;if(u=t.attributes)for(d=u.length;d--;)if((f=u[d]).operator?!f.test(e.getAttribute(f.key)):!e.hasAttribute(f.key))return!1}if(c=t.pseudos)for(d=c.length;d--;)if(f=c[d],p=this.pseudos[f.key]){if((i&&p.isArrayFilter||!i&&!p.isArrayFilter)&&!p(e,n,r,f.value))return!1}else if(!i&&!l.call(e,f.key))return!1;return!0},o.match=function(e,n){var r;if(!(r=t.isString(n)?o.Slick.parse(n):n))return!0;var i,a,s=r.expressions,l=0;for(i=0;a=s[i];i++)if(1==a.length){var u=a[0];if(this.check(e,u))return!0;l++}if(l==r.length)return!1;var c,d=this.query(document,r);for(i=0;c=d[i++];)if(c===e)return!0;return!1},o.filterSingle=function(e,t){var n=a.call(e,function(n,r){return o.check(n,t,r,e,!1)});return n=a.call(n,function(e,r){return o.check(e,t,r,n,!0)})},o.filter=function(e,n){if(!t.isString(n))return o.filterSingle(e,n);var r,i,a=o.Slick.parse(n).expressions,s=[];for(r=0;i=a[r];r++){if(1!=i.length)throw new Error("not supported selector:"+n);var l=i[0],u=o.filterSingle(e,l);s=t.uniq(s.concat(u))}return s},o.combine=function(e,t){var n,r=t.combinator,i=t,l=[];switch(r){case">":l=g(e,i);break;case"+":(n=_(e,i,!0))&&l.push(n);break;case"^":(n=v(e,i,!0))&&l.push(n);break;case"~":l=w(e,i);break;case"++":var u=A(e,i,!0),c=_(e,i,!0);u&&l.push(u),c&&l.push(c);break;case"~~":l=S(e,i);break;case"!":l=p(e,i);break;case"!>":(n=N(e,i))&&l.push(n);break;case"!+":l=A(e,i,!0);break;case"!^":(n=k(e,i,!0))&&l.push(n);break;case"!~":l=E(e,i);break;default:var d=this.divide(t);if(l=s.call(e.querySelectorAll(d.nativeSelector)),d.customPseudos)for(var f=d.customPseudos.length-1;f>=0;f--)l=a.call(l,function(e,t){return o.check(e,{pseudos:[d.customPseudos[f]]},t,l,!1)}),l=a.call(l,function(e,t){return o.check(e,{pseudos:[d.customPseudos[f]]},t,l,!0)})}return l},o.query=function(e,n,r){for(var i,a,s=this.Slick.parse(n),l=[],u=s.expressions,c=0;i=u[c];c++){for(var d,f=[e],h=0;a=i[h];h++)(d=t.map(f,function(e,t){return o.combine(e,a)}))&&(f=d);d&&(l=l.concat(d))}return l};var C=function(){return C};return t.mixin(C,{ancestor:function(e,n,r){var i=r&&t.isString(r);for(;e=e.parentNode;){if(x(e,n))return e;if(r)if(i){if(x(e,r))break}else if(e==r)break}return null},ancestors:p,byId:function(e,t){return(t=t||r.doc()).getElementById(e)},children:g,closest:function(e,t){for(;e&&!x(e,t);)e=e.parentNode;return e},descendant:m,descendants:y,find:b,findAll:function(e,t){t||(t=e,e=document.body);return y(e,t)},firstChild:v,lastChild:k,matches:x,nextSibling:_,nextSiblings:w,parent:N,previousSibling:A,previousSiblings:E,pseudos:o.pseudos,siblings:S}),e.attach("domx.finder",C)}),t("skylark-domx-finder/main",["./finder"],function(e){return e}),t("skylark-domx-finder",["skylark-domx-finder/main"],function(e){return e}),t("skylark-domx-data/data",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-finder","skylark-domx-noder"],function(e,t,n,r){var i=Array.prototype.map,o=(Array.prototype.filter,t.camelCase),a=t.deserializeValue,s=/([A-Z])/g,l={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"};var u={option:{get:function(e){var t=e.getAttribute("value");return null!=t?t:(g(e).match(/[^\x20\t\r\n\f]+/g)||[]).join(" ")}},select:{get:function(e){var t,n,i,o=e.options,a=e.selectedIndex,s="select-one"===e.type,l=s?null:[],u=s?a+1:o.length;for(i=a<0?u:s?a:0;i<u;i++)if((n=o[i]).selected&&!n.disabled&&(!n.parentNode.disabled||!r.nodeName(n.parentNode,"optgroup"))){if(t=y(n),s)return t;l.push(t)}return l},set:function(e,n){for(var r,i,o=e.options,a=t.makeArray(n),s=o.length;s--;)((i=o[s]).selected=t.inArray(u.option.get(i),a)>-1)&&(r=!0);return r||(e.selectedIndex=-1),a}}};function c(e,t,n){if(void 0!==n)return e.setAttribute(t,n),this;if("object"==typeof t){for(var r in t)c(e,r,t[r]);return this}return e.hasAttribute&&e.hasAttribute(t)?e.getAttribute(t):void 0}function d(e,n){var r=e._$_store;return!r&&n&&(r=e._$_store=function(e){var n={};return t.each(e.attributes||[],function(e,t){0==t.name.indexOf("data-")&&(n[o(t.name.replace("data-",""))]=a(t.value))}),n}(e)),r}function f(e,t,n){var r=d(e,!0);r[o(t)]=n}function h(e,t,n){if(void 0===n){if("object"==typeof t){for(var r in t)f(e,r,t[r]);return this}return function(e,t){if(void 0===t)return d(e,!0);var n=d(e);if(n){if(t in n)return n[t];var r=o(t);if(r in n)return n[r]}var i="data-"+t.replace(s,"-$1").toLowerCase();return c(e,i)}(e,t)}return f(e,t,n),this}function p(e){e._$_store&&delete e._$_store}function g(e,t){return void 0===t?e.textContent:(e.textContent=null==t?"":""+t,this)}function y(e,n){var r=u[e.type]||u[e.nodeName.toLowerCase()];if(void 0===n)return r&&"get"in r&&void 0!==(ret=r.get(e,"value"))?ret:(ret=e.value,"string"==typeof ret?ret.replace(/\r/g,""):null==ret?"":ret);null==n?n="":"number"==typeof n?n+="":t.isArray(n)&&(n=t.map(n,function(e){return null==e?"":e+""})),r&&"set"in r&&void 0!==r.set(e,n,"value")||(e.value=n)}function m(){return m}return t.each(["radio","checkbox"],function(){u[this]={set:function(e,n){if(t.isArray(n))return e.checked=t.inArray(y(e),n)>-1}}}),n.pseudos.data=function(e,t,n,r){return!!h(e,r||n[3])},t.mixin(m,{aria:function(e,t,n){return this.attr(e,"aria-"+t,n)},attr:c,cleanData:p,data:h,pluck:function(e,t){return i.call(e,function(e){return e[t]})},prop:function(e,t,n){return t=l[t]||t,void 0===n?e[t]:(e[t]=n,this)},removeAttr:function(e,t){return t.split(" ").forEach(function(t){!function(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}(e,t)}),this},removeData:function(e,n){if(n){t.isString(n)&&(n=n.split(/\s+/));var r=d(e,!0);n.forEach(function(e){delete r[e]})}else p(e);return this},removeProp:function(e,t){return t.split(" ").forEach(function(t){delete e[t]}),this},text:g,val:y,valHooks:u}),e.attach("domx.data",m)}),t("skylark-domx-query/query",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-finder"],function(e,t,n,r){var i,o=Array.prototype.some,a=Array.prototype.push,s=(Array.prototype.every,Array.prototype.concat,Array.prototype.slice),l=(Array.prototype.map,Array.prototype.filter),u=Array.prototype.forEach,c=Array.prototype.indexOf,d=Array.prototype.sort,f=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,h=t.funcArg,p=t.isArrayLike,g=t.isString,y=t.uniq,m=t.isFunction,b=t.type,v=(t.isArray,t.isWindow,t.isDocument,t.isObject);t.isPlainObject,t.compact,t.flatten,t.camelCase,t.dasherize,r.children;function k(e,r,i){return function(i){var o,a=t.map(arguments,function(e){return"function"==(o=b(e))||"object"==o||"array"==o||null==e?e:n.createFragment(e)});return a.length<1?this:(this.each(function(t){e.apply(r,[this,a,t>0])}),this)}}function x(e,n){return function(){var r=s.call(arguments),i=t.map(this,function(t,i){return e.apply(n,[t].concat(r))});return C(y(i))}}function _(e,t,n){return function(r){s.call(arguments);var i=this.map(function(i,o){return e.apply(t,n?[o]:[o,r])});return n&&r?i.filter(r):i}}function w(e,t,n){return function(r,i){s.call(arguments);var o=this.map(function(o,a){return e.apply(t,n?[a,r]:[a,i,r])});return n&&i?o.filter(i):o}}function N(e,t){return function(){var n=s.call(arguments);return this.each(function(r,i){e.apply(t,[this].concat(n))}),this}}function A(e,n,r){return function(i){return t.isDefined(i)?(u.call(this,function(t,o){var a;a=r?h(t,i,o,r(t)):i,e.apply(n,[t,a])}),this):this[0]?e.apply(n,[this[0]]):void 0}}var E,S=t.klass({klassName:"SkNodeList",init:function(e,i){var o,s,l,u;if(e&&(this.context=i=i||n.doc(),g(e)?(this.selector=e,(o="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:f.exec(e))?o[1]?(s=n.createFragment(e),t.isPlainObject(i)&&(u=i)):(l=r.byId(o[2],n.ownerDoc(i)))&&(s=[l]):(t.isString(i)&&(i=r.find(i)),s=r.descendants(i,e))):s=e!==window&&p(e)?e:[e]),s&&(a.apply(this,s),u))for(var c in u)t.isFunction(this[c])?this[c](u[c]):this.attr(c,u[c]);return this}}),C=function(){i=function(e){return e instanceof S},init=function(e,t){return new S(e,t)};var e=function(t,n){if(!m(t))return i(t)?t:n&&i(n)&&g(t)?n.find(t):init(t,n);e.ready(function(){t(e)})};e.fn=S.prototype,t.mixin(e.fn,{length:0,map:function(n){return e(y(t.map(this,function(e,t){return n.call(e,t,e)})))},slice:function(){return e(s.apply(this,arguments))},forEach:function(){return u.apply(this,arguments)},get:function(e){return void 0===e?s.call(this):this[e>=0?e:e+this.length]},indexOf:function(){return c.apply(this,arguments)},sort:function(){return d.apply(this,arguments)},toArray:function(){return s.call(this)},size:function(){return this.length},remove:function(e){return e?this.find(e).remove():(this.each(function(e,t){n.remove(t)}),this)},each:function(e){return t.each(this,e),this},filter:function(t){return m(t)?this.not(this.not(t)):e(l.call(this,function(e){return r.matches(e,t)}))},add:function(t,n){return e(y(this.toArray().concat(e(t,n).toArray())))},is:function(e){if(this.length>0){if(t.isString(e))return o.call(this,function(t){return r.matches(t,e)});if(t.isArrayLike(e))return o.call(this,function(n){return t.inArray(n,e)>-1});if(t.isHtmlNode(e))return o.call(this,function(t){return t==e})}return!1},not:function(t){var n=[];if(m(t)&&void 0!==t.call)this.each(function(e,r){t.call(this,e,r)||n.push(this)});else{var r="string"==typeof t?this.filter(t):p(t)&&m(t.item)?s.call(t):e(t);this.forEach(function(e){r.indexOf(e)<0&&n.push(e)})}return e(n)},has:function(t){return this.filter(function(){return v(t)?n.contains(this,t):e(this).find(t).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:_(r.descendants,r),closest:_(r.closest,r),parents:_(r.ancestors,r),parentsUntil:w(r.ancestors,r),parent:_(r.parent,r),children:_(r.children,r),contents:x(n.contents,n),empty:N(n.empty,n),html:A(n.html,n),pluck:function(e){return t.map(this,function(t){return t[e]})},pushStack:function(t){var n=e(t);return n.prevObject=this,n},replaceWith:function(e){return this.before(e).remove()},wrap:function(t){var n="function"==typeof t;return this.each(function(r){e(this).wrapAll(n?t.call(this,r):t)})},wrapAll:function(t){var n;return this[0]&&("function"==typeof t&&(t=t.call(this[0])),n=e(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&n.insertBefore(this[0]),n.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(t){return"function"==typeof t?this.each(function(n){e(this).wrapInner(t.call(this,n))}):this.each(function(){var n=e(this),r=n.contents();r.length?r.wrapAll(t):n.append(t)})},unwrap:function(t){return this.parent(t).not("body").each(function(){e(this).replaceWith(this.childNodes)}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},toggle:function(t){return this.each(function(){var n=e(this);(void 0===t?"none"==n.css("display"):t)?n.show():n.hide()})},prev:function(t){return e(this.pluck("previousElementSibling")).filter(t||"*")},prevAll:_(r.previousSiblings,r),next:function(t){return e(this.pluck("nextElementSibling")).filter(t||"*")},nextAll:_(r.nextSiblings,r),siblings:_(r.siblings,r),index:function(t){return t?this.indexOf(e(t)[0]):this.parent().children().indexOf(this[0])}}),e.fn.detach=e.fn.remove,e.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};n.traverse;return e.fn.after=k(n.after,n),e.fn.prepend=k(n.prepend,n),e.fn.before=k(n.before,n),e.fn.append=k(n.append,n),t.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,n){e.fn[t]=function(t){for(var r,i=[],o=e(t),s=o.length-1,l=0;l<=s;l++)r=l===s?this:this.clone(!0),e(o[l])[n](r),a.apply(i,r.get());return this.pushStack(i)}}),e}();return(E=C).fn.scrollParent=function(e){var t=this.css("position"),n="absolute"===t,r=e?/(auto|scroll|hidden)/:/(auto|scroll)/,i=this.parents().filter(function(){var e=E(this);return(!n||"static"!==e.css("position"))&&r.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==t&&i.length?i:E(this[0].ownerDocument||document)},function(e){e.fn.end=function(){return this.prevObject||e()},e.fn.andSelf=function(){return this.add(this.prevObject||e())},e.fn.addBack=function(e){return this.prevObject?e?this.add(this.prevObject.filter(e)):this.add(this.prevObject):this},"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings,prev,prevAll,next,nextAll".split(",").forEach(function(t){var n=e.fn[t];e.fn[t]=function(){var e=n.apply(this,arguments);return e.prevObject=this,e}})}(C),function(e){var o;e.fn.query=e.fn.find,e.fn.place=function(e,o){return t.isString(e)?e=r.descendant(e):i(e)&&(e=e[0]),this.each(function(t,r){switch(o){case"before":n.before(e,r);break;case"after":n.after(e,r);break;case"replace":n.replace(e,r);break;case"only":n.empty(e),n.append(e,r);break;case"first":n.prepend(e,r);break;default:n.append(e,r)}})},e.fn.addContent=function(e,n){return e.template&&(e=t.substitute(e.template,e)),this.append(e)},e.fn.disableSelection=(o="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(o+".ui-disableSelection",function(e){e.preventDefault()})}),e.fn.enableSelection=function(){return this.off(".ui-disableSelection")},e.fn.reflow=function(){return n.flow(this[0])},e.fn.isBlockNode=function(){return n.isBlockNode(this[0])}}(C),C.fn.plugin=function(e,t){var n=s.call(arguments,1),r=this,i=this;return this.each(function(){i=plugins.instantiate.apply(r,[this,e].concat(n))}),i},C.wraps={wrapper_node_operation:k,wrapper_map:x,wrapper_value:A,wrapper_selector:_,wrapper_some_chk:function(e,t){return function(){var n=s.call(arguments);return o.call(this,function(r){return e.apply(t,[r].concat(n))})}},wrapper_selector_until:w,wrapper_every_act_firstArgFunc:function(e,t,n){return function(r){var i=s.call(arguments);return u.call(this,function(o,a){h(o,r,a,n(o));e.apply(t,[o,r].concat(i.slice(1)))}),this}},wrapper_every_act:N,wrapper_name_value:function(e,n,r){return function(i,o){var a=s.call(arguments);return t.isPlainObject(i)||t.isDefined(o)?(u.call(this,function(t,s){r&&h(t,o,s,r(t,i)),e.apply(n,[t].concat(a))}),this):this[0]?e.apply(n,[this[0],i]):void 0}}},e.attach("domx.query",C)}),t("skylark-domx-query/main",["./query"],function(e){return e}),t("skylark-domx-query",["skylark-domx-query/main"],function(e){return e}),t("skylark-domx-velm/velm",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-finder","skylark-domx-query"],function(e,t,n,r,i){var o=Array.prototype.map,a=Array.prototype.slice,s=t.klass({klassName:"VisualElement",_construct:function(e){t.isString(e)&&(e="<"===e.charAt(0)?n.createFragment(e)[0]:document.getElementById(e)),this._elm=e}});s.prototype.$=s.prototype.query=function(e){return i(e,this._elm)},s.prototype.elm=function(){return this._elm};var l=new s(document.body),u=function(e){return e?new s(e):l};return t.mixin(u,{batch:function(e,t,n){return e.forEach(function(e){var r=e instanceof s?e:u(e);r[t].apply(r,n)}),this},root:new s(document.body),VisualElement:s,partial:function(e,t){var n={};n[e]=t,s.partial(n)},delegate:function(e,n){var r={};e.forEach(function(e){r[e]=function(e,n){return function(){var r=this._elm,i=e.apply(n,[r].concat(a.call(arguments)));if(i){if(i===n)return this;i instanceof HTMLElement?i=new s(i):t.isArrayLike(i)&&(i=o.call(i,function(e){return e instanceof HTMLElement?new s(e):e}))}return i}}(n[e],n)}),s.partial(r)}}),u.delegate(["ancestor","ancestors","children","descendant","find","findAll","firstChild","lastChild","matches","nextSibling","nextSiblings","parent","previousSibling","previousSiblings","siblings"],r),u.find=function(e){return"body"===e?this.root:this.root.descendant(e)},u.delegate(["after","append","before","clone","contains","contents","empty","html","isChildOf","isDocument","isInDocument","isWindow","ownerDoc","prepend","remove","removeChild","replace","reverse","throb","traverse","wrapper","wrapperInner","unwrap"],n),e.attach("domx.velm",u)}),t("skylark-domx-velm/main",["./velm"],function(e){return e}),t("skylark-domx-velm",["skylark-domx-velm/main"],function(e){return e}),t("skylark-domx-data/main",["./data","skylark-domx-velm","skylark-domx-query"],function(e,t,n){return t.delegate(["attr","data","prop","removeAttr","removeData","text","val"],e),n.fn.text=n.wraps.wrapper_value(e.text,e,e.text),n.fn.attr=n.wraps.wrapper_name_value(e.attr,e,e.attr),n.fn.removeAttr=n.wraps.wrapper_every_act(e.removeAttr,e),n.fn.prop=n.wraps.wrapper_name_value(e.prop,e,e.prop),n.fn.removeProp=n.wraps.wrapper_every_act(e.removeProp,e),n.fn.data=n.wraps.wrapper_name_value(e.data,e,e.data),n.fn.removeData=n.wraps.wrapper_every_act(e.removeData,e),n.fn.val=n.wraps.wrapper_value(e.val,e,e.val),e}),t("skylark-domx-data",["skylark-domx-data/main"],function(e){return e}),t("skylark-domx-contents/contents",["skylark-langx/skylark","skylark-langx/langx","skylark-domx-noder","skylark-domx-data"],function(e,t,n,r){"use strict";var i=function(){return i};return e.attach("domx.contents",i)}),t("skylark-domx-contents/Hotkeys",["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,n){var r=e.Evented.inherit({});return r.count=0,r.keyNameMap={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",91:"Meta",93:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r.aliases={escape:"esc",delete:"del",return:"enter",ctrl:"control",space:"spacebar",ins:"insert",cmd:"meta",command:"meta",wins:"meta",windows:"meta"},r.normalize=function(e){var t,n,r,i,o,a;for(o=e.toLowerCase().replace(/\s+/gi,"").split("+"),t=n=0,a=o.length;n<a;t=++n)r=o[t],o[t]=this.aliases[r]||r;return i=o.pop(),o.sort().push(i),o.join("_")},r.prototype.opts={el:document},r.prototype.init=function(){var e;this.id=++this.constructor.count,this._map={},this._delegate="string"==typeof this.opts.el?document:this.opts.el,t(this._delegate).on("keydown.simple-hotkeys-"+this.id,this.opts.el,(e=this,function(t){var n;return null!=(n=e._getHander(t))?n.call(e,t):void 0}))},r.prototype._getHander=function(e){var t,n;if(t=this.constructor.keyNameMap[e.which])return n="",e.altKey&&(n+="alt_"),e.ctrlKey&&(n+="control_"),e.metaKey&&(n+="meta_"),e.shiftKey&&(n+="shift_"),n+=t.toLowerCase(),this._map[n]},r.prototype.respondTo=function(e){return"string"==typeof e?null!=this._map[this.constructor.normalize(e)]:null!=this._getHander(e)},r.prototype.add=function(e,t){return this._map[this.constructor.normalize(e)]=t,this},r.prototype.remove=function(e){return delete this._map[this.constructor.normalize(e)],this},r.prototype.destroy=function(){return t(this._delegate).off(".simple-hotkeys-"+this.id),this._map={},this},n.Hotkeys=r}),t("skylark-domx-contents/Util",["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,n){var r,i,o,a,s,l,u,c,d,f,h,p,g=e.Evented.inherit({init:function(t,n){if(this.editor=t,this.opts=e.extend({},this.opts,n),this.browser.msie&&this.browser.version<11)return this.phBr=""}});return g.pluginName="Util",g.prototype.phBr="<br/>",g.prototype.os=(r={},/Mac/.test(navigator.appVersion)?r.mac=!0:/Linux/.test(navigator.appVersion)?r.linux=!0:/Win/.test(navigator.appVersion)?r.win=!0:/X11/.test(navigator.appVersion)&&(r.unix=!0),/Mobi/.test(navigator.appVersion)&&(r.mobile=!0),r),g.prototype.browser=(p=navigator.userAgent,s=/(msie|trident)/i.test(p),i=/chrome|crios/i.test(p),h=/safari/i.test(p)&&!i,a=/firefox/i.test(p),o=/edge/i.test(p),s?{msie:!0,version:1*(null!=(l=p.match(/(msie |rv:)(\d+(\.\d+)?)/i))?l[2]:void 0)}:o?{edge:!0,webkit:!0,version:1*(null!=(u=p.match(/edge\/(\d+(\.\d+)?)/i))?u[1]:void 0)}:i?{webkit:!0,chrome:!0,version:1*(null!=(c=p.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))?c[1]:void 0)}:h?{webkit:!0,safari:!0,version:1*(null!=(d=p.match(/version\/(\d+(\.\d+)?)/i))?d[1]:void 0)}:a?{mozilla:!0,firefox:!0,version:1*(null!=(f=p.match(/firefox\/(\d+(\.\d+)?)/i))?f[1]:void 0)}:{}),g.prototype.support={onselectionchange:function(){var e;if(void 0!==(e=document.onselectionchange))try{return document.onselectionchange=0,null===document.onselectionchange}catch(e){}finally{document.onselectionchange=e}return!1}(),oninput:!/(msie|trident)/i.test(navigator.userAgent)},g.prototype.reflow=function(e){return null==e&&(e=document),t(e)[0].offsetHeight},g.prototype.metaKey=function(e){return/Mac/.test(navigator.userAgent)?e.metaKey:e.ctrlKey},g.prototype.isEmptyNode=function(e){var n;return(n=t(e)).is(":empty")||!n.text()&&!n.find(":not(br, span, div)").length},g.prototype.isDecoratedNode=function(e){return t(e).is('[class^="'+this.opts.classPrefix+'"]')},g.prototype.blockNodes=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","h5","table"],g.prototype.isBlockNode=function(e){return!(!(e=t(e)[0])||3===e.nodeType)&&new RegExp("^("+this.blockNodes.join("|")+")$").test(e.nodeName.toLowerCase())},g.prototype.getNodeLength=function(e){switch((e=t(e)[0]).nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},g.prototype.dataURLtoBlob=function(e){var t,n,r,i,o,a,s,l,u,c,d;if(a=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return e,!1}}(),o=a&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return e,!1}}(),t=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,!((a||t)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(i=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),n=new ArrayBuffer(i.length),l=new Uint8Array(n),s=u=0,d=i.length;0<=d?u<=d:u>=d;s=0<=d?++u:--u)l[s]=i.charCodeAt(s);return c=e.split(",")[0].split(":")[1].split(";")[0],a?new Blob([o?l:n],{type:c}):((r=new t).append(n),r.getBlob(c))},g.prototype.throttle=function(e,t){var n,r,i,o,a,s,l;return o=0,l=0,i=n=a=null,r=function(){return l=0,o=+new Date,a=e.apply(i,n),i=null,n=null},(s=function(){var e;return i=this,n=arguments,e=new Date-o,l||(e>=t?r():l=setTimeout(r,t-e)),a}).clear=function(){if(l)return clearTimeout(l),r()},s},g.prototype.formatHTML=function(t){var n,r,i,o,a,s,l,u;for(a=/<(\/?)(.+?)(\/?)>/g,l="",i=0,r=null,"  ",s=function(e,t){return new Array(t+1).join(e)};null!==(o=a.exec(t));)o.isBlockNode=e.inArray(o[2],this.blockNodes)>-1,o.isStartTag="/"!==o[1]&&"/"!==o[3],o.isEndTag="/"===o[1]||"/"===o[3],n=r?r.index+r[0].length:0,(u=t.substring(n,o.index)).length>0&&e.trim(u)&&(l+=u),o.isBlockNode&&o.isEndTag&&!o.isStartTag&&(i-=1),o.isBlockNode&&o.isStartTag&&(r&&r.isBlockNode&&r.isEndTag||(l+="\n"),l+=s("  ",i)),l+=o[0],o.isBlockNode&&o.isEndTag&&(l+="\n"),o.isBlockNode&&o.isStartTag&&(i+=1),r=o;return e.trim(l)},n.Util=g}),t("skylark-domx-contents/InputManager",["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,n){var r=[].indexOf,i=e.Evented.inherit({init:function(n,r){var i,o,a;this.editable=n,this.opts=e.extend({},this.opts,r),this.throttledValueChanged=this.editable.util.throttle((a=this,function(e){return setTimeout(function(){return a.editable.trigger("valuechanged",e)},10)}),300),this.throttledSelectionChanged=this.editable.util.throttle(function(e){return function(){return e.editable.trigger("selectionchanged")}}(this),50),t(document).on("selectionchange.simditor"+this.editable.id,function(e){return function(t){var n;if(e.focused&&!e.editable.clipboard.pasting)return(n=function(){return e._selectionTimer&&(clearTimeout(e._selectionTimer),e._selectionTimer=null),e.editable.selection._selection.rangeCount>0?e.throttledSelectionChanged():e._selectionTimer=setTimeout(function(){if(e._selectionTimer=null,e.focused)return n()},10)})()}}(this)),this.editable.on("valuechanged",function(e){return function(){var n;if(e.lastCaretPosition=null,n=e.editable.body.children().filter(function(t,n){return e.editable.util.isBlockNode(n)}),e.focused&&0===n.length&&(e.editable.selection.save(),e.editable.formatter.format(),e.editable.selection.restore()),e.editable.body.find("hr, pre, ."+e.opts.classPrefix+"table").each(function(n,r){var i,o;if(((i=t(r)).parent().is("blockquote")||i.parent()[0]===e.editable.body[0])&&(o=!1,0===i.next().length&&(t("<p/>").append(e.editable.util.phBr).insertAfter(i),o=!0),0===i.prev().length&&(t("<p/>").append(e.editable.util.phBr).insertBefore(i),o=!0),o))return e.throttledValueChanged()}),e.editable.body.find("pre:empty").append(e.editable.util.phBr),!e.editable.util.support.onselectionchange&&e.focused)return e.throttledSelectionChanged()}}(this)),this.editable.body.on("keydown",e.proxy(this._onKeyDown,this)).on("keypress",e.proxy(this._onKeyPress,this)).on("keyup",e.proxy(this._onKeyUp,this)).on("mouseup",e.proxy(this._onMouseUp,this)).on("focus",e.proxy(this._onFocus,this)).on("blur",e.proxy(this._onBlur,this)).on("drop",e.proxy(this._onDrop,this)).on("input",e.proxy(this._onInput,this)),this.editable.util.browser.firefox&&(this.editable.hotkeys.add("cmd+left",function(e){return function(t){return t.preventDefault(),e.editable.selection._selection.modify("move","backward","lineboundary"),!1}}(this)),this.editable.hotkeys.add("cmd+right",function(e){return function(t){return t.preventDefault(),e.editable.selection._selection.modify("move","forward","lineboundary"),!1}}(this)),i=this.editable.util.os.mac?"cmd+a":"ctrl+a",this.editable.hotkeys.add(i,function(e){return function(t){var n,r,i,o;if((n=e.editable.body.children()).length>0)return r=n.first().get(0),i=n.last().get(0),(o=document.createRange()).setStart(r,0),o.setEnd(i,e.editable.util.getNodeLength(i)),e.editable.selection.range(o),!1}}(this))),o=this.editable.util.os.mac?"cmd+enter":"ctrl+enter",this.editable.hotkeys.add(o,function(e){return function(t){return e.editable.$el.closest("form").find("button:submit").click(),!1}}(this))}});return i.pluginName="InputManager",i.prototype._modifierKeys=[16,17,18,91,93,224],i.prototype._arrowKeys=[37,38,39,40],i.prototype._onFocus=function(e){var t;if(!this.editable.clipboard.pasting)return this.editable.$el.addClass("focus").removeClass("error"),this.focused=!0,setTimeout((t=this,function(){var e,n;if((n=t.editable.selection._selection.getRangeAt(0)).startContainer===t.editable.body[0]&&(t.lastCaretPosition?t.editable.undoManager.caretPosition(t.lastCaretPosition):(e=t.editable.body.children().first(),n=document.createRange(),t.editable.selection.setRangeAtStartOf(e,n),console.log("aaaaaa"))),t.lastCaretPosition=null,t.editable.trigger("focus"),!t.editable.util.support.onselectionchange)return t.throttledSelectionChanged()}),0)},i.prototype._onBlur=function(e){var t;if(!this.editable.clipboard.pasting)return this.editable.$el.removeClass("focus"),this.editable.sync(),this.focused=!1,this.lastCaretPosition=null!=(t=this.editable.undoManager.currentState())?t.caret:void 0,this.editable.trigger("blur")},i.prototype._onMouseUp=function(e){if(!this.editable.util.support.onselectionchange)return this.throttledSelectionChanged()},i.prototype._onKeyDown=function(e){var t,n;if(!1===this.editable.trigger(e))return!1;if(!this.editable.hotkeys.respondTo(e)){if(this.editable.keystroke.respondTo(e))return this.throttledValueChanged(),!1;if(!(t=e.which,r.call(this._modifierKeys,t)>=0||(n=e.which,r.call(this._arrowKeys,n)>=0)||this.editable.util.metaKey(e)&&86===e.which))return this.editable.util.support.oninput||this.throttledValueChanged(["typing"]),null}},i.prototype._onKeyPress=function(e){if(!1===this.editable.trigger(e))return!1},i.prototype._onKeyUp=function(e){var n,i;if(!1===this.editable.trigger(e))return!1;!this.editable.util.support.onselectionchange&&(i=e.which,r.call(this._arrowKeys,i)>=0)?this.throttledValueChanged():8!==e.which&&46!==e.which||!this.editable.util.isEmptyNode(this.editable.body)||(this.editable.body.empty(),n=t("<p/>").append(this.editable.util.phBr).appendTo(this.editable.body),this.editable.selection.setRangeAtStartOf(n))},i.prototype._onDrop=function(e){return!1!==this.editable.trigger(e)&&this.throttledValueChanged()},i.prototype._onInput=function(e){return this.throttledValueChanged(["oninput"])},n.InputManager=i}),t("skylark-domx-contents/Selection",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","./contents"],function(e,t,n,r){var i=e.Evented.inherit({_range:null,_startNodes:null,_endNodes:null,_containerNode:null,_nodes:null,_blockNodes:null,_rootNodes:null,init:function(t,n){var r=this;this.editable=t,this.opts=e.extend({},this.opts,n),this._selection=document.getSelection(),this.editable.on("selectionchanged",function(e){return console.log("selectionchanged"),r.reset(),r._range=r._selection.getRangeAt(0)}),this.editable.on("blur",function(e){return r.reset()}),this.editable.on("focus",function(e){return r.reset(),r._range=r._selection.getRangeAt(0)})},reset:function(){return this._range=null,this._startNodes=null,this._endNodes=null,this._containerNode=null,this._nodes=null,this._blockNodes=null,this._rootNodes=null},clear:function(){try{this._selection.removeAllRanges(),console.log("clear")}catch(e){e}return this.reset()},range:function(t){var n;return t?(this.clear(),this._selection.addRange(t),this._range=t,n=e.hoster.browser.mozilla||e.hoster.browser.msie,!this.editable.inputManager.focused&&n&&this.editable.body.focus()):!this._range&&this.editable.inputManager.focused&&this._selection.rangeCount&&(this._range=this._selection.getRangeAt(0)),this._range},startNodes:function(){var e;return this._range&&(this._startNodes||(this._startNodes=(e=this,function(){var t;return(t=n(e._range.startContainer).parentsUntil(e.editable.body).get()).unshift(e._range.startContainer),n(t)})())),this._startNodes},endNodes:function(){var e;return this._range&&(this._endNodes||(this._endNodes=this._range.collapsed?this.startNodes():((e=n(this._range.endContainer).parentsUntil(this.editable.body).get()).unshift(this._range.endContainer),n(e)))),this._endNodes},containerNode:function(){return this._range&&(this._containerNode||(this._containerNode=n(this._range.commonAncestorContainer))),this._containerNode},nodes:function(){var t;return this._range&&(this._nodes||(this._nodes=(t=this,function(){var r;return r=[],t.startNodes().first().is(t.endNodes().first())?r=t.startNodes().get():(t.startNodes().each(function(i,o){var a,s,l,u,c,d,f;return s=n(o),t.endNodes().index(s)>-1?r.push(o):s.parent().is(t.editable.body)||(d=t.endNodes().index(s.parent()))>-1?(a=d&&d>-1?t.endNodes().eq(d-1):t.endNodes().last(),l=s.parent().contents(),f=l.index(s),u=l.index(a),e.merge(r,l.slice(f,u).get())):(l=s.parent().contents(),c=l.index(s),e.merge(r,l.slice(c).get()))}),t.endNodes().each(function(i,o){var a,s,l;return(a=n(o)).parent().is(t.editable.body)||t.startNodes().index(a.parent())>-1?(r.push(o),!1):(s=a.parent().contents(),l=s.index(a),e.merge(r,s.slice(0,l+1)))})),n(e.uniq(r))})())),this._nodes},blockNodes:function(){var e;if(this._range)return this._blockNodes||(this._blockNodes=(e=this,function(){return e.nodes().filter(function(t,n){return e.editable.util.isBlockNode(n)})})()),this._blockNodes},rootNodes:function(){var e;if(this._range)return this._rootNodes||(this._rootNodes=(e=this,function(){return e.nodes().filter(function(t,r){var i;return(i=n(r).parent()).is(e.editable.body)||i.is("blockquote")})})()),this._rootNodes},rangeAtEndOf:function(e,r){var i,o,a,s,l,u;if(null==r&&(r=this.range()),r&&r.collapsed)return e=n(e)[0],a=r.endContainer,s=this.editable.util.getNodeLength(a),o=r.endOffset===s-1,l=n(a).contents().last().is("br"),i=r.endOffset===s,!!(o&&l||i)&&(e===a||!!t.contains(e,a)&&(u=!0,n(a).parentsUntil(e).addBack().each(function(e,t){var r,i,o,a;if(a=n(t).parent().contents().filter(function(){return!(this!==t&&3===this.nodeType&&!this.nodeValue)}),r=a.last(),o=r.get(0)===t,i=r.is("br")&&r.prev().get(0)===t,!o&&!i)return u=!1,!1}),u))},rangeAtStartOf:function(e,r){var i,o;if(null==r&&(r=this.range()),r&&r.collapsed)return e=n(e)[0],o=r.startContainer,0===r.startOffset&&(e===o||!!t.contains(e,o)&&(i=!0,n(o).parentsUntil(e).addBack().each(function(e,t){if(n(t).parent().contents().filter(function(){return!(this!==t&&3===this.nodeType&&!this.nodeValue)}).first().get(0)!==t)return i=!1}),i))},insertNode:function(e,t){if(null==t&&(t=this.range()),t)return e=n(e)[0],t.insertNode(e),this.setRangeAfter(e,t)},setRangeAfter:function(e,t){if(null==t&&(t=this.range()),null!=t)return e=n(e)[0],t.setEndAfter(e),t.collapse(!1),this.range(t)},setRangeBefore:function(e,t){if(null==t&&(t=this.range()),null!=t)return e=n(e)[0],t.setEndBefore(e),t.collapse(!1),this.range(t)},setRangeAtStartOf:function(e,t){return null==t&&(t=this.range()),e=n(e).get(0),t.setEnd(e,0),t.collapse(!1),this.range(t)},setRangeAtEndOf:function(e,t){var r,i,o,a,s,l,u;if(null==t&&(t=this.range()),i=n(e),e=i[0])return i.is("pre")?(o=i.contents()).length>0?(a=o.last(),l=a.text(),s=this.editable.util.getNodeLength(a[0]),"\n"===l.charAt(l.length-1)?t.setEnd(a[0],s-1):t.setEnd(a[0],s)):t.setEnd(e,0):(u=this.editable.util.getNodeLength(e),3!==e.nodeType&&u>0&&((r=n(e).contents().last()).is("br")?u-=1:3!==r[0].nodeType&&this.editable.util.isEmptyNode(r)&&(r.append(this.editable.util.phBr),e=r[0],u=0)),t.setEnd(e,u)),t.collapse(!1),this.range(t)},deleteRangeContents:function(e){var t,n,r,i;return null==e&&(e=this.range()),i=e.cloneRange(),r=e.cloneRange(),i.collapse(!0),r.collapse(!1),n=this.rangeAtStartOf(this.editable.body,i),t=this.rangeAtEndOf(this.editable.body,r),!e.collapsed&&n&&t?(this.editable.body.empty(),e.setStart(this.editable.body[0],0),e.collapse(!0),this.range(e)):e.deleteContents(),e},breakBlockEl:function(e,t){var r;return null==t&&(t=this.range()),r=n(e),t.collapsed?(t.setStartBefore(r.get(0)),t.collapsed?r:r.before(t.extractContents())):r},save:function(e){var t,r,i;if(null==e&&(e=this.range()),!this._selectionSaved)return(r=e.cloneRange()).collapse(!1),i=n("<span/>").addClass(this.opts.classPrefix+"caret-start"),t=n("<span/>").addClass(this.opts.classPrefix+"caret-end"),r.insertNode(t[0]),e.insertNode(i[0]),this.clear(),this._selectionSaved=!0},restore:function(){var e,t,n,r,i,o,a;return!!this._selectionSaved&&(i=this.editable.body.find("."+this.opts.classPrefix+"caret-start"),e=this.editable.body.find("."+this.opts.classPrefix+"caret-end"),i.length&&e.length?(o=i.parent(),a=o.contents().index(i),t=e.parent(),n=t.contents().index(e),o[0]===t[0]&&(n-=1),(r=document.createRange()).setStart(o.get(0),a),r.setEnd(t.get(0),n),i.remove(),e.remove(),this.range(r)):(i.remove(),e.remove()),this._selectionSaved=!1,r)}});return i.pluginName="Selection",r.Selection=i}),t("skylark-domx-contents/UndoManager",["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,n){var r=e.Evented.inherit({init:function(t,n){var r,i,o;this.editable=t,this.opts=e.extend({},this.opts,n),this._stack=[],this.editable.util.os.mac?(i="cmd+z",r="shift+cmd+z"):this.editable.util.os.win?(i="ctrl+z",r="ctrl+y"):(i="ctrl+z",r="shift+ctrl+z"),this.editable.hotkeys.add(i,(o=this,function(e){return e.preventDefault(),o.undo(),!1})),this.editable.hotkeys.add(r,function(e){return function(t){return t.preventDefault(),e.redo(),!1}}(this)),this.throttledPushState=this.editable.util.throttle(function(e){return function(){return e._pushUndoState()}}(this),2e3),this.editable.on("valuechanged",function(e){return function(t,n){if("undo"!==n&&"redo"!==n)return e.throttledPushState()}}(this)),this.editable.on("selectionchanged",function(e){return function(t){return e.resetCaretPosition(),e.update()}}(this)),this.editable.on("focus",function(e){return function(t){if(0===e._stack.length)return e._pushUndoState()}}(this)),this.editable.on("blur",function(e){return function(t){return e.resetCaretPosition()}}(this))}});return r.pluginName="UndoManager",r.prototype._index=-1,r.prototype._capacity=20,r.prototype._startPosition=null,r.prototype._endPosition=null,r.prototype.resetCaretPosition=function(){return this._startPosition=null,this._endPosition=null},r.prototype.startPosition=function(){return this.editable.selection._range&&(this._startPosition||(this._startPosition=this._getPosition("start"))),this._startPosition},r.prototype.endPosition=function(){var e;return this.editable.selection._range&&(this._endPosition||(this._endPosition=(e=this,function(){return e.editable.selection.range().collapsed?e._startPosition:e._getPosition("end")})())),this._endPosition},r.prototype._pushUndoState=function(){if(!1!==this.editable.trigger("pushundostate")&&this.caretPosition().start)return this._index+=1,this._stack.length=this._index,this._stack.push({html:this.editable.body.html(),caret:this.caretPosition()}),this._stack.length>this._capacity?(this._stack.shift(),this._index-=1):void 0},r.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},r.prototype.undo=function(){var e;if(!(this._index<1||this._stack.length<2))return this._index-=1,e=this._stack[this._index],this.editable.body.get(0).innerHTML=e.html,this.caretPosition(e.caret),this.editable.body.find(".selected").removeClass("selected"),this.editable.sync(),this.editable.trigger("valuechanged",["undo"])},r.prototype.redo=function(){var e;if(!(this._index<0||this._stack.length<this._index+2))return this._index+=1,e=this._stack[this._index],this.editable.body.get(0).innerHTML=e.html,this.caretPosition(e.caret),this.editable.body.find(".selected").removeClass("selected"),this.editable.sync(),this.editable.trigger("valuechanged",["redo"])},r.prototype.update=function(){var e;if(e=this.currentState())return e.html=this.editable.body.html(),e.caret=this.caretPosition()},r.prototype._getNodeOffset=function(n,r){var i,o,a;return i=e.isNumber(r)?t(n):t(n).parent(),a=0,o=!1,i.contents().each(function(e,t){return n!==t&&(r!==e||0!==e)&&(t.nodeType===Node.TEXT_NODE?!o&&t.nodeValue.length>0&&(a+=1,o=!0):(a+=1,o=!1),r-1!==e&&null)}),a},r.prototype._getPosition=function(e){var n,r,i,o,a,s,l,u;if(null==e&&(e="start"),l=this.editable.selection.range(),o=l[e+"Offset"],n=this.editable.selection[e+"Nodes"](),(r=n.first()[0]).nodeType===Node.TEXT_NODE){for(s=r.previousSibling;s&&s.nodeType===Node.TEXT_NODE;)r=s,o+=this.editable.util.getNodeLength(s),s=s.previousSibling;(i=n.get())[0]=r,n=t(i)}else o=this._getNodeOffset(r,o);return a=[o],n.each((u=this,function(e,t){return a.unshift(u._getNodeOffset(t))})),a},r.prototype._getNodeByPosition=function(e){var n,r,i,o,a,s,l,u;for(s=this.editable.body[0],u=e.slice(0,e.length-1),i=o=0,a=u.length;o<a;i=++o){if(l=u[i],r=s.childNodes,l>r.length-1){if(i!==e.length-2||!t(s).is(":empty")){s=null;break}n=document.createTextNode(""),s.appendChild(n),r=s.childNodes}s=r[l]}return s},r.prototype.caretPosition=function(e){var t,n,r,i,o;if(e){if(!e.start)return;return i=this._getNodeByPosition(e.start),o=e.start[e.start.length-1],e.collapsed?(t=i,n=o):(t=this._getNodeByPosition(e.end),n=e.start[e.start.length-1]),i&&t?((r=document.createRange()).setStart(i,o),r.setEnd(t,n),this.editable.selection.range(r)):void("undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("simditor: invalid caret state"))}return r=this.editable.selection.range(),e=this.editable.inputManager.focused&&null!=r?{start:this.startPosition(),end:this.endPosition(),collapsed:r.collapsed}:{}},n.UndoManager=r}),t("skylark-domx-contents/Keystroke",["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,n){var r=e.Evented.inherit({init:function(t,n){this.editable=t,this.opts=e.extend({},this.opts,n),this._keystrokeHandlers={},this._initKeystrokeHandlers()}});return r.pluginName="Keystroke",r.prototype.add=function(e,t,n){return e=e.toLowerCase(),e=this.editable.hotkeys.constructor.aliases[e]||e,this._keystrokeHandlers[e]||(this._keystrokeHandlers[e]={}),this._keystrokeHandlers[e][t]=n},r.prototype.respondTo=function(e){var n,r,i,o,a;if(r=null!=(i=this.editable.hotkeys.constructor.keyNameMap[e.which])?i.toLowerCase():void 0)return!!(r in this._keystrokeHandlers&&((o="function"==typeof(n=this._keystrokeHandlers[r])["*"]?n["*"](e):void 0)||this.editable.selection.startNodes().each((a=this,function(n,i){var s,l;if(i.nodeType===Node.ELEMENT_NODE)return s=null!=(l=a._keystrokeHandlers[r])?l[i.tagName.toLowerCase()]:void 0,!0!==(o="function"==typeof s?s(e,t(i)):void 0)&&!1!==o&&void 0})),o))||void 0},r.prototype._initKeystrokeHandlers=function(){var e,n;return this.editable.util.browser.safari&&this.add("enter","*",(n=this,function(e){var r,i;if(e.shiftKey&&!(r=n.editable.selection.blockNodes().last()).is("pre"))return i=t("<br/>"),n.editable.selection.rangeAtEndOf(r)?(n.editable.selection.insertNode(i),n.editable.selection.insertNode(t("<br/>")),n.editable.selection.setRangeBefore(i)):n.editable.selection.insertNode(i),!0})),(this.editable.util.browser.webkit||this.editable.util.browser.msie)&&(e=function(e){return function(n,r){var i;if(e.editable.selection.rangeAtEndOf(r))return i=t("<p/>").append(e.editable.util.phBr).insertAfter(r),e.editable.selection.setRangeAtStartOf(i),!0}}(this),this.add("enter","h1",e),this.add("enter","h2",e),this.add("enter","h3",e),this.add("enter","h4",e),this.add("enter","h5",e),this.add("enter","h6",e)),this.add("backspace","*",function(e){return function(t){var n,r,i;return i=e.editable.selection.rootNodes().first(),(r=i.prev()).is("hr")&&e.editable.selection.rangeAtStartOf(i)?(e.editable.selection.save(),r.remove(),e.editable.selection.restore(),!0):((n=e.editable.selection.blockNodes().last()).is("."+e.opts.classPrefix+"resize-handle")&&i.is("."+e.opts.classPrefix+"table")&&(t.preventDefault(),i.remove(),e.editable.selection.setRangeAtEndOf(r)),r.is("."+e.opts.classPrefix+"table")&&!n.is("table")&&e.editable.util.isEmptyNode(n)&&(t.preventDefault(),n.remove(),e.editable.selection.setRangeAtEndOf(r)),e.editable.util.browser.webkit&&e.editable.selection.rangeAtStartOf(n)?(e.editable.selection.save(),e.editable.formatter.cleanNode(n,!0),e.editable.selection.restore(),null):void 0)}}(this)),this.add("enter","div",function(e){return function(n,r){var i;if(r.is("."+e.opts.classPrefix+"table")&&e.editable.selection.blockNodes().last().is("."+e.opts.classPrefix+"resize-handle"))return n.preventDefault(),i=t("<p/>").append(e.editable.util.phBr).insertAfter(r),e.editable.selection.setRangeAtStartOf(i)}}(this)),this.add("enter","li",function(e){return function(n,r){var i,o,a,s;if((i=r.clone()).find("ul, ol").remove(),e.editable.util.isEmptyNode(i)&&r.is(e.editable.selection.blockNodes().last())){if(o=r.parent(),r.next("li").length>0){if(!e.editable.util.isEmptyNode(r))return;o.parent("li").length>0?(a=t("<li/>").append(e.editable.util.phBr).insertAfter(o.parent("li")),s=t("<"+o[0].tagName+"/>").append(r.nextAll("li")),a.append(s)):(a=t("<p/>").append(e.editable.util.phBr).insertAfter(o),s=t("<"+o[0].tagName+"/>").append(r.nextAll("li")),a.after(s))}else o.parent("li").length>0?(a=t("<li/>").insertAfter(o.parent("li")),r.contents().length>0?a.append(r.contents()):a.append(e.editable.util.phBr)):(a=t("<p/>").append(e.editable.util.phBr).insertAfter(o),r.children("ul, ol").length>0&&a.after(r.children("ul, ol")));return r.prev("li").length?r.remove():r.prev("ul").length||r.prev("ol").length?r.remove():o.remove(),e.editable.selection.setRangeAtStartOf(a),!0}}}(this)),this.add("enter","pre",function(e){return function(n,r){var i,o,a;return n.preventDefault(),n.shiftKey?(i=t("<p/>").append(e.editable.util.phBr).insertAfter(r),e.editable.selection.setRangeAtStartOf(i),!0):(a=e.editable.selection.range(),o=null,a.deleteContents(),o=!e.editable.util.browser.msie&&e.editable.selection.rangeAtEndOf(r)?document.createTextNode("\n\n"):document.createTextNode("\n"),a.insertNode(o),a.setEnd(o,1),a.collapse(!1),e.editable.selection.range(a),!0)}}(this)),this.add("enter","blockquote",function(e){return function(t,n){var r,i;if((r=e.editable.selection.blockNodes().last()).is("p")&&!r.next().length&&e.editable.util.isEmptyNode(r))return n.after(r),i=document.createRange(),e.editable.selection.setRangeAtStartOf(r,i),!0}}(this)),this.add("backspace","li",function(e){return function(n,r){var i,o,a,s,l,u,c,d,f;return o=r.children("ul, ol"),l=r.prev("li"),o.length>0&&l.length>0&&(f="",u=null,r.contents().each(function(e,n){return(1!==n.nodeType||!/UL|OL/.test(n.nodeName))&&(1===n.nodeType&&/BR/.test(n.nodeName)?void 0:(3===n.nodeType&&n.nodeValue?f+=n.nodeValue:1===n.nodeType&&(f+=t(n).text()),u=t(n)))}),c=e.editable.util.browser.firefox&&!u.next("br").length,u&&1===f.length&&c?(i=t(e.editable.util.phBr).insertAfter(u),u.remove(),e.editable.selection.setRangeBefore(i),!0):!(f.length>0)&&(d=document.createRange(),(s=l.children("ul, ol")).length>0?(a=t("<li/>").append(e.editable.util.phBr).appendTo(s),s.append(o.children("li")),r.remove(),e.editable.selection.setRangeAtEndOf(a,d)):(e.editable.selection.setRangeAtEndOf(l,d),l.append(o),r.remove(),e.editable.selection.range(d)),!0))}}(this)),this.add("backspace","pre",function(e){return function(n,r){var i,o,a;if(e.editable.selection.rangeAtStartOf(r))return o=r.html().replace("\n","<br/>")||e.editable.util.phBr,i=t("<p/>").append(o).insertAfter(r),r.remove(),a=document.createRange(),e.editable.selection.setRangeAtStartOf(i,a),!0}}(this)),this.add("backspace","blockquote",function(e){return function(t,n){var r,i;if(e.editable.selection.rangeAtStartOf(n))return r=n.children().first().unwrap(),i=document.createRange(),e.editable.selection.setRangeAtStartOf(r,i),!0}}(this))},n.Keystroke=r}),t("skylark-domx-contents/Formatter",["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,n){var r=[].indexOf,i=e.Evented.inherit({opts:{allowedTags:[],allowedAttributes:{},allowedStyles:{}},init:function(t,n){this.editable=t,this.opts=e.extend({},this.opts,n),this._allowedTags=e.merge(["br","span","a","img","b","strong","i","strike","u","font","p","ul","ol","li","blockquote","pre","code","h1","h2","h3","h4","hr"],this.opts.allowedTags),this._allowedAttributes=e.extend({img:["src","alt","width","height","data-non-image"],a:["href","target","download"],font:["color"],code:["class"]},this.opts.allowedAttributes),this._allowedStyles=e.extend({span:["color","font-size"],b:["color","font-size"],i:["color","font-size"],strong:["color","font-size"],strike:["color","font-size"],u:["color","font-size"],p:["margin-left","text-align"],h1:["margin-left","text-align"],h2:["margin-left","text-align"],h3:["margin-left","text-align"],h4:["margin-left","text-align"]},this.opts.allowedStyles),this.editable.body.on("click","a",function(e){return!1})},decorate:function(e){return null==e&&(e=this.editable.body),this.editable.trigger("decorate",[e]),e},undecorate:function(e){return null==e&&(e=this.editable.body.clone()),this.editable.trigger("undecorate",[e]),e},autolink:function(e){var n,r,i,o,a,s,l,u,c,d,f,h,p;for(null==e&&(e=this.editable.body),l=[],(i=function(n){return n.contents().each(function(n,r){var o,a;if(!(o=t(r)).is("a")&&!o.closest("a, pre",e).length)return!o.is("iframe")&&o.contents().length?i(o):(a=o.text())&&/https?:\/\/|www\./gi.test(a)?l.push(o):void 0})})(e),c=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/gi,o=0,s=l.length;o<s;o++){for(r=l[o],h=r.text(),d=[],u=null,a=0;null!==(u=c.exec(h));)f=h.substring(a,u.index),d.push(document.createTextNode(f)),a=c.lastIndex,p=/^(http(s)?:\/\/|\/)/.test(u[0])?u[0]:"http://"+u[0],n=t('<a href="'+p+'" rel="nofollow"></a>').text(u[0]),d.push(n[0]);d.push(document.createTextNode(h.substring(a))),r.replaceWith(t(d))}return e},format:function(e){var n,r,i,o,a,s,l,u,c,d;if(null==e&&(e=this.editable.body),e.is(":empty"))return e.append("<p>"+this.editable.util.phBr+"</p>"),e;for(c=e.contents(),i=0,a=c.length;i<a;i++)l=c[i],this.cleanNode(l,!0);for(d=e.contents(),o=0,s=d.length;o<s;o++)u=d[o],(n=t(u)).is("br")?(void 0!==r&&null!==r&&(r=null),n.remove()):this.editable.util.isBlockNode(u)?n.is("li")?r&&r.is("ul, ol")?r.append(u):(r=t("<ul/>").insertBefore(u)).append(u):r=null:(r&&!r.is("ul, ol")||(r=t("<p/>").insertBefore(u)),r.append(u),this.editable.util.isEmptyNode(r)&&r.append(this.editable.util.phBr));return e},cleanNode:function(n,i){var o,a,s,l,u,c,d,f,h,p,g,y,m,b,v,k,x,_;if((s=t(n)).length>0){if(3!==s[0].nodeType){if(f=s.is("iframe")?null:s.contents(),h=this.editable.util.isDecoratedNode(s),s.is(this._allowedTags.join(","))||h){if(s.is("a")&&(a=s.find("img")).length>0&&(s.replaceWith(a),s=a,f=null),s.is("td")&&(o=s.find(this.editable.util.blockNodes.join(","))).length>0&&(o.each(function(e,n){return t(n).contents().unwrap()}),f=s.contents()),s.is("img")&&s.hasClass("uploading")&&s.remove(),!h){for(c=this._allowedAttributes[s[0].tagName.toLowerCase()],v=e.makeArray(s[0].attributes),p=0,y=v.length;p<y;p++)"style"!==(d=v[p]).name&&(null!=c&&(k=d.name,r.call(c,k)>=0)||s.removeAttr(d.name));this._cleanNodeStyles(s),s.is("span")&&(0===s[0].attributes.length&&s.contents().first().unwrap(),2===s[0].style.length&&"rgb(51, 51, 51)"===s[0].style.color&&"16px"===s[0].style.fontSize&&s.contents().unwrap())}}else 1!==s[0].nodeType||s.is(":empty")?(s.remove(),f=null):s.is("div, article, dl, header, footer, tr")?(s.append("<br/>"),f.first().unwrap()):s.is("table")?(l=t("<p/>"),s.find("tr").each(function(e,n){return l.append(t(n).text()+"<br/>")}),s.replaceWith(l),f=null):s.is("thead, tfoot")?(s.remove(),f=null):s.is("th")?(u=t("<td/>").append(s.contents()),s.replaceWith(u)):f.first().unwrap();if(i&&null!=f&&!s.is("pre"))for(g=0,m=f.length;g<m;g++)b=f[g],this.cleanNode(b,!0);return null}(x=s.text().replace(/(\r\n|\n|\r)/gm,""))?(_=document.createTextNode(x),s.replaceWith(_)):s.remove()}},_cleanNodeStyles:function(t){var n,i,o,a,s,l,u,c,d;if(c=t.attr("style")){if(t.removeAttr("style"),!((n=this._allowedStyles[t[0].tagName.toLowerCase()])&&n.length>0))return t;for(d={},s=c.split(";"),i=0,o=s.length;i<o;i++)u=s[i],u=e.trim(u),2===(a=u.split(":")).length&&("font-size"===a[0]&&a[1].indexOf("px")>0&&parseInt(a[1],10)<12||(l=a[0],r.call(n,l)>=0&&(d[e.trim(a[0])]=e.trim(a[1]))));return Object.keys(d).length>0&&t.css(d),t}},clearHtml:function(e,n){var r,i,o,a;return null==n&&(n=!0),r=t("<div/>").append(e),i=r.contents(),o="",i.each((a=this,function(e,r){var s,l;return 3===r.nodeType?o+=r.nodeValue:1===r.nodeType&&(s=t(r),(l=s.is("iframe")?null:s.contents())&&l.length>0&&(o+=a.clearHtml(l)),n&&e<i.length-1&&s.is("br, p, div, li,tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2,h3, h4, header"))?o+="\n":void 0})),o},beautify:function(e){var n,r=this;return n=function(e){return!!(e.is("p")&&!e.text()&&e.children(":not(br)").length<1)},e.each(function(e,i){var o;return o=t(i),(o.is(':not(img, br, col, td, hr, [class^="'+r.opts.classPrefix+'"]):empty')||n(o))&&o.remove(),o.find(':not(img, br, col, td, hr, [class^="'+r.opts.classPrefix+'"]):empty').remove()})}});return i.pluginName="Formatter",n.Formatter=i}),t("skylark-domx-contents/Indentation",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","./contents"],function(e,t,n,r){var i=e.Evented.inherit({});return i.pluginName="Indentation",i.prototype.opts={tabIndent:!0,indentWidth:40},i.prototype.init=function(t,n){var r;this.editable=t,this.opts=e.extend({},this.opts,n),this.editable.keystroke.add("tab","*",(r=this,function(e){var t;if(t=r.editable.toolbar.findButton("code"),r.opts.tabIndent||t&&t.active)return r.indent(e.shiftKey)}))},i.prototype.indent=function(e){var r,i,o,a;return this.editable.selection.startNodes(),this.editable.selection.endNodes(),r=this.editable.selection.blockNodes(),i=[],r=r.each(function(e,n){var r,o,a,s,l;for(r=!0,o=a=0,s=i.length;a<s;o=++a){if(l=i[o],t.contains(n,l)){r=!1;break}if(t.contains(l,n)){i.splice(o,1,n),r=!1;break}}if(r)return i.push(n)}),r=n(i),o=!1,r.each((a=this,function(t,n){var r;if(r=e?a.outdentBlock(n):a.indentBlock(n))return o=r})),o},i.prototype.indentBlock=function(e){var t,r,i,o,a,s,l,u,c,d;if((t=n(e)).length){if(t.is("pre")){if(!(s=this.editable.selection.containerNode()).is(t)&&!s.closest("pre").is(t))return;this.indentText(this.editable.selection.range())}else if(t.is("li")){if((a=t.prev("li")).length<1)return;this.editable.selection.save(),d=t.parent()[0].tagName,(r=a.children("ul, ol")).length>0?r.append(t):n("<"+d+"/>").append(t).appendTo(a),this.editable.selection.restore()}else if(t.is("p, h1, h2, h3, h4"))c=parseInt(t.css("margin-left"))||0,c=(Math.round(c/this.opts.indentWidth)+1)*this.opts.indentWidth,t.css("margin-left",c);else{if(!t.is("table")&&!t.is("."+this.opts.classPrefix+"table"))return!1;if(l=this.editable.selection.containerNode().closest("td, th"),(i=l.next("td, th")).length>0||(u=l.parent("tr"),(o=u.next("tr")).length<1&&u.parent().is("thead")&&(o=u.parent("thead").next("tbody").find("tr:first")),i=o.find("td:first, th:first")),!(l.length>0&&i.length>0))return;this.editable.selection.setRangeAtEndOf(i)}return!0}},i.prototype.indentText=function(e){var t,n;return t=e.toString().replace(/^(?=.+)/gm,"  "),n=document.createTextNode(t||"  "),e.deleteContents(),e.insertNode(n),t?(e.selectNode(n),this.editable.selection.range(e)):this.editable.selection.setRangeAfter(n)},i.prototype.outdentBlock=function(e){var t,r,i,o,a,s,l,u,c,d;if((t=n(e))&&t.length>0){if(t.is("pre")){if(!(o=this.editable.selection.containerNode()).is(t)&&!o.closest("pre").is(t))return;this.outdentText(d)}else if(t.is("li"))r=t.parent(),i=r.parent("li"),this.editable.selection.save(),i.length<1?((d=document.createRange()).setStartBefore(r[0]),d.setEndBefore(t[0]),r.before(d.extractContents()),n("<p/>").insertBefore(r).after(t.children("ul, ol")).append(t.contents()),t.remove()):(t.next("li").length>0&&n("<"+r[0].tagName+"/>").append(t.nextAll("li")).appendTo(t),t.insertAfter(i),r.children("li").length<1&&r.remove()),this.editable.selection.restore();else if(t.is("p, h1, h2, h3, h4"))c=parseInt(t.css("margin-left"))||0,c=Math.max(Math.round(c/this.opts.indentWidth)-1,0)*this.opts.indentWidth,t.css("margin-left",0===c?"":c);else{if(!t.is("table")&&!t.is("."+this.opts.classPrefix+"table"))return!1;if(l=this.editable.selection.containerNode().closest("td, th"),(a=l.prev("td, th")).length>0||(u=l.parent("tr"),(s=u.prev("tr")).length<1&&u.parent().is("tbody")&&(s=u.parent("tbody").prev("thead").find("tr:first")),a=s.find("td:last, th:last")),!(l.length>0&&a.length>0))return;this.editable.selection.setRangeAtEndOf(a)}return!0}},i.prototype.outdentText=function(e){},r.Indentation=i}),t("skylark-domx-contents/Clipboard",["skylark-langx/langx","skylark-domx-query","./contents"],function(e,t,n){var r=e.Evented.inherit({});return r.pluginName="Clipboard",r.prototype.opts={pasteImage:!1,cleanPaste:!1},r.prototype.init=function(t,n){var r;this.editable=t,this.opts=e.extend({},this.opts,n),this.opts.pasteImage&&"string"!=typeof this.opts.pasteImage&&(this.opts.pasteImage="inline"),this.editable.body.on("paste",(r=this,function(e){var t;if(!r.pasting&&!r._pasteBin)return!1!==r.editable.trigger(e)&&(t=r.editable.selection.deleteRangeContents(),r.editable.body.html()?t.collapsed||t.collapse(!0):(r.editable.formatter.format(),r.editable.selection.setRangeAtStartOf(r.editable.body.find("p:first"))),!r._processPasteByClipboardApi(e)&&(r.editable.inputManager.throttledValueChanged.clear(),r.editable.inputManager.throttledSelectionChanged.clear(),r.editable.undoManager.throttledPushState.clear(),r.editable.selection.reset(),r.editable.undoManager.resetCaretPosition(),r.pasting=!0,r._getPasteContent(function(e){return r._processPasteContent(e),r._pasteInBlockEl=null,r._pastePlainText=null,r.pasting=!1})))}))},r.prototype._processPasteByClipboardApi=function(e){var t,n,r,i;if(!this.editable.util.browser.edge&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items&&e.originalEvent.clipboardData.items.length>0&&(n=e.originalEvent.clipboardData.items[0],/^image\//.test(n.type))){if(null==(t=n.getAsFile())||!this.opts.pasteImage)return;if(t.name||(t.name="Clipboard Image.png"),!1===this.editable.triggerHandler("pasting",[t]))return;return(i={})[this.opts.pasteImage]=!0,null!=(r=this.editable.uploader)&&r.upload(t,i),!0}},r.prototype._getPasteContent=function(e){var n,r;return this._pasteBin=t('<div contenteditable="true" />').addClass("paste-bin").attr("tabIndex","-1").appendTo(this.editable.$el),n={html:this.editable.body.html(),caret:this.editable.undoManager.caretPosition()},this._pasteBin.focus(),setTimeout((r=this,function(){var i;return r.editable.body.get(0).innerHTML=n.html,r.editable.undoManager.caretPosition(n.caret),r.editable.body.focus(),r.editable.selection.reset(),r.editable.selection.range(),r._pasteInBlockEl=r.editable.selection.blockNodes().last(),r._pastePlainText=r.opts.cleanPaste||r._pasteInBlockEl.is("pre, table"),r._pastePlainText?i=r.editable.formatter.clearHtml(r._pasteBin.html(),!0):((i=t("<div/>").append(r._pasteBin.contents())).find("style").remove(),i.find("table colgroup").remove(),r._cleanPasteFontSize(i),r.editable.formatter.format(i),r.editable.formatter.decorate(i),r.editable.formatter.beautify(i.children()),i=i.contents()),r._pasteBin.remove(),r._pasteBin=null,e(i)}),0)},r.prototype._processPasteContent=function(e){var n,r,i,o,a,s,l,u,c,d,f,h,p,g,y,m,b,v,k,x,_,w,N,A,E,S;if(!1!==this.editable.trigger("pasting",[e])&&(n=this._pasteInBlockEl,e)){if(this._pastePlainText)if(n.is("table")){for(b=e.split("\n"),d=b.pop(),u=0,f=b.length;u<f;u++)m=b[u],this.editable.selection.insertNode(document.createTextNode(m)),this.editable.selection.insertNode(t("<br/>"));this.editable.selection.insertNode(document.createTextNode(d))}else for(e=t("<div/>").text(e),w=e.contents(),c=0,h=w.length;c<h;c++)k=w[c],this.editable.selection.insertNode(t(k)[0]);else if(n.is(this.editable.body))for(v=0,p=e.length;v<p;v++)k=e[v],this.editable.selection.insertNode(k);else{if(e.length<1)return;if(1===e.length)if(e.is("p")){if(o=e.contents(),n.is("h1, h2, h3, h4, h5")&&o.length&&o.css("font-size",""),1===o.length&&o.is("img")){if(/^data:image/.test((r=o).attr("src"))){if(!this.opts.pasteImage)return;return(i=this.editable.util.dataURLtoBlob(r.attr("src"))).name="Clipboard Image.png",(E={})[this.opts.pasteImage]=!0,void(null!=(N=this.editable.uploader)&&N.upload(i,E))}if(new RegExp("^blob:"+location.origin+"/").test(r.attr("src"))){if(!this.opts.pasteImage)return;return(E={})[this.opts.pasteImage]=!0,a=this.editable.util.dataURLtoBlob,S=this.editable.uploader,(s=new Image).onload=function(){var e;(e=document.createElement("canvas")).width=s.naturalWidth,e.height=s.naturalHeight,e.getContext("2d").drawImage(s,0,0),(i=a(e.toDataURL("image/png"))).name="Clipboard Image.png",null!==S&&S.upload(i,E)},void(s.src=r.attr("src"))}if(r.is('img[src^="webkit-fake-url://"]'))return}for(x=0,g=o.length;x<g;x++)k=o[x],this.editable.selection.insertNode(k)}else if(n.is("p")&&this.editable.util.isEmptyNode(n))n.replaceWith(e),this.editable.selection.setRangeAtEndOf(e);else if(e.is("ul, ol"))if(1===e.find("li").length)for(e=t("<div/>").text(e.text()),A=e.contents(),_=0,y=A.length;_<y;_++)k=A[_],this.editable.selection.insertNode(t(k)[0]);else n.is("li")?(n.parent().after(e),this.editable.selection.setRangeAtEndOf(e)):(n.after(e),this.editable.selection.setRangeAtEndOf(e));else n.after(e),this.editable.selection.setRangeAtEndOf(e);else n.is("li")&&(n=n.parent()),this.editable.selection.rangeAtStartOf(n)?l="before":this.editable.selection.rangeAtEndOf(n)?l="after":(this.editable.selection.breakBlockEl(n),l="before"),n[l](e),this.editable.selection.setRangeAtEndOf(e.last())}return this.editable.inputManager.throttledValueChanged()}},r.prototype._cleanPasteFontSize=function(n){var r,i;if((r=t(n)).length>0)return i=["1.5em","1.25em","0.75em","0.5em"],r.find('[style*="font-size"]').map(function(n,r){var o;if(o=t(r),e.inArray(o.css("font-size"),i)<0)return o.css("font-size","")})},n.Clipboard=r}),t("skylark-domx-contents/Editable",["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","./contents","./Hotkeys","./Util","./InputManager","./Selection","./UndoManager","./Keystroke","./Formatter","./Indentation","./Clipboard"],function(t,n,r,i,o,a,s,l,u,c,d,f,h){var p=t.Evented.inherit({init:function(t,n){this.$el=r(t),this.textarea=r(n.textarea),this.body=r(n.body);var i={classPrefix:n.classPrefix};if(this.util=new a(this,i),this.hotkeys=new o({el:this.body}),this.inputManager=new s(this,i),this.selection=new l(this,i),this.undoManager=new u(this,i),this.keystroke=new c(this,i),this.formatter=new d(this,i),this.indentation=new f(this,i),this.clipboard=new h(this,i),this.util.os.mac?this.$el.addClass(n.classPrefix+"mac"):this.util.os.linux&&this.$el.addClass(n.classPrefix+"linux"),this.util.os.mobile&&this.$el.addClass(n.classPrefix+"mobile"),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){e=t}}},setValue:function(e){this.textarea.val(e),this.body.get(0).innerHTML=e,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null},getValue:function(){return this.sync()},sync:function(){var e,n,r,i,o,a;for(n=this.body.clone(),this.formatter.undecorate(n),this.formatter.format(n),this.formatter.autolink(n),e=n.children(),o=e.last("p"),i=e.first("p");o.is("p")&&this.util.isEmptyNode(o);)r=o,o=o.prev("p"),r.remove();for(;i.is("p")&&this.util.isEmptyNode(i);)r=i,i=o.next("p"),r.remove();return n.find("img.uploading").remove(),a=t.trim(n.html()),this.textarea.val(a),a},focus:function(){var e,t;if(this.body.is(":visible")&&this.body.is("[contenteditable]"))return this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):((e=this.body.children().last()).is("p")||(e=r("<p/>").append(this.util.phBr).appendTo(this.body)),t=document.createRange(),this.selection.setRangeAtEndOf(e,t));this.$el.find("textarea:visible").focus()},blur:function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},isActive:function(e){return!0===document.queryCommandState(e)},status:function(e,t){if("alignment"===e){var n=this.selection.nodes().filter(t);return n.length<1?null:n.first().css("text-align")}},alignment:function(e,t){if("left"!==e&&"center"!==e&&"right"!==e)throw new Error("simditor alignment button: invalid align "+e);var n=this.selection.nodes().filter(t);return n.css({"text-align":"left"===e?"":e}),this.trigger("valuechanged"),this.inputManager.throttledSelectionChanged()},blockquote:function(e){var t,n,i,o;return t=(t=this.selection.rootNodes()).filter(function(e,t){return!r(t).parent().is("blockquote")}),this.selection.save(),i=[],n=function(){if(i.length>0)return r("<blockquote/>").insertBefore(i[0]).append(i),i.length=0},t.each((o=this,function(t,a){var s;if((s=r(a)).parent().is(o.body))return s.is("blockquote")?(n(),s.children().unwrap()):s.is(e)||o.util.isDecoratedNode(s)?n():i.push(a)})),n(),this.selection.restore(),this.trigger("valuechanged")},blockCode:function(e,t){var n,i,o,a,s;return n=this.selection.rootNodes(),o=[],a=[],s=this,i=function(){var t;if(o.length>0)return t=r("<"+e+"/>").insertBefore(o[0]).text(s.formatter.clearHtml(o)),a.push(t[0]),o.length=0},n.each(function(n){return function(s,l){var u,c;return(u=r(l)).is(e)?(i(),c=r("<p/>").append(u.html().replace("\n","<br/>")).replaceAll(u),a.push(c[0])):u.is(t)||n.util.isDecoratedNode(u)||u.is("blockquote")?i():o.push(l)}}(this)),i(),this.selection.setRangeAtEndOf(r(a).last()),this.trigger("valuechanged")},fontColor:function(e,t,n){var r=this.selection.range();if(!t&&r.collapsed&&(textNode=document.createTextNode(n),r.insertNode(textNode),r.selectNodeContents(textNode)),this.selection.range(r),document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,e),document.execCommand("styleWithCSS",!1,!1),!this.util.support.oninput)return this.trigger("valuechanged")},fontScale:function(e,t){var n,i;if(t||(t={"x-large":"1.5em",large:"1.25em",small:".75em","x-small":".5em"}),!(i=this.selection.range()).collapsed)return this.selection.range(i),document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,e),document.execCommand("styleWithCSS",!1,!1),this.selection.reset(),this.selection.range(),n=this.selection.containerNode(),(n[0].nodeType===Node.TEXT_NODE?n.closest('span[style*="font-size"]'):n.find('span[style*="font-size"]')).each(function(e,n){var i,o;return i=r(n),o=n.style.fontSize,/large|x-large|small|x-small/.test(o)?i.css("fontSize",t[o]):"medium"===o?i[0].style.length>1?i.css("fontSize",""):i.replaceWith(i.contents()):void 0}),this.trigger("valuechanged")},hr:function(){var e,t,n;return n=this.selection.rootNodes().first(),n.next().length>0?this.selection.save():t=r("<p/>").append(this.util.phBr),e=r("<hr/>").insertAfter(n),t?(t.insertAfter(e),this.selection.setRangeAtStartOf(t)):this.selection.restore(),this.trigger("valuechanged")},inlineCode:function(e){var t,n,i;return i=this.selection.range(),this.active?(i.selectNodeContents(this.node[0]),this.selection.save(i),this.node.contents().unwrap(),this.selection.restore()):(n=r(i.extractContents()),t=r("<"+this.htmlTag+"/>").append(n.contents()),i.insertNode(t[0]),i.selectNodeContents(t[0]),this.selection.range(i)),this.trigger("valuechanged")},indent:function(){return this.indentation.indent()},link:function(e,t){var n,i,o,a,s,l;if(s=this.selection.range(),e){var u=this.selection.startNodes();l=document.createTextNode(u.text()),u.replaceWith(l),s.selectNode(l)}else n=r(s.extractContents()),a=this.formatter.clearHtml(n.contents(),!1),i=r("<a/>",{href:"",target:"_blank",text:a||t}),this.selection.blockNodes().length>0?s.insertNode(i[0]):(o=r("<p/>").append(i),s.insertNode(o[0])),s.selectNodeContents(i[0]);return this.selection.range(s),this.trigger("valuechanged")},list:function(e,t,i){var o,a,s,l;return a=this.selection.blockNodes(),s="ul"===e?"ol":"ul",this.selection.save(),o=null,a.each((l=this,function(t,a){var u;if(!((u=r(a)).is("blockquote, li")||u.is(i)||l.util.isDecoratedNode(u))&&n.contains(document,a))return u.is(e)?(u.children("li").each(function(e,t){return r(t).children("ul, ol").insertAfter(u),r("<p/>").append(r(t).html()||l.util.phBr).insertBefore(u)}),u.remove()):u.is(s)?r("<"+e+"/>").append(u.contents()).replaceAll(u):o&&u.prev().is(o)?(r("<li/>").append(u.html()||l.util.phBr).appendTo(o),u.remove()):((o=r("<"+e+"><li></li></"+e+">")).find("li").append(u.html()||l.util.phBr),o.replaceAll(u))})),this.selection.restore(),this.trigger("valuechanged")},outdent:function(){return this.indentation.indent(!0)},title:function(e,t){return document.execCommand("formatBlock",!1,e),this.trigger("valuechanged")}});return["bold","insertImage","insertorderedlist","insertunorderedlist","italic","justifyLeft","justifyCenter","justifyFull","justifyRight","strikethrough","underline","undo"].forEach(function(e){p.prototype[e]=function(){return document.execCommand(e,!1,null),this.util.support.oninput||this.trigger("valuechanged"),r(document).trigger("selectionchange")}}),i.Editable=p}),t("skylark-domx-contents/main",["./contents","./Editable"],function(e){return e}),t("skylark-domx-contents",["skylark-domx-contents/main"],function(e){return e})}(r,require),!o){var l=require("skylark-langx/skylark");a?module.exports=l:n.skylarkjs=l}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-domx-contents-all.js.map
