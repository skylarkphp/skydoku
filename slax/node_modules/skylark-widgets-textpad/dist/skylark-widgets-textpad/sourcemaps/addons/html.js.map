{"version":3,"sources":["addons/html.js"],"names":["define","$","Editor","addon","init","editor","addAction","listfn","tag","getCursorMode","cm","doc","getDoc","pos","getCursor","posend","im","CodeMirror","innerMode","getMode","getTokenAt","state","inList","context","indexOf","tagName","i","line","replaceRange","getLine","ch","length","setCursor","focus","name","replace","mode","on","htmleditor","toggleClass","wrap","getWrapperElement","hasClass","fullScreenRestore","scrollTop","window","pageYOffset","scrollLeft","pageXOffset","width","style","height","content","document","documentElement","overflow","info","scrollTo","setTimeout","fit","trigger","addShortcut","element","addShortcutAction"],"mappings":"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","file":"../../addons/html.js","sourcesContent":["define([\r\n    \"skylark-domx-query\",\r\n    \"../Editor\"\r\n],function($,Editor){\r\n    Editor.addon('base', {\r\n        init: function(editor) {\r\n\r\n            addAction('bold', '<strong>$1</strong>');\r\n            addAction('italic', '<em>$1</em>');\r\n            addAction('strike', '<del>$1</del>');\r\n            addAction('blockquote', '<blockquote><p>$1</p></blockquote>', 'replaceLine');\r\n            addAction('link', '<a href=\"http://\">$1</a>');\r\n            addAction('image', '<img src=\"http://\" alt=\"$1\">');\r\n\r\n            var listfn = function(tag) {\r\n                if (editor.getCursorMode() == 'html') {\r\n\r\n                    tag = tag || 'ul';\r\n\r\n                    var cm        = editor.editor,\r\n                        doc       = cm.getDoc(),\r\n                        pos       = doc.getCursor(true),\r\n                        posend    = doc.getCursor(false),\r\n                        im        = CodeMirror.innerMode(cm.getMode(), cm.getTokenAt(cm.getCursor()).state),\r\n                        inList    = im && im.state && im.state.context && ['ul','ol'].indexOf(im.state.context.tagName) != -1;\r\n\r\n                    for (var i=pos.line; i<(posend.line+1);i++) {\r\n                        cm.replaceRange('<li>'+cm.getLine(i)+'</li>', { line: i, ch: 0 }, { line: i, ch: cm.getLine(i).length });\r\n                    }\r\n\r\n                    if (!inList) {\r\n                        cm.replaceRange('<'+tag+'>'+\"\\n\"+cm.getLine(pos.line), { line: pos.line, ch: 0 }, { line: pos.line, ch: cm.getLine(pos.line).length });\r\n                        cm.replaceRange(cm.getLine((posend.line+1))+\"\\n\"+'</'+tag+'>', { line: (posend.line+1), ch: 0 }, { line: (posend.line+1), ch: cm.getLine((posend.line+1)).length });\r\n                        cm.setCursor({ line: posend.line+1, ch: cm.getLine(posend.line+1).length });\r\n                    } else {\r\n                        cm.setCursor({ line: posend.line, ch: cm.getLine(posend.line).length });\r\n                    }\r\n\r\n                    cm.focus();\r\n                }\r\n            };\r\n\r\n            editor.on('action.listUl', function() {\r\n                listfn('ul');\r\n            });\r\n\r\n            editor.on('action.listOl', function() {\r\n                listfn('ol');\r\n            });\r\n\r\n            editor.htmleditor.on('click', 'a[data-htmleditor-button=\"fullscreen\"]', function() {\r\n                editor.htmleditor.toggleClass('uk-htmleditor-fullscreen');\r\n\r\n                var wrap = editor.editor.getWrapperElement();\r\n\r\n                if (editor.htmleditor.hasClass('uk-htmleditor-fullscreen')) {\r\n\r\n                    editor.editor.state.fullScreenRestore = {scrollTop: window.pageYOffset, scrollLeft: window.pageXOffset, width: wrap.style.width, height: wrap.style.height};\r\n                    wrap.style.width  = '';\r\n                    wrap.style.height = editor.content.height()+'px';\r\n                    document.documentElement.style.overflow = 'hidden';\r\n\r\n                } else {\r\n\r\n                    document.documentElement.style.overflow = '';\r\n                    var info = editor.editor.state.fullScreenRestore;\r\n                    wrap.style.width = info.width; wrap.style.height = info.height;\r\n                    window.scrollTo(info.scrollLeft, info.scrollTop);\r\n                }\r\n\r\n                setTimeout(function() {\r\n                    editor.fit();\r\n                    $(window).trigger('resize');\r\n                }, 50);\r\n            });\r\n\r\n            editor.addShortcut(['Ctrl-S', 'Cmd-S'], function() { editor.element.trigger('htmleditor-save', [editor]); });\r\n            editor.addShortcutAction('bold', ['Ctrl-B', 'Cmd-B']);\r\n\r\n            function addAction(name, replace, mode) {\r\n                editor.on('action.'+name, function() {\r\n                    if (editor.getCursorMode() == 'html') {\r\n                        editor[mode == 'replaceLine' ? 'replaceLine' : 'replaceSelection'](replace);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n});\r\n"]}