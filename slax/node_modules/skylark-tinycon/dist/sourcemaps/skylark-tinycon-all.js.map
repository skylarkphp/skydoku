{"version":3,"sources":["skylark-tinycon-all.js"],"names":["define","obj1","path","obj2","split","length","ns","i","name","_attach","skylark","attach","obj","agent","Tinycon","currentFavicon","originalFavicon","faviconImage","canvas","options","r","window","devicePixelRatio","size","defaults","width","height","font","color","background","fallback","crossOrigin","abbreviate","ua","navigator","userAgent","toLowerCase","browser","indexOf","ie","chrome","webkit","safari","mozilla","getCurrentFavicon","tag","links","document","getElementsByTagName","len","getAttribute","match","getFaviconTag","getCanvas","createElement","setFaviconTag","url","head","exists","removeChild","removeFaviconTag","link","type","rel","href","appendChild","updateTitle","label","originalTitle","title","slice","drawBubble","context","abbreviateNumber","top","left","bottom","right","radius","fillStyle","strokeStyle","lineWidth","beginPath","moveTo","quadraticCurveTo","lineTo","closePath","fill","stroke","textAlign","textBaseline","fillText","refreshFavicon","getContext","toDataURL","metricPrefixes","round","value","precision","number","Number","toFixed","setOptions","custom","key","colour","hasOwnProperty","this","setImage","setBubble","src","onload","clearRect","drawImage","drawFavicon","reset","tinycon","main"],"mappings":"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","file":"../skylark-tinycon-all.js","sourcesContent":["define('skylark-langx/_attach',[],function(){\r\n    return  function attach(obj1,path,obj2) {\r\n        if (typeof path == \"string\") {\r\n            path = path.split(\".\");//[path]\r\n        };\r\n        var length = path.length,\r\n            ns=obj1,\r\n            i=0,\r\n            name = path[i++];\r\n\r\n        while (i < length) {\r\n            ns = ns[name] = ns[name] || {};\r\n            name = path[i++];\r\n        }\r\n\r\n        return ns[name] = obj2;\r\n    }\r\n});\ndefine('skylark-langx/skylark',[\r\n    \"./_attach\"\r\n], function(_attach) {\r\n    var skylark = {\r\n    \tattach : function(path,obj) {\r\n    \t\treturn _attach(skylark,path,obj);\r\n    \t}\r\n    };\r\n    return skylark;\r\n});\r\n\ndefine('skylark-tinycon/tinycon',[\n  \"skylark-langx/skylark\"\n],function(skylark) {\n  var Tinycon = {};\n  var currentFavicon = null;\n  var originalFavicon = null;\n  var faviconImage = null;\n  var canvas = null;\n  var options = {};\n  var r = window.devicePixelRatio || 1;\n  var size = 16 * r;\n  var defaults = {\n    width: 7,\n    height: 9,\n    font: 10 * r + 'px arial',\n    color: '#ffffff',\n    background: '#F03D25',\n    fallback: true,\n    crossOrigin: true,\n    abbreviate: true\n  };\n\n  var ua = (function () {\n    var agent = navigator.userAgent.toLowerCase();\n    // New function has access to 'agent' via closure\n    return function (browser) {\n      return agent.indexOf(browser) !== -1;\n    };\n  }());\n\n  var browser = {\n    ie: ua('trident'),\n    chrome: ua('chrome'),\n    webkit: ua('chrome') || ua('safari'),\n    safari: ua('safari') && !ua('chrome'),\n    mozilla: ua('mozilla') && !ua('chrome') && !ua('safari')\n  };\n\n  // private methods\n  var getFaviconTag = function(){\n\n    var links = document.getElementsByTagName('link');\n\n    for(var i=0, len=links.length; i < len; i++) {\n      if ((links[i].getAttribute('rel') || '').match(/\\bicon\\b/i)) {\n        return links[i];\n      }\n    }\n\n    return false;\n  };\n\n  var removeFaviconTag = function(){\n\n    var links = document.getElementsByTagName('link');\n    var head = document.getElementsByTagName('head')[0];\n\n    for(var i=0, len=links.length; i < len; i++) {\n      var exists = (typeof(links[i]) !== 'undefined');\n      if (exists && (links[i].getAttribute('rel') || '').match(/\\bicon\\b/i)) {\n        head.removeChild(links[i]);\n      }\n    }\n  };\n\n  var getCurrentFavicon = function(){\n\n    if (!originalFavicon || !currentFavicon) {\n      var tag = getFaviconTag();\n      currentFavicon = tag ? tag.getAttribute('href') : '/favicon.ico';\n      if (!originalFavicon) {\n        originalFavicon = currentFavicon;\n      }\n    }\n\n    return currentFavicon;\n  };\n\n  var getCanvas = function (){\n\n    if (!canvas) {\n      canvas = document.createElement(\"canvas\");\n      canvas.width = size;\n      canvas.height = size;\n    }\n\n    return canvas;\n  };\n\n  var setFaviconTag = function(url){\n    if(url){\n      removeFaviconTag();\n\n      var link = document.createElement('link');\n      link.type = 'image/x-icon';\n      link.rel = 'icon';\n      link.href = url;\n      document.getElementsByTagName('head')[0].appendChild(link);\n    }\n  };\n\n  var log = function(message){\n    if (window.console) window.console.log(message);\n  };\n\n  var drawFavicon = function(label, color) {\n\n    // fallback to updating the browser title if unsupported\n    if (!getCanvas().getContext || browser.ie || browser.safari || options.fallback === 'force') {\n      return updateTitle(label);\n    }\n\n    var context = getCanvas().getContext(\"2d\");\n    var color = color || '#000000';\n    var src = getCurrentFavicon();\n\n    faviconImage = document.createElement('img');\n    faviconImage.onload = function() {\n\n      // clear canvas\n      context.clearRect(0, 0, size, size);\n\n      // draw the favicon\n      context.drawImage(faviconImage, 0, 0, faviconImage.width, faviconImage.height, 0, 0, size, size);\n\n      // draw bubble over the top\n      if ((label + '').length > 0) drawBubble(context, label, color);\n\n      // refresh tag in page\n      refreshFavicon();\n    };\n\n    // allow cross origin resource requests if the image is not a data:uri\n    // as detailed here: https://github.com/mrdoob/three.js/issues/1305\n    if (!src.match(/^data/) && options.crossOrigin) {\n      faviconImage.crossOrigin = 'anonymous';\n    }\n\n    faviconImage.src = src;\n  };\n\n  var updateTitle = function(label) {\n\n    if (options.fallback) {\n      // Grab the current title that we can prefix with the label\n      var originalTitle = document.title;\n\n      // Strip out the old label if there is one\n      if (originalTitle[0] === '(') {\n        originalTitle = originalTitle.slice(originalTitle.indexOf(' '));\n      }\n\n      if ((label + '').length > 0) {\n        document.title = '(' + label + ') ' + originalTitle;\n      } else {\n        document.title = originalTitle;\n      }\n    }\n  };\n\n  var drawBubble = function(context, label, color) {\n\n    // automatic abbreviation for long (>2 digits) numbers\n    if (typeof label == 'number' && label > 99 && options.abbreviate) {\n      label = abbreviateNumber(label);\n    }\n\n    // bubble needs to be larger for double digits\n    var len = (label + '').length-1;\n\n    var width = options.width * r + (6 * r * len),\n      height = options.height * r;\n\n    var top = size - height,\n            left = size - width - r,\n            bottom = 16 * r,\n            right = 16 * r,\n            radius = 2 * r;\n\n    // webkit seems to render fonts lighter than firefox\n    context.font = (browser.webkit ? 'bold ' : '') + options.font;\n    context.fillStyle = options.background;\n    context.strokeStyle = options.background;\n    context.lineWidth = r;\n\n    // bubble\n    context.beginPath();\n        context.moveTo(left + radius, top);\n    context.quadraticCurveTo(left, top, left, top + radius);\n    context.lineTo(left, bottom - radius);\n        context.quadraticCurveTo(left, bottom, left + radius, bottom);\n        context.lineTo(right - radius, bottom);\n        context.quadraticCurveTo(right, bottom, right, bottom - radius);\n        context.lineTo(right, top + radius);\n        context.quadraticCurveTo(right, top, right - radius, top);\n        context.closePath();\n        context.fill();\n\n    // bottom shadow\n    context.beginPath();\n    context.strokeStyle = \"rgba(0,0,0,0.3)\";\n    context.moveTo(left + radius / 2.0, bottom);\n    context.lineTo(right - radius / 2.0, bottom);\n    context.stroke();\n\n    // label\n    context.fillStyle = options.color;\n    context.textAlign = \"right\";\n    context.textBaseline = \"top\";\n\n    // unfortunately webkit/mozilla are a pixel different in text positioning\n    context.fillText(label, r === 2 ? 29 : 15, browser.mozilla ? 7*r : 6*r);\n  };\n\n  var refreshFavicon = function(){\n    // check support\n    if (!getCanvas().getContext) return;\n\n    setFaviconTag(getCanvas().toDataURL());\n  };\n\n  var abbreviateNumber = function(label) {\n    var metricPrefixes = [\n      ['G', 1000000000],\n      ['M',    1000000],\n      ['k',       1000]\n    ];\n\n    for(var i = 0; i < metricPrefixes.length; ++i) {\n      if (label >= metricPrefixes[i][1]) {\n        label = round(label / metricPrefixes[i][1]) + metricPrefixes[i][0];\n        break;\n      }\n    }\n\n    return label;\n  };\n\n  var round = function (value, precision) {\n    var number = new Number(value);\n    return number.toFixed(precision);\n  };\n\n  // public methods\n  Tinycon.setOptions = function(custom){\n    options = {};\n\n    // account for deprecated UK English spelling\n    if (custom.colour) {\n      custom.color = custom.colour;\n    }\n\n    for(var key in defaults){\n      options[key] = custom.hasOwnProperty(key) ? custom[key] : defaults[key];\n    }\n    return this;\n  };\n\n  Tinycon.setImage = function(url){\n    currentFavicon = url;\n    refreshFavicon();\n    return this;\n  };\n\n  Tinycon.setBubble = function(label, color) {\n    label = label || '';\n    drawFavicon(label, color);\n    return this;\n  };\n\n  Tinycon.reset = function(){\n    currentFavicon = originalFavicon;\n    setFaviconTag(originalFavicon);\n  };\n\n  Tinycon.setOptions(defaults);\n\n  return skylark.attach(\"itg.tinycon\",Tinycon);\n});\n\ndefine('skylark-tinycon/main',[\r\n\t\"./tinycon\"\r\n],function(tinycon){\r\n\treturn tinycon;\r\n});\ndefine('skylark-tinycon', ['skylark-tinycon/main'], function (main) { return main; });\n\n"]}