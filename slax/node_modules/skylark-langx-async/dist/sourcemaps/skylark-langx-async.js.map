{"version":3,"sources":["skylark-langx-async.js"],"names":["define","arrays","funcs","objects","PGLISTENERS","Symbol","PGNOTIFIES","slice","Array","prototype","proxy","makeArray","result","mixin","Promise","always","handler","this","then","done","i","arguments","length","fail","catch","Deferred","self","p","promise","resolve","reject","_resolve","_reject","wrapPromise","d","added","state","isResolved","isRejected","onResolved","onRejected","onProgress","progress","call","args","undefined","__ctx__","apply","forEach","value","push","pipe","resolveWith","context","_resolved","notify","listener","error","reason","rejectWith","_rejected","callback","errback","progback","all","array","bind","first","race","when","valueOrPromise","receivedPromise","nativePromise","deferred","cancel","err","immediate","data","skylark","each","async","parallel","arr","ctx","rets","func","series","waterful","attach","main"],"mappings":"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","file":"../skylark-langx-async.js","sourcesContent":["define('skylark-langx-async/Deferred',[\r\n    \"skylark-langx-arrays\",\r\n\t\"skylark-langx-funcs\",\r\n    \"skylark-langx-objects\"\r\n],function(arrays,funcs,objects){\r\n    \"use strict\";\r\n    \r\n    var  PGLISTENERS = Symbol ? Symbol() : '__pglisteners',\r\n         PGNOTIFIES = Symbol ? Symbol() : '__pgnotifies';\r\n\r\n    var slice = Array.prototype.slice,\r\n        proxy = funcs.proxy,\r\n        makeArray = arrays.makeArray,\r\n        result = objects.result,\r\n        mixin = objects.mixin;\r\n\r\n    mixin(Promise.prototype,{\r\n        always: function(handler) {\r\n            //this.done(handler);\r\n            //this.fail(handler);\r\n            this.then(handler,handler);\r\n            return this;\r\n        },\r\n        done : function() {\r\n            for (var i = 0;i<arguments.length;i++) {\r\n                this.then(arguments[i]);\r\n            }\r\n            return this;\r\n        },\r\n        fail : function(handler) { \r\n            //return mixin(Promise.prototype.catch.call(this,handler),added);\r\n            //return this.then(null,handler);\r\n            this.catch(handler);\r\n            return this;\r\n         }\r\n    });\r\n\r\n\r\n    var Deferred = function() {\r\n        var self = this,\r\n            p = this.promise = new Promise(function(resolve, reject) {\r\n                self._resolve = resolve;\r\n                self._reject = reject;\r\n            });\r\n\r\n        wrapPromise(p,self);\r\n\r\n        this[PGLISTENERS] = [];\r\n        this[PGNOTIFIES] = [];\r\n\r\n        //this.resolve = Deferred.prototype.resolve.bind(this);\r\n        //this.reject = Deferred.prototype.reject.bind(this);\r\n        //this.progress = Deferred.prototype.progress.bind(this);\r\n\r\n    };\r\n\r\n    function wrapPromise(p,d) {\r\n        var   added = {\r\n                state : function() {\r\n                    if (d.isResolved()) {\r\n                        return 'resolved';\r\n                    }\r\n                    if (d.isRejected()) {\r\n                        return 'rejected';\r\n                    }\r\n                    return 'pending';\r\n                },\r\n                then : function(onResolved,onRejected,onProgress) {\r\n                    if (onProgress) {\r\n                        this.progress(onProgress);\r\n                    }\r\n                    return wrapPromise(Promise.prototype.then.call(this,\r\n                            onResolved && function(args) {\r\n                                if (args && args.__ctx__ !== undefined) {\r\n                                    return onResolved.apply(args.__ctx__,args);\r\n                                } else {\r\n                                    return onResolved(args);\r\n                                }\r\n                            },\r\n                            onRejected && function(args){\r\n                                if (args && args.__ctx__ !== undefined) {\r\n                                    return onRejected.apply(args.__ctx__,args);\r\n                                } else {\r\n                                    return onRejected(args);\r\n                                }\r\n                            }));\r\n                },\r\n                progress : function(handler) {\r\n                    d[PGNOTIFIES].forEach(function (value) {\r\n                        handler(value);\r\n                    });\r\n                    d[PGLISTENERS].push(handler);\r\n                    return this;\r\n                }\r\n\r\n            };\r\n\r\n        added.pipe = added.then;\r\n        return mixin(p,added);\r\n\r\n    }\r\n\r\n    Deferred.prototype.resolve = function(value) {\r\n        var args = slice.call(arguments);\r\n        return this.resolveWith(null,args);\r\n    };\r\n\r\n    Deferred.prototype.resolveWith = function(context,args) {\r\n        args = args ? makeArray(args) : []; \r\n        args.__ctx__ = context;\r\n        this._resolve(args);\r\n        this._resolved = true;\r\n        return this;\r\n    };\r\n\r\n    Deferred.prototype.notify = function(value) {\r\n        try {\r\n            this[PGNOTIFIES].push(value);\r\n\r\n            return this[PGLISTENERS].forEach(function (listener) {\r\n                return listener(value);\r\n            });\r\n        } catch (error) {\r\n          this.reject(error);\r\n        }\r\n        return this;\r\n    };\r\n\r\n    Deferred.prototype.reject = function(reason) {\r\n        var args = slice.call(arguments);\r\n        return this.rejectWith(null,args);\r\n    };\r\n\r\n    Deferred.prototype.rejectWith = function(context,args) {\r\n        args = args ? makeArray(args) : []; \r\n        args.__ctx__ = context;\r\n        this._reject(args);\r\n        this._rejected = true;\r\n        return this;\r\n    };\r\n\r\n    Deferred.prototype.isResolved = function() {\r\n        return !!this._resolved;\r\n    };\r\n\r\n    Deferred.prototype.isRejected = function() {\r\n        return !!this._rejected;\r\n    };\r\n\r\n    Deferred.prototype.then = function(callback, errback, progback) {\r\n        var p = result(this,\"promise\");\r\n        return p.then(callback, errback, progback);\r\n    };\r\n\r\n    Deferred.prototype.progress = function(progback){\r\n        var p = result(this,\"promise\");\r\n        return p.progress(progback);\r\n    };\r\n   \r\n    Deferred.prototype.catch = function(errback) {\r\n        var p = result(this,\"promise\");\r\n        return p.catch(errback);\r\n    };\r\n\r\n\r\n    Deferred.prototype.done  = function() {\r\n        var p = result(this,\"promise\");\r\n        return p.done.apply(p,arguments);\r\n    };\r\n\r\n    Deferred.prototype.fail = function(errback) {\r\n        var p = result(this,\"promise\");\r\n        return p.fail(errback);\r\n    };\r\n\r\n\r\n    Deferred.all = function(array) {\r\n        //return wrapPromise(Promise.all(array));\r\n        var d = new Deferred();\r\n        Promise.all(array).then(d.resolve.bind(d),d.reject.bind(d));\r\n        return result(d,\"promise\");\r\n    };\r\n\r\n    Deferred.first = function(array) {\r\n        return wrapPromise(Promise.race(array));\r\n    };\r\n\r\n\r\n    Deferred.when = function(valueOrPromise, callback, errback, progback) {\r\n        var receivedPromise = valueOrPromise && typeof valueOrPromise.then === \"function\";\r\n        var nativePromise = receivedPromise && valueOrPromise instanceof Promise;\r\n\r\n        if (!receivedPromise) {\r\n            if (arguments.length > 1) {\r\n                return callback ? callback(valueOrPromise) : valueOrPromise;\r\n            } else {\r\n                return new Deferred().resolve(valueOrPromise);\r\n            }\r\n        } else if (!nativePromise) {\r\n            var deferred = new Deferred(valueOrPromise.cancel);\r\n            valueOrPromise.then(proxy(deferred.resolve,deferred), proxy(deferred.reject,deferred), deferred.notify);\r\n            valueOrPromise = deferred.promise;\r\n        }\r\n\r\n        if (callback || errback || progback) {\r\n            return valueOrPromise.then(callback, errback, progback);\r\n        }\r\n        return valueOrPromise;\r\n    };\r\n\r\n    Deferred.reject = function(err) {\r\n        var d = new Deferred();\r\n        d.reject(err);\r\n        return d.promise;\r\n    };\r\n\r\n    Deferred.resolve = function(data) {\r\n        var d = new Deferred();\r\n        d.resolve.apply(d,arguments);\r\n        return d.promise;\r\n    };\r\n\r\n    Deferred.immediate = Deferred.resolve;\r\n\r\n    return Deferred;\r\n});\ndefine('skylark-langx-async/async',[\r\n    \"skylark-langx-ns\",\r\n    \"skylark-langx-objects\",\r\n    \"./Deferred\"\r\n],function(skylark,objects,Deferred){\r\n    var each = objects.each;\r\n    \r\n    var async = {\r\n        Deferred : Deferred,\r\n\r\n        parallel : function(arr,args,ctx) {\r\n            var rets = [];\r\n            ctx = ctx || null;\r\n            args = args || [];\r\n\r\n            each(arr,function(i,func){\r\n                rets.push(func.apply(ctx,args));\r\n            });\r\n\r\n            return Deferred.all(rets);\r\n        },\r\n\r\n        series : function(arr,args,ctx) {\r\n            var rets = [],\r\n                d = new Deferred(),\r\n                p = d.promise;\r\n\r\n            ctx = ctx || null;\r\n            args = args || [];\r\n\r\n            d.resolve();\r\n            each(arr,function(i,func){\r\n                p = p.then(function(){\r\n                    return func.apply(ctx,args);\r\n                });\r\n                rets.push(p);\r\n            });\r\n\r\n            return Deferred.all(rets);\r\n        },\r\n\r\n        waterful : function(arr,args,ctx) {\r\n            var d = new Deferred(),\r\n                p = d.promise;\r\n\r\n            ctx = ctx || null;\r\n            args = args || [];\r\n\r\n            d.resolveWith(ctx,args);\r\n\r\n            each(arr,function(i,func){\r\n                p = p.then(func);\r\n            });\r\n            return p;\r\n        }\r\n    };\r\n\r\n\treturn skylark.attach(\"langx.async\",async);\t\r\n});\ndefine('skylark-langx-async/main',[\r\n\t\"./async\"\r\n],function(async){\r\n\treturn async;\r\n});\ndefine('skylark-langx-async', ['skylark-langx-async/main'], function (main) { return main; });\n\n"]}