/**
 * skylark-io-streams - The stream features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","./streams","./DecodeStream"],function(r,t,e,s){var i=s.inherit({klassName:"PredictorStream",init:function(r,t){var e=this.predictor=t.get("Predictor")||1;if(e<=1)return r;2!==e&&(e<10||e>15)&&error("Unsupported predictor: "+e),this.readBlock=2===e?this.readBlockTiff:this.readBlockPng,this.stream=r,this.dict=r.dict;var i=this.colors=t.get("Colors")||1,a=this.bits=t.get("BitsPerComponent")||8,o=this.columns=t.get("Columns")||1;this.pixBytes=i*a+7>>3,this.rowBytes=o*i*a+7>>3,s.prototype.init.call(this)},readBlockTiff:function(){var r=this.rowBytes,t=this.bufferLength,e=this.ensureBuffer(t+r),s=this.bits,i=this.colors,a=this.stream.getBytes(r),o=0,f=0,n=0,h=0,c=t;if(1===s)for(var l=0;l<r;++l){var u=a[l];o=o<<8|u,e[c++]=255&(u^o>>i),o&=65535}else if(8===s){for(l=0;l<i;++l)e[c++]=a[l];for(;l<r;++l)e[c]=e[c-i]+a[l],c++}else{var d=new Uint8Array(i+1),g=(1<<s)-1,k=0,B=t,v=this.columns;for(l=0;l<v;++l)for(var y=0;y<i;++y)n<s&&(o=o<<8|255&a[k++],n+=8),d[y]=d[y]+(o>>n-s)&g,n-=s,f=f<<s|d[y],(h+=s)>=8&&(e[B++]=f>>h-8&255,h-=8);h>0&&(e[B++]=(f<<8-h)+(o&(1<<8-h)-1))}this.bufferLength+=r},readBlockPng:function(){var r=this.rowBytes,t=this.pixBytes,e=this.stream.getByte(),s=this.stream.getBytes(r),i=this.bufferLength,a=this.ensureBuffer(i+r),o=a.subarray(i-r,i);0==o.length&&(o=new Uint8Array(r));var f=i;switch(e){case 0:for(var n=0;n<r;++n)a[f++]=s[n];break;case 1:for(n=0;n<t;++n)a[f++]=s[n];for(;n<r;++n)a[f]=a[f-t]+s[n]&255,f++;break;case 2:for(n=0;n<r;++n)a[f++]=o[n]+s[n]&255;break;case 3:for(n=0;n<t;++n)a[f++]=(o[n]>>1)+s[n];for(;n<r;++n)a[f]=(o[n]+a[f-t]>>1)+s[n]&255,f++;break;case 4:for(n=0;n<t;++n){var h=o[n],c=s[n];a[f++]=h+c}for(;n<r;++n){h=o[n];var l=o[n-t],u=a[f-t],d=u+h-l,g=d-u;g<0&&(g=-g);var k=d-h;k<0&&(k=-k);var B=d-l;B<0&&(B=-B);c=s[n];a[f++]=g<=k&&g<=B?u+c:k<=B?h+c:l+c}break;default:error("Unsupported predictor: "+e)}this.bufferLength+=r}});return e.PredictorStream=i});
//# sourceMappingURL=sourcemaps/PredictorStream.js.map
